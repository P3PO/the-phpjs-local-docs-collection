<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usage &mdash; Silex 1.2.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Silex 1.2.1 documentation" href="index.html" />
    <link rel="next" title="Middlewares" href="middlewares.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="middlewares.html" title="Middlewares"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Silex 1.2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>This chapter describes how to use Silex.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>If you want to get started fast, <a class="reference external" href="http://silex.sensiolabs.org/download">download</a> Silex as an archive and extract
it, you should have the following directory structure:</p>
<div class="highlight-text"><div class="highlight"><pre>├── composer.json
├── composer.lock
├── vendor
│   └── ...
└── web
    └── index.php
</pre></div>
</div>
<p>If you want more flexibility, use <a class="reference external" href="http://getcomposer.org/">Composer</a> instead. Create a
<tt class="docutils literal"><span class="pre">composer.json</span></tt> file and put this in it:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
    <span class="nt">&quot;require&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;silex/silex&quot;</span><span class="p">:</span> <span class="s2">&quot;~2.0&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And run Composer to install Silex and all its dependencies:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>curl -s http://getcomposer.org/installer | php
<span class="nv">$ </span>php composer.phar install
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">By default, Silex relies on the stable Symfony components. If you want to
use their master version instead, add <tt class="docutils literal"><span class="pre">&quot;minimum-stability&quot;:</span> <span class="pre">&quot;dev&quot;</span></tt> in
your <tt class="docutils literal"><span class="pre">composer.json</span></tt> file.</p>
</div>
</div>
<div class="section" id="upgrading">
<h2>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h2>
<p>Upgrading Silex to the latest version is as easy as running the <tt class="docutils literal"><span class="pre">update</span></tt>
command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php composer.phar update
</pre></div>
</div>
</div>
<div class="section" id="bootstrap">
<h2>Bootstrap<a class="headerlink" href="#bootstrap" title="Permalink to this headline">¶</a></h2>
<p>To bootstrap Silex, all you need to do is require the <tt class="docutils literal"><span class="pre">vendor/autoload.php</span></tt>
file and create an instance of <tt class="docutils literal"><span class="pre">Silex\Application</span></tt>. After your controller
definitions, call the <tt class="docutils literal"><span class="pre">run</span></tt> method on your application:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// web/index.php</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../vendor/autoload.php&#39;</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Silex\Application</span><span class="p">();</span>

<span class="c1">// ... definitions</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
<p>Then, you have to configure your web server (read the
<a class="reference internal" href="web_servers.html"><em>dedicated chapter</em></a> for more information).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When developing a website, you might want to turn on the debug mode to
ease debugging:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>If your application is hosted behind a reverse proxy at address <tt class="docutils literal"><span class="pre">$ip</span></tt>,
and you want Silex to trust the <tt class="docutils literal"><span class="pre">X-Forwarded-For*</span></tt> headers, you will
need to run your application like this:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">setTrustedProxies</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$ip</span><span class="p">));</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h2>
<p>In Silex you define a route and the controller that is called when that
route is matched.</p>
<p>A route pattern consists of:</p>
<ul class="simple">
<li><em>Pattern</em>: The route pattern defines a path that points to a resource. The
pattern can include variable parts and you are able to set RegExp
requirements for them.</li>
<li><em>Method</em>: One of the following HTTP methods: <tt class="docutils literal"><span class="pre">GET</span></tt>, <tt class="docutils literal"><span class="pre">POST</span></tt>, <tt class="docutils literal"><span class="pre">PUT</span></tt> or
<tt class="docutils literal"><span class="pre">DELETE</span></tt>. This describes the interaction with the resource. Commonly only
<tt class="docutils literal"><span class="pre">GET</span></tt> and <tt class="docutils literal"><span class="pre">POST</span></tt> are used, but it is possible to use the others as well.</li>
</ul>
<p>The controller is defined using a closure like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ... do something</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Closures are anonymous functions that may import state from outside of their
definition. This is different from globals, because the outer state does not
have to be global. For instance, you could define a closure in a function and
import local variables of that function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Closures that do not import scope are referred to as lambdas. Because all
anonymous functions are instances of the <tt class="docutils literal"><span class="pre">Closure</span></tt> class in PHP, the
documentation will not make a distinction here.</p>
</div>
<p>The return value of the closure becomes the content of the page.</p>
<div class="section" id="example-get-route">
<h3>Example GET Route<a class="headerlink" href="#example-get-route" title="Permalink to this headline">¶</a></h3>
<p>Here is an example definition of a <tt class="docutils literal"><span class="pre">GET</span></tt> route:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$blogPosts</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;date&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;2011-03-29&#39;</span><span class="p">,</span>
        <span class="s1">&#39;author&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;igorw&#39;</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;Using Silex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blogPosts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">];</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Visiting <tt class="docutils literal"><span class="pre">/blog</span></tt> will return a list of blog post titles. The <tt class="docutils literal"><span class="pre">use</span></tt>
statement means something different in this context. It tells the closure to
import the <tt class="docutils literal"><span class="pre">$blogPosts</span></tt> variable from the outer scope. This allows you to
use it from within the closure.</p>
</div>
<div class="section" id="dynamic-routing">
<h3>Dynamic Routing<a class="headerlink" href="#dynamic-routing" title="Permalink to this headline">¶</a></h3>
<p>Now, you can create another controller for viewing individual blog posts:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$post</span> <span class="o">=</span> <span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">];</span>

    <span class="k">return</span>  <span class="s2">&quot;&lt;h1&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/h1&gt;&quot;</span><span class="o">.</span>
            <span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This route definition has a variable <tt class="docutils literal"><span class="pre">{id}</span></tt> part which is passed to the
closure.</p>
<p>The current <tt class="docutils literal"><span class="pre">Application</span></tt> is automatically injected by Silex to the Closure
thanks to the type hinting.</p>
<p>When the post does not exist, you are using <tt class="docutils literal"><span class="pre">abort()</span></tt> to stop the request
early. It actually throws an exception, which you will see how to handle later
on.</p>
</div>
<div class="section" id="example-post-route">
<h3>Example POST Route<a class="headerlink" href="#example-post-route" title="Permalink to this headline">¶</a></h3>
<p>POST routes signify the creation of a resource. An example for this is a
feedback form. You will use the <tt class="docutils literal"><span class="pre">mail</span></tt> function to send an e-mail:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/feedback&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
    <span class="nb">mail</span><span class="p">(</span><span class="s1">&#39;feedback@yoursite.com&#39;</span><span class="p">,</span> <span class="s1">&#39;[YourSite] Feedback&#39;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Thank you for your feedback!&#39;</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>It is pretty straightforward.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is a <a class="reference internal" href="providers/swiftmailer.html"><em>SwiftmailerServiceProvider</em></a>
included that you can use instead of <tt class="docutils literal"><span class="pre">mail()</span></tt>.</p>
</div>
<p>The current <tt class="docutils literal"><span class="pre">request</span></tt> is automatically injected by Silex to the Closure
thanks to the type hinting. It is an instance of
<a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html">Request</a>, so you can fetch variables using the request <tt class="docutils literal"><span class="pre">get</span></tt> method.</p>
<p>Instead of returning a string you are returning an instance of <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html">Response</a>.
This allows setting an HTTP status code, in this case it is set to
<tt class="docutils literal"><span class="pre">201</span> <span class="pre">Created</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Silex always uses a <tt class="docutils literal"><span class="pre">Response</span></tt> internally, it converts strings to
responses with status code <tt class="docutils literal"><span class="pre">200</span> <span class="pre">Ok</span></tt>.</p>
</div>
</div>
<div class="section" id="other-methods">
<h3>Other methods<a class="headerlink" href="#other-methods" title="Permalink to this headline">¶</a></h3>
<p>You can create controllers for most HTTP methods. Just call one of these
methods on your application: <tt class="docutils literal"><span class="pre">get</span></tt>, <tt class="docutils literal"><span class="pre">post</span></tt>, <tt class="docutils literal"><span class="pre">put</span></tt>, <tt class="docutils literal"><span class="pre">delete</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Forms in most web browsers do not directly support the use of other HTTP
methods. To use methods other than GET and POST you can utilize a special
form field with a name of <tt class="docutils literal"><span class="pre">_method</span></tt>. The form&#8217;s <tt class="docutils literal"><span class="pre">method</span></tt> attribute must
be set to POST when using this field:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/my/target/route/&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">id=</span><span class="s">&quot;_method&quot;</span> <span class="na">name=</span><span class="s">&quot;_method&quot;</span> <span class="na">value=</span><span class="s">&quot;PUT&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>If you are using Symfony Components 2.2+, you will need to explicitly
enable this method override:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">enableHttpMethodParameterOverride</span><span class="p">();</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
<p>You can also call <tt class="docutils literal"><span class="pre">match</span></tt>, which will match all methods. This can be
restricted via the <tt class="docutils literal"><span class="pre">method</span></tt> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PATCH&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PUT|POST&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The order in which the routes are defined is significant. The first
matching route will be used, so place more generic routes at the bottom.</p>
</div>
</div>
<div class="section" id="route-variables">
<h3>Route Variables<a class="headerlink" href="#route-variables" title="Permalink to this headline">¶</a></h3>
<p>As it has been shown before you can define variable parts in a route like
this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>It is also possible to have more than one variable part, just make sure the
closure arguments match the names of the variable parts:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>While it&#8217;s not recommend, you could also do this (note the switched
arguments):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$commentId</span><span class="p">,</span> <span class="nv">$postId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can also ask for the current Request and Application objects:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note for the Application and Request objects, Silex does the injection
based on the type hinting and not on the variable name:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$bar</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="route-variables-converters">
<h3>Route Variables Converters<a class="headerlink" href="#route-variables-converters" title="Permalink to this headline">¶</a></h3>
<p>Before injecting the route variables into the controller, you can apply some
converters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$id</span><span class="p">;</span> <span class="p">});</span>
</pre></div>
</div>
<p>This is useful when you want to convert route variables to objects as it
allows to reuse the conversion code across different controllers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userProvider</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}/edit&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>
</pre></div>
</div>
<p>The converter callback also receives the <tt class="docutils literal"><span class="pre">Request</span></tt> as its second argument:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$callback</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">));</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}/{slug}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">);</span>
</pre></div>
</div>
<p>A converter can also be defined as a service. For example, here is a user
converter based on Doctrine ObjectManager:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Exception\NotFoundHttpException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserConverter</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$om</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$om</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">om</span> <span class="o">=</span> <span class="nv">$om</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">convert</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">===</span> <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">om</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundHttpException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;User %d does not exist&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The service will now be registered in the application, and the
convert method will be used as converter:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;converter.user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserConverter</span><span class="p">();</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;converter.user:convert&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Please note that the ability to use a service method (with the <cite>a:b</cite> notation) will be in version 1.2</p>
</div>
</div>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>In some cases you may want to only match certain expressions. You can define
requirements using regular expressions by calling <tt class="docutils literal"><span class="pre">assert</span></tt> on the
<tt class="docutils literal"><span class="pre">Controller</span></tt> object, which is returned by the routing methods.</p>
<p>The following will make sure the <tt class="docutils literal"><span class="pre">id</span></tt> argument is numeric, since <tt class="docutils literal"><span class="pre">\d+</span></tt>
matches any amount of digits:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can also chain these calls:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;postId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;commentId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="default-values">
<h3>Default Values<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h3>
<p>You can define a default value for any route variable by calling <tt class="docutils literal"><span class="pre">value</span></tt> on
the <tt class="docutils literal"><span class="pre">Controller</span></tt> object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/{pageName}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$pageName</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">value</span><span class="p">(</span><span class="s1">&#39;pageName&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>This will allow matching <tt class="docutils literal"><span class="pre">/</span></tt>, in which case the <tt class="docutils literal"><span class="pre">pageName</span></tt> variable will
have the value <tt class="docutils literal"><span class="pre">index</span></tt>.</p>
</div>
<div class="section" id="named-routes">
<h3>Named Routes<a class="headerlink" href="#named-routes" title="Permalink to this headline">¶</a></h3>
<p>Some providers (such as <tt class="docutils literal"><span class="pre">UrlGeneratorProvider</span></tt>) can make use of named
routes. By default Silex will generate a route name for you, that cannot
really be used. You can give a route a name by calling <tt class="docutils literal"><span class="pre">bind</span></tt> on the
<tt class="docutils literal"><span class="pre">Controller</span></tt> object that is returned by the routing methods:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;homepage&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;blog_post&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It only makes sense to name routes if you use providers that make use of
the <tt class="docutils literal"><span class="pre">RouteCollection</span></tt>.</p>
</div>
</div>
<div class="section" id="controllers-in-classes">
<h3>Controllers in Classes<a class="headerlink" href="#controllers-in-classes" title="Permalink to this headline">¶</a></h3>
<p>If you don&#8217;t want to use anonymous functions, you can also define your
controllers as methods. By using the <tt class="docutils literal"><span class="pre">ControllerClass::methodName</span></tt> syntax,
you can tell Silex to lazily create the controller object for you:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme\\Foo::bar&#39;</span><span class="p">);</span>

<span class="k">use</span> <span class="nx">Silex\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nx">Acme</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Foo</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Application</span> <span class="nv">$app</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will load the <tt class="docutils literal"><span class="pre">Acme\Foo</span></tt> class on demand, create an instance and call
the <tt class="docutils literal"><span class="pre">bar</span></tt> method to get the response. You can use <tt class="docutils literal"><span class="pre">Request</span></tt> and
<tt class="docutils literal"><span class="pre">Silex\Application</span></tt> type hints to get <tt class="docutils literal"><span class="pre">$request</span></tt> and <tt class="docutils literal"><span class="pre">$app</span></tt> injected.</p>
<p>For an even stronger separation between Silex and your controllers, you can
<a class="reference internal" href="providers/service_controller.html"><em>define your controllers as services</em></a>.</p>
</div>
</div>
<div class="section" id="global-configuration">
<h2>Global Configuration<a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h2>
<p>If a controller setting must be applied to all controllers (a converter, a
middleware, a requirement, or a default value), you can configure it on
<tt class="docutils literal"><span class="pre">$app['controllers']</span></tt>, which holds all application controllers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;controllers&#39;</span><span class="p">]</span>
    <span class="o">-&gt;</span><span class="na">value</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">requireHttps</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">before</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
<span class="p">;</span>
</pre></div>
</div>
<p>These settings are applied to already registered controllers and they become
the defaults for new controllers.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The global configuration does not apply to controller providers you might
mount as they have their own global configuration (read the
<a class="reference internal" href="organizing_controllers.html"><em>dedicated chapter</em></a> for more information).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The converters are run for <strong>all</strong> registered controllers.</p>
</div>
</div>
<div class="section" id="error-handlers">
<h2>Error Handlers<a class="headerlink" href="#error-handlers" title="Permalink to this headline">¶</a></h2>
<p>If some part of your code throws an exception you will want to display some
kind of error page to the user. This is what error handlers do. You can also
use them to do additional things, such as logging.</p>
<p>To register an error handler, pass a closure to the <tt class="docutils literal"><span class="pre">error</span></tt> method which
takes an <tt class="docutils literal"><span class="pre">Exception</span></tt> argument and returns a response:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can also check for specific errors by using the <tt class="docutils literal"><span class="pre">$code</span></tt> argument, and
handle them differently:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">404</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;The requested page could not be found.&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>As Silex ensures that the Response status code is set to the most
appropriate one depending on the exception, setting the status on the
response won&#8217;t work. If you want to overwrite the status code (which you
should not without a good reason), set the <tt class="docutils literal"><span class="pre">X-Status-Code</span></tt> header:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="mi">404</span> <span class="cm">/* ignored */</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;X-Status-Code&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>You can restrict an error handler to only handle some Exception classes by
setting a more specific type hint for the Closure argument:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\LogicException</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this handler will only handle \LogicException exceptions</span>
    <span class="c1">// and exceptions that extends \LogicException</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If you want to set up logging you can use a separate error handler for that.
Just make sure you register it before the response error handlers, because
once a response is returned, the following handlers are ignored.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Silex ships with a provider for <a class="reference external" href="https://github.com/Seldaek/monolog">Monolog</a> which handles logging of errors.
Check out the <em>Providers</em> chapter for details.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Silex comes with a default error handler that displays a detailed error
message with the stack trace when <strong>debug</strong> is true, and a simple error
message otherwise. Error handlers registered via the <tt class="docutils literal"><span class="pre">error()</span></tt> method
always take precedence but you can keep the nice error messages when debug
is turned on like this:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ... logic to handle the error and return a Response</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>The error handlers are also called when you use <tt class="docutils literal"><span class="pre">abort</span></tt> to abort a request
early:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="redirects">
<h2>Redirects<a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h2>
<p>You can redirect to another page by returning a redirect response, which you
can create by calling the <tt class="docutils literal"><span class="pre">redirect</span></tt> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This will redirect from <tt class="docutils literal"><span class="pre">/</span></tt> to <tt class="docutils literal"><span class="pre">/hello</span></tt>.</p>
</div>
<div class="section" id="forwards">
<h2>Forwards<a class="headerlink" href="#forwards" title="Permalink to this headline">¶</a></h2>
<p>When you want to delegate the rendering to another controller, without a
round-trip to the browser (as for a redirect), use an internal sub-request:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\HttpKernelInterface</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// redirect to /hello</span>
    <span class="nv">$subRequest</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$subRequest</span><span class="p">,</span> <span class="nx">HttpKernelInterface</span><span class="o">::</span><span class="na">SUB_REQUEST</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>If you are using <tt class="docutils literal"><span class="pre">UrlGeneratorProvider</span></tt>, you can also generate the URI:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;url_generator&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">),</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>There&#8217;s some more things that you need to keep in mind though. In most cases you
will want to forward some parts of the current master request to the sub-request.
That includes: Cookies, server information, session.
Read more on <a class="reference internal" href="cookbook/sub_requests.html"><em>how to make sub-requests</em></a>.</p>
</div>
<div class="section" id="json">
<h2>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h2>
<p>If you want to return JSON data, you can use the <tt class="docutils literal"><span class="pre">json</span></tt> helper method.
Simply pass it your data, status code and headers, and it will create a JSON
response for you:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">getUser</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The user was not found.&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$error</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="streaming">
<h2>Streaming<a class="headerlink" href="#streaming" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s possible to create a streaming response, which is important in cases when
you cannot buffer the data being sent:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/images/{file}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/images/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">&#39;The image was not found.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">readfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">stream</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/png&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If you need to send chunks, make sure you call <tt class="docutils literal"><span class="pre">ob_flush</span></tt> and <tt class="docutils literal"><span class="pre">flush</span></tt>
after every chunk:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$fh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;http://www.example.com/&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fh</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$fh</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
      <span class="nb">ob_flush</span><span class="p">();</span>
      <span class="nb">flush</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-a-file">
<h2>Sending a file<a class="headerlink" href="#sending-a-file" title="Permalink to this headline">¶</a></h2>
<p>If you want to return a file, you can use the <tt class="docutils literal"><span class="pre">sendFile</span></tt> helper method.
It eases returning files that would otherwise not be publicly available. Simply
pass it your file path, status code, headers and the content disposition and it
will create a <tt class="docutils literal"><span class="pre">BinaryFileResponse</span></tt> based response for you:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/files/{path}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">sendFile</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>To further customize the response before returning it, check the API doc for
<a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/BinaryFileResponse.html">SymfonyComponentHttpFoundationBinaryFileResponse</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">return</span> <span class="nv">$app</span>
    <span class="o">-&gt;</span><span class="na">sendFile</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setContentDisposition</span><span class="p">(</span><span class="nx">ResponseHeaderBag</span><span class="o">::</span><span class="na">DISPOSITION_ATTACHMENT</span><span class="p">,</span> <span class="s1">&#39;pic.jpg&#39;</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">HttpFoundation 2.2 or greater is required for this feature to be available.</p>
</div>
</div>
<div class="section" id="traits">
<h2>Traits<a class="headerlink" href="#traits" title="Permalink to this headline">¶</a></h2>
<p>Silex comes with PHP traits that define shortcut methods.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">You need to use PHP 5.4 or later to benefit from this feature.</p>
</div>
<p>Almost all built-in service providers have some corresponding PHP traits. To
use them, define your own Application class and include the traits you want:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Silex\Application</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyApplication</span> <span class="k">extends</span> <span class="nx">Application</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Application\TwigTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\SecurityTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\FormTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\UrlGeneratorTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\SwiftmailerTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\MonologTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\TranslationTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also define your own Route class and use some traits:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Silex\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyRoute</span> <span class="k">extends</span> <span class="nx">Route</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Route\SecurityTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To use your newly defined route, override the <tt class="docutils literal"><span class="pre">$app['route_class']</span></tt>
setting:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;route_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MyRoute&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Read each provider chapter to learn more about the added methods.</p>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>Make sure to protect your application against attacks.</p>
<div class="section" id="escaping">
<h3>Escaping<a class="headerlink" href="#escaping" title="Permalink to this headline">¶</a></h3>
<p>When outputting any user input (either route variables GET/POST variables
obtained from the request), you will have to make sure to escape it correctly,
to prevent Cross-Site-Scripting attacks.</p>
<ul>
<li><p class="first"><strong>Escaping HTML</strong>: PHP provides the <tt class="docutils literal"><span class="pre">htmlspecialchars</span></tt> function for this.
Silex provides a shortcut <tt class="docutils literal"><span class="pre">escape</span></tt> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;You provided the name </span><span class="si">{</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If you use the Twig template engine you should use its escaping or even
auto-escaping mechanisms.</p>
</li>
<li><p class="first"><strong>Escaping JSON</strong>: If you want to provide data in JSON format you should
use the Silex <tt class="docutils literal"><span class="pre">json</span></tt> function:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name.json&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#upgrading">Upgrading</a></li>
<li><a class="reference internal" href="#bootstrap">Bootstrap</a></li>
<li><a class="reference internal" href="#routing">Routing</a><ul>
<li><a class="reference internal" href="#example-get-route">Example GET Route</a></li>
<li><a class="reference internal" href="#dynamic-routing">Dynamic Routing</a></li>
<li><a class="reference internal" href="#example-post-route">Example POST Route</a></li>
<li><a class="reference internal" href="#other-methods">Other methods</a></li>
<li><a class="reference internal" href="#route-variables">Route Variables</a></li>
<li><a class="reference internal" href="#route-variables-converters">Route Variables Converters</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#default-values">Default Values</a></li>
<li><a class="reference internal" href="#named-routes">Named Routes</a></li>
<li><a class="reference internal" href="#controllers-in-classes">Controllers in Classes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#global-configuration">Global Configuration</a></li>
<li><a class="reference internal" href="#error-handlers">Error Handlers</a></li>
<li><a class="reference internal" href="#redirects">Redirects</a></li>
<li><a class="reference internal" href="#forwards">Forwards</a></li>
<li><a class="reference internal" href="#json">JSON</a></li>
<li><a class="reference internal" href="#streaming">Streaming</a></li>
<li><a class="reference internal" href="#sending-a-file">Sending a file</a></li>
<li><a class="reference internal" href="#traits">Traits</a></li>
<li><a class="reference internal" href="#security">Security</a><ul>
<li><a class="reference internal" href="#escaping">Escaping</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="middlewares.html"
                        title="next chapter">Middlewares</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/usage.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="middlewares.html" title="Middlewares"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">Silex 1.2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010 Fabien Potencier.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>