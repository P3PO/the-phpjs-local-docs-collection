<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Usage | Kohana User Guide</title>

<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok8v=02fcfa4f56/"},atok:"eee59e90a8282bcfc7cd8af99a42a3da",petok:"30207b93fb055efbe63a48e03cbe60f7bfad1b4d-1394799561-1800",zone:"kohanaframework.org",rocket:"0",apps:{"ga_key":{"ua":"UA-27864271-1","ga_bs":"2"}}}];var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0;a.src="//ajax.cloudflare.com/cdn-cgi/nexp/dok8v=b064e16429/cloudflare.min.js";b.parentNode.insertBefore(a,b);}}catch(e){};
//]]>
</script>
<link type="text/css" href="../../guide-media/css/print.css" rel="stylesheet" media="print" />
<link type="text/css" href="../../guide-media/css/screen.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/kodoc.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/shCore.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/shThemeKodoc.css" rel="stylesheet" media="screen" />

<script type="text/javascript" src="../../guide-media/js/jquery.min.js"></script>
<script type="text/javascript" src="../../guide-media/js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../guide-media/js/kodoc.js"></script>
<script type="text/javascript" src="../../guide-media/js/shCore.js"></script>
<script type="text/javascript" src="../../guide-media/js/shBrushPhp.js"></script>

<!--[if lt IE 9]>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
<![endif]-->
<script type="text/javascript">
/* <![CDATA[ */
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-27864271-1']);
_gaq.push(['_trackPageview']);

(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

(function(b){(function(a){"__CF"in b&&"DJS"in b.__CF?b.__CF.DJS.push(a):"addEventListener"in b?b.addEventListener("load",a,!1):b.attachEvent("onload",a)})(function(){"FB"in b&&"Event"in FB&&"subscribe"in FB.Event&&(FB.Event.subscribe("edge.create",function(a){_gaq.push(["_trackSocial","facebook","like",a])}),FB.Event.subscribe("edge.remove",function(a){_gaq.push(["_trackSocial","facebook","unlike",a])}),FB.Event.subscribe("message.send",function(a){_gaq.push(["_trackSocial","facebook","send",a])}));"twttr"in b&&"events"in twttr&&"bind"in twttr.events&&twttr.events.bind("tweet",function(a){if(a){var b;if(a.target&&a.target.nodeName=="IFRAME")a:{if(a=a.target.src){a=a.split("#")[0].match(/[^?=&]+=([^&]*)?/g);b=0;for(var c;c=a[b];++b)if(c.indexOf("url")===0){b=unescape(c.split("=")[1]);break a}}b=void 0}_gaq.push(["_trackSocial","twitter","tweet",b])}})})})(window);
/* ]]> */
</script>
</head>
<body>

	<div id="kodoc-header">
		<div class="container">
			<a href="http://kohanaframework.org/" id="kodoc-logo">
				<img src="../../guide-media/img/kohana.png" />
			</a>
			<div id="kodoc-menu">
				<ul>
					<li class="guide first">
						<a href="../../guide.1.html">User Guide</a>
					</li>
										<li class="api">
						<a href="../../guide-api.html">API Browser</a>
					</li>
									</ul>
			</div>
		</div>
	</div>

	<div id="kodoc-content">
		<div class="wrapper">
			<div class="container">
				<div class="span-22 prefix-1 suffix-1">
					<ul id="kodoc-breadcrumb">
																				<li><a href="../../guide.1.html">User Guide</a></li>
																											<li><a href="../cache.1.html">Cache</a></li>
																											<li class="last">Usage</li>
																		</ul>
				</div>
				<div class="span-6 prefix-1">
					<div id="kodoc-topics">
						<h2 id="cache"><a href="index.html">Cache</a></h2>

<ul>
<li><a href="config.html">Configuration</a></li>
<li><a href="usage.html">Usage</a></li>
</ul>
					</div>
				</div>
				<div id="kodoc-body" class="span-16 suffix-1 last">
					<h1 id="kohana-cache-usage">Kohana Cache usage</h1>

<div class="page-toc">
					<a href="usage.html#kohana-cache-usage">Kohana Cache usage</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#getting-a-new-cache-instance">Getting a new cache instance</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#setting-and-getting-variables-to-and-from-cache">Setting and getting variables to and from cache</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#setting-a-value-to-cache">Setting a value to cache</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#setting-a-value-with-tags">Setting a value with tags</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#getting-a-value-from-cache">Getting a value from cache</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#getting-values-from-cache-using-tags">Getting values from cache using tags</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#deleting-values-from-cache">Deleting values from cache</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#delete-value-by-key">Delete value by key</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#delete-all-values">Delete all values</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#delete-values-by-tag">Delete values by tag</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<a href="usage.html#garbage-collection">Garbage Collection</a><br />
					<a href="usage.html#interfaces">Interfaces</a><br />
	</div>
<p><a href="../../guide-api/Kohana_Cache.html">Kohana_Cache</a> provides a simple interface allowing getting, setting and deleting of cached values. Two interfaces included in <em>Kohana Cache</em> additionally provide <em>tagging</em> and <em>garbage collection</em> where they are supported by the respective drivers.</p>

<h2 id="getting-a-new-cache-instance">Getting a new cache instance</h2>

<p>Creating a new <em>Kohana Cache</em> instance is simple, however it must be done using the <a href="../../guide-api/Cache.html#instance">Cache::instance</a> method, rather than the traditional <code>new</code> constructor.</p>

<pre><code> // Create a new instance of cache using the default group
 $cache = Cache::instance();
</code></pre>

<p>The default group will use whatever is set to <a href="../../guide-api/Cache.html#property:default">Cache::$default</a> and must have a corresponding <a href="http://kohanaframework.org/3.3/guide/cache/cache.config">configuration</a> definition for that group.</p>

<p>To create a cache instance using a group other than the <em>default</em>, simply provide the group name as an argument.</p>

<pre><code> // Create a new instance of the memcache group
 $memcache = Cache::instance('memcache');
</code></pre>

<p>If there is a cache instance already instantiated then you can get it directly from the class member.</p>

<p>[!!] Beware that this can cause issues if you do not test for the instance before trying to access it.</p>

<pre><code> // Check for the existance of the cache driver
 if (isset(Cache::$instances['memcache']))
 {
      // Get the existing cache instance directly (faster)
      $memcache = Cache::$instances['memcache'];
 }
 else
 {
      // Get the cache driver instance (slower)
      $memcache = Cache::instance('memcache');
 }
</code></pre>

<h2 id="setting-and-getting-variables-to-and-from-cache">Setting and getting variables to and from cache</h2>

<p>The cache library supports scalar and object values, utilising object serialization where required (or not supported by the caching engine). This means that the majority or objects can be cached without any modification.</p>

<p>[!!] Serialisation does not work with resource handles, such as filesystem, curl or socket resources.</p>

<h3 id="setting-a-value-to-cache">Setting a value to cache</h3>

<p>Setting a value to cache using the <a href="../../guide-api/Cache.html#set">Cache::set</a> method can be done in one of two ways; either using the Cache instance interface, which is good for atomic operations; or getting an instance and using that for multiple operations.</p>

<p>The first example demonstrates how to quickly load and set a value to the default cache instance.</p>

<pre><code> // Create a cachable object
 $object = new stdClass;

 // Set a property
 $object-&gt;foo = 'bar';

 // Cache the object using default group (quick interface) with default time (3600 seconds)
 Cache::instance()-&gt;set('foo', $object);
</code></pre>

<p>If multiple cache operations are required, it is best to assign an instance of Cache to a variable and use that as below.</p>

<pre><code> // Set the object using a defined group for a defined time period (30 seconds)
 $memcache = Cache::instance('memcache');
 $memcache-&gt;set('foo', $object, 30);
</code></pre>

<h4 id="setting-a-value-with-tags">Setting a value with tags</h4>

<p>Certain cache drivers support setting values with tags. To set a value to cache with tags using the following interface.</p>

<pre><code> // Get a cache instance that supports tags
 $memcache = Cache::instance('memcachetag');

 // Test for tagging interface
 if ($memcache instanceof Cache_Tagging)
 {
      // Set a value with some tags for 30 seconds
      $memcache-&gt;set('foo', $object, 30, array('snafu', 'stfu', 'fubar'));
 }
 // Otherwise set without tags
 else
 {
      // Set a value for 30 seconds
      $memcache-&gt;set('foo', $object, 30);
 }
</code></pre>

<p>It is possible to implement custom tagging solutions onto existing or new cache drivers by implementing the <a href="../../guide-api/Cache_Tagging.html">Cache_Tagging</a> interface. Kohana_Cache only applies the interface to drivers that support tagging natively as standard.</p>

<h3 id="getting-a-value-from-cache">Getting a value from cache</h3>

<p>Getting variables back from cache is achieved using the <a href="../../guide-api/Cache.html#get">Cache::get</a> method using a single key to identify the cache entry.</p>

<pre><code> // Retrieve a value from cache (quickly)
 $object = Cache::instance()-&gt;get('foo');
</code></pre>

<p>In cases where the requested key is not available or the entry has expired, a default value will be returned (<strong>NULL</strong> by default). It is possible to define the default value as the key is requested.</p>

<pre><code> // If the cache key is available (with default value set to FALSE)
 if ($object = Cache::instance()-&gt;get('foo', FALSE))
 {
      // Do something
 }
 else
 {
      // Do something else
 }
</code></pre>

<h4 id="getting-values-from-cache-using-tags">Getting values from cache using tags</h4>

<p>It is possible to retrieve values from cache grouped by tag, using the <a href="../../guide-api/Cache.html#find">Cache::find</a> method with drivers that support tagging.</p>

<p>[!!] The <strong>Memcachetag</strong> driver does not support the <code>Cache::find($tag)</code> interface and will throw an exception.</p>

<pre><code> // Get an instance of cache
 $cache = Cache::instance('memcachetag');

 // Wrap in a try/catch statement to gracefully handle memcachetag
 try
 {
      // Find values based on tag
      return $cache-&gt;find('snafu');
 }
 catch (Cache_Exception $e)
 {
      // Handle gracefully
      return FALSE;
 }
</code></pre>

<h3 id="deleting-values-from-cache">Deleting values from cache</h3>

<p>Deleting variables is very similar to the getting and setting methods already described. Deleting operations are split into three categories:</p>

<ul>
<li><strong>Delete value by key</strong>. Deletes a cached value by the associated key.</li>
<li><strong>Delete all values</strong>. Deletes all caches values stored in the cache instance.</li>
<li><strong>Delete values by tag</strong>. Deletes all values that have the supplied tag. This is only supported by Memcached-Tag and Sqlite.</li>
</ul>

<h4 id="delete-value-by-key">Delete value by key</h4>

<p>To delete a specific value by its associated key:</p>

<pre><code> // If the cache entry for 'foo' is deleted
 if (Cache::instance()-&gt;delete('foo'))
 {
      // Cache entry successfully deleted, do something
 }
</code></pre>

<p>By default a <code>TRUE</code> value will be returned. However a <code>FALSE</code> value will be returned in instances where the key did not exist in the cache.</p>

<h4 id="delete-all-values">Delete all values</h4>

<p>To delete all values in a specific instance:</p>

<pre><code> // If all cache items where deleted successfully
 if (Cache::instance()-&gt;delete_all())
 {
       // Do something
 }
</code></pre>

<p>It is also possible to delete all cache items in every instance:</p>

<pre><code> // For each cache instance
 foreach (Cache::$instances as $group =&gt; $instance)
 {
      if ($instance-&gt;delete_all())
      {
           var_dump('instance : '.$group.' has been flushed!');
      }
 }
</code></pre>

<h4 id="delete-values-by-tag">Delete values by tag</h4>

<p>Some of the caching drivers support deleting by tag. This will remove all the cached values that are associated with a specific tag. Below is an example of how to robustly handle deletion by tag.</p>

<pre><code> // Get cache instance
 $cache = Cache::instance();

 // Check for tagging interface
 if ($cache instanceof Cache_Tagging)
 {
       // Delete all entries by the tag 'snafu'
       $cache-&gt;delete_tag('snafu');
 }
</code></pre>

<h4 id="garbage-collection">Garbage Collection</h4>

<p>Garbage Collection (GC) is the cleaning of expired cache entries. For the most part, caching engines will take care of garbage collection internally. However a few of the file based systems do not handle this task and in these circumstances it would be prudent to garbage collect at a predetermined frequency. If no garbage collection is executed, the resource storing the cache entries will eventually fill and become unusable.</p>

<p>When not automated, garbage collection is the responsibility of the developer. It is prudent to have a GC probability value that dictates how likely the garbage collection routing will be run. An example of such a system is demonstrated below.</p>

<pre><code> // Get a cache instance
 $cache_file = Cache::instance('file');

 // Set a GC probability of 10%
 $gc = 10;

 // If the GC probability is a hit
 if (rand(0,99) &lt;= $gc and $cache_file instanceof Cache_GarbageCollect)
 {
      // Garbage Collect
      $cache_file-&gt;garbage_collect();
 }
</code></pre>

<h1 id="interfaces">Interfaces</h1>

<p>Kohana Cache comes with two interfaces that are implemented where the drivers support them:</p>

<ul>
<li><strong><a href="../../guide-api/Cache_Tagging.html">Cache_Tagging</a> for tagging support on cache entries</strong>

<ul>
<li><a href="../../guide-api/Cache_MemcacheTag.html">Cache_MemcacheTag</a></li>
<li><a href="../../guide-api/Cache_Sqlite.html">Cache_Sqlite</a></li>
</ul></li>
<li><strong><a href="../../guide-api/Cache_GarbageCollect.html">Cache_GarbageCollect</a> for garbage collection with drivers without native support</strong>

<ul>
<li><a href="../../guide-api/Cache_File.html">Cache_File</a></li>
<li><a href="../../guide-api/Cache_Sqlite.html">Cache_Sqlite</a></li>
</ul></li>
</ul>

<p>When using interface specific caching features, ensure that code checks for the required interface before using the methods supplied. The following example checks whether the garbage collection interface is available before calling the <code>garbage_collect</code> method.</p>

<pre><code>// Create a cache instance
$cache = Cache::instance();

// Test for Garbage Collection
if ($cache instanceof Cache_GarbageCollect)
{
     // Collect garbage
     $cache-&gt;garbage_collect();
}
</code></pre>

									</div>
			</div>
		</div>
	</div>

	<div id="kodoc-footer">
		<div class="container">
			<div class="span-12">
							<p>&copy; 2008–2012 Kohana Team</p>
						</div>
			<div class="span-12 last right">
			<p>Powered by <a href="http://kohanaframework.org/">Kohana</a> v3.3.1</p>
			</div>
		</div>
	</div>

</body>
</html>
