<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Upgrading from v3.2 | Kohana User Guide</title>

<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok8v=02fcfa4f56/"},atok:"eee59e90a8282bcfc7cd8af99a42a3da",petok:"3c3e7b7bb535d2750ef22b1ce2ea583ba7503b6e-1394799551-1800",zone:"kohanaframework.org",rocket:"0",apps:{"ga_key":{"ua":"UA-27864271-1","ga_bs":"2"}}}];var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0;a.src="//ajax.cloudflare.com/cdn-cgi/nexp/dok8v=b064e16429/cloudflare.min.js";b.parentNode.insertBefore(a,b);}}catch(e){};
//]]>
</script>
<link type="text/css" href="../../guide-media/css/print.css" rel="stylesheet" media="print" />
<link type="text/css" href="../../guide-media/css/screen.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/kodoc.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/shCore.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/shThemeKodoc.css" rel="stylesheet" media="screen" />

<script type="text/javascript" src="../../guide-media/js/jquery.min.js"></script>
<script type="text/javascript" src="../../guide-media/js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../guide-media/js/kodoc.js"></script>
<script type="text/javascript" src="../../guide-media/js/shCore.js"></script>
<script type="text/javascript" src="../../guide-media/js/shBrushPhp.js"></script>

<!--[if lt IE 9]>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
<![endif]-->
<script type="text/javascript">
/* <![CDATA[ */
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-27864271-1']);
_gaq.push(['_trackPageview']);

(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

(function(b){(function(a){"__CF"in b&&"DJS"in b.__CF?b.__CF.DJS.push(a):"addEventListener"in b?b.addEventListener("load",a,!1):b.attachEvent("onload",a)})(function(){"FB"in b&&"Event"in FB&&"subscribe"in FB.Event&&(FB.Event.subscribe("edge.create",function(a){_gaq.push(["_trackSocial","facebook","like",a])}),FB.Event.subscribe("edge.remove",function(a){_gaq.push(["_trackSocial","facebook","unlike",a])}),FB.Event.subscribe("message.send",function(a){_gaq.push(["_trackSocial","facebook","send",a])}));"twttr"in b&&"events"in twttr&&"bind"in twttr.events&&twttr.events.bind("tweet",function(a){if(a){var b;if(a.target&&a.target.nodeName=="IFRAME")a:{if(a=a.target.src){a=a.split("#")[0].match(/[^?=&]+=([^&]*)?/g);b=0;for(var c;c=a[b];++b)if(c.indexOf("url")===0){b=unescape(c.split("=")[1]);break a}}b=void 0}_gaq.push(["_trackSocial","twitter","tweet",b])}})})})(window);
/* ]]> */
</script>
</head>
<body>

	<div id="kodoc-header">
		<div class="container">
			<a href="http://kohanaframework.org/" id="kodoc-logo">
				<img src="../../guide-media/img/kohana.png" />
			</a>
			<div id="kodoc-menu">
				<ul>
					<li class="guide first">
						<a href="../../guide.1.html">User Guide</a>
					</li>
										<li class="api">
						<a href="../../guide-api.html">API Browser</a>
					</li>
									</ul>
			</div>
		</div>
	</div>

	<div id="kodoc-content">
		<div class="wrapper">
			<div class="container">
				<div class="span-22 prefix-1 suffix-1">
					<ul id="kodoc-breadcrumb">
																				<li><a href="../../guide.1.html">User Guide</a></li>
																											<li><a href="../kohana.1.html">Kohana</a></li>
																											<li class="last">Upgrading from v3.2</li>
																		</ul>
				</div>
				<div class="span-6 prefix-1">
					<div id="kodoc-topics">
						<h2 id="kohana"><a href="index.html">Kohana</a></h2>

<ul>
<li><a href="install.html">Installation</a></li>
<li><span>Getting Started</span>

<ul>
<li><a href="conventions.html">Conventions and Style</a></li>
<li><a href="mvc.1.html">Model View Controller</a>

<ul>
<li><a href="mvc/controllers.html">Controllers</a></li>
<li><a href="mvc/models.html">Models</a></li>
<li><a href="mvc/views.html">Views</a></li>
</ul></li>
<li><a href="files.1.html">Cascading Filesystem</a>

<ul>
<li><a href="files/classes.html">Class Files</a></li>
<li><a href="files/config.html">Config Files</a></li>
<li><a href="files/i18n.html">Translation Files</a></li>
<li><a href="files/messages.html">Message Files</a></li>
</ul></li>
<li><a href="config.html">Configuration</a></li>
<li><a href="flow.html">Request Flow</a></li>
<li><a href="bootstrap.html">Bootstrap</a></li>
<li><a href="modules.html">Modules</a></li>
<li><a href="routing.html">Routing</a></li>
<li><a href="errors.html">Error Handling</a></li>
<li><a href="tips.html">Tips &amp; Common Mistakes</a></li>
<li><a href="upgrading.html">Upgrading from v3.2</a></li>
</ul></li>
<li><span>Basic Usage</span>

<ul>
<li><a href="debugging.html">Debugging</a></li>
<li><a href="autoloading.html">Loading Classes</a></li>
<li><a href="extension.html">Transparent Extension</a></li>
<li><a href="helpers.html">Helpers</a></li>
<li><a href="requests.html">Requests</a></li>
<li><a href="sessions.html">Sessions</a></li>
<li><a href="cookies.html">Cookies</a></li>
<li><a href="fragments.html">Fragments</a></li>
<li><a href="profiling.html">Profiling</a></li>
</ul></li>
<li><a href="security.1.html">Security</a>

<ul>
<li><a href="security/xss.html">XSS</a></li>
<li><a href="security/validation.html">Validation</a></li>
<li><a href="security/cookies.html">Cookies</a></li>
<li><a href="security/database.html">Database</a></li>
<li><a href="security/encryption.html">Encryption</a></li>
<li><a href="security/deploying.html">Deploying</a></li>
</ul></li>
<li><span>Tutorials</span>

<ul>
<li><a href="tutorials/hello-world.html">Hello World</a></li>
<li><a href="tutorials/simple-mvc.html">Simple MVC</a></li>
<li><a href="tutorials/error-pages.html">Custom Error Pages</a></li>
<li><a href="tutorials/clean-urls.html">Clean URLs</a></li>
<li><a href="tutorials/sharing-kohana.html">Sharing Kohana</a></li>
<li><a href="tutorials/library-kohana.html">Kohana as a Library</a></li>
<li><a href="tutorials/git.html">Working with Git</a></li>
</ul></li>
</ul>
					</div>
				</div>
				<div id="kodoc-body" class="span-16 suffix-1 last">
					<h1 id="migrating-from-32x">Migrating from 3.2.x</h1>

<h2 id="hvmc-isolation">HVMC Isolation</h2>

<div class="page-toc">
					<a href="upgrading.html#migrating-from-32x">Migrating from 3.2.x</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#hvmc-isolation">HVMC Isolation</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#http-exceptions">HTTP Exceptions</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#redirects-http-300-301-302-303-307">Redirects (HTTP 300, 301, 302, 303, 307)</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#custom-error-pages-http-500-404-403-401-etc">Custom Error Pages (HTTP 500, 404, 403, 401 etc)</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#browser-cache-checking-etags">Browser cache checking (ETags)</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#psr-0-support-fileclass-naming-conventions">PSR-0 support (file/class naming conventions)</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#query-builder-identifier-escaping">Query Builder Identifier Escaping</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="upgrading.html#route-filters">Route Filters</a><br />
	</div>
<p>HVMC Sub-request isolation has been improved to prevent exceptions leaking from this inner to the outer request. If you were previously catching any exceptions from sub-requests, you should now be checking the <a href="../../guide-api/Response.html">Response</a> object returned from <a href="../../guide-api/Request.html#execute">Request::execute</a>.</p>

<h2 id="http-exceptions">HTTP Exceptions</h2>

<p>The use of HTTP Exceptions is now encouraged over manually setting the <a href="../../guide-api/Response.html">Response</a> status to, for example, '404'. This allows for easier custom error pages (detailed below);</p>

<p>The full list of supported codes can be seen in the SYSPATH/classes/HTTP/Exception/ folder.</p>

<p>Syntax:</p>

<pre><code>throw HTTP_Exception::factory($code, $message, array $variables, Exception $previous);
</code></pre>

<p>Examples:</p>

<pre><code>// Page Not Found
throw HTTP_Exception::factory(404, 'The requested URL :uri was not found on this server.', array(
        ':uri' =&gt; $this-&gt;request-&gt;uri(),
    ));

// Unauthorized / Login Requied
throw HTTP_Exception::factory(401)-&gt;authenticate('Basic realm="MySite"');

// Forbidden / Permission Deined
throw HTTP_Exception::factory(403);
</code></pre>

<h2 id="redirects-http-300-301-302-303-307">Redirects (HTTP 300, 301, 302, 303, 307)</h2>

<p>Redirects are no longer issued against the <a href="../../guide-api/Request.html">Request</a> object. The new syntax from inside a controller is:</p>

<pre><code>$this-&gt;redirect('http://www.google.com', 302);
</code></pre>

<p>or from outside a controller:</p>

<pre><code>HTTP::redirect('http://www.google.com', 302);
</code></pre>

<h2 id="custom-error-pages-http-500-404-403-401-etc">Custom Error Pages (HTTP 500, 404, 403, 401 etc)</h2>

<p>Custom error pages are now easier than ever to implement, thanks to some of the changes brought about by the HVMC and Redirect changes above.</p>

<p>See <a href="tutorials/error-pages.html">Custom Error Pages</a> for more details.</p>

<h2 id="browser-cache-checking-etags">Browser cache checking (ETags)</h2>

<p>The Response::check_cache method has moved to <a href="../../guide-api/HTTP.html#check_cache">HTTP::check_cache</a>, with an alias at <a href="../../guide-api/Controller.html#check_cache">Controller::check_cache</a>. Previously, this method would be used from a controller like this:</p>

<pre><code>$this-&gt;response-&gt;check_cache(sha1('my content'), Request $this-&gt;request);
</code></pre>

<p>Now, there are two options for using the method:</p>

<pre><code>$this-&gt;check_cache(sha1('my content'));
</code></pre>

<p>which is an alias for:</p>

<pre><code>HTTP::check_cache($this-&gt;request, $this-&gt;response, sha1('my content'));
</code></pre>

<h2 id="psr-0-support-fileclass-naming-conventions">PSR-0 support (file/class naming conventions)</h2>

<p>With the introduction of <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md">PSR-0</a> support, the autoloading of classes is case sensitive. Now, the file (and folder) names must match the class name exactly.</p>

<p>Examples:</p>

<pre><code>Kohana_Core
</code></pre>

<p>would be located in</p>

<pre><code>classes/Kohana/Core.php
</code></pre>

<p>and</p>

<pre><code>Kohana_HTTP_Header
</code></pre>

<p>would be located in</p>

<pre><code>classes/Kohana/HTTP/Header.php
</code></pre>

<p>This also affects dynamically named classes such as drivers and ORMs. So for example, in the database config using <code>'mysql'</code> as the type instead of <code>'MySQL'</code> would throw a class not found error.</p>

<h2 id="query-builder-identifier-escaping">Query Builder Identifier Escaping</h2>

<p>The query builder will no longer detect columns like <code>COUNT("*")</code>. Instead, you will need to use <code>DB::expr()</code> any time you need an unescaped column. For example:</p>

<pre><code>DB::select(DB::expr('COUNT(*)'))-&gt;from('users')-&gt;execute()
</code></pre>

<h2 id="route-filters">Route Filters</h2>

<p>In <code>3.3.0</code>, you can no longer pass a callback to <code>Route::uri()</code>. Instead, we've added the ability to define one or more filters which will be able to decide if the route matches and will also allow you to change any of the parameters. These filters will receive the <code>Route</code> object being tested, the currently matched <code>$params</code> array, and the <code>Request</code> object as the three parameters.</p>

<pre><code>Route::set('route-name', 'some/uri/&lt;id&gt;')
    -&gt;filter(function($route, $params, $request) {
        // Returning FALSE will make this route not match
        // Returning an array will replace the $params sent to the controller
    });
</code></pre>

<p>These filters can be used for things like prepending the request method to the action, checking if a resource exists before matching the route, or any other logic that the URI alone cannot provide. You can add as many filters as needed so it's useful to keep filters as small as possible to make them reusable.</p>

<p>See <a href="routing.html#route-filters">Routing</a> for more details.</p>

									</div>
			</div>
		</div>
	</div>

	<div id="kodoc-footer">
		<div class="container">
			<div class="span-12">
							<p>&copy; 2008–2012 Kohana Team</p>
						</div>
			<div class="span-12 last right">
			<p>Powered by <a href="http://kohanaframework.org/">Kohana</a> v3.3.1</p>
			</div>
		</div>
	</div>

</body>
</html>
