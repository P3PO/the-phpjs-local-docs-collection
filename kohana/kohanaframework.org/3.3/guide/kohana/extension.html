<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Transparent Extension | Kohana User Guide</title>

<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok8v=02fcfa4f56/"},atok:"eee59e90a8282bcfc7cd8af99a42a3da",petok:"3e04d98dc83bedfcb4111790173b9ca932a740fd-1394799552-1800",zone:"kohanaframework.org",rocket:"0",apps:{"ga_key":{"ua":"UA-27864271-1","ga_bs":"2"}}}];var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0;a.src="//ajax.cloudflare.com/cdn-cgi/nexp/dok8v=b064e16429/cloudflare.min.js";b.parentNode.insertBefore(a,b);}}catch(e){};
//]]>
</script>
<link type="text/css" href="../../guide-media/css/print.css" rel="stylesheet" media="print" />
<link type="text/css" href="../../guide-media/css/screen.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/kodoc.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/shCore.css" rel="stylesheet" media="screen" />
<link type="text/css" href="../../guide-media/css/shThemeKodoc.css" rel="stylesheet" media="screen" />

<script type="text/javascript" src="../../guide-media/js/jquery.min.js"></script>
<script type="text/javascript" src="../../guide-media/js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../guide-media/js/kodoc.js"></script>
<script type="text/javascript" src="../../guide-media/js/shCore.js"></script>
<script type="text/javascript" src="../../guide-media/js/shBrushPhp.js"></script>

<!--[if lt IE 9]>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
<![endif]-->
<script type="text/javascript">
/* <![CDATA[ */
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-27864271-1']);
_gaq.push(['_trackPageview']);

(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

(function(b){(function(a){"__CF"in b&&"DJS"in b.__CF?b.__CF.DJS.push(a):"addEventListener"in b?b.addEventListener("load",a,!1):b.attachEvent("onload",a)})(function(){"FB"in b&&"Event"in FB&&"subscribe"in FB.Event&&(FB.Event.subscribe("edge.create",function(a){_gaq.push(["_trackSocial","facebook","like",a])}),FB.Event.subscribe("edge.remove",function(a){_gaq.push(["_trackSocial","facebook","unlike",a])}),FB.Event.subscribe("message.send",function(a){_gaq.push(["_trackSocial","facebook","send",a])}));"twttr"in b&&"events"in twttr&&"bind"in twttr.events&&twttr.events.bind("tweet",function(a){if(a){var b;if(a.target&&a.target.nodeName=="IFRAME")a:{if(a=a.target.src){a=a.split("#")[0].match(/[^?=&]+=([^&]*)?/g);b=0;for(var c;c=a[b];++b)if(c.indexOf("url")===0){b=unescape(c.split("=")[1]);break a}}b=void 0}_gaq.push(["_trackSocial","twitter","tweet",b])}})})})(window);
/* ]]> */
</script>
</head>
<body>

	<div id="kodoc-header">
		<div class="container">
			<a href="http://kohanaframework.org/" id="kodoc-logo">
				<img src="../../guide-media/img/kohana.png" />
			</a>
			<div id="kodoc-menu">
				<ul>
					<li class="guide first">
						<a href="../../guide.1.html">User Guide</a>
					</li>
										<li class="api">
						<a href="../../guide-api.html">API Browser</a>
					</li>
									</ul>
			</div>
		</div>
	</div>

	<div id="kodoc-content">
		<div class="wrapper">
			<div class="container">
				<div class="span-22 prefix-1 suffix-1">
					<ul id="kodoc-breadcrumb">
																				<li><a href="../../guide.1.html">User Guide</a></li>
																											<li><a href="../kohana.1.html">Kohana</a></li>
																											<li class="last">Transparent Extension</li>
																		</ul>
				</div>
				<div class="span-6 prefix-1">
					<div id="kodoc-topics">
						<h2 id="kohana"><a href="index.html">Kohana</a></h2>

<ul>
<li><a href="install.html">Installation</a></li>
<li><span>Getting Started</span>

<ul>
<li><a href="conventions.html">Conventions and Style</a></li>
<li><a href="mvc.1.html">Model View Controller</a>

<ul>
<li><a href="mvc/controllers.html">Controllers</a></li>
<li><a href="mvc/models.html">Models</a></li>
<li><a href="mvc/views.html">Views</a></li>
</ul></li>
<li><a href="files.1.html">Cascading Filesystem</a>

<ul>
<li><a href="files/classes.html">Class Files</a></li>
<li><a href="files/config.html">Config Files</a></li>
<li><a href="files/i18n.html">Translation Files</a></li>
<li><a href="files/messages.html">Message Files</a></li>
</ul></li>
<li><a href="config.html">Configuration</a></li>
<li><a href="flow.html">Request Flow</a></li>
<li><a href="bootstrap.html">Bootstrap</a></li>
<li><a href="modules.html">Modules</a></li>
<li><a href="routing.html">Routing</a></li>
<li><a href="errors.html">Error Handling</a></li>
<li><a href="tips.html">Tips &amp; Common Mistakes</a></li>
<li><a href="upgrading.html">Upgrading from v3.2</a></li>
</ul></li>
<li><span>Basic Usage</span>

<ul>
<li><a href="debugging.html">Debugging</a></li>
<li><a href="autoloading.html">Loading Classes</a></li>
<li><a href="extension.html">Transparent Extension</a></li>
<li><a href="helpers.html">Helpers</a></li>
<li><a href="requests.html">Requests</a></li>
<li><a href="sessions.html">Sessions</a></li>
<li><a href="cookies.html">Cookies</a></li>
<li><a href="fragments.html">Fragments</a></li>
<li><a href="profiling.html">Profiling</a></li>
</ul></li>
<li><a href="security.1.html">Security</a>

<ul>
<li><a href="security/xss.html">XSS</a></li>
<li><a href="security/validation.html">Validation</a></li>
<li><a href="security/cookies.html">Cookies</a></li>
<li><a href="security/database.html">Database</a></li>
<li><a href="security/encryption.html">Encryption</a></li>
<li><a href="security/deploying.html">Deploying</a></li>
</ul></li>
<li><span>Tutorials</span>

<ul>
<li><a href="tutorials/hello-world.html">Hello World</a></li>
<li><a href="tutorials/simple-mvc.html">Simple MVC</a></li>
<li><a href="tutorials/error-pages.html">Custom Error Pages</a></li>
<li><a href="tutorials/clean-urls.html">Clean URLs</a></li>
<li><a href="tutorials/sharing-kohana.html">Sharing Kohana</a></li>
<li><a href="tutorials/library-kohana.html">Kohana as a Library</a></li>
<li><a href="tutorials/git.html">Working with Git</a></li>
</ul></li>
</ul>
					</div>
				</div>
				<div id="kodoc-body" class="span-16 suffix-1 last">
					<h1 id="transparent-class-extension">Transparent Class Extension</h1>

<div class="page-toc">
					<a href="extension.html#transparent-class-extension">Transparent Class Extension</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="extension.html#how-it-works">How it works</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="extension.html#example-changing-cookie-settings">Example: changing [Cookie] settings</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="extension.html#example-todo-an-example">Example: TODO: an example</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="extension.html#example-todo-something-else">Example: TODO: something else</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="extension.html#more-examples">More examples</a><br />
					&nbsp;&nbsp;&nbsp;&nbsp;				<a href="extension.html#multiple-levels-of-extension">Multiple Levels of Extension</a><br />
	</div>
<p>The <a href="files.1.html">cascading filesystem</a> allows transparent class extension. For instance, the class <a href="../../guide-api/Cookie.html">Cookie</a> is defined in <code>SYSPATH/classes/Cookie.php</code> as:</p>

<pre><code>class Cookie extends Kohana_Cookie {}
</code></pre>

<p>The default Kohana classes, and many extensions, use this definition so that almost all classes can be extended. You extend any class transparently, by defining your own class in <code>APPPATH/classes/Cookie.php</code> to add your own methods.</p>

<p class="note">You should <strong>never</strong> modify any of the files that are distributed with Kohana. Always make modifications to classes using transparent extension to prevent upgrade issues.</p>

<p>For instance, if you wanted to create method that sets encrypted cookies using the <a href="../../guide-api/Encrypt.html">Encrypt</a> class, you would create a file at <code>APPPATH/classes/Cookie.php</code> that extends Kohana_Cookie, and adds your functions:</p>

<pre><code>&lt;?php defined('SYSPATH') OR die('No direct script access.');

class Cookie extends Kohana_Cookie {

    /**
     * @var  mixed  default encryption instance
     */
    public static $encryption = 'default';

    /**
     * Sets an encrypted cookie.
     *
     * @uses  Cookie::set
     * @uses  Encrypt::encode
     */
     public static function encrypt($name, $value, $expiration = NULL)
     {
         $value = Encrypt::instance(Cookie::$encrpytion)-&gt;encode((string) $value);

         parent::set($name, $value, $expiration);
     }

     /**
      * Gets an encrypted cookie.
      *
      * @uses  Cookie::get
      * @uses  Encrypt::decode
      */
      public static function decrypt($name, $default = NULL)
      {
          if ($value = parent::get($name, NULL))
          {
              $value = Encrypt::instance(Cookie::$encryption)-&gt;decode($value);
          }

          return isset($value) ? $value : $default;
      }

} // End Cookie
</code></pre>

<p>Now calling <code>Cookie::encrypt('secret', $data)</code> will create an encrypted cookie which we can decrypt with <code>$data = Cookie::decrypt('secret')</code>.</p>

<h2 id="how-it-works">How it works</h2>

<p>To understand how this works, let's look at what happens normally.  When you use the Cookie class, <a href="http://kohanaframework.org/3.3/guide-api/Kohana#autoload">Kohana::autoload</a> looks for <code>classes/Cookie.php</code> in the <a href="files.1.html">cascading filesystem</a>.  It looks in <code>application</code>, then each module, then <code>system</code>. The file is found in <code>system</code> and is included.  Of course, <code>system/classes/Cookie.php</code> is just an empty class which extends <code>Kohana_Cookie</code>.  Again, <a href="http://kohanaframework.org/3.3/guide-api/Kohana#autoload">Kohana::autoload</a> is called this time looking for <code>classes/Kohana/Cookie.php</code> which it finds in <code>system</code>.</p>

<p>When you add your transparently extended cookie class at <code>application/classes/Cookie.php</code> this file essentially "replaces" the file at <code>system/classes/Cookie.php</code> without actually touching it.  This happens because this time when we use the Cookie class <a href="http://kohanaframework.org/3.3/guide-api/Kohana#autoload">Kohana::autoload</a> looks for <code>classes/Cookie.php</code> and finds the file in <code>application</code> and includes that one, instead of the one in system.</p>

<h2 id="example-changing-cookie-settings">Example: changing <a href="../../guide-api/Cookie.html">Cookie</a> settings</h2>

<p>If you are using the <a href="cookies.html">Cookie</a> class, and want to change a setting, you should do so using transparent extension, rather than editing the file in the system folder.  If you edit it directly, and in the future you upgrade your Kohana version by replacing the system folder, your changes will be reverted and your cookies will probably be invalid.  Instead, create a Cookie.php file either in <code>application/classes/Cookie.php</code> or a module (<code>MODPATH/&lt;modulename&gt;/classes/Cookie.php</code>).</p>

<pre><code>class Cookie extends Kohana_Cookie {

    // Set a new salt
    public $salt = "some new better random salt phrase";

    // Don't allow javascript access to cookies
    public $httponly = TRUE;

}
</code></pre>

<h2 id="example-todo-an-example">Example: TODO: an example</h2>

<p>Just post the code and brief description of what function it adds, you don't have to do the "How it works" like above.</p>

<h2 id="example-todo-something-else">Example: TODO: something else</h2>

<p>Just post the code and brief description of what function it adds, you don't have to do the "How it works" like above.</p>

<h2 id="more-examples">More examples</h2>

<p>TODO: Provide some links to modules on github, etc that have examples of transparent extension in use.</p>

<h2 id="multiple-levels-of-extension">Multiple Levels of Extension</h2>

<p>If you are extending a Kohana class in a module, you should maintain transparent extensions. In other words, do not include any variables or function in the "base" class (eg. Cookie). Instead make your own namespaced class, and have the "base" class extend that one. With our Encrypted cookie example we can create <code>MODPATH/mymod/Encrypted/Cookie.php</code>:</p>

<pre><code>class Encrypted_Cookie extends Kohana_Cookie {

    // Use the same encrypt() and decrypt() methods as above

}
</code></pre>

<p>And create <code>MODPATH/mymod/Cookie.php</code>:</p>

<pre><code>class Cookie extends Encrypted_Cookie {}
</code></pre>

<p>This will still allow users to add their own extension to <a href="../../guide-api/Cookie.html">Cookie</a> while leaving your extensions intact. To do that they would make a cookie class that extends <code>Encrypted_Cookie</code> (rather than <code>Kohana_Cookie</code>) in their application folder.</p>

									</div>
			</div>
		</div>
	</div>

	<div id="kodoc-footer">
		<div class="container">
			<div class="span-12">
							<p>&copy; 2008–2012 Kohana Team</p>
						</div>
			<div class="span-12 last right">
			<p>Powered by <a href="http://kohanaframework.org/">Kohana</a> v3.3.1</p>
			</div>
		</div>
	</div>

</body>
</html>
