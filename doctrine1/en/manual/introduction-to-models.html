

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction to Models &mdash; Doctrine 1.2.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Doctrine 1.2.4 documentation" href="../../index.html" />
    <link rel="up" title="Doctrine 1.2 ORM Manual" href="index.html" />
    <link rel="next" title="Defining Models" href="defining-models.html" />
    <link rel="prev" title="Connections" href="connections.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="defining-models.html" title="Defining Models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="connections.html" title="Connections"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="introduction-to-models">
<h1>Introduction to Models<a class="headerlink" href="#introduction-to-models" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>At the lowest level, Doctrine represents your database schema with a set of PHP
classes. These classes define the schema and behavior of your model.</p>
<p>A basic model that represents a user in a web application might look something
like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">actAs</span><span class="p">(</span><span class="s1">&#39;Timestampable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We aren&#8217;t actually going to use the above class definition, it is only
meant to be an example. We will generate our first class definition from an
existing database table later in this chapter.</p>
</div>
<p>Each <a href="#id1"><span class="problematic" id="id2">:php:class:`Doctrine_Record`</span></a> child class can have a
<a href="#id3"><span class="problematic" id="id4">:php:meth:`setTableDefinition`</span></a> and <a href="#id5"><span class="problematic" id="id6">:php:meth:`setUp`</span></a> method. The
<a href="#id7"><span class="problematic" id="id8">:php:meth:`setTableDefinition`</span></a> method is for defining columns, indexes and
other information about the schema of tables. The <a href="#id9"><span class="problematic" id="id10">:php:meth:`setUp`</span></a> method is
for attaching behaviors and defining relationships between
<a href="#id11"><span class="problematic" id="id12">:php:class:`Doctrine_Record`</span></a> child classes. In the above example we are
enabling the Timestampable behavior which adds some automagic functionality.
You will learn more about what all can be used in these functions in the
<a class="reference internal" href="defining-models.html"><em>Defining Models</em></a> chapter.</p>
</div>
<div class="section" id="generating-models">
<h2>Generating Models<a class="headerlink" href="#generating-models" title="Permalink to this headline">¶</a></h2>
<p>Doctrine offers ways to generate these classes to make it easier to get started
using Doctrine.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generating from existing databases is only meant to be a convenience for
getting started. After you generate from the database you will have to tweak it
and clean things up as needed.</p>
</div>
<div class="section" id="existing-databases">
<h3>Existing Databases<a class="headerlink" href="#existing-databases" title="Permalink to this headline">¶</a></h3>
<p>A common case when looking for ORM tools like Doctrine is that the database and
the code that access it is growing large/complex. A more substantial tool is
needed than manual SQL code.</p>
<p>Doctrine has support for generating <a href="#id13"><span class="problematic" id="id14">:php:class:`Doctrine_Record`</span></a> classes from
your existing database. There is no need for you to manually write all the
<a href="#id15"><span class="problematic" id="id16">:php:class:`Doctrine_Record`</span></a> classes for your domain model.</p>
<div class="section" id="making-the-first-import">
<h4>Making the first import<a class="headerlink" href="#making-the-first-import" title="Permalink to this headline">¶</a></h4>
<p>Let&#8217;s consider we have a mysql database called <tt class="docutils literal"><span class="pre">doctrine_test</span></tt> with a single
table named <tt class="docutils literal"><span class="pre">user</span></tt>. The <tt class="docutils literal"><span class="pre">user</span></tt> table has been created with the following
sql statement:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">user</span> <span class="p">(</span>
    <span class="n">id</span> <span class="kt">BIGINT</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="kp">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="n">first_name</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="no">NULL</span><span class="p">,</span>
    <span class="n">last_name</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="no">NULL</span><span class="p">,</span>
    <span class="n">username</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="no">NULL</span><span class="p">,</span>
    <span class="n">password</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="no">NULL</span><span class="p">,</span>
    <span class="n">type</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="no">NULL</span><span class="p">,</span>
    <span class="n">is_active</span> <span class="kt">TINYINT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="n">is_super_admin</span> <span class="kt">TINYINT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
    <span class="n">created_at</span> <span class="kt">TIMESTAMP</span><span class="p">,</span>
    <span class="n">updated_at</span> <span class="kt">TIMESTAMP</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="kp">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span>
</pre></div>
</div>
<p>Now we would like to convert it into <a href="#id17"><span class="problematic" id="id18">:php:class:`Doctrine_Record`</span></a> class. With
Doctrine this is easy! Remember our test script we created in the
<a class="reference internal" href="getting-started.html"><em>Getting Started</em></a> chapter? We&#8217;re going to use that generate our models.</p>
<p>First we need to modify our <tt class="docutils literal"><span class="pre">bootstrap.php</span></tt> to use the MySQL database
instead of sqlite memory:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Doctrine_Manager</span><span class="o">::</span><span class="na">connection</span><span class="p">(</span><span class="s1">&#39;mysql://root:mys3cr3et@localhost/doctrinetest&#39;</span><span class="p">,</span> <span class="s1">&#39;doctrine&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use the <a href="#id19"><span class="problematic" id="id20">:php:meth:`$conn-&gt;createDatabase`</span></a> method to create the
database if it does not already exist and the connected user has permission to
create databases. Then use the above provided <tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></tt> statement to
create the table.</p>
</div>
<p>Now we need a place to store our generated classes so lets create a directory
named <tt class="docutils literal"><span class="pre">models</span></tt> in the <tt class="docutils literal"><span class="pre">doctrine_test</span></tt> directory:</p>
<div class="highlight-sh"><div class="highlight"><pre>mkdir doctrine_test/models
</pre></div>
</div>
<p>Now we just need to add the code to our <tt class="docutils literal"><span class="pre">test.php</span></tt> script to generate the
model classes:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">generateModelsFromDb</span><span class="p">(</span>
    <span class="s1">&#39;models&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;generateTableClasses&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">generateModelsFromDb</span></tt> method only requires one parameter and it is
the import directory (the directory where the generated record files will be
written to). The second argument is an array of database connection names to
generate models for, and the third is the array of options to use for the model
building.</p>
</div>
<p>That&#8217;s it! Now there should be a file called <tt class="docutils literal"><span class="pre">BaseUser.php</span></tt> in your
<tt class="docutils literal"><span class="pre">doctrine_test/models/generated</span></tt> directory. The file should look like the
following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/generated/BaseUser.php</span>
<span class="sd">/**</span>
<span class="sd"> * This class has been auto-generated by the Doctrine ORM Framework</span>
<span class="sd"> */</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">BaseUser</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setTableName</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="s1">&#39;autoincrement&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;is_active&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;is_super_admin&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0&#39;</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span>
                <span class="s1">&#39;notnull&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span>
            <span class="s1">&#39;updated_at&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span>
                <span class="s1">&#39;notnull&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You should also have a file called <tt class="docutils literal"><span class="pre">User.php</span></tt> in your
<tt class="docutils literal"><span class="pre">doctrine_test/models</span></tt> directory. The file should look like the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="sd">/**</span>
<span class="sd"> * This class has been auto-generated by the Doctrine ORM Framework</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Doctrine will automatically generate a skeleton <a href="#id21"><span class="problematic" id="id22">:php:class:`Doctrine_Table`</span></a>
class for the model at <tt class="docutils literal"><span class="pre">doctrine_test/models/UserTable.php</span></tt> because we passed
the option <tt class="docutils literal"><span class="pre">generateTableClasses</span></tt> with a value of <tt class="docutils literal"><span class="pre">true</span></tt>.  The file should
look like the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/UserTable.php</span>
<span class="sd">/**</span>
<span class="sd"> * This class has been auto-generated by the Doctrine ORM Framework</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">UserTable</span> <span class="k">extends</span> <span class="nx">Doctrine_Table</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can place custom functions inside the <tt class="docutils literal"><span class="pre">User</span></tt> and <tt class="docutils literal"><span class="pre">UserTable</span></tt>
classes to customize the functionality of your models. Below are some
examples:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setPassword</span><span class="p">(</span><span class="nv">$password</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_set</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$password</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order for the above <tt class="docutils literal"><span class="pre">password</span></tt> accessor overriding to work properly
you must enabled the <tt class="docutils literal"><span class="pre">auto_accessor_override</span></tt> attribute in your
<tt class="docutils literal"><span class="pre">bootstrap.php</span></tt> file like done below:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_AUTO_ACCESSOR_OVERRIDE</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Now when you try and set a users password it will be md5 encrypted.
First we need to modify our <tt class="docutils literal"><span class="pre">bootstrap.php</span></tt> file to include some code
for autoloading our models from the <tt class="docutils literal"><span class="pre">models</span></tt> directory:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">loadModels</span><span class="p">(</span><span class="s1">&#39;models&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The model loading is fully explained later in the <a class="reference internal" href="#autoloading-models"><em>Autoloading Models</em></a> section of this chapter.</p>
</div>
<p>Now we can modify <tt class="docutils literal"><span class="pre">test.php</span></tt> to include some code which will test the changes
we made to the <tt class="docutils literal"><span class="pre">User</span></tt> model:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;changeme&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">;</span> <span class="c1">// outputs md5 hash and not changeme</span>
</pre></div>
</div>
<p>Now when you execute <tt class="docutils literal"><span class="pre">test.php</span></tt> from your terminal you should see the
following:</p>
<div class="highlight-sh"><div class="highlight"><pre>php test.php 4cb9c8a8048fd02294477fcb1a41191a
</pre></div>
</div>
<p>Here is an example of some custom functions you might add to the <tt class="docutils literal"><span class="pre">UserTable</span></tt>
class:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/UserTable.php</span>
<span class="k">class</span> <span class="nc">UserTable</span> <span class="k">extends</span> <span class="nx">Doctrine_Table</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCreatedToday</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$today</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d h:i:s&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">)));</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.created_at &gt; ?&#39;</span><span class="p">,</span> <span class="nv">$today</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order for custom <a href="#id23"><span class="problematic" id="id24">:php:class:`Doctrine_Table`</span></a> classes to be loaded you must
enable the <tt class="docutils literal"><span class="pre">autoload_table_classes</span></tt> attribute in your <tt class="docutils literal"><span class="pre">bootstrap.php</span></tt> file
like done below:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_AUTOLOAD_TABLE_CLASSES</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Now you have access to this function when you are working with the
<tt class="docutils literal"><span class="pre">UserTable</span></tt> instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$usersCreatedToday</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getCreatedToday</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="schema-files">
<h3>Schema Files<a class="headerlink" href="#schema-files" title="Permalink to this headline">¶</a></h3>
<p>You can alternatively manage your models with YAML schema files and
generate PHP classes from them. First lets generate a YAML schema file
from the existing models we already have to make things easier. Change
<tt class="docutils literal"><span class="pre">test.php</span></tt> to have the following code inside:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">generateYamlFromModels</span><span class="p">(</span><span class="s1">&#39;schema.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Execute the <tt class="docutils literal"><span class="pre">test.php</span></tt> script:</p>
<div class="highlight-sh"><div class="highlight"><pre>php test.php
</pre></div>
</div>
<p>Now you should see a file named <tt class="docutils literal"><span class="pre">schema.yml</span></tt> created in the root of
the <tt class="docutils literal"><span class="pre">doctrine_test</span></tt> directory. It should look like the following:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">tableName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user</span>
<span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer(8)</span>
    <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">autoincrement</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
  <span class="l-Scalar-Plain">is_active</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer(1)</span>
    <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="s">&#39;1&#39;</span>
  <span class="l-Scalar-Plain">is_super_admin</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer(1)</span>
    <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="s">&#39;0&#39;</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp(25)</span>
    <span class="l-Scalar-Plain">notnull</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
  <span class="l-Scalar-Plain">updated_at</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp(25)</span>
    <span class="l-Scalar-Plain">notnull</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
  <span class="l-Scalar-Plain">first_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">last_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
</pre></div>
</div>
<p>So now that we have a valid YAML schema file, we can now maintain our schema
from here and generate the PHP classes from here. Lets create a new php script
called <tt class="docutils literal"><span class="pre">generate.php</span></tt>. This script will re-generate everything and make sure
the database is reinstantiated each time the script is called:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// generate.php</span>
<span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;bootstrap.php&#39;</span><span class="p">);</span>

<span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">dropDatabases</span><span class="p">();</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">createDatabases</span><span class="p">();</span>
<span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">generateModelsFromYaml</span><span class="p">(</span><span class="s1">&#39;schema.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">);</span>
<span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">createTablesFromModels</span><span class="p">(</span><span class="s1">&#39;models&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now you can alter your <tt class="docutils literal"><span class="pre">schema.yml</span></tt> and re-generate your models by
running the following command from your terminal:</p>
<div class="highlight-sh"><div class="highlight"><pre>php generate.php
</pre></div>
</div>
<p>Now that we have our YAML schema file setup and we can re-generate our
models from the schema files lets cleanup the file a little and take
advantage of some of the power of Doctrine:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">actAs</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Timestampable</span><span class="p-Indicator">]</span>
<span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">is_active</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer(1)</span>
    <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="s">&#39;1&#39;</span>
  <span class="l-Scalar-Plain">is_super_admin</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer(1)</span>
    <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="s">&#39;0&#39;</span>
  <span class="l-Scalar-Plain">first_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">last_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Notice some of the changes we made:</strong></p>
<ol class="arabic simple">
<li>Removed the explicit <tt class="docutils literal"><span class="pre">tableName</span></tt> definition as it will default to user.</li>
<li>Attached the <tt class="docutils literal"><span class="pre">Timestampable</span></tt> behavior.</li>
<li>Removed <tt class="docutils literal"><span class="pre">id</span></tt> column as it is automatically added if no primary key is defined.</li>
<li>Removed <tt class="docutils literal"><span class="pre">updated_at</span></tt> and <tt class="docutils literal"><span class="pre">created_at</span></tt> columns as they can be handled automatically by the <tt class="docutils literal"><span class="pre">Timestampable</span></tt> behavior.</li>
</ol>
<p class="last">Now look how much cleaner the YAML is and is because we take advantage of
defaults and utilize core behaviors it is much less work we have to do
ourselves.</p>
</div>
<p>Now re-generate your models from the YAML schema file:</p>
<div class="highlight-sh"><div class="highlight"><pre>php generate.php
</pre></div>
</div>
<p>You can learn more about YAML Schema Files in its <a class="reference internal" href="yaml-schema-files.html"><em>dedicated chapter</em></a>.</p>
</div>
</div>
<div class="section" id="manually-writing-models">
<h2>Manually Writing Models<a class="headerlink" href="#manually-writing-models" title="Permalink to this headline">¶</a></h2>
<p>You can optionally skip all the convenience methods and write your
models manually using nothing but your own PHP code. You can learn all
about the models syntax in the <a class="reference internal" href="defining-models.html"><em>Defining Models</em></a> chapter.</p>
</div>
<div class="section" id="autoloading-models">
<span id="id25"></span><h2>Autoloading Models<a class="headerlink" href="#autoloading-models" title="Permalink to this headline">¶</a></h2>
<p>Doctrine offers two ways of loading models. We have conservative (lazy)
loading, and aggressive loading. Conservative loading will not require the PHP
file initially, instead it will cache the path to the class name and this path
is then used in the <a href="#id26"><span class="problematic" id="id27">:php:meth:`Doctrine_Core::modelsAutoload`</span></a>.</p>
<p>To use Doctrine model loading you need to register the model autoloader in your
bootstrap:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nb">spl_autoload_register</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Doctrine_Core&#39;</span><span class="p">,</span> <span class="s1">&#39;modelsAutoload&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Below are some examples using the both types of model loading.</p>
<div class="section" id="conservative">
<h3>Conservative<a class="headerlink" href="#conservative" title="Permalink to this headline">¶</a></h3>
<p>Conservative model loading is going to be the ideal model loading method for a
production environment. This method will lazy load all of the models instead of
loading them all when model loading is executed.</p>
<p>Conservative model loading requires that each file contain only one class, and
the file must be named after the class. For example, if you have a class named
<tt class="docutils literal"><span class="pre">User</span></tt>, it must be contained in a file named <tt class="file docutils literal"><span class="pre">User.php</span></tt>.</p>
<p>To use conservative model loading we need to set the model loading
attribute to be conservative:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_MODEL_LOADING</span><span class="p">,</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">MODEL_LOADING_CONSERVATIVE</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We already made this change in an earlier step in the <tt class="docutils literal"><span class="pre">bootstrap.php</span></tt>
file so you don&#8217;t need to make this change again.</p>
</div>
<p>When we use the <a href="#id28"><span class="problematic" id="id29">:php:meth:`Doctrine_Core::loadModels`</span></a> functionality all found
classes will be cached internally so the autoloader can require them later:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">loadModels</span><span class="p">(</span><span class="s1">&#39;models&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now when we instantiate a new class, for example a <tt class="docutils literal"><span class="pre">User</span></tt> class, the
autoloader will be triggered and the class is required:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// triggers call to Doctrine_Core::modelsAutoload() and the class is included</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</pre></div>
</div>
<p>Instantiating the class above triggers a call to
<a href="#id30"><span class="problematic" id="id31">:php:meth:`Doctrine_Core::modelsAutoload`</span></a> and the class that was found in the
call to <a href="#id32"><span class="problematic" id="id33">:php:meth:`Doctrine_Core::loadModels`</span></a> will be required and made
available.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Conservative model loading is recommended in most cases,
specifically for production environments as you do not want to
require every single model class even when it is not needed as this
is unnecessary overhead. You only want to require it when it is
needed.</p>
</div>
</div>
<div class="section" id="aggressive">
<h3>Aggressive<a class="headerlink" href="#aggressive" title="Permalink to this headline">¶</a></h3>
<p>Aggressive model loading is the default model loading method and is very
simple, it will look for all files with a <tt class="docutils literal"><span class="pre">.php</span></tt> extension and will include
it. Doctrine can not satisfy any inheritance and if your models extend another
model, it cannot include them in the correct order so it is up to you to make
sure all dependencies are satisfied in each class.</p>
<p>With aggressive model loading you can have multiple classes per file and
the file name is not required to be related to the name of the class
inside of the file.</p>
<p>The downside of aggressive model loading is that every php file is
included in every request, so if you have lots of models it is
recommended you use conservative model loading.</p>
<p>To use aggressive model loading we need to set the model loading
attribute to be aggressive:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_MODEL_LOADING</span><span class="p">,</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">MODEL_LOADING_AGGRESSIVE</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Aggressive is the default of the model loading attribute so
explicitly setting it is not necessary if you wish to use it.</p>
</div>
<p>When we use the <a href="#id34"><span class="problematic" id="id35">:php:meth:`Doctrine_Core::loadModels`</span></a> functionality all the
classes found will be included right away:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">loadModels</span><span class="p">(</span><span class="s1">&#39;/path/to/models&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This chapter is probably the most intense chapter so far but it is a good one.
We learned a little about how to use models, how to generate models from
existing databases, how to write our own models, and how to maintain our models
as YAML schema files. We also modified our Doctrine test environment to
implement some functionality for loading models from our models directory.</p>
<p>This topic of Doctrine models is so large that it warranted the chapters being
split in to three pieces to make it easier on the developer to absorb all the
information. In <a class="reference internal" href="defining-models.html"><em>Defining Models</em></a> we will really get in to the API we use
to define our models.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction to Models</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#generating-models">Generating Models</a><ul>
<li><a class="reference internal" href="#existing-databases">Existing Databases</a><ul>
<li><a class="reference internal" href="#making-the-first-import">Making the first import</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schema-files">Schema Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manually-writing-models">Manually Writing Models</a></li>
<li><a class="reference internal" href="#autoloading-models">Autoloading Models</a><ul>
<li><a class="reference internal" href="#conservative">Conservative</a></li>
<li><a class="reference internal" href="#aggressive">Aggressive</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="connections.html"
                        title="previous chapter">Connections</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="defining-models.html"
                        title="next chapter">Defining Models</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/en/manual/introduction-to-models.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="defining-models.html" title="Defining Models"
             >next</a> |</li>
        <li class="right" >
          <a href="connections.html" title="Connections"
             >previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" >Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jonathan Wage and Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>