

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Defining Models &mdash; Doctrine 1.2.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Doctrine 1.2.4 documentation" href="../../index.html" />
    <link rel="up" title="Doctrine 1.2 ORM Manual" href="index.html" />
    <link rel="next" title="Working with Models" href="working-with-models.html" />
    <link rel="prev" title="Introduction to Models" href="introduction-to-models.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="working-with-models.html" title="Working with Models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction-to-models.html" title="Introduction to Models"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="defining-models">
<h1>Defining Models<a class="headerlink" href="#defining-models" title="Permalink to this headline">¶</a></h1>
<p>As we mentioned before, at the lowest level in Doctrine your schema is
represented by a set of php classes that map the schema meta data for your
database tables.</p>
<p>In this chapter we will explain in detail how you can map your schema
information using php code.</p>
<div class="section" id="columns">
<h2>Columns<a class="headerlink" href="#columns" title="Permalink to this headline">¶</a></h2>
<p>One problem with database compatibility is that many databases differ in their
behavior of how the result set of a query is returned. MySQL leaves the field
names unchanged, which means if you issue a query of the form <tt class="docutils literal"><span class="pre">&quot;SELECT</span> <span class="pre">myField</span>
<span class="pre">FROM</span> <span class="pre">...&quot;</span></tt> then the result set will contain the field <tt class="docutils literal"><span class="pre">myField</span></tt>.</p>
<p>Unfortunately, this is just the way MySQL and some other databases do
it. Postgres for example returns all field names in lowercase whilst
Oracle returns all field names in uppercase. &#8220;So what? In what way does
this influence me when using Doctrine?&#8221;, you may ask. Fortunately, you
don&#8217;t have to bother about that issue at all.</p>
<p>Doctrine takes care of this problem transparently. That means if you define a
derived Record class and define a field called <tt class="docutils literal"><span class="pre">myField</span></tt> you will always
access it through <tt class="docutils literal"><span class="pre">$record-&gt;myField</span></tt> (or <tt class="docutils literal"><span class="pre">$record['myField']</span></tt>, whatever
you prefer) no matter whether you&#8217;re using MySQL or Postgres or Oracle etc.</p>
<p>In short: You can name your fields however you want, using under_scores,
camelCase or whatever you prefer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In Doctrine columns and column aliases are case sensitive.  So when you are
using columns in your DQL queries, the column/field names must match the
case in your model definition.</p>
</div>
<div class="section" id="column-lengths">
<h3>Column Lengths<a class="headerlink" href="#column-lengths" title="Permalink to this headline">¶</a></h3>
<p>In Doctrine column length is an integer that specifies the column length. Some
column types depend not only the given portable type but also on the given
length. For example type <tt class="docutils literal"><span class="pre">string</span></tt> with length 1000 will be translated into native
type <tt class="docutils literal"><span class="pre">TEXT</span></tt> on mysql.</p>
<p>The length is different depending on the type of column you are using:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">integer</span></tt></dt>
<dd><p class="first last">Length is the the number of bytes the integer occupies.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">string</span></tt></dt>
<dd><p class="first last">Number of the characters allowed in the string.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">float/decimal</span></tt></dt>
<dd><p class="first last">Total number of characters allowed excluding the decimal.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">enum</span></tt></dt>
<dd><p class="first last">If using native enum length does not apply but if using
emulated enums then it is just the string length of the
column value.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="column-aliases">
<h3>Column Aliases<a class="headerlink" href="#column-aliases" title="Permalink to this headline">¶</a></h3>
<p>Doctrine offers a way of setting column aliases. This can be very useful when
you want to keep the application logic separate from the database logic. For
example if you want to change the name of the database field all you need to
change at your application is the column definition.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Book.php</span>
<span class="k">class</span> <span class="nc">Book</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;bookTitle as title&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Book</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">bookTitle</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bookTitle as title</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
</pre></div>
</div>
<p>Now the column in the database is named bookTitle but you can access the
property on your objects using title.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Book</span><span class="p">();</span>
<span class="nv">$book</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;Some book&#39;</span><span class="p">;</span>
<span class="nv">$book</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="default-values">
<h3>Default values<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h3>
<p>Doctrine supports default values for all data types. When default value
is attached to a record column this means two things. First this value
is attached to every newly created Record and when Doctrine creates your
database tables it includes the default value in the create table
statement.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/generated/BaseUser.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;default username&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
      <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">default username</span>
    <span class="c1">#...</span>
</pre></div>
</div>
<p>Now when you print the name on a brand new User record it will print the
default value:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span> <span class="c1">// default username</span>
</pre></div>
</div>
</div>
<div class="section" id="data-types">
<h3>Data types<a class="headerlink" href="#data-types" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<p>All DBMS provide multiple choice of data types for the information that can be
stored in their database table fields. However, the set of data types made
available varies from DBMS to DBMS.</p>
<p>To simplify the interface with the DBMS supported by Doctrine, a base set of
data types was defined. Applications may access them independently of the
underlying DBMS.</p>
<p>The Doctrine applications programming interface takes care of mapping data
types when managing database options. It is also able to convert that is sent
to and received from the underlying DBMS using the respective driver.</p>
<p>The following data type examples should be used with Doctrine&#8217;s
<a href="#id1"><span class="problematic" id="id2">:php:meth:`createTable`</span></a> method. The example array at the end of the data types
section may be used with <a href="#id3"><span class="problematic" id="id4">:php:meth:`createTable`</span></a> to create a portable table on
the DBMS of choice (please refer to the main Doctrine documentation to find out
what DBMS back ends are properly supported). It should also be noted that the
following examples do not cover the creation and maintenance of indices, this
chapter is only concerned with data types and the proper usage thereof.</p>
<p>It should be noted that the length of the column affects in database level type
as well as application level validated length (the length that is validated
with Doctrine validators).</p>
<ol class="arabic simple">
<li>Example: Column named <tt class="docutils literal"><span class="pre">content</span></tt> with type <tt class="docutils literal"><span class="pre">string</span></tt> and length 3000 results in
database type <tt class="docutils literal"><span class="pre">TEXT</span></tt> of which has database level length of 4000. However when
the record is validated it is only allowed to have &#8216;content&#8217; -column with
maximum length of 3000.</li>
<li>Example: Column with type <tt class="docutils literal"><span class="pre">integer</span></tt> and length 1 results in <tt class="docutils literal"><span class="pre">TINYINT</span></tt>
on many databases.</li>
</ol>
<p>In general Doctrine is smart enough to know which integer/string type to
use depending on the specified length.</p>
</div>
<div class="section" id="type-modifiers">
<h4>Type modifiers<a class="headerlink" href="#type-modifiers" title="Permalink to this headline">¶</a></h4>
<p>Within the Doctrine API there are a few modifiers that have been
designed to aid in optimal table design. These are:</p>
<ul class="simple">
<li>The notnull modifiers</li>
<li>The length modifiers</li>
<li>The default modifiers</li>
<li>unsigned modifiers for some field definitions, although not all
DBMS&#8217;s support this modifier for integer field types.</li>
<li>collation modifiers (not supported by all drivers)</li>
<li>fixed length modifiers for some field definitions.</li>
</ul>
<p>Building upon the above, we can say that the modifiers alter the field
definition to create more specific field types for specific usage scenarios.
The notnull modifier will be used in the following way to set the default DBMS
NOT NULL Flag on the field to true or false, depending on the DBMS&#8217;s definition
of the field value: In PostgreSQL the &#8220;NOT NULL&#8221; definition will be set to &#8220;NOT
NULL&#8221;, whilst in MySQL (for example) the &#8220;NULL&#8221; option will be set to &#8220;NO&#8221;. In
order to define a &#8220;NOT NULL&#8221; field type, we simply add an extra parameter to
our definition array (See the <a class="reference internal" href="#data-type-examples"><em>examples</em></a> in the
following section)</p>
<div class="highlight-text"><div class="highlight"><pre>&#39;sometime&#39; = array(
    &#39;type&#39; =&gt; &#39;time&#39;,
    &#39;default&#39; =&gt; &#39;12:34:05&#39;,
    &#39;notnull&#39; =&gt; true,
),
</pre></div>
</div>
<p>Using the above example, we can also explore the default field operator.
Default is set in the same way as the notnull operator to set a default value
for the field. This value may be set in any character set that the DBMS
supports for text fields, and any other valid data for the field&#8217;s data type.
In the above example, we have specified a valid time for the &#8220;Time&#8221; data type,
&#8216;12:34:05&#8217;. Remember that when setting default dates and times, as well as
datetimes, you should research and stay within the epoch of your chosen DBMS,
otherwise you will encounter difficult to diagnose errors!</p>
<div class="highlight-text"><div class="highlight"><pre>&#39;sometext&#39; = array(
    &#39;type&#39; =&gt; &#39;string&#39;,
    &#39;length&#39; =&gt; 12,
),
</pre></div>
</div>
<p>The above example will create a character varying field of length 12 characters
in the database table. If the length definition is left out, Doctrine will
create a length of the maximum allowable length for the data type specified,
which may create a problem with some field types and indexing. Best practice is
to define lengths for all or most of your fields.</p>
</div>
<div class="section" id="boolean">
<h4>Boolean<a class="headerlink" href="#boolean" title="Permalink to this headline">¶</a></h4>
<p>The boolean data type represents only two values that can be either 1 or 0. Do
not assume that these data types are stored as integers because some DBMS
drivers may implement this type with single character text fields for a matter
of efficiency. Ternary logic is possible by using null as the third possible
value that may be assigned to fields of this type.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The next several examples are not meant for you to use and
give them a try. They are simply for demonstrating purposes to show
you how to use the different Doctrine data types using PHP code or
YAML schema files.</p>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;booltest&#39;</span><span class="p">,</span> <span class="s1">&#39;boolean&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">booltest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">boolean</span>
</pre></div>
</div>
</div>
<div class="section" id="integer">
<h4>Integer<a class="headerlink" href="#integer" title="Permalink to this headline">¶</a></h4>
<p>The integer type is the same as integer type in PHP. It may store integer
values as large as each DBMS may handle.</p>
<p>Fields of this type may be created optionally as unsigned integers but
not all DBMS support it. Therefore, such option may be ignored. Truly
portable applications should not rely on the availability of this
option.</p>
<p>The integer type maps to different database type depending on the column
length.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;integertest&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;unsigned&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">integertest</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer(4)</span>
      <span class="l-Scalar-Plain">unsigned</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<div class="section" id="float">
<h4>Float<a class="headerlink" href="#float" title="Permalink to this headline">¶</a></h4>
<p>The float data type may store floating point decimal numbers. This data
type is suitable for representing numbers withina large scale range that
do not require high accuracy. The scale and the precision limits of the
values that may be stored in a database depends on the DBMS that it is
used.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;floattest&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">floattest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">float</span>
</pre></div>
</div>
</div>
<div class="section" id="decimal">
<h4>Decimal<a class="headerlink" href="#decimal" title="Permalink to this headline">¶</a></h4>
<p>The decimal data type may store fixed precision decimal numbers. This
data type is suitable for representing numbers that require high
precision and accuracy.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;decimaltest&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">decimaltest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">decimal</span>
</pre></div>
</div>
<p>You can specify the length of the decimal just like you would set the
<tt class="docutils literal"><span class="pre">length</span></tt> of any other column and you can specify the <tt class="docutils literal"><span class="pre">scale</span></tt> as an
option in the third argument:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;decimaltest&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">decimaltest</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">decimal(18)</span>
      <span class="l-Scalar-Plain">scale</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</pre></div>
</div>
</div>
<div class="section" id="string">
<h4>String<a class="headerlink" href="#string" title="Permalink to this headline">¶</a></h4>
<p>The text data type is available with two options for the length: one
that is explicitly length limited and another of undefined length that
should be as large as the database allows.</p>
<p>The length limited option is the most recommended for efficiency
reasons. The undefined length option allows very large fields but may
prevent the use of indexes, nullability and may not allow sorting on
fields of its type.</p>
<p>The fields of this type should be able to handle 8 bit characters.
Drivers take care of DBMS specific escaping of characters of special
meaning with the values of the strings to be converted to this type.</p>
<p>By default Doctrine will use variable length character types. If fixed
length types should be used can be controlled via the fixed modifier.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;stringtest&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fixed&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">stringtest</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(200)</span>
      <span class="l-Scalar-Plain">fixed</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<div class="section" id="array">
<h4>Array<a class="headerlink" href="#array" title="Permalink to this headline">¶</a></h4>
<p>This is the same as the &#8216;array&#8217; type in PHP:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;arraytest&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">arraytest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">array(10000)</span>
</pre></div>
</div>
</div>
<div class="section" id="object">
<h4>Object<a class="headerlink" href="#object" title="Permalink to this headline">¶</a></h4>
<p>Doctrine supports objects as column types. Basically you can set an
object to a field and Doctrine handles automatically the serialization /
unserialization of that object.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;objecttest&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">objecttest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">object</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The array and object types simply serialize the data when persisting to the
database and unserialize the data when pulling from the database.</p>
</div>
</div>
<div class="section" id="blob">
<h4>Blob<a class="headerlink" href="#blob" title="Permalink to this headline">¶</a></h4>
<p>Blob (Binary Large OBject) data type is meant to store data of undefined
length that may be too large to store in text fields, like data that is
usually stored in files.</p>
<p>Blob fields are usually not meant to be used as parameters of query
search clause (<tt class="docutils literal"><span class="pre">WHERE</span></tt>) unless the underlying DBMS supports a feature
usually known as &#8220;full text search&#8221;.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;blobtest&#39;</span><span class="p">,</span> <span class="s1">&#39;blob&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">blobtest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">blob</span>
</pre></div>
</div>
</div>
<div class="section" id="clob">
<h4>Clob<a class="headerlink" href="#clob" title="Permalink to this headline">¶</a></h4>
<p>Clob (Character Large OBject) data type is meant to store data of
undefined length that may be too large to store in text fields, like
data that is usually stored in files.</p>
<p>Clob fields are meant to store only data made of printable ASCII
characters whereas blob fields are meant to store all types of data.</p>
<p>Clob fields are usually not meant to be used as parameters of query
search clause (<tt class="docutils literal"><span class="pre">WHERE</span></tt>) unless the underlying DBMS supports a feature
usually known as &#8220;full text search&#8221;.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;clobtest&#39;</span><span class="p">,</span> <span class="s1">&#39;clob&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">clobtest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">clob</span>
</pre></div>
</div>
</div>
<div class="section" id="timestamp">
<h4>Timestamp<a class="headerlink" href="#timestamp" title="Permalink to this headline">¶</a></h4>
<p>The timestamp data type is a mere combination of the date and the time
of the day data types. The representation of values of the time stamp
type is accomplished by joining the date and time string values in a
single string joined by a space. Therefore, the format template is
<tt class="docutils literal"><span class="pre">YYYY-MM-DD</span> <span class="pre">HH:MI:SS</span></tt>. The represented values obey the same rules and
ranges described for the date and time data types.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;timestamptest&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">timestamptest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp</span>
</pre></div>
</div>
</div>
<div class="section" id="time">
<h4>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h4>
<p>The time data type may represent the time of a given moment of the day.
DBMS independent representation of the time of the day is also
accomplished by using text strings formatted according to the ISO-8601
standard.</p>
<p>The format defined by the ISO-8601 standard for the time of the day is
HH:MI:SS where HH is the number of hour the day from 00 to 23 and MI and
SS are respectively the number of the minute and of the second from 00
to 59. Hours, minutes and seconds numbered below 10 should be padded on
the left with 0.</p>
<p>Some DBMS have native support for time of the day formats, but for
others the DBMS driver may have to represent them as integers or text
values. In any case, it is always possible to make comparisons between
time values as well sort query results by fields of this type.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;timetest&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">timetest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">time</span>
</pre></div>
</div>
</div>
<div class="section" id="date">
<h4>Date<a class="headerlink" href="#date" title="Permalink to this headline">¶</a></h4>
<p>The date data type may represent dates with year, month and day. DBMS
independent representation of dates is accomplished by using text
strings formatted according to the IS0-8601 standard.</p>
<p>The format defined by the ISO-8601 standard for dates is YYYY-MM-DD
where YYYY is the number of the year (Gregorian calendar), MM is the
number of the month from 01 to 12 and DD is the number of the day from
01 to 31. Months or days numbered below 10 should be padded on the left
with 0.</p>
<p>Some DBMS have native support for date formats, but for others the DBMS
driver may have to represent them as integers or text values. In any
case, it is always possible to make comparisons between date values as
well sort query results by fields of this type.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;datetest&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">datetest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">date</span>
</pre></div>
</div>
</div>
<div class="section" id="enum">
<h4>Enum<a class="headerlink" href="#enum" title="Permalink to this headline">¶</a></h4>
<p>Doctrine has a unified enum type. The possible values for the column can
be specified on the column definition with
<a href="#id5"><span class="problematic" id="id6">:php:meth:`Doctrine_Record::hasColumn`</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you wish to use native enum types for your DBMS if it
supports it then you must set the following attribute:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_USE_NATIVE_ENUM</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Here is an example of how to specify the enum values:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;enumtest&#39;</span><span class="p">,</span> <span class="s1">&#39;enum&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;values&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;php&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">))</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enumtest</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">enum</span>
      <span class="l-Scalar-Plain">values</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">php</span><span class="p-Indicator">,</span> <span class="nv">java</span><span class="p-Indicator">,</span> <span class="nv">python</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="gzip">
<h4>Gzip<a class="headerlink" href="#gzip" title="Permalink to this headline">¶</a></h4>
<p>Gzip datatype is the same as string except that its automatically
compressed when persisted and uncompressed when fetched. This datatype
can be useful when storing data with a large compressibility ratio, such
as bitmap images.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;gziptest&#39;</span><span class="p">,</span> <span class="s1">&#39;gzip&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">gziptest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">gzip</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The family of php functions for <a class="reference external" href="http://www.php.net/gzcompress">compressing</a> are used internally for compressing and
uncompressing the contents of the gzip column type.</p>
</div>
</div>
</div>
<div class="section" id="examples">
<span id="data-type-examples"></span><h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Consider the following definition:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Example</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fixed&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;32&#39;</span> <span class="p">)</span>
        <span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;someint&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;unsigned&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;10&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;sometime&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span>
            <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;12:34:05&#39;</span><span class="p">,</span>
            <span class="s1">&#39;notnull&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;25&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;sometext&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;12&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;somedate&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;25&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;sometimestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;25&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;someboolean&#39;</span><span class="p">,</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;25&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;somedecimal&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;decimal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;18&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;somefloat&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2147483647&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;someclob&#39;</span><span class="p">,</span> <span class="s1">&#39;clob&#39;</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;clob&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2147483647&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;someblob&#39;</span><span class="p">,</span> <span class="s1">&#39;blob&#39;</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blob&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2147483647&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">Example</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">tableName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">example</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">string(32)</span>
      <span class="l-Scalar-Plain">fixed</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">true</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">someint</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span>     <span class="l-Scalar-Plain">integer(10)</span>
      <span class="l-Scalar-Plain">unsigned</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">sometime</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">time(25)</span>
      <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="s">&#39;12:34:05&#39;</span>
      <span class="l-Scalar-Plain">notnull</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">sometext</span><span class="p-Indicator">:</span>      <span class="l-Scalar-Plain">string(12)</span>
    <span class="l-Scalar-Plain">somedate</span><span class="p-Indicator">:</span>      <span class="l-Scalar-Plain">date(25)</span>
    <span class="l-Scalar-Plain">sometimestamp</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp(25)</span>
    <span class="l-Scalar-Plain">someboolean</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">boolean(25)</span>
    <span class="l-Scalar-Plain">somedecimal</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">decimal(18)</span>
    <span class="l-Scalar-Plain">somefloat</span><span class="p-Indicator">:</span>     <span class="l-Scalar-Plain">float(2147483647)</span>
    <span class="l-Scalar-Plain">someclob</span><span class="p-Indicator">:</span>      <span class="l-Scalar-Plain">clob(2147483647)</span>
    <span class="l-Scalar-Plain">someblob</span><span class="p-Indicator">:</span>      <span class="l-Scalar-Plain">blob(2147483647)</span>
</pre></div>
</div>
<p>The above example will create the following database table in Pgsql:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">id</span></tt></td>
<td><tt class="docutils literal"><span class="pre">character(32)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">someint</span></tt></td>
<td><tt class="docutils literal"><span class="pre">integer</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">sometime</span></tt></td>
<td><tt class="docutils literal"><span class="pre">time</span></tt> without time zone</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">sometext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">character</span></tt> or <tt class="docutils literal"><span class="pre">varying(12)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">somedate</span></tt></td>
<td><tt class="docutils literal"><span class="pre">date</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">sometimestamp</span></tt></td>
<td><tt class="docutils literal"><span class="pre">timestamp</span></tt> without time zone</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">someboolean</span></tt></td>
<td><tt class="docutils literal"><span class="pre">boolean</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">somedecimal</span></tt></td>
<td><tt class="docutils literal"><span class="pre">numeric(18,2)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">somefloat</span></tt></td>
<td><tt class="docutils literal"><span class="pre">double</span></tt> precision</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">someclob</span></tt></td>
<td><tt class="docutils literal"><span class="pre">text</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">someblob</span></tt></td>
<td><tt class="docutils literal"><span class="pre">bytea</span></tt></td>
</tr>
</tbody>
</table>
<p>The schema will create the following database table in Mysql:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">id</span></tt></td>
<td><tt class="docutils literal"><span class="pre">char(32)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">someint</span></tt></td>
<td><tt class="docutils literal"><span class="pre">integer</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">sometime</span></tt></td>
<td><tt class="docutils literal"><span class="pre">time</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">sometext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">varchar(12)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">somedate</span></tt></td>
<td><tt class="docutils literal"><span class="pre">date</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">sometimestamp</span></tt></td>
<td><tt class="docutils literal"><span class="pre">timestamp</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">someboolean</span></tt></td>
<td><tt class="docutils literal"><span class="pre">tinyint(1)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">somedecimal</span></tt></td>
<td><tt class="docutils literal"><span class="pre">decimal(18,2)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">somefloat</span></tt></td>
<td><tt class="docutils literal"><span class="pre">double</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">someclob</span></tt></td>
<td><tt class="docutils literal"><span class="pre">longtext</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">someblob</span></tt></td>
<td><tt class="docutils literal"><span class="pre">longblob</span></tt></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="relationships">
<span id="defining-models-relationships"></span><h2>Relationships<a class="headerlink" href="#relationships" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>Introduction<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>In Doctrine all record relations are being set with
<a href="#id8"><span class="problematic" id="id9">:php:meth:`Doctrine_Record::hasMany`</span></a>, <a href="#id10"><span class="problematic" id="id11">:php:meth:`Doctrine_Record::hasOne`</span></a> methods.
Doctrine supports almost all kinds of database relations from simple
one-to-one foreign key relations to join table self-referencing
relations.</p>
<p>Unlike the column definitions the <a href="#id12"><span class="problematic" id="id13">:php:meth:`Doctrine_Record::hasMany`</span></a> and
<a href="#id14"><span class="problematic" id="id15">:php:meth:`Doctrine_Record::hasOne`</span></a> methods are placed within a method called
setUp(). Both methods take two arguments: the first argument is a string
containing the name of the class and optional alias, the second argument
is an array consisting of relation options. The option array contains
the following keys:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="11%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Optional</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">local</span></tt></td>
<td>No</td>
<td>The local field of the relation. Local field is the
linked field inthe defining class.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">foreign</span></tt></td>
<td>No</td>
<td>The foreign fieldof the relation. Foreign field is
the linked field in the linked class.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">refClass</span></tt></td>
<td>Yes</td>
<td>The name of the association class.This is only
needed for many-to-many associations.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">owningSide</span></tt></td>
<td>Yes</td>
<td>Set to boolean true to indicate the owningside of
the relation. The owning side is the side that owns
the foreignkey. There can only be one owning side in
an association between twoclasses. Note that this
option is required if Doctrine can&#8217;t guess theowning
side or it&#8217;s guess is wrong. An example where this is
the case iswhen both &#8216;local&#8217; and &#8216;foreign&#8217; are part
of the identifier (primarykey).  It never hurts to
specify the owning side in this way.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">onDelete</span></tt></td>
<td>Yes</td>
<td>The <tt class="docutils literal"><span class="pre">onDelete</span></tt> integrity action that is applied on
the foreign key constraint when the tables are
created byDoctrine.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">onUpdate</span></tt></td>
<td>Yes</td>
<td>The <tt class="docutils literal"><span class="pre">onUpdate</span></tt> integrity action that is applied on
the foreign key constraint when thetables are
created by Doctrine.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">cascade</span></tt></td>
<td>Yes</td>
<td>Specify application level cascading operations.
Currently only delete issupported</td>
</tr>
</tbody>
</table>
<p>So lets take our first example, say we have two classes <tt class="docutils literal"><span class="pre">Forum_Board</span></tt>
and <tt class="docutils literal"><span class="pre">Forum_Thread</span></tt>. Here <tt class="docutils literal"><span class="pre">Forum_Board</span></tt> has many
<tt class="docutils literal"><span class="pre">Forum_Threads</span></tt>, hence their relation is one-to-many. We don&#8217;t want
to write <tt class="docutils literal"><span class="pre">Forum_</span></tt> when accessing relations, so we use relation
aliases and use the alias Threads.</p>
<p>First lets take a look at the <tt class="docutils literal"><span class="pre">Forum_Board</span></tt> class. It has three
columns: name, description and since we didn&#8217;t specify any primary key,
Doctrine auto-creates an id column for it.</p>
<p>We define the relation to the <tt class="docutils literal"><span class="pre">Forum_Thread</span></tt> class by using the
<a href="#id16"><span class="problematic" id="id17">:php:meth:`hasMany`</span></a> method. Here the local field is the primary key of the
board class whereas the foreign field is the <tt class="docutils literal"><span class="pre">board_id</span></tt> field of the
<tt class="docutils literal"><span class="pre">Forum_Thread</span></tt> class.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Forum_Board.php</span>
<span class="k">class</span> <span class="nc">Forum_Board</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Forum_Thread as Threads&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;board_id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice the as keyword being used above. This means that the <tt class="docutils literal"><span class="pre">Forum_Board</span></tt>
has a many relationship defined to <tt class="docutils literal"><span class="pre">Forum_Thread</span></tt> but is aliased as
<tt class="docutils literal"><span class="pre">Threads</span></tt>.</p>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in the
<a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Forum_Board</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>        <span class="l-Scalar-Plain">string(100)</span>
    <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(5000)</span>
</pre></div>
</div>
<p>Then lets have a peek at the <tt class="docutils literal"><span class="pre">Forum_Thread</span></tt> class. The columns here
are irrelevant, but pay attention to how we define the relation. Since
each Thread can have only one Board we are using the <a href="#id18"><span class="problematic" id="id19">:php:meth:`hasOne`</span></a>
method. Also notice how we once again use aliases and how the local
column here is <tt class="docutils literal"><span class="pre">board_id</span></tt> while the foreign column is the <tt class="docutils literal"><span class="pre">id</span></tt>
column.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Forum_Thread.php</span>
<span class="k">class</span> <span class="nc">Forum_Thread</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;board_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;Forum_Board as Board&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;board_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in the
<a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre> <span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Forum_Thread</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">board_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">string(200)</span>
    <span class="l-Scalar-Plain">updated</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">integer(10)</span>
    <span class="l-Scalar-Plain">closed</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">integer(1)</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
      <span class="l-Scalar-Plain">foreignAlias</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Threads</span>
    <span class="l-Scalar-Plain">Board</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Forum_Board</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">board_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
      <span class="l-Scalar-Plain">foreignAlias</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Threads</span>
</pre></div>
</div>
<p>Now we can start using these classes. The same accessors that you&#8217;ve already
used for properties are all available for relations.</p>
<p>First lets create a new board:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$board</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Forum_Board</span><span class="p">();</span>
<span class="nv">$board</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;Some board&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Now lets create a new thread under the board:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$board</span><span class="o">-&gt;</span><span class="na">Threads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;new thread 1&#39;</span><span class="p">;</span>
<span class="nv">$board</span><span class="o">-&gt;</span><span class="na">Threads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;new thread 2&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Each <tt class="docutils literal"><span class="pre">Thread</span></tt> needs to be associated to a user so lets create a new
<tt class="docutils literal"><span class="pre">User</span></tt> and associate it to each <tt class="docutils literal"><span class="pre">Thread</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$board</span><span class="o">-&gt;</span><span class="na">Threads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">User</span><span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
<span class="nv">$board</span><span class="o">-&gt;</span><span class="na">Threads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">User</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
</pre></div>
</div>
<p>Now we can save all the changes with one call. It will save the new
board as well as its threads:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$board</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Lets do a little inspecting and see the data structure that is created
when you use the code from above. Add some code to <tt class="file docutils literal"><span class="pre">test.php</span></tt> to
output an array of the object graph we&#8217;ve just populated:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nb">print_r</span><span class="p">(</span><span class="nv">$board</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <a href="#id20"><span class="problematic" id="id21">:php:meth:`Doctrine_Record::toArray`</span></a> takes all the data of a
<a href="#id22"><span class="problematic" id="id23">:php:class:`Doctrine_Record`</span></a> instance and converts it to an array so you
can easily inspect the data of a record. It accepts an argument named
<tt class="docutils literal"><span class="pre">$deep</span></tt> telling it whether or not to include relationships. In this
example we have specified <tt class="docutils literal"><span class="pre">true</span></tt> because we want to include the
<tt class="docutils literal"><span class="pre">Threads</span></tt> data.</p>
</div>
<p>Now when you execute <tt class="file docutils literal"><span class="pre">test.php</span></tt> with PHP from your terminal you should see
the following</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [id] =&gt; 2
    [name] =&gt; Some board
    [description] =&gt;
    [Threads] =&gt; Array
        (
            [0] =&gt; Array
                (
                    [id] =&gt; 3
                    [user_id] =&gt; 1
                    [board_id] =&gt; 2
                    [title] =&gt; new thread 1
                    [updated] =&gt;
                    [closed] =&gt;
                    [User] =&gt; Array
                        (
                            [id] =&gt; 1
                            [is_active] =&gt; 1
                            [is_super_admin] =&gt; 0
                            [first_name] =&gt;
                            [last_name] =&gt;
                            [username] =&gt; jwage
                            [password] =&gt;
                            [type] =&gt;
                            [created_at] =&gt; 2009-01-20 16:41:57
                            [updated_at] =&gt; 2009-01-20 16:41:57
                        )
                )
            [1] =&gt; Array
                (
                    [id] =&gt; 4
                    [user_id] =&gt; 1
                    [board_id] =&gt; 2
                    [title] =&gt; new thread 2
                    [updated] =&gt;
                    [closed] =&gt;
                    [User] =&gt; Array
                        (
                            [id] =&gt; 1
                            [is_active] =&gt; 1
                            [is_super_admin] =&gt; 0
                            [first_name] =&gt;
                            [last_name] =&gt;
                            [username] =&gt; jwage
                            [password] =&gt;
                            [type] =&gt;
                            [created_at] =&gt; 2009-01-20 16:41:57
                            [updated_at] =&gt; 2009-01-20 16:41:57
                        )
                )
        )
)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the auto increment primary key and foreign keys
are automatically set by Doctrine internally. You don&#8217;t have to
worry about the setting of primary keys and foreign keys at all!</p>
</div>
</div>
<div class="section" id="foreign-key-associations">
<h3>Foreign Key Associations<a class="headerlink" href="#foreign-key-associations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="one-to-one">
<h4>One to One<a class="headerlink" href="#one-to-one" title="Permalink to this headline">¶</a></h4>
<p>One-to-one relations are probably the most basic relations. In the
following example we have two classes, <tt class="docutils literal"><span class="pre">User</span></tt> and <tt class="docutils literal"><span class="pre">Email</span></tt> with their
relation being one-to-one.</p>
<p>First lets take a look at the <tt class="docutils literal"><span class="pre">Email</span></tt> class. Since we are binding a
one-to-one relationship we are using the <a href="#id24"><span class="problematic" id="id25">:php:meth:`hasOne`</span></a> method. Notice how
we define the foreign key column (<tt class="docutils literal"><span class="pre">user_id</span></tt>) in the <tt class="docutils literal"><span class="pre">Email</span></tt> class.
This is due to a fact that <tt class="docutils literal"><span class="pre">Email</span></tt> is owned by the <tt class="docutils literal"><span class="pre">User</span></tt> class and
not the other way around. In fact you should always follow this
convention - always place the foreign key in the owned class.</p>
<p>The recommended naming convention for foreign key columns is:
<tt class="docutils literal"><span class="pre">[tableName]_[primaryKey]</span></tt>. As here the foreign table is &#8216;user&#8217; and
its primary key is &#8216;id&#8217; we have named the foreign key column as
&#8216;user_id&#8217;.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Email.php</span>
<span class="k">class</span> <span class="nc">Email</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">150</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Email</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">address</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(150)</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
      <span class="l-Scalar-Plain">foreignType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">one</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When using YAML schema files it is not required to specify the relationship
on the opposite end(<tt class="docutils literal"><span class="pre">User</span></tt>) because the relationship is automatically
flipped and added for you. The relationship will be named the name of the
class. So in this case the relationship on the <tt class="docutils literal"><span class="pre">User</span></tt> side will be called
<tt class="docutils literal"><span class="pre">Email</span></tt> and will be <tt class="docutils literal"><span class="pre">many</span></tt>. If you wish to customize this you can use
the <tt class="docutils literal"><span class="pre">foreignAlias</span></tt> and <tt class="docutils literal"><span class="pre">foreignType</span></tt> options.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">Email</span></tt> class is very similar to the <tt class="docutils literal"><span class="pre">User</span></tt> class. Notice how the local
and foreign columns are switched in the <a href="#id26"><span class="problematic" id="id27">:php:meth:`hasOne`</span></a> definition compared
to the definition of the <tt class="docutils literal"><span class="pre">Email</span></tt> class.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how we override the <a href="#id28"><span class="problematic" id="id29">:php:meth:`setUp`</span></a> method and call
<a href="#id30"><span class="problematic" id="id31">:php:meth:`parent::setUp`</span></a>. This is because the <tt class="docutils literal"><span class="pre">BaseUser</span></tt> class which is
generated from YAML or from an existing database contains the main
<a href="#id32"><span class="problematic" id="id33">:php:meth:`setUp`</span></a> method and we override it in the <tt class="docutils literal"><span class="pre">User</span></tt> class to add
an additional relationship.</p>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l-Scalar-Plain">Email</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
            <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
</pre></div>
</div>
</div>
<div class="section" id="one-to-many-and-many-to-one">
<h4>One to Many and Many to One<a class="headerlink" href="#one-to-many-and-many-to-one" title="Permalink to this headline">¶</a></h4>
<p>One-to-Many and Many-to-One relations are very similar to One-to-One
relations. The recommended conventions you came in terms with in the
previous chapter also apply to one-to-many and many-to-one relations.</p>
<p>In the following example we have two classes: <tt class="docutils literal"><span class="pre">User</span></tt> and
<tt class="docutils literal"><span class="pre">Phonenumber</span></tt>. We define their relation as one-to-many (a user can
have many phonenumbers). Here once again the <tt class="docutils literal"><span class="pre">Phonenumber</span></tt> is clearly
owned by the <tt class="docutils literal"><span class="pre">User</span></tt> so we place the foreign key in the <tt class="docutils literal"><span class="pre">Phonenumber</span></tt>
class.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>

        <span class="c1">// ...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Phonenumber as Phonenumbers&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Phonenumber.php</span>
<span class="k">class</span> <span class="nc">Phonenumber</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">Phonenumbers</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">many</span>
      <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Phonenumber</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>

<span class="l-Scalar-Plain">Phonenumber</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">phonenumber</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(50)</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
</pre></div>
</div>
</div>
<div class="section" id="tree-structure">
<h4>Tree Structure<a class="headerlink" href="#tree-structure" title="Permalink to this headline">¶</a></h4>
<p>A tree structure is a self-referencing foreign key relation. The
following definition is also called Adjacency List implementation in
terms of hierarchical data concepts.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Task.php</span>
<span class="k">class</span> <span class="nc">Task</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;Task as Parent&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Task as Subtasks&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;parent_id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Task</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(100)</span>
    <span class="l-Scalar-Plain">parent_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Parent</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Task</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">parent_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
      <span class="l-Scalar-Plain">foreignAlias</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Subtasks</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above implementation is purely an example and is not the most efficient
way to store and retrieve hierarchical data.  Check the <tt class="docutils literal"><span class="pre">NestedSet</span></tt>
behavior included in Doctrine for the recommended way to deal with
hierarchical data.</p>
</div>
</div>
</div>
<div class="section" id="join-table-associations">
<h3>Join Table Associations<a class="headerlink" href="#join-table-associations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="many-to-many">
<h4>Many to Many<a class="headerlink" href="#many-to-many" title="Permalink to this headline">¶</a></h4>
<p>If you are coming from relational database background it may be familiar to you
how many-to-many associations are handled: an additional association table is
needed.</p>
<p>In many-to-many relations the relation between the two components is always an
aggregate relation and the association table is owned by both ends. For example
in the case of users and groups: when a user is being deleted, the groups
he/she belongs to are not being deleted. However, the associations between this
user and the groups he/she belongs to are instead being deleted. This removes
the relation between the user and the groups he/she belonged to, but does not
remove the user nor the groups.</p>
<p>Sometimes you may not want that association table rows are being deleted when
user / group is being deleted. You can override this behavior by setting the
relations to association component (in this case <tt class="docutils literal"><span class="pre">Groupuser</span></tt>) explicitly.</p>
<p>In the following example we have Groups and Users of which relation is defined
as many-to-many. In this case we also need to define an additional class called
<tt class="docutils literal"><span class="pre">Groupuser</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>

        <span class="c1">// ...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Group as Groups&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;group_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;refClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;UserGroup&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l-Scalar-Plain">Groups</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Group</span>
            <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
            <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">group_id</span>
            <span class="l-Scalar-Plain">refClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UserGroup</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above <tt class="docutils literal"><span class="pre">refClass</span></tt> option is required when setting up many-to-many
relationships.</p>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Group.php</span>
<span class="k">class</span> <span class="nc">Group</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setTableName</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;User as Users&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;group_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;refClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;UserGroup&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Group</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">tableName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">groups</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(30)</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Users</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">User</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">group_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
      <span class="l-Scalar-Plain">refClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UserGroup</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Please note that <tt class="docutils literal"><span class="pre">group</span></tt> is a reserved keyword so that is why we renamed
the table to <tt class="docutils literal"><span class="pre">groups</span></tt> using the <tt class="docutils literal"><span class="pre">setTableName</span></tt> method. The other option
is to turn on identifier quoting using the
<a href="#id34"><span class="problematic" id="id35">:php:const:`Doctrine_Core::ATTR_QUOTE_IDENTIFIER`</span></a> attribute so that the
reserved word is escaped with quotes.</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_QUOTE_IDENTIFIER</span><span class="p">,</span>
<span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/UserGroup.php</span>
<span class="k">class</span> <span class="nc">UserGroup</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;group_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in the
<a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">UserGroup</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">group_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>Notice how the relationship is bi-directional. Both <tt class="docutils literal"><span class="pre">User</span></tt> has many <tt class="docutils literal"><span class="pre">Group</span></tt>
and <tt class="docutils literal"><span class="pre">Group</span></tt> has many <tt class="docutils literal"><span class="pre">User</span></tt>. This is required by Doctrine in order for
many-to-many relationships to fully work.</p>
<p>Now lets play around with the new models and create a user and assign it some
groups. First create a new <tt class="docutils literal"><span class="pre">User</span></tt> instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</pre></div>
</div>
<p>Now add two new groups to the <tt class="docutils literal"><span class="pre">User</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;First Group&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;Second Group&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Now you can save the groups to the database:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Now you can delete the associations between user and groups it belongs
to:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">UserGroup</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>

<span class="nv">$groups</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine_Collection</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;Group&#39;</span><span class="p">));</span>

<span class="nv">$groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;Third Group&#39;</span><span class="p">;</span>
<span class="nv">$groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;Fourth Group&#39;</span><span class="p">;</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$groups</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// $user will now have 3 groups</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span> <span class="o">=</span> <span class="nv">$groups</span><span class="p">;</span> <span class="c1">// $user will now have two groups &#39;Third Group&#39; and &#39;Fourth Group&#39;</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Now if we inspect the <tt class="docutils literal"><span class="pre">$user</span></tt> object data with the
<a href="#id36"><span class="problematic" id="id37">:php:meth:`Doctrine_Record::toArray`</span></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>
</pre></div>
</div>
<p>The above example would produce the following output</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array
    (
        [id] =&gt; 1
        [is_active] =&gt; 1
        [is_super_admin] =&gt; 0
        [first_name] =&gt;
        [last_name] =&gt;
        [username] =&gt; default username
        [password] =&gt;
        [type] =&gt;
        [created_at] =&gt; 2009-01-20 16:48:57
        [updated_at] =&gt; 2009-01-20 16:48:57
        [Groups] =&gt; Array
            (
                [0] =&gt; Array
                    (
                        [id] =&gt; 3
                        [name] =&gt; Third Group
                    )
            [1] =&gt; Array
                (
                    [id] =&gt; 4
                    [name] =&gt; Fourth Group
                )
            )
        [UserGroup] =&gt; Array
            (
            )
    )
</pre></div>
</div>
</div>
<div class="section" id="self-referencing-nest-relations">
<h4>Self Referencing (Nest Relations)<a class="headerlink" href="#self-referencing-nest-relations" title="Permalink to this headline">¶</a></h4>
<div class="section" id="non-equal-nest-relations">
<h5>Non-Equal Nest Relations<a class="headerlink" href="#non-equal-nest-relations" title="Permalink to this headline">¶</a></h5>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>

        <span class="c1">// ...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;User as Parents&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;child_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;refClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;UserReference&#39;</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;User as Children&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;child_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;refClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;UserReference&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/UserReference.php</span>
<span class="k">class</span> <span class="nc">UserReference</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;child_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in the
<a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">Parents</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">User</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">child_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">parent_id</span>
      <span class="l-Scalar-Plain">refClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UserReference</span>
      <span class="l-Scalar-Plain">foreignAlias</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Children</span>

<span class="l-Scalar-Plain">UserReference</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">parent_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">child_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<div class="section" id="equal-nest-relations">
<h5>Equal Nest Relations<a class="headerlink" href="#equal-nest-relations" title="Permalink to this headline">¶</a></h5>
<p>Equal nest relations are perfectly suitable for expressing relations
where a class references to itself and the columns within the reference
class are equal.</p>
<p>This means that when fetching related records it doesn&#8217;t matter which
column in the reference class has the primary key value of the main
class.</p>
<p>The previous clause may be hard to understand so lets take an example. We
define a class called User which can have many friends. Notice here how
we use the &#8216;equal&#8217; option.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>

        <span class="c1">// ...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;User as Friends&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;user2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;refClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;FriendReference&#39;</span><span class="p">,</span>
            <span class="s1">&#39;equal&#39;</span>    <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/FriendReference.php</span>
<span class="k">class</span> <span class="nc">FriendReference</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user2&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">Friends</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">User</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user1</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user2</span>
      <span class="l-Scalar-Plain">refClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FriendReference</span>
      <span class="l-Scalar-Plain">equal</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>

<span class="l-Scalar-Plain">FriendReference</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user1</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">user2</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>Now lets define 4 users: Jack Daniels, John Brandy, Mikko Koskenkorva and
Stefan Beer with Jack Daniels and John Brandy being buddies and Mikko
Koskenkorva being the friend of all of them.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$daniels</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$daniels</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Jack Daniels&#39;</span><span class="p">;</span>

<span class="nv">$brandy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$brandy</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;John Brandy&#39;</span><span class="p">;</span>

<span class="nv">$koskenkorva</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$koskenkorva</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Mikko Koskenkorva&#39;</span><span class="p">;</span>

<span class="nv">$beer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$beer</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Stefan Beer&#39;</span><span class="p">;</span>

<span class="nv">$daniels</span><span class="o">-&gt;</span><span class="na">Friends</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brandy</span><span class="p">;</span>

<span class="nv">$koskenkorva</span><span class="o">-&gt;</span><span class="na">Friends</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$daniels</span><span class="p">;</span>
<span class="nv">$koskenkorva</span><span class="o">-&gt;</span><span class="na">Friends</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brandy</span><span class="p">;</span>
<span class="nv">$koskenkorva</span><span class="o">-&gt;</span><span class="na">Friends</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$beer</span><span class="p">;</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Calling <a href="#id38"><span class="problematic" id="id39">:php:meth:`Doctrine_Connection::flush`</span></a> will trigger an
operation that saves all unsaved objects and wraps it in a single
transaction.</p>
</div>
<p>Now if we access for example the friends of Stefan Beer it would return
one user &#8216;Mikko Koskenkorva&#8217;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$beer</span><span class="o">-&gt;</span><span class="na">free</span><span class="p">();</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$beer</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneByUsername</span><span class="p">(</span><span class="s1">&#39;Stefan Beer&#39;</span><span class="p">);</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Friends</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
</pre></div>
</div>
<p>Now when you execute <tt class="file docutils literal"><span class="pre">test.php</span></tt> you will see the following:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array
    (
        [0] =&gt; Array
            (
                [id] =&gt; 4
                [is_active] =&gt; 1
                [is_super_admin] =&gt; 0
                [first_name] =&gt;
                [last_name] =&gt;
                [username] =&gt; Mikko Koskenkorva
                [password] =&gt;
                [type] =&gt;
                [created_at] =&gt; 2009-01-20 16:53:13
                [updated_at] =&gt; 2009-01-20 16:53:13
            )
    )
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="foreign-key-constraints">
<h3>Foreign Key Constraints<a class="headerlink" href="#foreign-key-constraints" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id40">
<h4>Introduction<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<p>A foreign key constraint specifies that the values in a column (or a
group of columns) must match the values appearing in some row of another
table. In other words foreign key constraints maintain the referential
integrity between two related tables.</p>
<p>Say you have the product table with the following definition:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Product.php</span>
<span class="k">class</span> <span class="nc">Product</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;discounted_price&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Order as Orders&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Product</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
    <span class="l-Scalar-Plain">price</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">decimal(18)</span>
    <span class="l-Scalar-Plain">discounted_price</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">decimal(18)</span>
    <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">Orders</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Order</span>
        <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
        <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">product_id</span>
</pre></div>
</div>
<p>Let&#8217;s also assume you have a table storing orders of those products. We
want to ensure that the order table only contains orders of products
that actually exist. So we define a foreign key constraint in the orders
table that references the products table:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Order.php</span>
<span class="k">class</span> <span class="nc">Order</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setTableName</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Order</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">tableName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">orders</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">product_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">quantity</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">Product</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">product_id</span>
        <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Foreign key columns are automatically indexed by Doctrine
to ensure optimal performance when issuing queries involving the
foreign key.</p>
</div>
<p>When exported the class <tt class="docutils literal"><span class="pre">Order</span></tt> would execute the following SQL:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">orders</span> <span class="p">(</span>
    <span class="n">id</span> <span class="kt">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="kp">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="n">product_id</span> <span class="kt">INTEGER</span> <span class="k">REFERENCES</span> <span class="nf">products</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">quantity</span> <span class="kt">INTEGER</span><span class="p">,</span>
    <span class="k">INDEX</span> <span class="nf">product_id_idx</span> <span class="p">(</span><span class="n">product_id</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now it is impossible to create <tt class="docutils literal"><span class="pre">orders</span></tt> with a <tt class="docutils literal"><span class="pre">product_id</span></tt> that
does not appear in the <tt class="docutils literal"><span class="pre">product</span></tt> table.</p>
<p>We say that in this situation the orders table is the referencing table
and the products table is the referenced table. Similarly, there are
referencing and referenced columns.</p>
</div>
<div class="section" id="foreign-key-names">
<h4>Foreign Key Names<a class="headerlink" href="#foreign-key-names" title="Permalink to this headline">¶</a></h4>
<p>When you define a relationship in Doctrine, when the foreign key is
created in the database for you Doctrine will try to create a foreign
key name for you. Sometimes though, this name may not be something you
want so you can customize the name to use with the <tt class="docutils literal"><span class="pre">foreignKeyName</span></tt>
option to your relationship setup.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Order.php</span>
<span class="k">class</span> <span class="nc">Order</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreignKeyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;product_id_fk&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Order</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Product</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">product_id</span>
            <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
            <span class="l-Scalar-Plain">foreignKeyName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">product_id_fk</span>
</pre></div>
</div>
</div>
<div class="section" id="integrity-actions">
<h4>Integrity Actions<a class="headerlink" href="#integrity-actions" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cascade">
<h5>CASCADE<a class="headerlink" href="#cascade" title="Permalink to this headline">¶</a></h5>
<p>Delete or update the row from the parent table and automatically delete
or update the matching rows in the child table. Both <tt class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span>
<span class="pre">CASCADE</span></tt> and <tt class="docutils literal"><span class="pre">ON</span> <span class="pre">UPDATE</span> <span class="pre">CASCADE</span></tt> are supported. Between two tables,
you should not define several <tt class="docutils literal"><span class="pre">ON</span> <span class="pre">UPDATE</span> <span class="pre">CASCADE</span></tt> clauses that act on
the same column in the parent table or in the child table.</p>
</div>
<div class="section" id="set-null">
<h5>SET NULL<a class="headerlink" href="#set-null" title="Permalink to this headline">¶</a></h5>
<p>Delete or update the row from the parent table and set the foreign key
column or columns in the child table to <tt class="docutils literal"><span class="pre">NULL</span></tt>. This is valid only if
the foreign key columns do not have the <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></tt> qualifier
specified. Both <tt class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span> <span class="pre">SET</span> <span class="pre">NULL</span></tt> and <tt class="docutils literal"><span class="pre">ON</span> <span class="pre">UPDATE</span> <span class="pre">SET</span> <span class="pre">NULL</span></tt>
clauses are supported.</p>
</div>
<div class="section" id="no-action">
<h5>NO ACTION<a class="headerlink" href="#no-action" title="Permalink to this headline">¶</a></h5>
<p>In standard SQL, <tt class="docutils literal"><span class="pre">NO</span> <span class="pre">ACTION</span></tt> means no action in the sense that an
attempt to delete or update a primary key value is not allowed to
proceed if there is a related foreign key value in the referenced table.</p>
</div>
<div class="section" id="restrict">
<h5>RESTRICT<a class="headerlink" href="#restrict" title="Permalink to this headline">¶</a></h5>
<p>Rejects the delete or update operation for the parent table. <tt class="docutils literal"><span class="pre">NO</span>
<span class="pre">ACTION</span></tt> and <tt class="docutils literal"><span class="pre">RESTRICT</span></tt> are the same as omitting the <tt class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span></tt> or
<tt class="docutils literal"><span class="pre">ON</span> <span class="pre">UPDATE</span></tt> clause.</p>
</div>
<div class="section" id="set-default">
<h5>SET DEFAULT<a class="headerlink" href="#set-default" title="Permalink to this headline">¶</a></h5>
<p>In the following example we define two classes, <tt class="docutils literal"><span class="pre">User</span></tt> and
<tt class="docutils literal"><span class="pre">Phonenumber</span></tt> with their relation being one-to-many. We also add a
foreign key constraint with onDelete cascade action. This means that
every time a <tt class="docutils literal"><span class="pre">user</span></tt> is being deleted its associated <tt class="docutils literal"><span class="pre">phonenumbers</span></tt>
will also be deleted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The integrity constraints listed above are case sensitive
and must be in upper case when being defined in your schema.</p>
</div>
<p>Below is an example where the database delete cascading is used.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Phonenumber</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>

        <span class="c1">// ...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;onDelete&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CASCADE&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Phonenumber</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
            <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
            <span class="l-Scalar-Plain">onDelete</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CASCADE</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the integrity constraints are placed on the side
where the foreign key exists. This is required in order for the
integrity constraints to be exported to your database properly.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="indexes">
<span id="id41"></span><h2>Indexes<a class="headerlink" href="#indexes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id42">
<h3>Introduction<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<p>Indexes are used to find rows with specific column values quickly.
Without an index, the database must begin with the first row and then
read through the entire table to find the relevant rows.</p>
<p>The larger the table, the more this consumes time. If the table has an
index for the columns in question, the database can quickly determine
the position to seek to in the middle of the data file without having to
look at all the data. If a table has 1,000 rows, this is at least 100
times faster than reading rows one-by-one.</p>
<p>Indexes come with a cost as they slow down the inserts and updates.
However, in general you should <strong>always</strong> use indexes for the fields
that are used in SQL where conditions.</p>
</div>
<div class="section" id="adding-indexes">
<h3>Adding indexes<a class="headerlink" href="#adding-indexes" title="Permalink to this headline">¶</a></h3>
<p>You can add indexes by using <tt class="docutils literal"><span class="pre">Doctrine_Record::index</span></tt>. An example of
adding a simple index to field called name:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following index examples are not meant for you to
actually add to your test Doctrine environment. They are only meant
to demonstrate the API for adding indexes.</p>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IndexTest</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span><span class="s1">&#39;myindex&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">IndexTest</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
  <span class="l-Scalar-Plain">indexes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">myindex</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">name</span><span class="p-Indicator">]</span>
</pre></div>
</div>
<p>An example of adding a multi-column index to field called <tt class="docutils literal"><span class="pre">name</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MultiColumnIndexTest</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span><span class="s1">&#39;myindex&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in the
<a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">MultiColumnIndexTest</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
    <span class="l-Scalar-Plain">code</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
  <span class="l-Scalar-Plain">indexes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">myindex</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">name</span><span class="p-Indicator">,</span> <span class="nv">code</span><span class="p-Indicator">]</span>
</pre></div>
</div>
<p>An example of adding multiple indexes on same table:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MultipleIndexTest</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span><span class="s1">&#39;myindex&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">)</span>
        <span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span><span class="s1">&#39;ageindex&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">MultipleIndexTest</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
    <span class="l-Scalar-Plain">code</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
    <span class="l-Scalar-Plain">age</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
  <span class="l-Scalar-Plain">indexes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">myindex</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">name</span><span class="p-Indicator">,</span> <span class="nv">code</span><span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">ageindex</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">age</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="index-options">
<h3>Index options<a class="headerlink" href="#index-options" title="Permalink to this headline">¶</a></h3>
<p>Doctrine offers many index options, some of them being database
specific. Here is a full list of available options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">sorting</span></tt></td>
<td>A string valuethat can be either &#8216;ASC&#8217; or &#8216;DESC&#8217;.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">length</span></tt></td>
<td>Index length (only some drivers support this).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">primary</span></tt></td>
<td>Whether or not the index is a primary index.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">type</span></tt></td>
<td>A string value that can be unique, &#8216;fulltext&#8217;, &#8216;gist&#8217; or &#8216;gin&#8217;.</td>
</tr>
</tbody>
</table>
<p>Here is an example of how to create a unique index on the name column.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MultipleIndexTest</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span><span class="s1">&#39;myindex&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;sorting&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;length&#39;</span>  <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">),</span>
                <span class="s1">&#39;code&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;unique&#39;</span><span class="p">,</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in the
<a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">MultipleIndexTest</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
    <span class="l-Scalar-Plain">code</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
    <span class="l-Scalar-Plain">age</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
  <span class="l-Scalar-Plain">indexes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">myindex</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">sorting</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ASC</span>
          <span class="l-Scalar-Plain">length</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10</span>
        <span class="l-Scalar-Plain">code</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">unique</span>
</pre></div>
</div>
</div>
<div class="section" id="special-indexes">
<h3>Special indexes<a class="headerlink" href="#special-indexes" title="Permalink to this headline">¶</a></h3>
<p>Doctrine supports many special indexes. These include Mysql FULLTEXT and
Pgsql GiST indexes. In the following example we define a Mysql FULLTEXT
index for the field &#8216;content&#8217;.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Article.php</span>
<span class="k">class</span> <span class="nc">Article</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">option</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;MyISAM&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">),</span>
            <span class="s1">&#39;type&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;fulltext&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Article</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">MyISAM</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
    <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
  <span class="l-Scalar-Plain">indexes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">content</span><span class="p-Indicator">]</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">fulltext</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how we set the table type to <tt class="docutils literal"><span class="pre">MyISAM</span></tt>. This is
because the <tt class="docutils literal"><span class="pre">fulltext</span></tt> index type is only supported in <tt class="docutils literal"><span class="pre">MyISAM</span></tt>
so you will receive an error if you use something like <tt class="docutils literal"><span class="pre">InnoDB</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="checks">
<h2>Checks<a class="headerlink" href="#checks" title="Permalink to this headline">¶</a></h2>
<p>You can create any kind of <tt class="docutils literal"><span class="pre">CHECK</span></tt> constraints by using the <a href="#id43"><span class="problematic" id="id44">:php:meth:`check`</span></a>
method of the <a href="#id45"><span class="problematic" id="id46">:php:class:`Doctrine_Record`</span></a>. In the last example we add
constraint to ensure that price is always higher than the discounted price.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Product.php</span>
<span class="k">class</span> <span class="nc">Product</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">check</span><span class="p">(</span><span class="s1">&#39;price &gt; discounted_price&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Product</span><span class="p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l-Scalar-Plain">checks</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">price_check</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">price &gt; discounted_price</span>
</pre></div>
</div>
<p>Generates (in pgsql):</p>
<div class="highlight-postgres"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">product</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="n">discounted_price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;=</span> <span class="mf">0</span><span class="p">),</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&lt;=</span> <span class="mf">1000000</span><span class="p">),</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="n">discounted_price</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some databases don&#8217;t support <tt class="docutils literal"><span class="pre">CHECK</span></tt> constraints. When
this is the case Doctrine simply skips the creation of check
constraints.</p>
</div>
<p>If the Doctrine validators are turned on the given definition would also
ensure that when a record is being saved its price is always greater
than zero.</p>
<p>If some of the prices of the saved products within a transaction is
below zero, Doctrine throws <tt class="docutils literal"><span class="pre">Doctrine_Validator_Exception</span></tt> and
automatically rolls back the transaction.</p>
</div>
<div class="section" id="table-options">
<h2>Table Options<a class="headerlink" href="#table-options" title="Permalink to this headline">¶</a></h2>
<p>Doctrine offers various table options. All table options can be set via
the <tt class="docutils literal"><span class="pre">Doctrine_Record::option</span></tt> function.</p>
<p>For example if you are using MySQL and want to use INNODB tables it can
be done as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyInnoDbRecord</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">option</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;INNODB&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">MyInnoDbRecord</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
  <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">INNODB</span>
</pre></div>
</div>
<p>In the following example we set the collate and character set options:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyCustomOptionRecord</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">option</span><span class="p">(</span><span class="s1">&#39;collate&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8_unicode_ci&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">option</span><span class="p">(</span><span class="s1">&#39;charset&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">MyCustomOptionRecord</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
  <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">collate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">utf8_unicode_ci</span>
    <span class="l-Scalar-Plain">charset</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">utf8</span>
</pre></div>
</div>
<p>It is worth noting that for certain databases (Firebird, MySql and
PostgreSQL) setting the charset option might not be enough for Doctrine
to return data properly. For those databases, users are advised to also
use the <tt class="docutils literal"><span class="pre">setCharset</span></tt> function of the database connection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Doctrine_Manager</span><span class="o">::</span><span class="na">connection</span><span class="p">();</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">setCharset</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="record-filters">
<h2>Record Filters<a class="headerlink" href="#record-filters" title="Permalink to this headline">¶</a></h2>
<p>Doctrine offers the ability to attach record filters when defining your
models. A record filter is invoked whenever you access a property on a
model that is invalid. So it allows you to essentially add properties
dynamically to a model through the use of one of these filters.</p>
<p>To attach a filter you just need to add it in the <a href="#id47"><span class="problematic" id="id48">:php:meth:`setUp`</span></a> method of
your model definition:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;Profile&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unshiftFilter</span><span class="p">(</span><span class="k">new</span> <span class="nx">Doctrine_Record_Filter_Compound</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Profile&#39;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Profile</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now with the above example we can easily access the properties of the
<tt class="docutils literal"><span class="pre">Profile</span></tt> relationship when using an instance of <tt class="docutils literal"><span class="pre">User</span></tt>. Here is an
example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span><span class="s1">&#39;u.Profile p&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;p.username = ?&#39;</span><span class="p">,</span> <span class="s1">&#39;jwage&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">first_name</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">last_name</span><span class="p">;</span>
</pre></div>
</div>
<p>When we ask for the <tt class="docutils literal"><span class="pre">first_name</span></tt> and <tt class="docutils literal"><span class="pre">last_name</span></tt> properties they
do not exist on the <tt class="docutils literal"><span class="pre">$user</span></tt> instance so they are forwarded to the
<tt class="docutils literal"><span class="pre">Profile</span></tt> relationship. It is the same as if you were to do the
following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Profile</span><span class="o">-&gt;</span><span class="na">first_name</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Profile</span><span class="o">-&gt;</span><span class="na">last_name</span><span class="p">;</span>
</pre></div>
</div>
<p>You can write your own record filters pretty easily too. All that is
required is you create a class which extends
<tt class="docutils literal"><span class="pre">Doctrine_Record_Filter</span></tt> and implements the <a href="#id49"><span class="problematic" id="id50">:php:meth:`filterSet`</span></a> and
<a href="#id51"><span class="problematic" id="id52">:php:meth:`filterGet`</span></a> methods. Here is an example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyRecordFilter</span> <span class="k">extends</span> <span class="nx">Doctrine_Record_Filter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">filterSet</span><span class="p">(</span><span class="nx">Doctrine_Record</span> <span class="nv">$record</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// try and set the property</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Doctrine_Record_UnknownPropertyException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span>
            <span class="s1">&#39;Unknown record property / related component &quot;%s&quot; on &quot;%s&quot;&#39;</span><span class="p">,</span>
            <span class="nv">$name</span><span class="p">,</span>
            <span class="nb">get_class</span><span class="p">(</span><span class="nv">$record</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">filterGet</span><span class="p">(</span><span class="nx">Doctrine_Record</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// try and get the property</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Doctrine_Record_UnknownPropertyException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span>
            <span class="s1">&#39;Unknown record property / related component &quot;%s&quot; on &quot;%s&quot;&#39;</span><span class="p">,</span>
            <span class="nv">$name</span><span class="p">,</span>
            <span class="nb">get_class</span><span class="p">(</span><span class="nv">$record</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now you can add the filter to your models:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModel</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unshiftFilter</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyRecordFilter</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember to be sure to throw an instance of the
<tt class="docutils literal"><span class="pre">Doctrine_Record_UnknownPropertyException</span></tt> exception class if
<a href="#id53"><span class="problematic" id="id54">:php:meth:`filterSet`</span></a> or <a href="#id55"><span class="problematic" id="id56">:php:meth:`filterGet`</span></a> fail to find the property.</p>
</div>
</div>
<div class="section" id="transitive-persistence">
<h2>Transitive Persistence<a class="headerlink" href="#transitive-persistence" title="Permalink to this headline">¶</a></h2>
<p>Doctrine offers both database and application level cascading
operations. This section will explain in detail how to setup both
application and database level cascades.</p>
<div class="section" id="application-level-cascades">
<h3>Application-Level Cascades<a class="headerlink" href="#application-level-cascades" title="Permalink to this headline">¶</a></h3>
<p>Since it can be quite cumbersome to save and delete individual objects,
especially if you deal with an object graph, Doctrine provides
application-level cascading of operations.</p>
<div class="section" id="save-cascades">
<h4>Save Cascades<a class="headerlink" href="#save-cascades" title="Permalink to this headline">¶</a></h4>
<p>You may already have noticed that <a href="#id57"><span class="problematic" id="id58">:php:meth:`save`</span></a> operations are already
cascaded to associated objects by default.</p>
</div>
<div class="section" id="delete-cascades">
<h4>Delete Cascades<a class="headerlink" href="#delete-cascades" title="Permalink to this headline">¶</a></h4>
<p>Doctrine provides a second application-level cascade style: delete.
Unlike the <a href="#id59"><span class="problematic" id="id60">:php:meth:`save`</span></a> cascade, the delete cascade needs to be turned on
explicitly as can be seen in the following code snippet:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setup</span><span class="p">();</span>

        <span class="c1">// ...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Address as Addresses&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cascade&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l-Scalar-Plain">Addresses</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Address</span>
            <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
            <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
            <span class="l-Scalar-Plain">cascade</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">delete</span><span class="p-Indicator">]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">cascade</span></tt> option is used to specify the operations that are
cascaded to the related objects on the application-level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please note that the only currently supported value is <tt class="docutils literal"><span class="pre">delete</span></tt>, more
options will be added in future releases of Doctrine.</p>
</div>
<p>In the example above, Doctrine would cascade the deletion of a <tt class="docutils literal"><span class="pre">User</span></tt>
to it&#8217;s associated <tt class="docutils literal"><span class="pre">Addresses</span></tt>. The following describes the generic
procedure when you delete a record through <a href="#id61"><span class="problematic" id="id62">:php:meth:`$record-&gt;delete`</span></a>:</p>
<ol class="arabic simple">
<li>Doctrine looks at the relations to see if there are any deletion
cascades it needs to apply. If there are no deletion cascades, go to 3).</li>
<li>For each relation that has a delete cascade specified, Doctrine
verifies that the objects that are the target of the cascade are loaded.
That usually means that Doctrine fetches the related objects from the
database if they&#8217;re not yet loaded.(Exception: many-valued associations
are always re-fetched from the database, to make sure all objects are
loaded). For each associated object, proceed with step 1).</li>
<li>Doctrine orders all deletions and executes them in the most
efficient way, maintaining referential integrity.</li>
</ol>
<p>From this description one thing should be instantly clear:
Application-level cascades happen on the object-level, meaning
operations are cascaded from one object to another and in order to do
that the participating objects need to be available.</p>
<p>This has some important implications:</p>
<ul class="simple">
<li>Application-level delete cascades don&#8217;t perform well on many-valued
associations when there are a lot of objects in the related
collection (that is because they need to be fetched from the
database, the actual deletion is pretty efficient).</li>
<li>Application-level delete cascades do not skip the object lifecycle as
database-level cascades do (see next chapter). Therefore all
registered event listeners and other callback methods are properly
executed in an application-level cascade.</li>
</ul>
</div>
</div>
<div class="section" id="database-level-cascades">
<h3>Database-Level Cascades<a class="headerlink" href="#database-level-cascades" title="Permalink to this headline">¶</a></h3>
<p>Some cascading operations can be done much more efficiently at the
database level. The best example is the delete cascade.</p>
<p>Database-level delete cascades are generally preferrable over
application-level delete cascades except:</p>
<ul class="simple">
<li>Your database does not support database-level cascades (i.e. when
using MySql with MYISAM tables).</li>
<li>You have listeners that listen on the object lifecycle and you want
them to get invoked.</li>
</ul>
<p>Database-level delete cascades are applied on the foreign key
constraint. Therefore they&#8217;re specified on that side of the relation
that owns the foreign key. Picking up the example from above, the
definition of a database-level cascade would look as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Address.php</span>
<span class="k">class</span> <span class="nc">Address</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;postal_code&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;onDelete&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CASCADE&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Address</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">address</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
    <span class="l-Scalar-Plain">country</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
    <span class="l-Scalar-Plain">city</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
    <span class="l-Scalar-Plain">state</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(2)</span>
    <span class="l-Scalar-Plain">postal_code</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(25)</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
      <span class="l-Scalar-Plain">onDelete</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CASCADE</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">onDelete</span></tt> option is translated to proper DDL/DML statements when
Doctrine creates your tables.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that <tt class="docutils literal"><span class="pre">'onDelete'</span> <span class="pre">=&gt;</span> <span class="pre">'CASCADE'</span></tt> is specified on the
Address class, since the Address owns the foreign key (<tt class="docutils literal"><span class="pre">user_id</span></tt>)
and database-level cascades are applied on the foreign key.</p>
</div>
<p>Currently, the only two supported database-level cascade styles are for
<tt class="docutils literal"><span class="pre">onDelete</span></tt> and <tt class="docutils literal"><span class="pre">onUpdate</span></tt>. Both are specified on the side that owns
the foreign key and applied to your database schema when Doctrine
creates your tables.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Now that we know everything about how to define our Doctrine models, I think we
are ready to move on to learning about how to <a class="reference internal" href="working-with-models.html"><em>work with models</em></a> in your application.</p>
<p>This is a very large topic as well so take a break, grab a mountain dew
and hurry back for the <a class="reference internal" href="working-with-models.html"><em>next chapter</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining Models</a><ul>
<li><a class="reference internal" href="#columns">Columns</a><ul>
<li><a class="reference internal" href="#column-lengths">Column Lengths</a></li>
<li><a class="reference internal" href="#column-aliases">Column Aliases</a></li>
<li><a class="reference internal" href="#default-values">Default values</a></li>
<li><a class="reference internal" href="#data-types">Data types</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#type-modifiers">Type modifiers</a></li>
<li><a class="reference internal" href="#boolean">Boolean</a></li>
<li><a class="reference internal" href="#integer">Integer</a></li>
<li><a class="reference internal" href="#float">Float</a></li>
<li><a class="reference internal" href="#decimal">Decimal</a></li>
<li><a class="reference internal" href="#string">String</a></li>
<li><a class="reference internal" href="#array">Array</a></li>
<li><a class="reference internal" href="#object">Object</a></li>
<li><a class="reference internal" href="#blob">Blob</a></li>
<li><a class="reference internal" href="#clob">Clob</a></li>
<li><a class="reference internal" href="#timestamp">Timestamp</a></li>
<li><a class="reference internal" href="#time">Time</a></li>
<li><a class="reference internal" href="#date">Date</a></li>
<li><a class="reference internal" href="#enum">Enum</a></li>
<li><a class="reference internal" href="#gzip">Gzip</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relationships">Relationships</a><ul>
<li><a class="reference internal" href="#id7">Introduction</a></li>
<li><a class="reference internal" href="#foreign-key-associations">Foreign Key Associations</a><ul>
<li><a class="reference internal" href="#one-to-one">One to One</a></li>
<li><a class="reference internal" href="#one-to-many-and-many-to-one">One to Many and Many to One</a></li>
<li><a class="reference internal" href="#tree-structure">Tree Structure</a></li>
</ul>
</li>
<li><a class="reference internal" href="#join-table-associations">Join Table Associations</a><ul>
<li><a class="reference internal" href="#many-to-many">Many to Many</a></li>
<li><a class="reference internal" href="#self-referencing-nest-relations">Self Referencing (Nest Relations)</a><ul>
<li><a class="reference internal" href="#non-equal-nest-relations">Non-Equal Nest Relations</a></li>
<li><a class="reference internal" href="#equal-nest-relations">Equal Nest Relations</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#foreign-key-constraints">Foreign Key Constraints</a><ul>
<li><a class="reference internal" href="#id40">Introduction</a></li>
<li><a class="reference internal" href="#foreign-key-names">Foreign Key Names</a></li>
<li><a class="reference internal" href="#integrity-actions">Integrity Actions</a><ul>
<li><a class="reference internal" href="#cascade">CASCADE</a></li>
<li><a class="reference internal" href="#set-null">SET NULL</a></li>
<li><a class="reference internal" href="#no-action">NO ACTION</a></li>
<li><a class="reference internal" href="#restrict">RESTRICT</a></li>
<li><a class="reference internal" href="#set-default">SET DEFAULT</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indexes">Indexes</a><ul>
<li><a class="reference internal" href="#id42">Introduction</a></li>
<li><a class="reference internal" href="#adding-indexes">Adding indexes</a></li>
<li><a class="reference internal" href="#index-options">Index options</a></li>
<li><a class="reference internal" href="#special-indexes">Special indexes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#checks">Checks</a></li>
<li><a class="reference internal" href="#table-options">Table Options</a></li>
<li><a class="reference internal" href="#record-filters">Record Filters</a></li>
<li><a class="reference internal" href="#transitive-persistence">Transitive Persistence</a><ul>
<li><a class="reference internal" href="#application-level-cascades">Application-Level Cascades</a><ul>
<li><a class="reference internal" href="#save-cascades">Save Cascades</a></li>
<li><a class="reference internal" href="#delete-cascades">Delete Cascades</a></li>
</ul>
</li>
<li><a class="reference internal" href="#database-level-cascades">Database-Level Cascades</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction-to-models.html"
                        title="previous chapter">Introduction to Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="working-with-models.html"
                        title="next chapter">Working with Models</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/en/manual/defining-models.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="working-with-models.html" title="Working with Models"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction-to-models.html" title="Introduction to Models"
             >previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" >Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jonathan Wage and Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>