

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Inheritance &mdash; Doctrine 1.2.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Doctrine 1.2.4 documentation" href="../../index.html" />
    <link rel="up" title="Doctrine 1.2 ORM Manual" href="index.html" />
    <link rel="next" title="Behaviors" href="behaviors.html" />
    <link rel="prev" title="Data Hydrators" href="data-hydrators.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="behaviors.html" title="Behaviors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="data-hydrators.html" title="Data Hydrators"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="inheritance">
<h1>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h1>
<p>Doctrine supports three types of inheritance strategies which can be
mixed together. The three types are simple, concrete and column
aggregation. You will learn about these three different types of
inheritance and how to use them in this chapter.</p>
<p>For this chapter lets delete all our existing schemas and models from
our test environment we created and have been using in the earlier
chapters:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>rm schema.yml
<span class="nv">$ </span>touch schema.yml
<span class="nv">$ </span>rm -rf models/*
</pre></div>
</div>
<div class="section" id="simple">
<h2>Simple<a class="headerlink" href="#simple" title="Permalink to this headline">¶</a></h2>
<p>Simple inheritance is the easiest and simplest inheritance to use. In
simple inheritance all the child classes share the same columns as the
parent and all information is stored in the parent table.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Entity.php</span>
<span class="k">class</span> <span class="nc">Entity</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;update_at&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now lets create a <tt class="docutils literal"><span class="pre">User</span></tt> model that extends <tt class="docutils literal"><span class="pre">Entity</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Entity</span>
<span class="p">{</span> <span class="p">}</span>
</pre></div>
</div>
<p>Do the same thing for the <tt class="docutils literal"><span class="pre">Group</span></tt> model:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Group.php</span>
<span class="k">class</span> <span class="nc">Group</span> <span class="k">extends</span> <span class="nx">Entity</span>
<span class="p">{</span> <span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="c1"># schema.yml</span>

<span class="c1"># ...</span>
<span class="l-Scalar-Plain">Entity</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(30)</span>
    <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(20)</span>
    <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(16)</span>
    <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp</span>
    <span class="l-Scalar-Plain">updated_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp</span>

<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">inheritance</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Entity</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">simple</span>

<span class="l-Scalar-Plain">Group</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">inheritance</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Entity</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">simple</span>
</pre></div>
</div>
<p>Lets check the SQL that is generated by the above models:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">generateSqlFromArray</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Entity&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;Group&#39;</span><span class="p">));</span>
<span class="k">echo</span> <span class="nv">$sql</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</div>
<p>The above code would output the following SQL query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">entity</span> <span class="p">(</span><span class="nx">id</span> <span class="nx">BIGINT</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
<span class="nx">username</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="nx">password</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
<span class="nx">created_at</span> <span class="nx">DATETIME</span><span class="p">,</span>
<span class="nx">updated_at</span> <span class="nx">DATETIME</span><span class="p">,</span>
<span class="nx">name</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="nx">ENGINE</span> <span class="o">=</span> <span class="nx">INNODB</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using YAML schema files you are able to define columns
in the child classes but when the YAML is parsed the columns are
moved to the parent for you automatically. This is only a
convenience to you so that you can organize your columns easier.</p>
</div>
</div>
<div class="section" id="concrete">
<h2>Concrete<a class="headerlink" href="#concrete" title="Permalink to this headline">¶</a></h2>
<p>Concrete inheritance creates separate tables for child classes. However
in concrete inheritance each class generates a table which contains all
columns (including inherited columns). In order to use concrete
inheritance you&#8217;ll need to add explicit <tt class="docutils literal"><span class="pre">parent::setTableDefinition()</span></tt>
calls to child classes as shown below.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/TextItem.php</span>
<span class="k">class</span> <span class="nc">TextItem</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now lets create a model named <tt class="docutils literal"><span class="pre">Comment</span></tt> that extends <tt class="docutils literal"><span class="pre">TextItem</span></tt> and
add an extra column named <tt class="docutils literal"><span class="pre">content</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Comment.php</span>
<span class="k">class</span> <span class="nc">Comment</span> <span class="k">extends</span> <span class="nx">TextItem</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setTableDefinition</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="c1"># schema.yml</span>

<span class="l-Scalar-Plain">TextItem</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">topic</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(100)</span>

<span class="l-Scalar-Plain">Comment</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">inheritance</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">TextItem</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">concrete</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(300)</span>
</pre></div>
</div>
<p>Lets check the SQL that is generated by the above models:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">generateSqlFromArray</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;TextItem&#39;</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">));</span>
<span class="k">echo</span> <span class="nv">$sql</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$sql</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</pre></div>
</div>
<p>The above code would output the following SQL query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">text_item</span> <span class="p">(</span><span class="nx">id</span> <span class="nx">BIGINT</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
<span class="nx">topic</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="nx">ENGINE</span> <span class="o">=</span> <span class="nx">INNODB</span>
<span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">comment</span> <span class="p">(</span><span class="nx">id</span> <span class="nx">BIGINT</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
<span class="nx">topic</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="nx">content</span> <span class="nx">TEXT</span><span class="p">,</span>
<span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="nx">ENGINE</span> <span class="o">=</span> <span class="nx">INNODB</span>
</pre></div>
</div>
<p>In concrete inheritance you don&#8217;t necessarily have to define additional
columns, but in order to make Doctrine create separate tables for each
class you&#8217;ll have to make iterative <tt class="docutils literal"><span class="pre">setTableDefinition()</span></tt> calls.</p>
<p>In the following example we have three database tables called
<tt class="docutils literal"><span class="pre">entity</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt> and <tt class="docutils literal"><span class="pre">group</span></tt>. <tt class="docutils literal"><span class="pre">Users</span></tt> and <tt class="docutils literal"><span class="pre">groups</span></tt> are both
<tt class="docutils literal"><span class="pre">entities</span></tt>. The only thing we have to do is write 3 classes
(<tt class="docutils literal"><span class="pre">Entity</span></tt>, <tt class="docutils literal"><span class="pre">Group</span></tt> and <tt class="docutils literal"><span class="pre">User</span></tt>) and make iterative
<tt class="docutils literal"><span class="pre">setTableDefinition()</span></tt> method calls.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Entity.php</span>
<span class="k">class</span> <span class="nc">Entity</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Entity</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// the following method call is needed in</span>
        <span class="c1">// concrete inheritance</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setTableDefinition</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// models/Group.php</span>
<span class="k">class</span> <span class="nc">Group</span> <span class="k">extends</span> <span class="nx">Entity</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// the following method call is needed in</span>
        <span class="c1">// concrete inheritance</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setTableDefinition</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">Entity</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(30)</span>
    <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(20)</span>
    <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(16)</span>
    <span class="l-Scalar-Plain">created</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer(11)</span>

<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">inheritance</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Entity</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">concrete</span>

<span class="l-Scalar-Plain">Group</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">tableName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">groups</span>
  <span class="l-Scalar-Plain">inheritance</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Entity</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">concrete</span>
</pre></div>
</div>
<p>Lets check the SQL that is generated by the above models:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">generateSqlFromArray</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Entity&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;Group&#39;</span><span class="p">));</span>
<span class="k">echo</span> <span class="nv">$sql</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$sql</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$sql</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The above code would output the following SQL query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">user</span> <span class="p">(</span><span class="nx">id</span> <span class="nx">BIGINT</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
<span class="nx">name</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="nx">username</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="nx">password</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
<span class="nx">created</span> <span class="nx">BIGINT</span><span class="p">,</span>
<span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="nx">ENGINE</span> <span class="o">=</span> <span class="nx">INNODB</span>
<span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">groups</span> <span class="p">(</span><span class="nx">id</span> <span class="nx">BIGINT</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
<span class="nx">name</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="nx">username</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="nx">password</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
<span class="nx">created</span> <span class="nx">BIGINT</span><span class="p">,</span>
<span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="nx">ENGINE</span> <span class="o">=</span> <span class="nx">INNODB</span>
<span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">entity</span> <span class="p">(</span><span class="nx">id</span> <span class="nx">BIGINT</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
<span class="nx">name</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="nx">username</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="nx">password</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
<span class="nx">created</span> <span class="nx">BIGINT</span><span class="p">,</span>
<span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="nx">ENGINE</span> <span class="o">=</span> <span class="nx">INNODB</span>
</pre></div>
</div>
</div>
<div class="section" id="column-aggregation">
<h2>Column Aggregation<a class="headerlink" href="#column-aggregation" title="Permalink to this headline">¶</a></h2>
<p>In the following example we have one database table called <tt class="docutils literal"><span class="pre">entity</span></tt>.
<tt class="docutils literal"><span class="pre">Users</span></tt> and <tt class="docutils literal"><span class="pre">groups</span></tt> are both <tt class="docutils literal"><span class="pre">entities</span></tt> and they share the same
database table.</p>
<p>The <tt class="docutils literal"><span class="pre">entity</span></tt> table has a column called <tt class="docutils literal"><span class="pre">type</span></tt> which tells whether an
<tt class="docutils literal"><span class="pre">entity</span></tt> is a <tt class="docutils literal"><span class="pre">group</span></tt> or a <tt class="docutils literal"><span class="pre">user</span></tt>. Then we decide that <tt class="docutils literal"><span class="pre">users</span></tt>
are type 1 and groups type 2.</p>
<p>The only thing we have to do is to create 3 records (the same as before)
and add the call to the <tt class="docutils literal"><span class="pre">Doctrine_Table::setSubclasses()</span></tt> method from
the parent class.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Entity.php</span>
<span class="k">class</span> <span class="nc">Entity</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;update_at&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setSubclasses</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;User&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s1">&#39;Group&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Entity</span>
<span class="p">{</span> <span class="p">}</span>

<span class="c1">// models/Group.php</span>
<span class="k">class</span> <span class="nc">Group</span> <span class="k">extends</span> <span class="nx">Entity</span>
<span class="p">{</span> <span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">Entity</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(20)</span>
    <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(16)</span>
    <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp</span>
    <span class="l-Scalar-Plain">updated_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp</span>

    <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">inheritance</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Entity</span>
          <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">column_aggregation</span>
          <span class="l-Scalar-Plain">keyField</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">type</span>
          <span class="l-Scalar-Plain">keyValue</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>

    <span class="l-Scalar-Plain">Group</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">inheritance</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Entity</span>
        <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">column_aggregation</span>
        <span class="l-Scalar-Plain">keyField</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">type</span>
        <span class="l-Scalar-Plain">keyValue</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</pre></div>
</div>
<p>Lets check the SQL that is generated by the above models:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">generateSqlFromArray</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Entity&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;Group&#39;</span><span class="p">));</span>
<span class="k">echo</span> <span class="nv">$sql</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</div>
<p>The above code would output the following SQL query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">entity</span> <span class="p">(</span><span class="nx">id</span> <span class="nx">BIGINT</span> <span class="nx">AUTO_INCREMENT</span><span class="p">,</span>
<span class="nx">username</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="nx">password</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
<span class="nx">created_at</span> <span class="nx">DATETIME</span><span class="p">,</span>
<span class="nx">updated_at</span> <span class="nx">DATETIME</span><span class="p">,</span>
<span class="nx">type</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="nx">ENGINE</span> <span class="o">=</span> <span class="nx">INNODB</span>
</pre></div>
</div>
<p>This feature also enable us to query the <tt class="docutils literal"><span class="pre">Entity</span></tt> table and get a
<tt class="docutils literal"><span class="pre">User</span></tt> or <tt class="docutils literal"><span class="pre">Group</span></tt> object back if the returned object matches the
constraints set in the parent class.</p>
<p>See the code example below for an example of this. First lets save a new
<tt class="docutils literal"><span class="pre">User</span></tt> object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$user</span>           <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span>     <span class="o">=</span> <span class="s1">&#39;Bjarte S. Karlsen&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;meus&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;rat&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Now lets save a new <tt class="docutils literal"><span class="pre">Group</span></tt> object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$group</span>           <span class="o">=</span> <span class="k">new</span> <span class="nx">Group</span><span class="p">();</span>
<span class="nv">$group</span><span class="o">-&gt;</span><span class="na">name</span>     <span class="o">=</span> <span class="s1">&#39;Users&#39;</span><span class="p">;</span>
<span class="nv">$group</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span><span class="p">;</span>
<span class="nv">$group</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
<span class="nv">$group</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Now if we query the <tt class="docutils literal"><span class="pre">Entity</span></tt> model for the id of the <tt class="docutils literal"><span class="pre">User</span></tt> we
created, the <a href="#id1"><span class="problematic" id="id2">:php:class:`Doctrine_Query`</span></a> will return an instance of <tt class="docutils literal"><span class="pre">User</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Entity e&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;e.id = ?&#39;</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">));</span>

<span class="k">echo</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span> <span class="c1">// User</span>
</pre></div>
</div>
<p>If we do the same thing as above but for the <tt class="docutils literal"><span class="pre">Group</span></tt> record, it will
return an instance of <tt class="docutils literal"><span class="pre">Group</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>

<span class="c1">// ...</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Entity e&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;e.id = ?&#39;</span><span class="p">);</span>

<span class="nv">$group</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$group</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">));</span>

<span class="k">echo</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$group</span><span class="p">);</span> <span class="c1">// Group</span>
</pre></div>
</div>
<p>We can also query the individual <tt class="docutils literal"><span class="pre">User</span></tt> or <tt class="docutils literal"><span class="pre">Group</span></tt> models:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <tt class="docutils literal"><span class="pre">getSql()</span></tt> would output the following SQL query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">SELECT</span> <span class="nx">e</span><span class="o">.</span><span class="nx">id</span> <span class="k">AS</span>
<span class="nx">e_id</span> <span class="nx">FROM</span> <span class="nx">entity</span> <span class="nx">e</span> <span class="nx">WHERE</span> <span class="p">(</span><span class="nx">e</span><span class="o">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Now that we&#8217;ve learned about how to take advantage of PHPs inheritance
features with our models we can move on to learning about Doctrine <a class="reference internal" href="behaviors.html"><em>Behaviors</em></a>.
This is one of the most sophisticated and useful
features in Doctrine for accomplishing complex models with small and
easy to maintain code.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Inheritance</a><ul>
<li><a class="reference internal" href="#simple">Simple</a></li>
<li><a class="reference internal" href="#concrete">Concrete</a></li>
<li><a class="reference internal" href="#column-aggregation">Column Aggregation</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="data-hydrators.html"
                        title="previous chapter">Data Hydrators</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="behaviors.html"
                        title="next chapter">Behaviors</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/en/manual/inheritance.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="behaviors.html" title="Behaviors"
             >next</a> |</li>
        <li class="right" >
          <a href="data-hydrators.html" title="Data Hydrators"
             >previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" >Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jonathan Wage and Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>