

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DQL: Doctrine Query Language &mdash; Doctrine 1.2.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Doctrine 1.2.4 documentation" href="../../index.html" />
    <link rel="up" title="Doctrine 1.2 ORM Manual" href="index.html" />
    <link rel="next" title="Component Overview" href="component-overview.html" />
    <link rel="prev" title="Working with Models" href="working-with-models.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="component-overview.html" title="Component Overview"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="working-with-models.html" title="Working with Models"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="dql-doctrine-query-language">
<h1>DQL: Doctrine Query Language<a class="headerlink" href="#dql-doctrine-query-language" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Doctrine Query Language (DQL) is an Object Query Language created for helping
users in complex object retrieval. You should always consider using DQL (or raw
SQL) when retrieving relational data efficiently (eg.  when fetching users and
their phonenumbers).</p>
<p>In this chapter we will execute dozens of examples of how to use the Doctrine
Query Language. All of these examples assume you are using the schemas defined
in the previous chapters, primarily the <a class="reference internal" href="defining-models.html"><em>Defining Models</em></a> chapter. We will
define one additional model for our testing purposes:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Account.php</span>
<span class="k">class</span> <span class="nc">Account</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="nx">Account</span><span class="o">:</span>
  <span class="nx">columns</span><span class="o">:</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">string</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="nx">amount</span><span class="o">:</span> <span class="nx">decimal</span>
</pre></div>
</div>
<p>When compared to using raw SQL, DQL has several benefits:</p>
<ul class="simple">
<li>From the start it has been designed to retrieve records(objects) not
result set rows</li>
<li>DQL understands relations so you don&#8217;t have to type manually SQL
joins and join conditions</li>
<li>DQL is portable on different databases</li>
<li>DQL has some very complex built-in algorithms like (the record limit
algorithm) which can help the developer to efficiently retrieve
objects</li>
<li>It supports some functions that can save time when dealing with
one-to-many, many-to-many relational data with conditional fetching.</li>
</ul>
<p>If the power of DQL isn&#8217;t enough, you should consider using the <a class="reference internal" href="native-sql.html"><em>RawSql
API</em></a> for object population.</p>
<p>You may already be familiar with the following syntax:</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">DO NOT USE THE FOLLOWING CODE. It uses many SQL queries
for object population.</p>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">.</span> <span class="s2">&quot; has phonenumbers: &quot;</span><span class="p">;</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span> <span class="k">as</span> <span class="nv">$phonenumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$phonenumber</span><span class="o">-&gt;</span><span class="na">phonenumber</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Here is the same code but implemented more efficiently using
only one SQL query for object population.</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
</div>
<p>Lets take a look at the SQL that would be generated by the above query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">is_active</span> <span class="k">AS</span> <span class="n">u__is_active</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">is_super_admin</span> <span class="k">AS</span> <span class="n">u__is_super_admin</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">first_name</span> <span class="k">AS</span> <span class="n">u__first_name</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">last_name</span> <span class="k">AS</span> <span class="n">u__last_name</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">password</span> <span class="k">AS</span> <span class="n">u__password</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="k">type</span> <span class="k">AS</span> <span class="n">u__type</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">created_at</span> <span class="k">AS</span> <span class="n">u__created_at</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">updated_at</span> <span class="k">AS</span> <span class="n">u__updated_at</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">user_id</span> <span class="k">AS</span> <span class="n">p__user_id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span> <span class="k">AS</span> <span class="n">p__phonenumber</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
<p>Now lets execute the query and play with the data:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">.</span> <span class="s2">&quot; has phonenumbers: &quot;</span><span class="p">;</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span> <span class="k">as</span> <span class="nv">$phonenumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$phonenumber</span><span class="o">-&gt;</span><span class="na">phonenumber</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Using double quotes (&#8221;) in DQL strings is discouraged.  This is sensible in
MySQL standard but in DQL it can be confused as an identifier. Instead it is
recommended to use prepared statements for your values and it will be escaped
properly.</p>
</div>
</div>
<div class="section" id="select-queries">
<h2>SELECT queries<a class="headerlink" href="#select-queries" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">SELECT</span></tt> statement syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="p">[</span><span class="k">ALL</span> <span class="o">|</span> <span class="k">DISTINCT</span><span class="p">]</span>
    <span class="o">&lt;</span><span class="n">select_expr</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
    <span class="p">[</span><span class="k">FROM</span> <span class="o">&lt;</span><span class="n">components</span><span class="o">&gt;</span>
    <span class="p">[</span><span class="k">WHERE</span> <span class="o">&lt;</span><span class="n">where_condition</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="k">GROUP</span> <span class="k">BY</span> <span class="o">&lt;</span><span class="n">groupby_expr</span><span class="o">&gt;</span>
      <span class="p">[</span><span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span><span class="p">],</span> <span class="p">...</span> <span class="p">]</span>
    <span class="p">[</span><span class="k">HAVING</span> <span class="o">&lt;</span><span class="n">where_condition</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="o">&lt;</span><span class="n">orderby_expr</span><span class="o">&gt;</span>
      <span class="p">[</span><span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span><span class="p">],</span> <span class="p">...]</span>
    <span class="p">[</span><span class="k">LIMIT</span> <span class="o">&lt;</span><span class="k">row_count</span><span class="o">&gt;</span> <span class="k">OFFSET</span> <span class="o">&lt;</span><span class="k">offset</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">SELECT</span></tt> statement is used for the retrieval of data from one or more
components.</p>
<p>Each <tt class="docutils literal"><span class="pre">select_expr</span></tt> indicates a column or an aggregate function value that you
want to retrieve. There must be at least one <tt class="docutils literal"><span class="pre">select_expr</span></tt> in every
<tt class="docutils literal"><span class="pre">SELECT</span></tt> statement.</p>
<p>First insert a few sample <tt class="docutils literal"><span class="pre">Account</span></tt> records:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$account</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">();</span>
<span class="nv">$account</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;test 1&#39;</span><span class="p">;</span>

<span class="nv">$account</span><span class="o">-&gt;</span><span class="na">amount</span> <span class="o">=</span> <span class="s1">&#39;100.00&#39;</span><span class="p">;</span>
<span class="nv">$account</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="nv">$account</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">();</span>
<span class="nv">$account</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;test 2&#39;</span><span class="p">;</span>
<span class="nv">$account</span><span class="o">-&gt;</span><span class="na">amount</span> <span class="o">=</span> <span class="s1">&#39;200.00&#39;</span><span class="p">;</span>
<span class="nv">$account</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Be sure to execute <tt class="file docutils literal"><span class="pre">test.php</span></tt>:</p>
<div class="highlight-sh"><div class="highlight"><pre>php test.php
</pre></div>
</div>
<p>Now you can test the selecting of the data with these next few sample
queries:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.name&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Account a&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>Lets take a look at the SQL that would be generated by the above query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a__id</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">a__name</span> <span class="k">FROM</span> <span class="n">account</span> <span class="n">a</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$accounts</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$accounts</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
</pre></div>
</div>
<p>The above example would produce the following output:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [0] =&gt; Array
        (
            [id] =&gt; 1
            [name] =&gt; test 1
            [amount] =&gt;
        )
    [1] =&gt; Array
        (
            [id] =&gt; 2
            [name] =&gt; test 2
            [amount] =&gt;
        )
)
</pre></div>
</div>
<p>An asterisk can be used for selecting all columns from given component.
Even when using an asterisk the executed SQL queries never actually use
it (Doctrine converts asterisk to appropriate column names, hence
leading to better performance on some databases).</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.*&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Account a&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>Compare the generated SQL from the last query example to the SQL
generated by the query right above:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a__id</span><span class="p">,</span>
    <span class="n">a</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">a__name</span><span class="p">,</span>
    <span class="n">a</span><span class="p">.</span><span class="n">amount</span> <span class="k">AS</span> <span class="n">a__amount</span>
<span class="k">FROM</span> <span class="n">account</span> <span class="n">a</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the asterisk is replace by all the real column names that exist
in the <tt class="docutils literal"><span class="pre">Account</span></tt> model.</p>
</div>
<p>Now lets execute the query and inspect the results:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$accounts</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$accounts</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
</pre></div>
</div>
<p>The above example would produce the following output:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [0] =&gt; Array
        (
            [id] =&gt; 1
            [name] =&gt; test 1
            [amount] =&gt; 100.00
        )
    [1] =&gt; Array
        (
            [id] =&gt; 2
            [name] =&gt; test 2
            [amount] =&gt; 200.00
        )
)
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">FROM</span></tt> clause components indicate the component or components
from which to retrieve records.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username, p.*&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id1"><span class="problematic" id="id2">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">user_id</span> <span class="k">AS</span> <span class="n">p__user_id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span> <span class="k">AS</span> <span class="n">p__phonenumber</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause, if given, indicates the condition or conditions
that the records must satisfy to be selected. <tt class="docutils literal"><span class="pre">where_condition</span></tt> is an
expression that evaluates to true for each row to be selected. The
statement selects all rows if there is no <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.name&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Account a&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;a.amount &gt; 2000&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id3"><span class="problematic" id="id4">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a__id</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">a__name</span> <span class="k">FROM</span> <span class="n">account</span> <span class="n">a</span> <span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">2000</span>
</pre></div>
</div>
<p>In the <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause, you can use any of the functions and operators
that DQL supports, except for aggregate (summary) functions. The
<tt class="docutils literal"><span class="pre">HAVING</span></tt> clause can be used for narrowing the results with aggregate
functions:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">having</span><span class="p">(</span><span class="s1">&#39;COUNT(p.id) &gt; 3&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id5"><span class="problematic" id="id6">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
   <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
   <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></tt> clause can be used for sorting the results:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id7"><span class="problematic" id="id8">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">u</span><span class="p">.</span><span class="n">username</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">LIMIT</span></tt> and <tt class="docutils literal"><span class="pre">OFFSET</span></tt> clauses can be used for efficiently
limiting the number of records to a given <tt class="docutils literal"><span class="pre">row_count</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id9"><span class="problematic" id="id10">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span> <span class="k">LIMIT</span> <span class="mi">20</span>
</pre></div>
</div>
<div class="section" id="aggregate-values">
<h3>Aggregate values<a class="headerlink" href="#aggregate-values" title="Permalink to this headline">¶</a></h3>
<p>Aggregate value <tt class="docutils literal"><span class="pre">SELECT</span></tt> syntax:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, COUNT(t.id) AS num_threads&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u, u.Threads t&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id11"><span class="problematic" id="id12">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">f__0</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">forum__thread</span> <span class="n">f</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
</pre></div>
</div>
<p>Now execute the query and inspect the results:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>You can easily access the <tt class="docutils literal"><span class="pre">num_threads</span></tt> data with the following code:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">num_threads</span> <span class="o">.</span> <span class="s1">&#39; threads found&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="update-queries">
<h2>UPDATE queries<a class="headerlink" href="#update-queries" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">UPDATE</span></tt> statement syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="o">&lt;</span><span class="n">component_name</span><span class="o">&gt;</span>
<span class="k">SET</span>
    <span class="o">&lt;</span><span class="n">col_name1</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">expr1</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="n">col_name2</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">expr2</span><span class="o">&gt;</span>
<span class="k">WHERE</span> <span class="o">&lt;</span><span class="n">where_condition</span><span class="o">&gt;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="o">&lt;</span><span class="n">order_by</span><span class="o">&gt;</span>
<span class="k">LIMIT</span> <span class="o">&lt;</span><span class="n">record_count</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">UPDATE</span></tt> statement updates columns of existing records in
<tt class="docutils literal"><span class="pre">component_name</span></tt> with new values and returns the number of
affected records.</li>
<li>The <tt class="docutils literal"><span class="pre">SET</span></tt> clause indicates which columns to modify and the values
they should be given.</li>
<li>The optional <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause specifies the conditions that identify
which records to update. Without <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause, all records are
updated.</li>
<li>The optional <tt class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></tt> clause specifies the order in which the
records are being updated.</li>
<li>The <tt class="docutils literal"><span class="pre">LIMIT</span></tt> clause places a limit on the number of records that can
be updated. You can use <tt class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">row_count</span></tt> to restrict the scope of
the <tt class="docutils literal"><span class="pre">UPDATE</span></tt>. A <tt class="docutils literal"><span class="pre">LIMIT</span></tt> clause is a <strong>rows-matched restriction</strong>
not a rows-changed restriction. The statement stops as soon as it has
found <tt class="docutils literal"><span class="pre">record_count</span></tt> rows that satisfy the <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause,
whether or not they actually were changed.</li>
</ul>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;amount + 200&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id &gt; 200&#39;</span><span class="p">);</span>

<span class="c1">// If you just want to set the amount to a value</span>
<span class="c1">//   $q-&gt;set(&#39;amount&#39;, &#39;?&#39;, 500);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id13"><span class="problematic" id="id14">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">account</span> <span class="k">SET</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">+</span> <span class="mi">200</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">&gt;</span> <span class="mi">200</span>
</pre></div>
</div>
<p>Now to perform the update is simple. Just execute the query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$rows</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="delete-queries">
<h2>DELETE Queries<a class="headerlink" href="#delete-queries" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="o">&lt;</span><span class="n">component_name</span><span class="o">&gt;</span>
<span class="k">WHERE</span> <span class="o">&lt;</span><span class="n">where_condition</span><span class="o">&gt;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="o">&lt;</span><span class="n">order_by</span><span class="o">&gt;</span>
<span class="k">LIMIT</span> <span class="o">&lt;</span><span class="n">record_count</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">DELETE</span></tt> statement deletes records from <tt class="docutils literal"><span class="pre">component_name</span></tt> and
returns the number of records deleted.</li>
<li>The optional <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause specifies the conditions that identify
which records to delete. Without <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause, all records are
deleted.</li>
<li>If the <tt class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></tt> clause is specified, the records are deleted in
the order that is specified.</li>
<li>The <tt class="docutils literal"><span class="pre">LIMIT</span></tt> clause places a limit on the number of rows that can be
deleted. The statement will stop as soon as it has deleted
<tt class="docutils literal"><span class="pre">record_count</span></tt> records.</li>
</ul>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;Account a&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;a.id &gt; 3&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id15"><span class="problematic" id="id16">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">account</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">&gt;</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Now executing the <tt class="docutils literal"><span class="pre">DELETE</span></tt> query is just as you would think:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$rows</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When executing DQL UPDATE and DELETE queries the executing
of a query returns the number of affected rows.</p>
</div>
</div>
<div class="section" id="from-clause">
<h2>FROM clause<a class="headerlink" href="#from-clause" title="Permalink to this headline">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">FROM</span> <span class="o">&lt;</span><span class="n">component_reference</span><span class="o">&gt;</span>
    <span class="p">[[</span><span class="k">LEFT</span> <span class="o">|</span> <span class="k">INNER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="o">&lt;</span><span class="n">component_reference</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">...</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">FROM</span></tt> clause indicates the component or components from which to
retrieve records. If you name more than one component, you are performing a
join. For each table specified, you can optionally specify an alias.</p>
<p>Consider the following DQL query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id17"><span class="problematic" id="id18">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
</pre></div>
</div>
<p>Here <tt class="docutils literal"><span class="pre">User</span></tt> is the name of the class (component) and <tt class="docutils literal"><span class="pre">u</span></tt> is the alias. You
should always use short aliases, since most of the time those make the query
much shorther and also because when using for example caching the cached form
of the query takes less space when short aliases are being used.</p>
</div>
<div class="section" id="join-syntax">
<h2>JOIN syntax<a class="headerlink" href="#join-syntax" title="Permalink to this headline">¶</a></h2>
<p>DQL JOIN Syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="p">[[</span><span class="k">LEFT</span> <span class="o">|</span> <span class="k">INNER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="o">&lt;</span><span class="n">component_reference1</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="k">ON</span> <span class="o">|</span> <span class="k">WITH</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">join_condition1</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">INDEXBY</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">map_condition1</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">[[</span><span class="k">LEFT</span> <span class="o">|</span> <span class="k">INNER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="o">&lt;</span><span class="n">component_reference2</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="k">ON</span> <span class="o">|</span> <span class="k">WITH</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">join_condition2</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">INDEXBY</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">map_condition2</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">...</span>
<span class="p">[[</span><span class="k">LEFT</span> <span class="o">|</span> <span class="k">INNER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="o">&lt;</span><span class="n">component_referenceN</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="k">ON</span> <span class="o">|</span> <span class="k">WITH</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">join_conditionN</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">INDEXBY</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">map_conditionN</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>DQL supports two kinds of joins INNER JOINs and LEFT JOINs. For each joined
component, you can optionally specify an alias.</p>
<p>The default join type is <tt class="docutils literal"><span class="pre">LEFT</span> <span class="pre">JOIN</span></tt>. This join can be indicated by the use
of either <tt class="docutils literal"><span class="pre">LEFT</span> <span class="pre">JOIN</span></tt> clause or simply &#8216;<tt class="docutils literal"><span class="pre">,</span></tt>&#8216;, hence the following queries
are equal:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, p.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">);</span>

<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, p.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u, u.Phonenumbers p&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The recommended form is the first because it is more verbose
and easier to read and understand what is being done.</p>
</div>
<p>The above call to <a href="#id19"><span class="problematic" id="id20">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
<span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
<span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the JOIN condition is automatically added for
you. This is because Doctrine knows how <tt class="docutils literal"><span class="pre">User</span></tt> and <tt class="docutils literal"><span class="pre">Phonenumber</span></tt>
are related so it is able to add it for you.</p>
</div>
<p><tt class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></tt> produces an intersection between two specified components (that
is, each and every record in the first component is joined to each and every
record in the second component). So basically <tt class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></tt> can be used when
you want to efficiently fetch for example all users which have one or more
phonenumbers.</p>
<p>By default DQL auto-adds the primary key join condition:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, p.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id21"><span class="problematic" id="id22">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span>
<span class="k">FROM</span> <span class="k">User</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Phonenumbers</span> <span class="n">p</span> <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
<div class="section" id="on-keyword">
<h3>ON keyword<a class="headerlink" href="#on-keyword" title="Permalink to this headline">¶</a></h3>
<p>If you want to override this behavior and add your own custom join condition
you can do it with the <tt class="docutils literal"><span class="pre">ON</span></tt> keyword. Consider the following DQL query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, p.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p ON u.id = 2&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id23"><span class="problematic" id="id24">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span>
<span class="k">FROM</span> <span class="k">User</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Phonenumbers</span> <span class="n">p</span> <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the <tt class="docutils literal"><span class="pre">ON</span></tt> condition that would be normally automatically added
is not present and the user specified condition is used instead.</p>
</div>
</div>
<div class="section" id="with-keyword">
<h3>WITH keyword<a class="headerlink" href="#with-keyword" title="Permalink to this headline">¶</a></h3>
<p>Most of the time you don&#8217;t need to override the primary join condition,
rather you may want to add some custom conditions. This can be achieved
with the <tt class="docutils literal"><span class="pre">WITH</span></tt> keyword.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, p.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p WITH u.id = 2&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id25"><span class="problematic" id="id26">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span>
<span class="k">FROM</span> <span class="k">User</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Phonenumbers</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span> <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the <tt class="docutils literal"><span class="pre">ON</span></tt> condition isn&#8217;t completely replaced.
Instead the conditions you specify are appended on to the automatic
condition that is added for you.</p>
</div>
<p>The Doctrine_Query API offers two convenience methods for adding JOINS.  These
are called <a href="#id27"><span class="problematic" id="id28">:php:meth:`innerJoin`</span></a> and <a href="#id29"><span class="problematic" id="id30">:php:meth:`leftJoin`</span></a>, which usage should
be quite intuitive as shown below:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p WITH u.id &gt; 3&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Email e&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id31"><span class="problematic" id="id32">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">user_group</span> <span class="n">u2</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u2</span><span class="p">.</span><span class="n">user_id</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">groups</span> <span class="k">g</span>
        <span class="k">ON</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u2</span><span class="p">.</span><span class="n">group_id</span>
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span> <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">3</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">email</span> <span class="n">e</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indexby-keyword">
<h2>INDEXBY keyword<a class="headerlink" href="#indexby-keyword" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">INDEXBY</span></tt> keyword offers a way of mapping certain columns as collection /
array keys. By default Doctrine indexes multiple elements to numerically
indexed arrays / collections. The mapping starts from zero. In order to
override this behavior you need to use <tt class="docutils literal"><span class="pre">INDEXBY</span></tt> keyword as shown above:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u INDEXBY u.username&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">INDEXBY</span></tt> keyword does not alter the generated SQL.
It is simply used internally by <a href="#id33"><span class="problematic" id="id34">:php:class:`Doctrine_Query`</span></a> to hydrate the
data with the specified column as the key of each record in the
collection.</p>
</div>
<p>Now the users in <tt class="docutils literal"><span class="pre">$users</span></tt> collection are accessible through their
names:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;jack daniels&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">INDEXBY</span></tt> keyword can be applied to any given JOIN. This means
that any given component can have each own indexing behavior. In the
following we use distinct indexing for both <tt class="docutils literal"><span class="pre">Users</span></tt> and <tt class="docutils literal"><span class="pre">Groups</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u INDEXBY u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g INDEXBY g.name&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Now lets print out the drinkers club&#8217;s creation date.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$users</span><span class="p">[</span><span class="s1">&#39;jack daniels&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="s1">&#39;drinkers club&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">createdAt</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="where-clause">
<h2>WHERE clause<a class="headerlink" href="#where-clause" title="Permalink to this headline">¶</a></h2>
<p>Syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">WHERE</span> <span class="o">&lt;</span><span class="n">where_condition</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause, if given, indicates the condition or conditions
that the records must satisfy to be selected.</li>
<li><tt class="xref std std-token docutils literal"><span class="pre">where_condition</span></tt> is an expression that evaluates to true for each
row to be selected.</li>
<li>The statement selects all rows if there is no <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause.</li>
<li>When narrowing results with aggregate function values <tt class="docutils literal"><span class="pre">HAVING</span></tt>
clause should be used instead of <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause</li>
</ul>
<p>You can use the <a href="#id35"><span class="problematic" id="id36">:php:meth:`addWhere`</span></a>, <a href="#id37"><span class="problematic" id="id38">:php:meth:`andWhere`</span></a>, <a href="#id39"><span class="problematic" id="id40">:php:meth:`orWhere`</span></a>,
<a href="#id41"><span class="problematic" id="id42">:php:meth:`whereIn`</span></a>, <a href="#id43"><span class="problematic" id="id44">:php:meth:`andWhereIn`</span></a>, <a href="#id45"><span class="problematic" id="id46">:php:meth:`orWhereIn`</span></a>, <a href="#id47"><span class="problematic" id="id48">:php:meth:`whereNotIn`</span></a>,
<a href="#id49"><span class="problematic" id="id50">:php:meth:`andWhereNotIn`</span></a>, <a href="#id51"><span class="problematic" id="id52">:php:meth:`orWhereNotIn`</span></a> functions for building complex
where conditions using <a href="#id53"><span class="problematic" id="id54">:php:class:`Doctrine_Query`</span></a> objects.</p>
<p>Here is an example where we retrieve all active registered users or
super administrators:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.type = ?&#39;</span><span class="p">,</span> <span class="s1">&#39;registered&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">(</span><span class="s1">&#39;u.is_active = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">orWhere</span><span class="p">(</span><span class="s1">&#39;u.is_super_admin = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id55"><span class="problematic" id="id56">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="k">type</span> <span class="o">=</span> <span class="o">?</span>
    <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="o">?</span>
    <span class="k">OR</span> <span class="n">u</span><span class="p">.</span><span class="n">is_super_admin</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
</div>
<div class="section" id="conditional-expressions">
<h2>Conditional expressions<a class="headerlink" href="#conditional-expressions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="literals">
<h3>Literals<a class="headerlink" href="#literals" title="Permalink to this headline">¶</a></h3>
<div class="section" id="strings">
<h4>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h4>
<p>A string literal that includes a single quote is represented by two
single quotes; for example: ´´literal&#8217;&#8217;s´´.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = ?&#39;</span><span class="p">,</span> <span class="s1">&#39;Vincent&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id57"><span class="problematic" id="id58">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because we passed the value of the <tt class="docutils literal"><span class="pre">username</span></tt> as a
parameter to the <a href="#id59"><span class="problematic" id="id60">:php:meth:`where`</span></a> method it is not included in the
generated SQL. PDO handles the replacement when you execute the
query. To check the parameters that exist on a <a href="#id61"><span class="problematic" id="id62">:php:class:`Doctrine_Query`</span></a>
instance you can use the <a href="#id63"><span class="problematic" id="id64">:php:meth:`getParams`</span></a> method.</p>
</div>
</div>
<div class="section" id="integers">
<h4>Integers<a class="headerlink" href="#integers" title="Permalink to this headline">¶</a></h4>
<p>Integer literals support the use of PHP integer literal syntax.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = 4&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id65"><span class="problematic" id="id66">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span> <span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="section" id="floats">
<h4>Floats<a class="headerlink" href="#floats" title="Permalink to this headline">¶</a></h4>
<p>Float literals support the use of PHP float literal syntax.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Account a&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;a.amount = 432.123&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id67"><span class="problematic" id="id68">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a__id</span> <span class="k">FROM</span> <span class="n">account</span> <span class="n">a</span> <span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="mi">432</span><span class="p">.</span><span class="mi">123</span>
</pre></div>
</div>
</div>
<div class="section" id="booleans">
<h4>Booleans<a class="headerlink" href="#booleans" title="Permalink to this headline">¶</a></h4>
<p>The boolean literals are true and false.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.is_super_admin = true&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id69"><span class="problematic" id="id70">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span> <span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">is_super_admin</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="enums">
<h4>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">¶</a></h4>
<p>The enumerated values work in the same way as string literals.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;u.type = &#39;admin&#39;&quot;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id71"><span class="problematic" id="id72">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span> <span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
</pre></div>
</div>
<p>Predefined reserved literals are case insensitive, although its a good standard
to write them in uppercase.</p>
</div>
</div>
<div class="section" id="input-parameters">
<h3>Input parameters<a class="headerlink" href="#input-parameters" title="Permalink to this headline">¶</a></h3>
<p>Here are some examples of using positional parameters:</p>
<ul>
<li><p class="first">Single positional parameter:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Arnold&#39;</span><span class="p">));</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the passed parameter for a positional parameter
contains only one value you can simply pass a single scalar value
instead of an array containing one value.</p>
</div>
<p>The above call to <a href="#id73"><span class="problematic" id="id74">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
</li>
<li><p class="first">Multiple positional parameters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id &gt; ? AND u.username LIKE ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;A%&#39;</span><span class="p">));</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id75"><span class="problematic" id="id76">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span> <span class="p">(</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="o">?</span>
    <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">LIKE</span> <span class="o">?</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Here are some examples of using named parameters:</p>
<ul>
<li><p class="first">Single named parameter:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = :name&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;:name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Arnold&#39;</span><span class="p">));</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id77"><span class="problematic" id="id78">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="p">:</span><span class="n">name</span>
</pre></div>
</div>
</li>
<li><p class="first">Named parameter with a LIKE statement:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id &gt; :id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;:id&#39;</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">))</span>
        <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">(</span><span class="s1">&#39;u.username LIKE :name&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;:name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;A%&#39;</span><span class="p">));</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id79"><span class="problematic" id="id80">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="p">:</span><span class="n">id</span>
    <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">LIKE</span> <span class="p">:</span><span class="n">name</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="operators-and-operator-precedence">
<h3>Operators and operator precedence<a class="headerlink" href="#operators-and-operator-precedence" title="Permalink to this headline">¶</a></h3>
<p>The operators are listed below in order of decreasing precedence.</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operator</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">.</span></tt></td>
<td>Navigation operator</td>
</tr>
<tr class="row-odd"><td colspan="2"><strong>Arithmetic operators:</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">+</span></tt>, <tt class="docutils literal"><span class="pre">-</span></tt></td>
<td>Unary</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">*</span></tt>, <tt class="docutils literal"><span class="pre">/</span></tt></td>
<td>Multiplication and
division</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">+</span></tt>, <tt class="docutils literal"><span class="pre">-</span></tt></td>
<td>Addition and subtraction</td>
</tr>
<tr class="row-odd"><td colspan="2"><strong>Comparison operators:</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">=</span></tt>,
<tt class="docutils literal"><span class="pre">&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&gt;=</span></tt>,
<tt class="docutils literal"><span class="pre">&lt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;=</span></tt>,
<tt class="docutils literal"><span class="pre">&lt;&gt;</span></tt> (not equal)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">[NOT]</span> <span class="pre">LIKE</span></tt>,
<tt class="docutils literal"><span class="pre">[NOT]</span> <span class="pre">IN</span></tt>,
<tt class="docutils literal"><span class="pre">IS</span> <span class="pre">[NOT]</span> <span class="pre">NULL</span></tt>,
<tt class="docutils literal"><span class="pre">IS</span> <span class="pre">[NOT]</span> <span class="pre">EMPTY</span></tt></td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td colspan="2"><strong>Logical operators:</strong></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">NOT</span></tt>,
<tt class="docutils literal"><span class="pre">AND</span></tt>,
<tt class="docutils literal"><span class="pre">OR</span></tt>,</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="in-expressions">
<h3>In expressions<a class="headerlink" href="#in-expressions" title="Permalink to this headline">¶</a></h3>
<p>Syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">operand</span><span class="o">&gt;</span> <span class="k">IN</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">subquery</span><span class="o">&gt;|&lt;</span><span class="n">value</span> <span class="n">list</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>An <tt class="docutils literal"><span class="pre">IN</span></tt> conditional expression returns true if the <tt class="docutils literal"><span class="pre">operand</span></tt> is
found from result of the <tt class="docutils literal"><span class="pre">subquery</span></tt> or if its in the specificied comma
separated <tt class="docutils literal"><span class="pre">value</span> <span class="pre">list</span></tt>, hence the IN expression is always false if the
result of the subquery is empty.</p>
<p>When <tt class="docutils literal"><span class="pre">value</span> <span class="pre">list</span></tt> is being used there must be at least one element in
that list.</p>
<p>Here is an example where we use a subquery for the <tt class="docutils literal"><span class="pre">IN</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id IN (SELECT u.id FROM User u INNER JOIN u.Groups g WHERE g.id = ?)&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id81"><span class="problematic" id="id82">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">IN</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u2__id</span>
    <span class="k">FROM</span> <span class="k">user</span> <span class="n">u2</span>
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">user_group</span> <span class="n">u3</span>
        <span class="k">ON</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">user_id</span>
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">groups</span> <span class="k">g</span>
        <span class="k">ON</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">group_id</span>
    <span class="k">WHERE</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here is an example where we just use a list of integers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">whereIn</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id83"><span class="problematic" id="id84">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span> <span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="like-expressions">
<h3>Like Expressions<a class="headerlink" href="#like-expressions" title="Permalink to this headline">¶</a></h3>
<p>Syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="n">string_expression</span> <span class="p">[</span><span class="k">NOT</span><span class="p">]</span> <span class="k">LIKE</span> <span class="n">pattern_value</span> <span class="p">[</span><span class="k">ESCAPE</span> <span class="n">escape_character</span><span class="p">]</span>
</pre></div>
</div>
<p>The string_expression must have a string value. The pattern_value is a
string literal or a string-valued input parameter in which an underscore
(<tt class="docutils literal"><span class="pre">_</span></tt>) stands for any single character, a percent (<tt class="docutils literal"><span class="pre">%</span></tt>) character
stands for any sequence of characters (including the empty sequence),
and all other characters stand for themselves. The optional
escape_character is a single-character string literal or a
character-valued input parameter (i.e., char or Character) and is used
to escape the special meaning of the underscore and percent characters
in <tt class="docutils literal"><span class="pre">pattern_value</span></tt>.</p>
<p>Examples:</p>
<ul class="simple">
<li>address.phone <tt class="docutils literal"><span class="pre">LIKE</span></tt> &#8216;12%3&#8217; is true for &#8216;123&#8217; &#8216;12993&#8217; and false for &#8216;1234&#8217;</li>
<li>asentence.word <tt class="docutils literal"><span class="pre">LIKE</span></tt> &#8216;l_se&#8217; is true for &#8216;lose&#8217; and false for &#8216;loose&#8217;</li>
<li>aword.underscored <tt class="docutils literal"><span class="pre">LIKE</span></tt> &#8216;_%&#8217; ESCAPE &#8216;&#8217; is true for &#8216;_foo&#8217; and false for
&#8216;bar&#8217;</li>
<li>address.phone <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">LIKE</span></tt> &#8216;12%3&#8217; is false for &#8216;123&#8217; and &#8216;12993&#8217; and true
for &#8216;1234&#8217;</li>
</ul>
<p>If the value of the string_expression or pattern_value is NULL or
unknown, the value of the LIKE expression is unknown. If the
escape_characteris specified and is NULL, the value of the LIKE
expression is unknown.</p>
<ul>
<li><p class="first">Find all users whose email ends with <a class="reference external" href="mailto:'&#37;&#52;&#48;gmail&#46;com">'<span>&#64;</span>gmail<span>&#46;</span>com</a>&#8216;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Email e&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;e.address LIKE ?&#39;</span><span class="p">,</span> <span class="s1">&#39;%@gmail.com&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id85"><span class="problematic" id="id86">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">email</span> <span class="n">e</span> <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span>
    <span class="n">e</span><span class="p">.</span><span class="n">address</span> <span class="k">LIKE</span> <span class="o">?</span>
</pre></div>
</div>
</li>
<li><p class="first">Find all users whose name starts with letter &#8216;A&#8217;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username LIKE ?&#39;</span><span class="p">,</span> <span class="s1">&#39;A%&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id87"><span class="problematic" id="id88">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">LIKE</span> <span class="o">?</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="exists-expressions">
<h3>Exists Expressions<a class="headerlink" href="#exists-expressions" title="Permalink to this headline">¶</a></h3>
<p>Syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="p">[</span><span class="k">NOT</span><span class="p">]</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">subquery</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">EXISTS</span></tt> operator returns <tt class="docutils literal"><span class="pre">TRUE</span></tt> if the subquery returns one or
more rows and <tt class="docutils literal"><span class="pre">FALSE</span></tt> otherwise.</p>
<p>The <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">EXISTS</span></tt> operator returns <tt class="docutils literal"><span class="pre">TRUE</span></tt> if the subquery returns 0
rows and <tt class="docutils literal"><span class="pre">FALSE</span></tt> otherwise.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For the next few examples we need to add the <tt class="docutils literal"><span class="pre">ReaderLog</span></tt>
model.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/ReaderLog.php</span>
<span class="k">class</span> <span class="nc">ReaderLog</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;article_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">ReaderLog</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">article_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p>After adding the <tt class="docutils literal"><span class="pre">ReaderLog</span></tt> model don&#8217;t forget to run the
<tt class="file docutils literal"><span class="pre">generate.php</span></tt> script!</p>
<div class="last highlight-sh"><div class="highlight"><pre>php generate.php
</pre></div>
</div>
</div>
</div>
<p>Now we can run some tests! First, finding all articles which have
readers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Article a&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;EXISTS (SELECT r.id FROM ReaderLog r WHERE r.article_id = a.id)&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id89"><span class="problematic" id="id90">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a__id</span>
<span class="k">FROM</span> <span class="n">article</span> <span class="n">a</span>
<span class="k">WHERE</span>
    <span class="k">EXISTS</span> <span class="p">(</span>
        <span class="k">SELECT</span>
            <span class="n">r</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">r__id</span>
        <span class="k">FROM</span> <span class="n">reader_log</span> <span class="n">r</span>
        <span class="k">WHERE</span>
            <span class="n">r</span><span class="p">.</span><span class="n">article_id</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Finding all articles which don&#8217;t have readers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;a.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Article a&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;NOT EXISTS (SELECT r.id FROM ReaderLog r WHERE r.article_id = a.id)&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id91"><span class="problematic" id="id92">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">a__id</span>
<span class="k">FROM</span> <span class="n">article</span> <span class="n">a</span>
<span class="k">WHERE</span>
    <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="p">(</span>
        <span class="k">SELECT</span>
            <span class="n">r</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">r__id</span>
        <span class="k">FROM</span> <span class="n">reader_log</span> <span class="n">r</span>
        <span class="k">WHERE</span>
            <span class="n">r</span><span class="p">.</span><span class="n">article_id</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="all-and-any-expressions">
<h3>All and Any Expressions<a class="headerlink" href="#all-and-any-expressions" title="Permalink to this headline">¶</a></h3>
<p>Syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="n">operand</span> <span class="n">comparison_operator</span> <span class="k">ANY</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span>
<span class="n">operand</span> <span class="n">comparison_operator</span> <span class="k">SOME</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span>
<span class="n">operand</span> <span class="n">comparison_operator</span> <span class="k">ALL</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span>
</pre></div>
</div>
<p>An ALL conditional expression returns true if the comparison operation
is true for all values in the result of the subquery or the result of
the subquery is empty. An ALL conditional expression is false if the
result of the comparison is false for at least one row, and is unknown
if neither true nor false.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
       <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
       <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;C.col1 &lt; ALL (FROM C2(col1))&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>An ANY conditional expression returns true if the comparison operation
is true for some value in the result of the subquery. An ANY conditional
expression is false if the result of the subquery is empty or if the
comparison operation is false for every value in the result of the
subquery, and is unknown if neither true nor false.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;C.col1 &gt; ANY (FROM C2(col1))&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The keyword SOME is an alias for ANY.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;C.col1 &gt; SOME (FROM C2(col1))&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The comparison operators that can be used with ALL or ANY conditional
expressions are =, &lt;, &lt;=, &gt;, &gt;=, &lt;&gt;. The result of the subquery must be
same type with the conditional expression.</p>
<p>NOT IN is an alias for &lt;&gt; ALL. Thus, these two statements are equal:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">FROM</span> <span class="k">C</span> <span class="k">WHERE</span> <span class="k">C</span><span class="p">.</span><span class="n">col1</span> <span class="o">&lt;&gt;</span> <span class="k">ALL</span> <span class="p">(</span><span class="k">FROM</span> <span class="n">C2</span><span class="p">(</span><span class="n">col1</span><span class="p">));</span>
<span class="k">FROM</span> <span class="k">C</span> <span class="k">WHERE</span> <span class="k">C</span><span class="p">.</span><span class="n">col1</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">FROM</span> <span class="n">C2</span><span class="p">(</span><span class="n">col1</span><span class="p">));</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;C.col1 &lt;&gt; ALL (FROM C2(col1))&#39;</span><span class="p">);</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;C.col1 NOT IN (FROM C2(col1))&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="subqueries">
<h3>Subqueries<a class="headerlink" href="#subqueries" title="Permalink to this headline">¶</a></h3>
<p>A subquery can contain any of the keywords or clauses that an ordinary
SELECT query can contain.</p>
<p>Some advantages of the subqueries:</p>
<ul class="simple">
<li>They allow queries that are structured so that it is possible to
isolate each part of a statement.</li>
<li>They provide alternative ways to perform operations that would
otherwise require complex joins and unions.</li>
<li>They are, in many people&#8217;s opinion, readable. Indeed, it was the
innovation of subqueries that gave people the original idea of
calling the early SQL &#8220;Structured Query Language.&#8221;</li>
</ul>
<p>Here is an example where we find all users which don&#8217;t belong to the
group id 1:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id NOT IN (SELECT u2.id FROM User u2 INNER JOIN u2.Groups g WHERE g.id = ?)&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id93"><span class="problematic" id="id94">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span>
        <span class="n">u2__id</span>
    <span class="k">FROM</span> <span class="k">user</span> <span class="n">u2</span>
        <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">user_group</span> <span class="n">u3</span>
            <span class="k">ON</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">user_id</span>
        <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">groups</span> <span class="k">g</span>
            <span class="k">ON</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">group_id</span>
    <span class="k">WHERE</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here is an example where we find all users which don&#8217;t belong to any
groups:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id NOT IN (SELECT u2.id FROM User u2 INNER JOIN u2.Groups g)&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id95"><span class="problematic" id="id96">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u2__id</span>
    <span class="k">FROM</span> <span class="k">user</span> <span class="n">u2</span>
        <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">user_group</span> <span class="n">u3</span>
            <span class="k">ON</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">user_id</span>
        <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">groups</span> <span class="k">g</span>
            <span class="k">ON</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">group_id</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="functional-expressions">
<h2>Functional Expressions<a class="headerlink" href="#functional-expressions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="string-functions">
<h3>String functions<a class="headerlink" href="#string-functions" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">CONCAT</span></tt> function returns a string that is a concatenation of its
arguments. In the example above we map the concatenation of users
<tt class="docutils literal"><span class="pre">first_name</span></tt> and <tt class="docutils literal"><span class="pre">last_name</span></tt> to a value called <tt class="docutils literal"><span class="pre">name</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;CONCAT(u.first_name, u.last_name) AS name&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id97"><span class="problematic" id="id98">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">CONCAT</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">last_name</span><span class="p">)</span> <span class="k">AS</span> <span class="n">u__0</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
</pre></div>
</div>
<p>Now we can execute the query and get the mapped function value:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// here &#39;name&#39; is not a property of $user,</span>
    <span class="c1">// its a mapped function value echo $user-&gt;name;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The second and third arguments of the <tt class="docutils literal"><span class="pre">SUBSTRING</span></tt> function denote the
starting position and length of the substring to be returned. These
arguments are integers. The first position of a string is denoted by 1.
The <tt class="docutils literal"><span class="pre">SUBSTRING</span></tt> function returns a string.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;SUBSTRING(u.username, 0, 1) = &#39;z&#39;&quot;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id99"><span class="problematic" id="id100">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="k">SUBSTRING</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">FROM</span> <span class="mi">0</span> <span class="k">FOR</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the SQL is generated with the proper
<tt class="docutils literal"><span class="pre">SUBSTRING</span></tt> syntax for the DBMS you are using!</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">TRIM</span></tt> function trims the specified character from a string. If
the character to be trimmed is not specified, it is assumed to be space
(or blank). The optional trim_character is a single-character string
literal or a character-valued input parameter (i.e., char or
Character)[30]. If a trim specification is not provided, BOTH is
assumed. The <tt class="docutils literal"><span class="pre">TRIM</span></tt> function returns the trimmed string.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;TRIM(u.username) = ?&#39;</span><span class="p">,</span> <span class="s1">&#39;Someone&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id101"><span class="problematic" id="id102">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
<span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
<span class="k">TRIM</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">username</span><span class="p">)</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">LOWER</span></tt> and <tt class="docutils literal"><span class="pre">UPPER</span></tt> functions convert a string to lower and
upper case, respectively. They return a string.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;LOWER(u.username) = &#39;jon wage&#39;&quot;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id103"><span class="problematic" id="id104">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="k">LOWER</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">username</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;someone&#39;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">LOCATE</span></tt> function returns the position of a given string within a
string, starting the search at a specified position. It returns the
first position at which the string was found as an integer. The first
argument is the string to be located; the second argument is the string
to be searched; the optional third argument is an integer that
represents the string position at which the search is started (by
default, the beginning of the string to be searched). The first position
in a string is denoted by 1. If the string is not found, 0 is returned.</p>
<p>The <tt class="docutils literal"><span class="pre">LENGTH</span></tt> function returns the length of the string in characters
as an integer.</p>
</div>
<div class="section" id="arithmetic-functions">
<h3>Arithmetic functions<a class="headerlink" href="#arithmetic-functions" title="Permalink to this headline">¶</a></h3>
<p>Availible DQL arithmetic functions:</p>
<blockquote>
<div>ABS(<a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref std std-token docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a>)
SQRT(<a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref std std-token docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a>)
MOD(<a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref std std-token docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a>, <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref std std-token docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a>)</div></blockquote>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">ABS</span></tt> function returns the absolute value for given number.</li>
<li>The <tt class="docutils literal"><span class="pre">SQRT</span></tt> function returns the square root for given number.</li>
<li>The <tt class="docutils literal"><span class="pre">MOD</span></tt> function returns the modulus of first argument using the
second argument.</li>
</ul>
</div>
</div>
<div class="section" id="id105">
<h2>Subqueries<a class="headerlink" href="#id105" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id106">
<h3>Introduction<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h3>
<p>Doctrine allows you to use sub-dql queries in the FROM, SELECT and WHERE
statements. Below you will find examples for all the different types of
subqueries Doctrine supports.</p>
</div>
<div class="section" id="comparisons-using-subqueries">
<h3>Comparisons using subqueries<a class="headerlink" href="#comparisons-using-subqueries" title="Permalink to this headline">¶</a></h3>
<p>Find all the users which are not in a specific group.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id NOT IN (</span>
<span class="s1">                    SELECT u.id</span>
<span class="s1">                    FROM User u</span>
<span class="s1">                    INNER JOIN u.Groups g</span>
<span class="s1">                    WHERE g.id = ?</span>
<span class="s1">                )&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id107"><span class="problematic" id="id108">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span>
            <span class="n">u2__id</span>
        <span class="k">FROM</span> <span class="k">user</span> <span class="n">u2</span>
            <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">user_group</span> <span class="n">u3</span>
                <span class="k">ON</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">user_id</span>
            <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">groups</span> <span class="k">g</span>
                <span class="k">ON</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u3</span><span class="p">.</span><span class="n">group_id</span>
        <span class="k">WHERE</span> <span class="k">g</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Retrieve the users phonenumber in a subquery and include it in the
resultset of user information.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">addSelect</span><span class="p">(</span><span class="s1">&#39;(SELECT p.phonenumber</span>
<span class="s1">                        FROM Phonenumber p</span>
<span class="s1">                        WHERE p.user_id = u.id</span>
<span class="s1">                        LIMIT 1) as phonenumber&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id109"><span class="problematic" id="id110">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="k">SELECT</span>
            <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span> <span class="k">AS</span> <span class="n">p__phonenumber</span>
        <span class="k">FROM</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">WHERE</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
        <span class="k">LIMIT</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="k">AS</span> <span class="n">u__0</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="group-by-having-clauses">
<h2>GROUP BY, HAVING clauses<a class="headerlink" href="#group-by-having-clauses" title="Permalink to this headline">¶</a></h2>
<p>DQL GROUP BY syntax:</p>
<div class="highlight-sql"><pre>GROUP BY groupby_item {, groupby_item}*</pre>
</div>
<p>DQL HAVING syntax:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">HAVING</span> <span class="n">conditional_expression</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></tt> and <tt class="docutils literal"><span class="pre">HAVING</span></tt> clauses can be used for dealing with
aggregate functions. The Following aggregate functions are available on
DQL: <tt class="docutils literal"><span class="pre">COUNT</span></tt>, <tt class="docutils literal"><span class="pre">MAX</span></tt>, <tt class="docutils literal"><span class="pre">MIN</span></tt>, <tt class="docutils literal"><span class="pre">AVG</span></tt>, <tt class="docutils literal"><span class="pre">SUM</span></tt></p>
<ul>
<li><p class="first">Selecting alphabetically first user by name:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;MIN(a.amount)&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Account a&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id111"><span class="problematic" id="id112">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="k">MIN</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a__0</span> <span class="k">FROM</span> <span class="n">account</span> <span class="n">a</span>
</pre></div>
</div>
</li>
<li><p class="first">Selecting the sum of all Account amounts:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;SUM(a.amount)&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Account a&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id113"><span class="problematic" id="id114">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a__0</span> <span class="k">FROM</span> <span class="n">account</span> <span class="n">a</span>
</pre></div>
</div>
</li>
<li><p class="first">Using an aggregate function in a statement containing no <tt class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></tt>
clause, results in grouping on all rows. In the example below we fetch
all users and the number of phonenumbers they have.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">addSelect</span><span class="p">(</span><span class="s1">&#39;COUNT(p.id) as num_phonenumbers&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id115"><span class="problematic" id="id116">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">p__0</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
</pre></div>
</div>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">HAVING</span></tt> clause can be used for narrowing the results using
aggregate values. In the following example we fetch all users which have
at least 2 phonenumbers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">addSelect</span><span class="p">(</span><span class="s1">&#39;COUNT(p.id) as num_phonenumbers&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">having</span><span class="p">(</span><span class="s1">&#39;num_phonenumbers &gt;= 2&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id117"><span class="problematic" id="id118">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">p__0</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
<span class="k">HAVING</span> <span class="n">p__0</span> <span class="o">&gt;=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>You can access the number of phonenumbers with the following code:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span>
        <span class="o">.</span> <span class="s1">&#39; has &#39;</span>
        <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">num_phonenumbers</span>
        <span class="o">.</span> <span class="s1">&#39; phonenumbers&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="order-by-clause">
<h2>ORDER BY clause<a class="headerlink" href="#order-by-clause" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id119">
<h3>Introduction<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h3>
<p>Record collections can be sorted efficiently at the database level using
the ORDER BY clause.</p>
<p>Syntax:</p>
<div class="highlight-sql"><pre>[
   ORDER BY {ComponentAlias.columnName}
   [ASC | DESC], ...
]</pre>
</div>
<p>Examples:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;u.username, p.phonenumber&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id120"><span class="problematic" id="id121">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span>
</pre></div>
</div>
<p>In order to sort in reverse order you can add the <tt class="docutils literal"><span class="pre">DESC</span></tt> (descending) keyword
to the name of the column in the <tt class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></tt> clause that you are sorting by.
The default is ascending order; this can be specified explicitly using the
<tt class="docutils literal"><span class="pre">ASC</span></tt> keyword.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Email e&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;e.address DESC, u.id ASC&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id122"><span class="problematic" id="id123">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">email</span> <span class="n">e</span>
    <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">e</span><span class="p">.</span><span class="n">address</span> <span class="k">DESC</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">ASC</span>
</pre></div>
</div>
</div>
<div class="section" id="sorting-by-an-aggregate-value">
<h3>Sorting by an aggregate value<a class="headerlink" href="#sorting-by-an-aggregate-value" title="Permalink to this headline">¶</a></h3>
<p>In the following example we fetch all users and sort those users by the
number of phonenumbers they have.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username, COUNT(p.id) count&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">orderby</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id124"><span class="problematic" id="id125">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">p__0</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">p__0</span>
</pre></div>
</div>
</div>
<div class="section" id="using-random-order">
<h3>Using random order<a class="headerlink" href="#using-random-order" title="Permalink to this headline">¶</a></h3>
<p>In the following example we use random in the <tt class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></tt> clause in
order to fetch random post.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;t.id, RANDOM() AS rand&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Forum_Thread t&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">orderby</span><span class="p">(</span><span class="s1">&#39;rand&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id126"><span class="problematic" id="id127">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">f</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">f__id</span><span class="p">,</span> <span class="n">RAND</span><span class="p">()</span> <span class="k">AS</span> <span class="n">f__0</span> <span class="k">FROM</span> <span class="n">forum__thread</span> <span class="n">f</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">f__0</span> <span class="k">LIMIT</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="limit-and-offset-clauses">
<h2>LIMIT and OFFSET clauses<a class="headerlink" href="#limit-and-offset-clauses" title="Permalink to this headline">¶</a></h2>
<p>Propably the most complex feature DQL parser has to offer is its
<tt class="docutils literal"><span class="pre">LIMIT</span></tt> clause parser. Not only does the DQL <tt class="docutils literal"><span class="pre">LIMIT</span></tt> clause parser
take care of <tt class="docutils literal"><span class="pre">LIMIT</span></tt> database portability it is capable of limiting
the number of records instead of rows by using complex query analysis
and subqueries.</p>
<p>Retrieve the first 20 users and all their associated phonenumbers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username, p.phonenumber&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can also use the <a href="#id128"><span class="problematic" id="id129">:php:meth:`offset`</span></a> method of the
<a href="#id130"><span class="problematic" id="id131">:php:class:`Doctrine_Query`</span></a> object in combination with the <a href="#id132"><span class="problematic" id="id133">:php:meth:`limit`</span></a>
method to produce your desired <tt class="docutils literal"><span class="pre">LIMIT</span></tt> and <tt class="docutils literal"><span class="pre">OFFSET</span></tt> in the
executed SQL query.</p>
</div>
<p>The above call to <a href="#id134"><span class="problematic" id="id135">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span> <span class="k">AS</span> <span class="n">p__phonenumber</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">LIMIT</span> <span class="mi">20</span>
</pre></div>
</div>
<div class="section" id="driver-portability">
<h3>Driver Portability<a class="headerlink" href="#driver-portability" title="Permalink to this headline">¶</a></h3>
<p>DQL <tt class="docutils literal"><span class="pre">LIMIT</span></tt> clause is portable on all supported databases. Special
attention have been paid to following facts:</p>
<ul class="simple">
<li>Only MySQL, PgSQL and Sqlite implement LIMIT / OFFSET clauses
natively</li>
<li>In Oracle / MSSQL / Firebird LIMIT / OFFSET clauses need to be
emulated in driver specific way</li>
<li>The limit-subquery-algorithm needs to execute to subquery separately
in MySQL, since MySQL doesn&#8217;t yet support LIMIT clause in subqueries</li>
<li>PgSQL needs the order by fields to be preserved in SELECT clause,
hence limit-subquery-algorithm needs to take this into consideration
when pgSQL driver is used</li>
<li>Oracle only allows &lt; 30 object identifiers (= table/column
names/aliases), hence the limit subquery must use as short aliases as
possible and it must avoid alias collisions with the main query.</li>
</ul>
</div>
<div class="section" id="the-limit-subquery-algorithm">
<h3>The limit-subquery-algorithm<a class="headerlink" href="#the-limit-subquery-algorithm" title="Permalink to this headline">¶</a></h3>
<p>The limit-subquery-algorithm is an algorithm that DQL parser uses
internally when one-to-many / many-to-many relational data is being
fetched simultaneously. This kind of special algorithm is needed for the
LIMIT clause to limit the number of records instead of SQL result set
rows.</p>
<p>This behavior can be overwritten using the configuration system (at
global, connection or table level) using:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_QUERY_LIMIT</span><span class="p">,</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">LIMIT_ROWS</span><span class="p">);</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_QUERY_LIMIT</span><span class="p">,</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">LIMIT_RECORDS</span><span class="p">);</span> <span class="c1">// revert</span>
</pre></div>
</div>
<p>In the following example we have users and phonenumbers with their
relation being one-to-many. Now lets say we want fetch the first 20
users and all their related phonenumbers.</p>
<p>Now one might consider that adding a simple driver specific LIMIT 20 at
the end of query would return the correct results. Thats wrong, since we
you might get anything between 1-20 users as the first user might have
20 phonenumbers and then record set would consist of 20 rows.</p>
<p>DQL overcomes this problem with subqueries and with complex but
efficient subquery analysis. In the next example we are going to fetch
first 20 users and all their phonenumbers with single efficient query.
Notice how the DQL parser is smart enough to use column aggregation
inheritance even in the subquery and how it&#8217;s smart enough to use
different aliases for the tables in the subquery to avoid alias
collisions.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, u.username, p.*&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id136"><span class="problematic" id="id137">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span> <span class="k">AS</span> <span class="n">p__phonenumber</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">user_id</span> <span class="k">AS</span> <span class="n">p__user_id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">IN</span> <span class="p">(</span>
        <span class="k">SELECT</span>
            <span class="k">DISTINCT</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span>
        <span class="k">FROM</span> <span class="k">user</span> <span class="n">u2</span>
        <span class="k">LIMIT</span> <span class="mi">20</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how the IN clause with the subquery was added. This
is so that the users are limited to 20 and the users phonenumbers
are not limited.</p>
</div>
<p>In the next example we are going to fetch first 20 users and all their
phonenumbers and only those users that actually have phonenumbers with
single efficient query, hence we use an <tt class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></tt>. Notice how the
DQL parser is smart enough to use the <tt class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></tt> in the subquery:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, u.username, p.*&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id138"><span class="problematic" id="id139">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">p__id</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span> <span class="k">AS</span> <span class="n">p__phonenumber</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">user_id</span> <span class="k">AS</span> <span class="n">p__user_id</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p</span>
        <span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">IN</span> <span class="p">(</span>
        <span class="k">SELECT</span>
        <span class="k">DISTINCT</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span>
        <span class="k">FROM</span> <span class="k">user</span> <span class="n">u2</span>
            <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">phonenumber</span> <span class="n">p2</span>
                <span class="k">ON</span> <span class="n">u2</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p2</span><span class="p">.</span><span class="n">user_id</span>
        <span class="k">LIMIT</span> <span class="mi">20</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="named-queries">
<h2>Named Queries<a class="headerlink" href="#named-queries" title="Permalink to this headline">¶</a></h2>
<p>When you are dealing with a model that may change, but you need to keep
your queries easily updated, you need to find an easy way to define
queries. Imagine for example that you change one field and you need to
follow all queries in your application to make sure it&#8217;ll not break
anything.</p>
<p>Named Queries is a nice and effective way to solve this situation,
allowing you to create <tt class="docutils literal"><span class="pre">Doctrine_Queries</span></tt> and reuse them without the
need to keep rewritting them.</p>
<p>The Named Query support is built at the top of
<tt class="docutils literal"><span class="pre">Doctrine_Query_Registry</span></tt> support. <tt class="docutils literal"><span class="pre">Doctrine_Query_Registry</span></tt> is
a class for registering and naming queries. It helps with the
organization of your applications queries and along with that it offers
some very nice convenience stuff.</p>
<p>The queries are added using the <a href="#id140"><span class="problematic" id="id141">:php:meth:`add`</span></a> method of the registry object.
It takes two parameters, the query name and the actual DQL query.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$r</span> <span class="o">=</span> <span class="nx">Doctrine_Manager</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getQueryRegistry</span><span class="p">();</span>
<span class="nv">$r</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;User/all&#39;</span><span class="p">,</span> <span class="s1">&#39;FROM User u&#39;</span><span class="p">);</span>

<span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
<span class="c1">// find all users $users = $userTable-&gt;find(&#39;all&#39;);</span>
</pre></div>
</div>
<p>To simplify this support, <a href="#id142"><span class="problematic" id="id143">:php:class:`Doctrine_Table`</span></a> support some accessors to
<tt class="docutils literal"><span class="pre">Doctrine_Query_Registry</span></tt>.</p>
<div class="section" id="creating-a-named-query">
<h3>Creating a Named Query<a class="headerlink" href="#creating-a-named-query" title="Permalink to this headline">¶</a></h3>
<p>When you build your models with option <tt class="docutils literal"><span class="pre">generateTableClasses</span></tt> defined as
true, each record class will also generate a <tt class="docutils literal"><span class="pre">*Table</span></tt> class, extending from
<a href="#id144"><span class="problematic" id="id145">:php:class:`Doctrine_Table`</span></a>.</p>
<p>Then, you can implement the method <a href="#id146"><span class="problematic" id="id147">:php:meth:`construct`</span></a> to include your Named
Queries:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserTable</span> <span class="k">extends</span> <span class="nx">Doctrine_Table</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Named Query defined using DQL string</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addNamedQuery</span><span class="p">(</span><span class="s1">&#39;get.by.id&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT u.username FROM User u WHERE u.id = ?&#39;</span><span class="p">);</span>

        <span class="c1">// Named Query defined using Doctrine_Query object</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addNamedQuery</span><span class="p">(</span>
            <span class="s1">&#39;get.by.similar.usernames&#39;</span><span class="p">,</span>
            <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, u.username&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;LOWER(u.username) LIKE LOWER(?)&#39;</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-named-query">
<h3>Accessing Named Query<a class="headerlink" href="#accessing-named-query" title="Permalink to this headline">¶</a></h3>
<p>To reach the <tt class="docutils literal"><span class="pre">MyFooTable</span></tt> class, which is a subclass of
<a href="#id148"><span class="problematic" id="id149">:php:class:`Doctrine_Table`</span></a>, you can do the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>To access the Named Query (will return you a <a href="#id150"><span class="problematic" id="id151">:php:class:`Doctrine_Query`</span></a>
instance, always):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s1">&#39;get.by.id&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id152"><span class="problematic" id="id153">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span>
    <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">username</span> <span class="k">AS</span> <span class="n">u__username</span>
<span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span>
<span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
</div>
<div class="section" id="executing-a-named-query">
<h3>Executing a Named Query<a class="headerlink" href="#executing-a-named-query" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to execute a Named Query. The first one is by
retrieving the <a href="#id154"><span class="problematic" id="id155">:php:class:`Doctrine_Query`</span></a> and then executing it normally, as a
normal instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s1">&#39;get.by.similar.usernames&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;%jon%wage%&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>You can also simplify the execution, by doing:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;get.by.similar.usernames&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;%jon%wage%&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>The method <a href="#id156"><span class="problematic" id="id157">:php:meth:`find`</span></a> also accepts a third parameter, which is the
hydration mode.</p>
</div>
<div class="section" id="cross-accessing-named-query">
<h3>Cross-Accessing Named Query<a class="headerlink" href="#cross-accessing-named-query" title="Permalink to this headline">¶</a></h3>
<p>If that&#8217;s not enough, Doctrine take advantage the
<tt class="docutils literal"><span class="pre">Doctrine_Query_Registry</span></tt> and uses namespace queries to enable
cross-access of Named Queries between objects. Suppose you have the
<tt class="docutils literal"><span class="pre">*Table</span></tt> class instance of record <tt class="docutils literal"><span class="pre">Article</span></tt>. You want to call the
&#8220;get.by.id&#8221; Named Query of record <tt class="docutils literal"><span class="pre">User</span></tt>. To access the Named Query,
you have to do:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$articleTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;Article&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$articleTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;User/get.by.id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bnf">
<h2>BNF<a class="headerlink" href="#bnf" title="Permalink to this headline">¶</a></h2>
<pre>
<strong id="grammar-token-QL_statement">QL_statement                                  </strong> ::=  <a class="reference internal" href="#grammar-token-select_statement"><tt class="xref docutils literal"><span class="pre">select_statement</span></tt></a> | <a class="reference internal" href="#grammar-token-update_statement"><tt class="xref docutils literal"><span class="pre">update_statement</span></tt></a> | <a class="reference internal" href="#grammar-token-delete_statement"><tt class="xref docutils literal"><span class="pre">delete_statement</span></tt></a>
<strong id="grammar-token-select_statement">select_statement                              </strong> ::=  <a class="reference internal" href="#grammar-token-select_clause"><tt class="xref docutils literal"><span class="pre">select_clause</span></tt></a> <a class="reference internal" href="#grammar-token-from_clause"><tt class="xref docutils literal"><span class="pre">from_clause</span></tt></a>
                                                    [<a class="reference internal" href="#grammar-token-where_clause"><tt class="xref docutils literal"><span class="pre">where_clause</span></tt></a>]
                                                    [<a class="reference internal" href="#grammar-token-groupby_clause"><tt class="xref docutils literal"><span class="pre">groupby_clause</span></tt></a>]
                                                    [<a class="reference internal" href="#grammar-token-having_clause"><tt class="xref docutils literal"><span class="pre">having_clause</span></tt></a>]
                                                    [<a class="reference internal" href="#grammar-token-orderby_clause"><tt class="xref docutils literal"><span class="pre">orderby_clause</span></tt></a>]
<strong id="grammar-token-update_statement">update_statement                              </strong> ::=  <a class="reference internal" href="#grammar-token-update_clause"><tt class="xref docutils literal"><span class="pre">update_clause</span></tt></a> [<a class="reference internal" href="#grammar-token-where_clause"><tt class="xref docutils literal"><span class="pre">where_clause</span></tt></a>]
<strong id="grammar-token-delete_statement">delete_statement                              </strong> ::=  <a class="reference internal" href="#grammar-token-delete_clause"><tt class="xref docutils literal"><span class="pre">delete_clause</span></tt></a> [<a class="reference internal" href="#grammar-token-where_clause"><tt class="xref docutils literal"><span class="pre">where_clause</span></tt></a>]
<strong id="grammar-token-from_clause">from_clause                                   </strong> ::=  &quot;FROM&quot; <a class="reference internal" href="#grammar-token-identification_variable_declaration"><tt class="xref docutils literal"><span class="pre">identification_variable_declaration</span></tt></a>
                                                        {
                                                            &quot;,&quot;
                                                            {<a class="reference internal" href="#grammar-token-identification_variable_declaration"><tt class="xref docutils literal"><span class="pre">identification_variable_declaration</span></tt></a> | <a class="reference internal" href="#grammar-token-collection_member_declaration"><tt class="xref docutils literal"><span class="pre">collection_member_declaration</span></tt></a>}
                                                        }*
<strong id="grammar-token-identification_variable_declaration">identification_variable_declaration           </strong> ::=  <a class="reference internal" href="#grammar-token-range_variable_declaration"><tt class="xref docutils literal"><span class="pre">range_variable_declaration</span></tt></a>
                                                    {<a class="reference internal" href="#grammar-token-join"><tt class="xref docutils literal"><span class="pre">join</span></tt></a> | <a class="reference internal" href="#grammar-token-fetch_join"><tt class="xref docutils literal"><span class="pre">fetch_join</span></tt></a>}*
<strong id="grammar-token-range_variable_declaration">range_variable_declaration                    </strong> ::=  <tt class="xref docutils literal"><span class="pre">abstract_schema_name</span></tt>
                                                    [&quot;AS&quot;]
                                                    <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
<strong id="grammar-token-join">join                                          </strong> ::=  <a class="reference internal" href="#grammar-token-join_spec"><tt class="xref docutils literal"><span class="pre">join_spec</span></tt></a>
                                                    <a class="reference internal" href="#grammar-token-join_association_path_expression"><tt class="xref docutils literal"><span class="pre">join_association_path_expression</span></tt></a>
                                                    [&quot;AS&quot;] <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
<strong id="grammar-token-fetch_join">fetch_join                                    </strong> ::=  <a class="reference internal" href="#grammar-token-join_spec"><tt class="xref docutils literal"><span class="pre">join_spec</span></tt></a> &quot;FETCH&quot; <a class="reference internal" href="#grammar-token-join_association_path_expression"><tt class="xref docutils literal"><span class="pre">join_association_path_expression</span></tt></a>
<strong id="grammar-token-association_path_expression">association_path_expression                   </strong> ::=  <a class="reference internal" href="#grammar-token-collection_valued_path_expression"><tt class="xref docutils literal"><span class="pre">collection_valued_path_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-single_valued_association_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_association_path_expression</span></tt></a>
<strong id="grammar-token-join_spec">join_spec                                     </strong> ::=  [&quot;LEFT&quot;]
                                                    [&quot;OUTER&quot; | &quot;INNER&quot;]
                                                    &quot;JOIN&quot;
<strong id="grammar-token-join_association_path_expression">join_association_path_expression              </strong> ::=  <a class="reference internal" href="#grammar-token-join_collection_valued_path_expression"><tt class="xref docutils literal"><span class="pre">join_collection_valued_path_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-join_single_valued_association_path_expression"><tt class="xref docutils literal"><span class="pre">join_single_valued_association_path_expression</span></tt></a>
<strong id="grammar-token-join_collection_valued_path_expression">join_collection_valued_path_expression        </strong> ::=  <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>.<tt class="xref docutils literal"><span class="pre">collection_valued_association_field</span></tt>
<strong id="grammar-token-join_single_valued_association_path_expression">join_single_valued_association_path_expression</strong> ::=  <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>.<tt class="xref docutils literal"><span class="pre">single_valued_association_field</span></tt>
<strong id="grammar-token-collection_member_declaration">collection_member_declaration                 </strong> ::=  &quot;IN&quot;
                                                    &quot;(&quot; <a class="reference internal" href="#grammar-token-collection_valued_path_expression"><tt class="xref docutils literal"><span class="pre">collection_valued_path_expression</span></tt></a> &quot;)&quot;
                                                    [&quot;AS&quot;]
                                                    <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
<strong id="grammar-token-single_valued_path_expression">single_valued_path_expression                 </strong> ::=  <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-single_valued_association_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_association_path_expression</span></tt></a>
<strong id="grammar-token-state_field_path_expression">state_field_path_expression                   </strong> ::=  {
                                                        <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
                                                            | <a class="reference internal" href="#grammar-token-single_valued_association_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_association_path_expression</span></tt></a>
                                                    }.<a class="reference internal" href="#grammar-token-state_field"><tt class="xref docutils literal"><span class="pre">state_field</span></tt></a>
<strong id="grammar-token-single_valued_association_path_expression">single_valued_association_path_expression     </strong> ::=  <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>.{<tt class="xref docutils literal"><span class="pre">single_valued_association_field</span></tt>.}*
                                                    <tt class="xref docutils literal"><span class="pre">single_valued_association_field</span></tt>
<strong id="grammar-token-collection_valued_path_expression">collection_valued_path_expression             </strong> ::=  <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>.{<tt class="xref docutils literal"><span class="pre">single_valued_association_field</span></tt>.}*
                                                    <tt class="xref docutils literal"><span class="pre">collection_valued_association_field</span></tt>
<strong id="grammar-token-state_field">state_field                                   </strong> ::=  {<tt class="xref docutils literal"><span class="pre">embedded_class_state_field</span></tt>.}*
                                                    <tt class="xref docutils literal"><span class="pre">simple_state_field</span></tt>
<strong id="grammar-token-update_clause">update_clause                                 </strong> ::=  &quot;UPDATE&quot;
                                                    <tt class="xref docutils literal"><span class="pre">abstract_schema_name</span></tt>
                                                    [[&quot;AS&quot;] <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>]
                                                    &quot;SET&quot;
                                                    <a class="reference internal" href="#grammar-token-update_item"><tt class="xref docutils literal"><span class="pre">update_item</span></tt></a> {&quot;,&quot; <a class="reference internal" href="#grammar-token-update_item"><tt class="xref docutils literal"><span class="pre">update_item</span></tt></a>}*
<strong id="grammar-token-update_item">update_item                                   </strong> ::=  [<tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>.]{<a class="reference internal" href="#grammar-token-state_field"><tt class="xref docutils literal"><span class="pre">state_field</span></tt></a> | <tt class="xref docutils literal"><span class="pre">single_valued_association_field</span></tt>}
                                                    &quot;=&quot;
                                                    <a class="reference internal" href="#grammar-token-new_value"><tt class="xref docutils literal"><span class="pre">new_value</span></tt></a>
<strong id="grammar-token-new_value">new_value                                     </strong> ::=  <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-datetime_primary"><tt class="xref docutils literal"><span class="pre">datetime_primary</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-boolean_primary"><tt class="xref docutils literal"><span class="pre">boolean_primary</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-enum_primary"><tt class="xref docutils literal"><span class="pre">enum_primary</span></tt></a> <a class="reference internal" href="#grammar-token-simple_entity_expression"><tt class="xref docutils literal"><span class="pre">simple_entity_expression</span></tt></a>
                                                        | &quot;NULL&quot;
<strong id="grammar-token-delete_clause">delete_clause                                 </strong> ::=  &quot;DELETE&quot; &quot;FROM&quot; <tt class="xref docutils literal"><span class="pre">abstract_schema_name</span></tt> [[&quot;AS&quot;] <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>]
<strong id="grammar-token-select_clause">select_clause                                 </strong> ::=  &quot;SELECT&quot; [&quot;DISTINCT&quot;] <a class="reference internal" href="#grammar-token-select_expression"><tt class="xref docutils literal"><span class="pre">select_expression</span></tt></a> {&quot;,&quot; <a class="reference internal" href="#grammar-token-select_expression"><tt class="xref docutils literal"><span class="pre">select_expression</span></tt></a>}*
<strong id="grammar-token-select_expression">select_expression                             </strong> ::=  <a class="reference internal" href="#grammar-token-single_valued_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_path_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-aggregate_expression"><tt class="xref docutils literal"><span class="pre">aggregate_expression</span></tt></a>
                                                        | <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
                                                        | &quot;OBJECT&quot; &quot;(&quot; <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt> &quot;)&quot;
                                                        | <a class="reference internal" href="#grammar-token-constructor_expression"><tt class="xref docutils literal"><span class="pre">constructor_expression</span></tt></a>
<strong id="grammar-token-constructor_expression">constructor_expression                        </strong> ::=  &quot;NEW&quot; <tt class="xref docutils literal"><span class="pre">constructor_name</span></tt> &quot;(&quot;
                                                        <a class="reference internal" href="#grammar-token-constructor_item"><tt class="xref docutils literal"><span class="pre">constructor_item</span></tt></a> {&quot;,&quot; <a class="reference internal" href="#grammar-token-constructor_item"><tt class="xref docutils literal"><span class="pre">constructor_item</span></tt></a>}*
                                                    &quot;)&quot;
<strong id="grammar-token-constructor_item">constructor_item                              </strong> ::=  <a class="reference internal" href="#grammar-token-single_valued_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_path_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-aggregate_expression"><tt class="xref docutils literal"><span class="pre">aggregate_expression</span></tt></a>
<strong id="grammar-token-aggregate_expression">aggregate_expression                          </strong> ::=      { &quot;AVG&quot; | &quot;MAX&quot; | &quot;MIN&quot; | &quot;SUM&quot;} &quot;(&quot;
                                                            [&quot;DISTINCT&quot;]
                                                            <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a>
                                                        &quot;)&quot;
                                                    |
                                                        &quot;COUNT&quot; &quot;(&quot;
                                                            [&quot;DISTINCT&quot;]
                                                            <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
                                                                | <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a>
                                                                | <a class="reference internal" href="#grammar-token-single_valued_association_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_association_path_expression</span></tt></a>
                                                        &quot;)&quot;
<strong id="grammar-token-where_clause">where_clause                                  </strong> ::=  &quot;WHERE&quot; <a class="reference internal" href="#grammar-token-conditional_expression"><tt class="xref docutils literal"><span class="pre">conditional_expression</span></tt></a>
<strong id="grammar-token-groupby_clause">groupby_clause                                </strong> ::=  &quot;GROUP&quot; &quot;BY&quot; <a class="reference internal" href="#grammar-token-groupby_item"><tt class="xref docutils literal"><span class="pre">groupby_item</span></tt></a> {&quot;,&quot; <a class="reference internal" href="#grammar-token-groupby_item"><tt class="xref docutils literal"><span class="pre">groupby_item</span></tt></a>}*
<strong id="grammar-token-groupby_item">groupby_item                                  </strong> ::=  single_valued_path_expression` | <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
<strong id="grammar-token-having_clause">having_clause                                 </strong> ::=  &quot;HAVING&quot; <a class="reference internal" href="#grammar-token-conditional_expression"><tt class="xref docutils literal"><span class="pre">conditional_expression</span></tt></a>
<strong id="grammar-token-orderby_clause">orderby_clause                                </strong> ::=  &quot;ORDER&quot; &quot;BY&quot; <a class="reference internal" href="#grammar-token-orderby_item"><tt class="xref docutils literal"><span class="pre">orderby_item</span></tt></a> {&quot;,&quot; <a class="reference internal" href="#grammar-token-orderby_item"><tt class="xref docutils literal"><span class="pre">orderby_item</span></tt></a>}*
<strong id="grammar-token-orderby_item">orderby_item                                  </strong> ::=  state_field_path_expression` [&quot;ASC&quot; | &quot;DESC&quot;]
<strong id="grammar-token-subquery">subquery                                      </strong> ::=  simple_select_clause` <a class="reference internal" href="#grammar-token-subquery_from_clause"><tt class="xref docutils literal"><span class="pre">subquery_from_clause</span></tt></a> [<a class="reference internal" href="#grammar-token-where_clause"><tt class="xref docutils literal"><span class="pre">where_clause</span></tt></a>] [<a class="reference internal" href="#grammar-token-groupby_clause"><tt class="xref docutils literal"><span class="pre">groupby_clause</span></tt></a>] [<a class="reference internal" href="#grammar-token-having_clause"><tt class="xref docutils literal"><span class="pre">having_clause</span></tt></a>]
<strong id="grammar-token-subquery_from_clause">subquery_from_clause                          </strong> ::=  FROM&quot; <a class="reference internal" href="#grammar-token-subselect_identification_variable_declaration"><tt class="xref docutils literal"><span class="pre">subselect_identification_variable_declaration</span></tt></a>{&quot;,&quot; <a class="reference internal" href="#grammar-token-subselect_identification_variable_declaration"><tt class="xref docutils literal"><span class="pre">subselect_identification_variable_declaration</span></tt></a>}*
<strong id="grammar-token-subselect_identification_variable_declaration">subselect_identification_variable_declaration </strong> ::=  <a class="reference internal" href="#grammar-token-identification_variable_declaration"><tt class="xref docutils literal"><span class="pre">identification_variable_declaration</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-association_path_expression"><tt class="xref docutils literal"><span class="pre">association_path_expression</span></tt></a> [&quot;AS&quot;] <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
                                                        | <a class="reference internal" href="#grammar-token-collection_member_declaration"><tt class="xref docutils literal"><span class="pre">collection_member_declaration</span></tt></a>
<strong id="grammar-token-simple_select_clause">simple_select_clause                          </strong> ::=  &quot;SELECT&quot; [&quot;DISTINCT&quot;] <a class="reference internal" href="#grammar-token-simple_select_expression"><tt class="xref docutils literal"><span class="pre">simple_select_expression</span></tt></a>
<strong id="grammar-token-simple_select_expression">simple_select_expression                      </strong> ::=  <a class="reference internal" href="#grammar-token-single_valued_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_path_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-aggregate_expression"><tt class="xref docutils literal"><span class="pre">aggregate_expression</span></tt></a>
                                                        | <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt>
<strong id="grammar-token-conditional_expression">conditional_expression                        </strong> ::=  <a class="reference internal" href="#grammar-token-conditional_term"><tt class="xref docutils literal"><span class="pre">conditional_term</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-conditional_expression"><tt class="xref docutils literal"><span class="pre">conditional_expression</span></tt></a> &quot;OR&quot; <a class="reference internal" href="#grammar-token-conditional_term"><tt class="xref docutils literal"><span class="pre">conditional_term</span></tt></a>
<strong id="grammar-token-conditional_term">conditional_term                              </strong> ::=  <a class="reference internal" href="#grammar-token-conditional_factor"><tt class="xref docutils literal"><span class="pre">conditional_factor</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-conditional_term"><tt class="xref docutils literal"><span class="pre">conditional_term</span></tt></a> &quot;AND&quot; <a class="reference internal" href="#grammar-token-conditional_factor"><tt class="xref docutils literal"><span class="pre">conditional_factor</span></tt></a>
<strong id="grammar-token-conditional_factor">conditional_factor                            </strong> ::=  [&quot;NOT&quot;]
                                                    <a class="reference internal" href="#grammar-token-conditional_primary"><tt class="xref docutils literal"><span class="pre">conditional_primary</span></tt></a>
<strong id="grammar-token-conditional_primary">conditional_primary                           </strong> ::=  <a class="reference internal" href="#grammar-token-simple_cond_expression"><tt class="xref docutils literal"><span class="pre">simple_cond_expression</span></tt></a>
                                                        | &quot;(&quot; <a class="reference internal" href="#grammar-token-conditional_expression"><tt class="xref docutils literal"><span class="pre">conditional_expression</span></tt></a> &quot;)&quot;
<strong id="grammar-token-simple_cond_expression">simple_cond_expression                        </strong> ::=  comparison_expression`
                                                        | <a class="reference internal" href="#grammar-token-between_expression"><tt class="xref docutils literal"><span class="pre">between_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-like_expression"><tt class="xref docutils literal"><span class="pre">like_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-in_expression"><tt class="xref docutils literal"><span class="pre">in_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-null_comparison_expression"><tt class="xref docutils literal"><span class="pre">null_comparison_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-empty_collection_comparison_expression"><tt class="xref docutils literal"><span class="pre">empty_collection_comparison_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-collection_member_expression"><tt class="xref docutils literal"><span class="pre">collection_member_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-exists_expression"><tt class="xref docutils literal"><span class="pre">exists_expression</span></tt></a>
<strong id="grammar-token-between_expression">between_expression                            </strong> ::=  <a class="reference internal" href="#grammar-token-arithmetic_expression"><tt class="xref docutils literal"><span class="pre">arithmetic_expression</span></tt></a> [&quot;NOT&quot;] &quot;BETWEEN&quot; <a class="reference internal" href="#grammar-token-arithmetic_expression"><tt class="xref docutils literal"><span class="pre">arithmetic_expression</span></tt></a> &quot;AND&quot; <a class="reference internal" href="#grammar-token-arithmetic_expression"><tt class="xref docutils literal"><span class="pre">arithmetic_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-string_expression"><tt class="xref docutils literal"><span class="pre">string_expression</span></tt></a> [&quot;NOT&quot;] &quot;BETWEEN&quot; <a class="reference internal" href="#grammar-token-string_expression"><tt class="xref docutils literal"><span class="pre">string_expression</span></tt></a> &quot;AND&quot; <a class="reference internal" href="#grammar-token-string_expression"><tt class="xref docutils literal"><span class="pre">string_expression</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-datetime_expression"><tt class="xref docutils literal"><span class="pre">datetime_expression</span></tt></a> [&quot;NOT&quot;] &quot;BETWEEN&quot; <a class="reference internal" href="#grammar-token-datetime_expression"><tt class="xref docutils literal"><span class="pre">datetime_expression</span></tt></a> &quot;AND&quot; <a class="reference internal" href="#grammar-token-datetime_expression"><tt class="xref docutils literal"><span class="pre">datetime_expression</span></tt></a>
<strong id="grammar-token-in_expression">in_expression                                 </strong> ::=  <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a>
                                                    [&quot;NOT&quot;] &quot;IN&quot;
                                                    &quot;(&quot;
                                                        <a class="reference internal" href="#grammar-token-in_item"><tt class="xref docutils literal"><span class="pre">in_item</span></tt></a> {&quot;,&quot; <a class="reference internal" href="#grammar-token-in_item"><tt class="xref docutils literal"><span class="pre">in_item</span></tt></a>}* | <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a>
                                                    &quot;)&quot;
<strong id="grammar-token-in_item">in_item                                       </strong> ::=  literal` | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>
<strong id="grammar-token-like_expression">like_expression                               </strong> ::=  <a class="reference internal" href="#grammar-token-string_expression"><tt class="xref docutils literal"><span class="pre">string_expression</span></tt></a>
                                                    [&quot;NOT&quot;] &quot;LIKE&quot;
                                                    <tt class="xref docutils literal"><span class="pre">pattern_value</span></tt>
                                                    [&quot;ESCAPE&quot; <tt class="xref docutils literal"><span class="pre">escape_character</span></tt>]
<strong id="grammar-token-null_comparison_expression">null_comparison_expression                    </strong> ::=  {<a class="reference internal" href="#grammar-token-single_valued_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_path_expression</span></tt></a> | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>}
                                                    &quot;IS&quot; [&quot;NOT&quot;] &quot;NULL&quot;
<strong id="grammar-token-empty_collection_comparison_expression">empty_collection_comparison_expression        </strong> ::=  <a class="reference internal" href="#grammar-token-collection_valued_path_expression"><tt class="xref docutils literal"><span class="pre">collection_valued_path_expression</span></tt></a>
                                                    &quot;IS&quot; [&quot;NOT&quot;] &quot;EMPTY&quot;
<strong id="grammar-token-collection_member_expression">collection_member_expression                  </strong> ::=  <a class="reference internal" href="#grammar-token-entity_expression"><tt class="xref docutils literal"><span class="pre">entity_expression</span></tt></a>
                                                    [&quot;NOT&quot;] &quot;MEMBER&quot; [&quot;OF&quot;]
                                                    <a class="reference internal" href="#grammar-token-collection_valued_path_expression"><tt class="xref docutils literal"><span class="pre">collection_valued_path_expression</span></tt></a>
<strong id="grammar-token-exists_expression">exists_expression                             </strong> ::=  [&quot;NOT&quot;] &quot;EXISTS&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a> &quot;)&quot;
<strong id="grammar-token-all_or_any_expression">all_or_any_expression                         </strong> ::=   &quot;ALL&quot; | &quot;ANY&quot; | &quot;SOME&quot; } &quot;(&quot; <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a> &quot;)&quot;
<strong id="grammar-token-comparison_expression">comparison_expression                         </strong> ::=  string_expression` <a class="reference internal" href="#grammar-token-comparison_operator"><tt class="xref docutils literal"><span class="pre">comparison_operator</span></tt></a> {<a class="reference internal" href="#grammar-token-string_expression"><tt class="xref docutils literal"><span class="pre">string_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-all_or_any_expression"><tt class="xref docutils literal"><span class="pre">all_or_any_expression</span></tt></a>}
                                                        | <a class="reference internal" href="#grammar-token-boolean_expression"><tt class="xref docutils literal"><span class="pre">boolean_expression</span></tt></a> {&quot;=&quot; | &quot;&lt;&gt;&quot;} {<a class="reference internal" href="#grammar-token-boolean_expression"><tt class="xref docutils literal"><span class="pre">boolean_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-all_or_any_expression"><tt class="xref docutils literal"><span class="pre">all_or_any_expression</span></tt></a>}
                                                        | <a class="reference internal" href="#grammar-token-enum_expression"><tt class="xref docutils literal"><span class="pre">enum_expression</span></tt></a> {&quot;=&quot; | &quot;&lt;&gt;&quot;} {<a class="reference internal" href="#grammar-token-enum_expression"><tt class="xref docutils literal"><span class="pre">enum_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-all_or_any_expression"><tt class="xref docutils literal"><span class="pre">all_or_any_expression</span></tt></a>}
                                                        | <a class="reference internal" href="#grammar-token-datetime_expression"><tt class="xref docutils literal"><span class="pre">datetime_expression</span></tt></a> <a class="reference internal" href="#grammar-token-comparison_operator"><tt class="xref docutils literal"><span class="pre">comparison_operator</span></tt></a> {<a class="reference internal" href="#grammar-token-datetime_expression"><tt class="xref docutils literal"><span class="pre">datetime_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-all_or_any_expression"><tt class="xref docutils literal"><span class="pre">all_or_any_expression</span></tt></a>}
                                                        | <a class="reference internal" href="#grammar-token-entity_expression"><tt class="xref docutils literal"><span class="pre">entity_expression</span></tt></a> {&quot;=&quot; | &quot;&lt;&gt;&quot;} {<a class="reference internal" href="#grammar-token-entity_expression"><tt class="xref docutils literal"><span class="pre">entity_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-all_or_any_expression"><tt class="xref docutils literal"><span class="pre">all_or_any_expression</span></tt></a>}
                                                        | <a class="reference internal" href="#grammar-token-arithmetic_expression"><tt class="xref docutils literal"><span class="pre">arithmetic_expression</span></tt></a> <a class="reference internal" href="#grammar-token-comparison_operator"><tt class="xref docutils literal"><span class="pre">comparison_operator</span></tt></a> {<a class="reference internal" href="#grammar-token-arithmetic_expression"><tt class="xref docutils literal"><span class="pre">arithmetic_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-all_or_any_expression"><tt class="xref docutils literal"><span class="pre">all_or_any_expression</span></tt></a>}
<strong id="grammar-token-comparison_operator">comparison_operator                           </strong> ::=  &quot;=&quot; | &quot;&gt;&quot; | &quot;&gt;=&quot; | &quot;&lt;&quot; | &quot;&lt;=&quot; | &quot;&lt;&gt;&quot;
<strong id="grammar-token-arithmetic_expression">arithmetic_expression                         </strong> ::=  <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> | &quot;(&quot; <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a> &quot;)&quot;
<strong id="grammar-token-simple_arithmetic_expression">simple_arithmetic_expression                  </strong> ::=  <a class="reference internal" href="#grammar-token-arithmetic_term"><tt class="xref docutils literal"><span class="pre">arithmetic_term</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> {&quot;+&quot; | &quot;-&quot;} <a class="reference internal" href="#grammar-token-arithmetic_term"><tt class="xref docutils literal"><span class="pre">arithmetic_term</span></tt></a>
<strong id="grammar-token-arithmetic_term">arithmetic_term                               </strong> ::=  <a class="reference internal" href="#grammar-token-arithmetic_factor"><tt class="xref docutils literal"><span class="pre">arithmetic_factor</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-arithmetic_term"><tt class="xref docutils literal"><span class="pre">arithmetic_term</span></tt></a> { &quot;*&quot; | &quot;/&quot; } <a class="reference internal" href="#grammar-token-arithmetic_factor"><tt class="xref docutils literal"><span class="pre">arithmetic_factor</span></tt></a>
<strong id="grammar-token-arithmetic_factor">arithmetic_factor                             </strong> ::=  [{&quot;+&quot; | &quot;-&quot;}] <a class="reference internal" href="#grammar-token-arithmetic_primary"><tt class="xref docutils literal"><span class="pre">arithmetic_primary</span></tt></a>
<strong id="grammar-token-arithmetic_primary">arithmetic_primary                            </strong> ::=  <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a>
                                                        | <tt class="xref docutils literal"><span class="pre">numeric_literal</span></tt>
                                                        | &quot;(&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> &quot;)&quot;
                                                        | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>
                                                        | <a class="reference internal" href="#grammar-token-functions_returning_numerics"><tt class="xref docutils literal"><span class="pre">functions_returning_numerics</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-aggregate_expression"><tt class="xref docutils literal"><span class="pre">aggregate_expression</span></tt></a>
<strong id="grammar-token-string_expression">string_expression                             </strong> ::=  string_primary` | &quot;(&quot; <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a> &quot;)&quot;
<strong id="grammar-token-string_primary">string_primary                                </strong> ::=  <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a>
                                                        | <tt class="xref docutils literal"><span class="pre">string_literal</span></tt>
                                                        | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>
                                                        | <a class="reference internal" href="#grammar-token-functions_returning_strings"><tt class="xref docutils literal"><span class="pre">functions_returning_strings</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-aggregate_expression"><tt class="xref docutils literal"><span class="pre">aggregate_expression</span></tt></a>
<strong id="grammar-token-datetime_expression">datetime_expression                           </strong> ::=  datetime_primary` | &quot;(&quot; <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a> &quot;)&quot;
<strong id="grammar-token-datetime_primary">datetime_primary                              </strong> ::=  <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a>
                                                        | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>
                                                        | <a class="reference internal" href="#grammar-token-functions_returning_datetime"><tt class="xref docutils literal"><span class="pre">functions_returning_datetime</span></tt></a>
                                                        | <a class="reference internal" href="#grammar-token-aggregate_expression"><tt class="xref docutils literal"><span class="pre">aggregate_expression</span></tt></a>
<strong id="grammar-token-boolean_expression">boolean_expression                            </strong> ::=  boolean_primary` | &quot;(&quot; <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a> &quot;)&quot;
<strong id="grammar-token-boolean_primary">boolean_primary                               </strong> ::=  <a class="reference internal" href="#grammar-token-state_field_path_expression"><tt class="xref docutils literal"><span class="pre">state_field_path_expression</span></tt></a> | <tt class="xref docutils literal"><span class="pre">boolean_literal</span></tt> | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>
<strong id="grammar-token-enum_expression">enum_expression                               </strong> ::=  enum_primary` | &quot;(&quot; <a class="reference internal" href="#grammar-token-subquery"><tt class="xref docutils literal"><span class="pre">subquery</span></tt></a> &quot;)&quot;
<strong id="grammar-token-enum_primary">enum_primary                                  </strong> ::=  state_field_path_expression` | <tt class="xref docutils literal"><span class="pre">enum_literal</span></tt> | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>
<strong id="grammar-token-entity_expression">entity_expression                             </strong> ::=  <a class="reference internal" href="#grammar-token-single_valued_association_path_expression"><tt class="xref docutils literal"><span class="pre">single_valued_association_path_expression</span></tt></a> | <a class="reference internal" href="#grammar-token-simple_entity_expression"><tt class="xref docutils literal"><span class="pre">simple_entity_expression</span></tt></a>
<strong id="grammar-token-simple_entity_expression">simple_entity_expression                      </strong> ::=  <tt class="xref docutils literal"><span class="pre">identification_variable</span></tt> | <tt class="xref docutils literal"><span class="pre">input_parameter</span></tt>
<strong id="grammar-token-functions_returning_numerics">functions_returning_numerics                  </strong> ::=  &quot;LENGTH&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> &quot;)&quot;
                                                        | &quot;LOCATE&quot; &quot;(&quot; `string_primary &quot;,&quot; <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> [&quot;,&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a>] &quot;)&quot;
                                                        | &quot;ABS&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> &quot;)&quot;
                                                        | &quot;SQRT&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> &quot;)&quot;
                                                        | &quot;MOD&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> &quot;,&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> &quot;)&quot;
                                                        | &quot;SIZE&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-collection_valued_path_expression"><tt class="xref docutils literal"><span class="pre">collection_valued_path_expression</span></tt></a> &quot;)&quot;
<strong id="grammar-token-functions_returning_datetime">functions_returning_datetime                  </strong> ::=  &quot;CURRENT_DATE&quot; | &quot;CURRENT_TIME&quot; | &quot;CURRENT_TIMESTAMP&quot;
<strong id="grammar-token-functions_returning_strings">functions_returning_strings                   </strong> ::=  CONCAT&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> &quot;,&quot; <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> &quot;)&quot;
                                                        | &quot;SUBSTRING&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> &quot;,&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> &quot;,&quot; <a class="reference internal" href="#grammar-token-simple_arithmetic_expression"><tt class="xref docutils literal"><span class="pre">simple_arithmetic_expression</span></tt></a> &quot;)&quot;
                                                        | &quot;TRIM&quot; &quot;(&quot; [[<a class="reference internal" href="#grammar-token-trim_specification"><tt class="xref docutils literal"><span class="pre">trim_specification</span></tt></a>] [<tt class="xref docutils literal"><span class="pre">trim_character</span></tt>] &quot;FROM&quot;] <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> &quot;)&quot;
                                                        | &quot;LOWER&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> &quot;)&quot;
                                                        | &quot;UPPER&quot; &quot;(&quot; <a class="reference internal" href="#grammar-token-string_primary"><tt class="xref docutils literal"><span class="pre">string_primary</span></tt></a> &quot;)&quot;
<strong id="grammar-token-trim_specification">trim_specification                            </strong> ::=  &quot;LEADING&quot; | &quot;TRAILING&quot; | &quot;BOTH&quot;
</pre>
</div>
<div class="section" id="magic-finders">
<h2>Magic Finders<a class="headerlink" href="#magic-finders" title="Permalink to this headline">¶</a></h2>
<p>Doctrine offers some magic finders for your Doctrine models that allow
you to find a record by any column that is present in the model. This is
helpful for simply finding a user by their username, or finding a group
by the name of it. Normally this would require writing a
<a href="#id158"><span class="problematic" id="id159">:php:class:`Doctrine_Query`</span></a> instance and storing this somewhere so it can be
reused. That is no longer needed for simple situations like that.</p>
<p>The basic pattern for the finder methods are as follows:
<tt class="docutils literal"><span class="pre">findBy%s($value)</span></tt> or <tt class="docutils literal"><span class="pre">findOneBy%s($value)</span></tt>. The <tt class="docutils literal"><span class="pre">%s</span></tt> can
be a column name or a relation alias. If you give a column name you must
give the value you are looking for. If you specify a relationship alias,
you can either pass an instance of the relation class to find, or give
the actual primary key value.</p>
<p>First lets retrieve the <tt class="docutils literal"><span class="pre">UserTable</span></tt> instance to work with:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now we can easily find a <tt class="docutils literal"><span class="pre">User</span></tt> record by its primary key by using the
<a href="#id160"><span class="problematic" id="id161">:php:meth:`find`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Now if you want to find a single user by their username you can use the
following magic finder:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findOneByUsername</span><span class="p">(</span><span class="s1">&#39;jonwage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can also easily find records by using the relationships between
records. Because <tt class="docutils literal"><span class="pre">User</span></tt> has many <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> we can find those
<tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> by passing the <a href="#id162"><span class="problematic" id="id163">:php:meth:`findBy**`</span></a> method a <tt class="docutils literal"><span class="pre">User</span></tt>
instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$phonenumberTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;Phonenumber&#39;</span><span class="p">);</span>
<span class="nv">$phonenumbers</span> <span class="o">=</span> <span class="nv">$phonenumberTable</span><span class="o">-&gt;</span><span class="na">findByUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</pre></div>
</div>
<p>The magic finders will even allow a little more complex finds. You can
use the <tt class="docutils literal"><span class="pre">And</span></tt> and <tt class="docutils literal"><span class="pre">Or</span></tt> keywords in the method name to retrieve
record by multiple properties.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findOneByUsernameAndPassword</span><span class="p">(</span><span class="s1">&#39;jonwage&#39;</span><span class="p">,</span> <span class="nb">md5</span><span class="p">(</span><span class="s1">&#39;changeme&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>You can even mix the conditions.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findByIsAdminAndIsModeratorOrIsSuperAdmin</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">These are very limited magic finders and it is always
recommended to expand your queries to be manually written DQL
queries. These methods are meant for only quickly accessing single
records, no relationships, and are good for prototyping code
quickly.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The documented magic finders above are made possibly by
using PHP&#8217;s <a class="reference external" href="http://us3.php.net/__call">__call()</a> overloading
functionality. The undefined functions are forwarded to
<a href="#id164"><span class="problematic" id="id165">:php:meth:`Doctrine_Table::{*}call`</span></a> where the <a href="#id166"><span class="problematic" id="id167">:php:class:`Doctrine_Query`</span></a> objects
are built, executed and returned to the user.</p>
</div>
</div>
<div class="section" id="debugging-queries">
<h2>Debugging Queries<a class="headerlink" href="#debugging-queries" title="Permalink to this headline">¶</a></h2>
<p>The <a href="#id168"><span class="problematic" id="id169">:php:class:`Doctrine_Query`</span></a> object has a few functions that can be used to
help debug problems with the query:</p>
<p>Sometimes you may want to see the complete SQL string of your
<a href="#id170"><span class="problematic" id="id171">:php:class:`Doctrine_Query`</span></a> object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getSqlQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>The above call to <a href="#id172"><span class="problematic" id="id173">:php:meth:`getSqlQuery()`</span></a> would output the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">u__id</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">u</span><span class="p">.</span><span class="n">username</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The SQL returned above by the <a href="#id174"><span class="problematic" id="id175">:php:meth:`Doctrine_Query::getSql`</span></a>
function does not replace the tokens with the parameters. This is
the job of PDO and when we execute the query we pass the parameters
to PDO where the replacement is executed. You can retrieve the array
of parameters with the <a href="#id176"><span class="problematic" id="id177">:php:meth:`Doctrine_Query::getParams`</span></a> method.</p>
</div>
<p>Get the array of parameters for the <a href="#id178"><span class="problematic" id="id179">:php:class:`Doctrine_Query`</span></a> instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nb">print_r</span><span class="p">(</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>The Doctrine Query Language is by far one of the most advanced and
helpful feature of Doctrine. It allows you to easily select very complex
data from RDBMS relationships efficiently!</p>
<p>Now that we have gone over most of the major components of Doctrine and
how to use them we are going to take a step back in the next chapter and
look at everything from a birds eye view in the <a class="reference internal" href="component-overview.html"><em>Component Overview</em></a> chapter.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">DQL: Doctrine Query Language</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#select-queries">SELECT queries</a><ul>
<li><a class="reference internal" href="#aggregate-values">Aggregate values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-queries">UPDATE queries</a></li>
<li><a class="reference internal" href="#delete-queries">DELETE Queries</a></li>
<li><a class="reference internal" href="#from-clause">FROM clause</a></li>
<li><a class="reference internal" href="#join-syntax">JOIN syntax</a><ul>
<li><a class="reference internal" href="#on-keyword">ON keyword</a></li>
<li><a class="reference internal" href="#with-keyword">WITH keyword</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indexby-keyword">INDEXBY keyword</a></li>
<li><a class="reference internal" href="#where-clause">WHERE clause</a></li>
<li><a class="reference internal" href="#conditional-expressions">Conditional expressions</a><ul>
<li><a class="reference internal" href="#literals">Literals</a><ul>
<li><a class="reference internal" href="#strings">Strings</a></li>
<li><a class="reference internal" href="#integers">Integers</a></li>
<li><a class="reference internal" href="#floats">Floats</a></li>
<li><a class="reference internal" href="#booleans">Booleans</a></li>
<li><a class="reference internal" href="#enums">Enums</a></li>
</ul>
</li>
<li><a class="reference internal" href="#input-parameters">Input parameters</a></li>
<li><a class="reference internal" href="#operators-and-operator-precedence">Operators and operator precedence</a></li>
<li><a class="reference internal" href="#in-expressions">In expressions</a></li>
<li><a class="reference internal" href="#like-expressions">Like Expressions</a></li>
<li><a class="reference internal" href="#exists-expressions">Exists Expressions</a></li>
<li><a class="reference internal" href="#all-and-any-expressions">All and Any Expressions</a></li>
<li><a class="reference internal" href="#subqueries">Subqueries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-expressions">Functional Expressions</a><ul>
<li><a class="reference internal" href="#string-functions">String functions</a></li>
<li><a class="reference internal" href="#arithmetic-functions">Arithmetic functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id105">Subqueries</a><ul>
<li><a class="reference internal" href="#id106">Introduction</a></li>
<li><a class="reference internal" href="#comparisons-using-subqueries">Comparisons using subqueries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#group-by-having-clauses">GROUP BY, HAVING clauses</a></li>
<li><a class="reference internal" href="#order-by-clause">ORDER BY clause</a><ul>
<li><a class="reference internal" href="#id119">Introduction</a></li>
<li><a class="reference internal" href="#sorting-by-an-aggregate-value">Sorting by an aggregate value</a></li>
<li><a class="reference internal" href="#using-random-order">Using random order</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limit-and-offset-clauses">LIMIT and OFFSET clauses</a><ul>
<li><a class="reference internal" href="#driver-portability">Driver Portability</a></li>
<li><a class="reference internal" href="#the-limit-subquery-algorithm">The limit-subquery-algorithm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#named-queries">Named Queries</a><ul>
<li><a class="reference internal" href="#creating-a-named-query">Creating a Named Query</a></li>
<li><a class="reference internal" href="#accessing-named-query">Accessing Named Query</a></li>
<li><a class="reference internal" href="#executing-a-named-query">Executing a Named Query</a></li>
<li><a class="reference internal" href="#cross-accessing-named-query">Cross-Accessing Named Query</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bnf">BNF</a></li>
<li><a class="reference internal" href="#magic-finders">Magic Finders</a></li>
<li><a class="reference internal" href="#debugging-queries">Debugging Queries</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="working-with-models.html"
                        title="previous chapter">Working with Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="component-overview.html"
                        title="next chapter">Component Overview</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/en/manual/dql-doctrine-query-language.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="component-overview.html" title="Component Overview"
             >next</a> |</li>
        <li class="right" >
          <a href="working-with-models.html" title="Working with Models"
             >previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" >Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jonathan Wage and Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>