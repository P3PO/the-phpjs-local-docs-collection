

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Working with Models &mdash; Doctrine 1.2.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Doctrine 1.2.4 documentation" href="../../index.html" />
    <link rel="up" title="Doctrine 1.2 ORM Manual" href="index.html" />
    <link rel="next" title="DQL: Doctrine Query Language" href="dql-doctrine-query-language.html" />
    <link rel="prev" title="Defining Models" href="defining-models.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="dql-doctrine-query-language.html" title="DQL: Doctrine Query Language"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="defining-models.html" title="Defining Models"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="working-with-models">
<h1>Working with Models<a class="headerlink" href="#working-with-models" title="Permalink to this headline">¶</a></h1>
<div class="section" id="define-test-schema">
<h2>Define Test Schema<a class="headerlink" href="#define-test-schema" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Remember to delete any existing schema information and
models from previous chapters.</p>
<div class="last highlight-sh"><div class="highlight"><pre>rm schema.yml
touch schema.yml
rm -rf models/*
</pre></div>
</div>
</div>
<p>For the next several examples we will use the following schema:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;255&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;255&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Group as Groups&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;refClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;UserGroup&#39;</span><span class="p">,</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;group_id&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;Phonenumber as Phonenumbers&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Email.php</span>
<span class="k">class</span> <span class="nc">Email</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;255&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Phonenumber.php</span>
<span class="k">class</span> <span class="nc">Phonenumber</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;255&#39;</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;primary_num&#39;</span><span class="p">,</span> <span class="s1">&#39;boolean&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Group.php</span>
<span class="k">class</span> <span class="nc">Group</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setTableName</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;255&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;User as Users&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;refClass&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;UserGroup&#39;</span><span class="p">,</span>
            <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;group_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foreign&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/UserGroup.php</span>
<span class="k">class</span> <span class="nc">UserGroup</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;group_id&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
    <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Groups</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Group</span>
      <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_id</span>
      <span class="l-Scalar-Plain">foreign</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">group_id</span>
      <span class="l-Scalar-Plain">refClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UserGroup</span>
      <span class="l-Scalar-Plain">foreignAlias</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Users</span>

<span class="l-Scalar-Plain">Email</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">address</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">foreignType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">one</span>

<span class="l-Scalar-Plain">Phonenumber</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
    <span class="l-Scalar-Plain">phonenumber</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>
    <span class="l-Scalar-Plain">primary_num</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">boolean</span>
  <span class="l-Scalar-Plain">relations</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">foreignAlias</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Phonenumbers</span>

<span class="l-Scalar-Plain">Group</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">tableName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">groups</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(255)</span>

<span class="l-Scalar-Plain">UserGroup</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">group_id</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
      <span class="l-Scalar-Plain">primary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>Now that you have your schema defined you can instantiate the database
by simply running the <tt class="file docutils literal"><span class="pre">generate.php</span></tt> script we so conveniently created
in the previous chapter.</p>
<div class="highlight-sh"><div class="highlight"><pre>php generate.php
</pre></div>
</div>
</div>
<div class="section" id="dealing-with-relations">
<h2>Dealing with Relations<a class="headerlink" href="#dealing-with-relations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-related-records">
<h3>Creating Related Records<a class="headerlink" href="#creating-related-records" title="Permalink to this headline">¶</a></h3>
<p>Accessing related records in Doctrine is easy: you can use exactly the
same getters and setters as for the record properties.</p>
<p>You can use any of the three ways above, however the last one is the
recommended one for array portability purposes.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;changeme&#39;</span><span class="p">;</span>

<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="p">;</span>

<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">);</span>

<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;Email&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>When accessing a one-to-one related record that doesn&#8217;t exist, Doctrine
automatically creates the object. That is why the above code is
possible.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="o">-&gt;</span><span class="na">address</span> <span class="o">=</span> <span class="s1">&#39;jonwage@gmail.com&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>When accessing one-to-many related records, Doctrine creates a
<a href="#id1"><span class="problematic" id="id2">:php:class:`Doctrine_Collection`</span></a> for the related component. Lets say we have
<tt class="docutils literal"><span class="pre">users</span></tt> and <tt class="docutils literal"><span class="pre">phonenumbers</span></tt> and their relation is one-to-many. You
can add <tt class="docutils literal"><span class="pre">phonenumbers</span></tt> easily as shown above:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[]</span><span class="o">-&gt;</span><span class="na">phonenumber</span> <span class="o">=</span> <span class="s1">&#39;123 123&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[]</span><span class="o">-&gt;</span><span class="na">phonenumber</span> <span class="o">=</span> <span class="s1">&#39;456 123&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[]</span><span class="o">-&gt;</span><span class="na">phonenumber</span> <span class="o">=</span> <span class="s1">&#39;123 777&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Now we can easily save the user and the associated phonenumbers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Another way to easily create a link between two related components is by
using <a href="#id3"><span class="problematic" id="id4">:php:meth:`Doctrine_Record::link`</span></a>. It often happens that you have two
existing records that you would like to relate (or link) to one another.
In this case, if there is a relation defined between the involved record
classes, you only need the identifiers of the related record(s):</p>
<p>Lets create a few new <tt class="docutils literal"><span class="pre">Phonenumber</span></tt> objects and keep track of the new
phone number identifiers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$phoneIds</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="nv">$phone1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phonenumber</span><span class="p">();</span> <span class="nv">$phone1</span><span class="p">[</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;555 202 7890&#39;</span><span class="p">;</span>
<span class="nv">$phone1</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="nv">$phoneIds</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$phone1</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>

<span class="nv">$phone2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phonenumber</span><span class="p">();</span> <span class="nv">$phone2</span><span class="p">[</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;555 100 7890&#39;</span><span class="p">;</span>
<span class="nv">$phone2</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="nv">$phoneIds</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$phone2</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>Let&#8217;s link the phone numbers to the user, since the relation to
<tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> exists for the <tt class="docutils literal"><span class="pre">User</span></tt> record:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;changeme&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span><span class="s1">&#39;Phonenumbers&#39;</span><span class="p">,</span> <span class="nv">$phoneIds</span><span class="p">);</span>
</pre></div>
</div>
<p>If a relation to the <tt class="docutils literal"><span class="pre">User</span></tt> record class is defined for the
<tt class="docutils literal"><span class="pre">Phonenumber</span></tt> record class, you may even do this:</p>
<p>First create a user to work with:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;changeme&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Now create a new <tt class="docutils literal"><span class="pre">Phonenumber</span></tt> instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$phone1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phonenumber</span><span class="p">();</span>
<span class="nv">$phone1</span><span class="p">[</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;555 202 7890&#39;</span><span class="p">;</span>
<span class="nv">$phone1</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Now we can link the <tt class="docutils literal"><span class="pre">User</span></tt> to our <tt class="docutils literal"><span class="pre">Phonenumber</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$phone1</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]));</span>
</pre></div>
</div>
<p>We can create another phone number:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$phone2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phonenumber</span><span class="p">();</span>
<span class="nv">$phone2</span><span class="p">[</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;555 100 7890&#39;</span><span class="p">;</span>
<span class="nv">$phone2</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Let&#8217;s link this <tt class="docutils literal"><span class="pre">Phonenumber</span></tt> to our <tt class="docutils literal"><span class="pre">User</span></tt> too:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$phone2</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]));</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-related-records">
<h3>Retrieving Related Records<a class="headerlink" href="#retrieving-related-records" title="Permalink to this headline">¶</a></h3>
<p>You can retrieve related records by the very same <a href="#id5"><span class="problematic" id="id6">:php:class:`Doctrine_Record`</span></a>
methods as in the previous subchapter. Please note that whenever you
access a related component that isn&#8217;t already loaded Doctrine uses one
<tt class="docutils literal"><span class="pre">SQL</span> <span class="pre">SELECT</span></tt> statement for the fetching, hence the following example
executes three <tt class="docutils literal"><span class="pre">SQL</span> <span class="pre">SELECTs</span></tt>.</p>
<p>dakmdaklsd alksdlkamsd kldlksmdklm</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">];</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">phonenumber</span><span class="p">;</span>
</pre></div>
</div>
<p>Much more efficient way of doing this is using DQL. The following
example uses only one SQL query for the retrieval of related components.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Email e&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">];</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-related-records">
<h3>Updating Related Records<a class="headerlink" href="#updating-related-records" title="Permalink to this headline">¶</a></h3>
<p>You can update the related records by calling save for each related
object / collection individually or by calling save on the object that
owns the other objects. You can also call
<tt class="docutils literal"><span class="pre">Doctrine_Connection::flush</span></tt> which saves all pending objects.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;koskenkorva@drinkmore.info&#39;</span><span class="p">;</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;phonenumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;123123&#39;</span><span class="p">;</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the above example calling <a href="#id7"><span class="problematic" id="id8">:php:meth:`$user-&gt;save`</span></a> saves the
<tt class="docutils literal"><span class="pre">email</span></tt> and <tt class="docutils literal"><span class="pre">phonenumber</span></tt>.</p>
</div>
</div>
<div class="section" id="clearing-related-records">
<h3>Clearing Related Records<a class="headerlink" href="#clearing-related-records" title="Permalink to this headline">¶</a></h3>
<p>You can clear a related records references from an object. This does not
change the fact that these objects are related and won&#8217;t change it in
the database if you save. It just simply clears the reference in PHP of
one object to another.</p>
<p>You can clear all references by doing the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">clearRelated</span><span class="p">();</span>
</pre></div>
</div>
<p>Or you can clear a specific relationship:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">clearRelated</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>This is useful if you were to do something like the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// User has e-mail</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// User does not have a e-mail</span>
<span class="p">}</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">clearRelated</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Because Doctrine will automatically create a new <tt class="docutils literal"><span class="pre">Email</span></tt> object if the
user does not have one, we need to clear that reference so that if we
were to call <a href="#id9"><span class="problematic" id="id10">:php:meth:`$user-&gt;save`</span></a> it wouldn&#8217;t save a blank <tt class="docutils literal"><span class="pre">Email</span></tt> record
for the <tt class="docutils literal"><span class="pre">User</span></tt>.</p>
<p>We can simplify the above scenario even further by using the
<a href="#id11"><span class="problematic" id="id12">:php:meth:`relatedExists`</span></a> method. This is so that you can do the above check
with less code and not have to worry about clearing the unnecessary
reference afterwards.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">relatedExists</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// User has e-mail</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//  User does not have a e-mail</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-related-records">
<h3>Deleting Related Records<a class="headerlink" href="#deleting-related-records" title="Permalink to this headline">¶</a></h3>
<p>You can delete related records individually be calling <a href="#id13"><span class="problematic" id="id14">:php:meth:`delete`</span></a> on a
record or on a collection.</p>
<p>Here you can delete an individual related record:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
<p>You can delete an individual record from within a collection of records:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
<p>You could delete the entire collection if you wanted:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
<p>Or can just delete the entire user and all related objects:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
<p>Usually in a typical web application the primary keys of the related
objects that are to be deleted come from a form. In this case the most
efficient way of deleting the related records is using DQL DELETE
statement. Lets say we have once again <tt class="docutils literal"><span class="pre">Users</span></tt> and <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt>
with their relation being one-to-many. Deleting the given
<tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> for given user id can be achieved as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;Phonenumber&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">addWhere</span><span class="p">(</span><span class="s1">&#39;user_id = ?&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">whereIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>

<span class="nv">$numDeleted</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Sometimes you may not want to delete the <tt class="docutils literal"><span class="pre">Phonenumber</span></tt> records but to
simply unlink the relations by setting the foreign key fields to null.
This can of course be achieved with DQL but perhaps to most elegant way
of doing this is by using <a href="#id15"><span class="problematic" id="id16">:php:meth:`Doctrine_Record::unlink`</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please note that the <a href="#id17"><span class="problematic" id="id18">:php:meth:`unlink`</span></a> method is very smart. It
not only sets the foreign fields for related <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> to
null but it also removes all given <tt class="docutils literal"><span class="pre">Phonenumber</span></tt> references from
the <tt class="docutils literal"><span class="pre">User</span></tt> object.</p>
</div>
<p>Lets say we have a <tt class="docutils literal"><span class="pre">User</span></tt> who has three <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> (with
identifiers 1, 2 and 3). Now unlinking the <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> 1 and 3 can
be achieved as easily as:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">unlink</span><span class="p">(</span><span class="s1">&#39;Phonenumbers&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span> <span class="c1">// 1</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-related-records">
<h3>Working with Related Records<a class="headerlink" href="#working-with-related-records" title="Permalink to this headline">¶</a></h3>
<div class="section" id="testing-the-existence-of-a-relation">
<h4>Testing the Existence of a Relation<a class="headerlink" href="#testing-the-existence-of-a-relation" title="Permalink to this headline">¶</a></h4>
<p>The below example would return false because the relationship has not
been instantiated yet:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now the next example will return true because we instantiated the
<tt class="docutils literal"><span class="pre">Email</span></tt> relationship:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">Email</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">Email</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="many-to-many-relations">
<h2>Many-to-Many Relations<a class="headerlink" href="#many-to-many-relations" title="Permalink to this headline">¶</a></h2>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Doctrine requires that Many-to-Many relationships be
bi-directional. For example: both <tt class="docutils literal"><span class="pre">User</span></tt> must have many <tt class="docutils literal"><span class="pre">Groups</span></tt>
and <tt class="docutils literal"><span class="pre">Group</span></tt> must have many <tt class="docutils literal"><span class="pre">User</span></tt>.</p>
</div>
<div class="section" id="creating-a-new-link">
<h3>Creating a New Link<a class="headerlink" href="#creating-a-new-link" title="Permalink to this headline">¶</a></h3>
<p>Lets say we have two classes <tt class="docutils literal"><span class="pre">User</span></tt> and <tt class="docutils literal"><span class="pre">Group</span></tt> which are linked
through a <tt class="docutils literal"><span class="pre">GroupUser</span></tt> association class. When working with transient
(new) records the fastest way for adding a <tt class="docutils literal"><span class="pre">User</span></tt> and couple of
<tt class="docutils literal"><span class="pre">Group</span></tt> objects for it is:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Some User&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Some Group&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Some Other Group&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>However in real world scenarios you often already have existing groups,
where you want to add a given user. The most efficient way of doing this
is:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$groupUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GroupUser</span><span class="p">();</span>
<span class="nv">$groupUser</span><span class="o">-&gt;</span><span class="na">user_id</span> <span class="o">=</span> <span class="nv">$userId</span><span class="p">;</span>
<span class="nv">$groupUser</span><span class="o">-&gt;</span><span class="na">group_id</span> <span class="o">=</span> <span class="nv">$groupId</span><span class="p">;</span>
<span class="nv">$groupUser</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-link">
<h3>Deleting a Link<a class="headerlink" href="#deleting-a-link" title="Permalink to this headline">¶</a></h3>
<p>The right way to delete links between many-to-many associated records is
by using the DQL DELETE statement. Convenient and recommended way of
using DQL DELETE is through the Query API.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;UserGroup&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">addWhere</span><span class="p">(</span><span class="s1">&#39;user_id = ?&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">whereIn</span><span class="p">(</span><span class="s1">&#39;group_id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

<span class="nv">$deleted</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Another way to <tt class="docutils literal"><span class="pre">unlink</span></tt> the relationships between related objects is
through the <tt class="docutils literal"><span class="pre">Doctrine_Record::unlink</span></tt> method. However, you should
avoid using this method unless you already have the parent model, since
it involves querying the database first.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">unlink</span><span class="p">(</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>You can also unlink ALL relationships to <tt class="docutils literal"><span class="pre">Group</span></tt> by omitting the
second argument:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">unlink</span><span class="p">(</span><span class="s1">&#39;Group&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>While the obvious and convenient way of deleting a link between <tt class="docutils literal"><span class="pre">User</span></tt>
and <tt class="docutils literal"><span class="pre">Group</span></tt> would be the following, you still should NOT do this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">GroupUser</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>This is due to a fact that the call to <tt class="docutils literal"><span class="pre">$user-&gt;GroupUser</span></tt> loads all
<tt class="docutils literal"><span class="pre">Group</span></tt> links for given <tt class="docutils literal"><span class="pre">User</span></tt>. This can be time-consuming task if
the <tt class="docutils literal"><span class="pre">User</span></tt> belongs to many <tt class="docutils literal"><span class="pre">Groups</span></tt>. Even if the user belongs to few
<tt class="docutils literal"><span class="pre">groups</span></tt> this will still execute an unnecessary SELECT statement.</p>
</div>
</div>
<div class="section" id="fetching-objects">
<h2>Fetching Objects<a class="headerlink" href="#fetching-objects" title="Permalink to this headline">¶</a></h2>
<p>Normally when you fetch data from database the following phases are
executed:</p>
<ul class="simple">
<li>Sending the query to database</li>
<li>Retrieve the returned data from the database</li>
</ul>
<p>In terms of object fetching we call these two phases the &#8216;fetching&#8217;
phase. Doctrine also has another phase called hydration phase. The
hydration phase takes place whenever you are fetching structured arrays
/ objects. Unless explicitly specified everything in Doctrine gets
hydrated.</p>
<p>Lets consider we have <tt class="docutils literal"><span class="pre">Users</span></tt> and <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> with their relation
being one-to-many. Now consider the following plain sql query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s1">&#39;SELECT</span>
<span class="s1">            u.id, u.username, p.phonenumber</span>
<span class="s1">        FROM user u</span>
<span class="s1">           LEFT JOIN phonenumber p</span>
<span class="s1">               ON u.id = p.user_id&#39;</span><span class="p">;</span>

<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">getDbh</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</pre></div>
</div>
<p>If you are familiar with these kind of one-to-many joins it may be familiar to
you how the basic result set is constructed. Whenever the user has more than
one phonenumbers there will be duplicated data in the result set. The result
set might look something like:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="29%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><tt class="docutils literal"><span class="pre">index</span></tt></th>
<th class="head"><tt class="docutils literal"><span class="pre">u.id</span></tt></th>
<th class="head"><tt class="docutils literal"><span class="pre">u.username</span></tt></th>
<th class="head"><tt class="docutils literal"><span class="pre">p.phonenumber</span></tt></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>1</td>
<td>Jack Daniels</td>
<td>123 123</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>1</td>
<td>Jack Daniels</td>
<td>456 456</td>
</tr>
<tr class="row-even"><td>2</td>
<td>2</td>
<td>John Beer</td>
<td>111 111</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>3</td>
<td>John Smith</td>
<td>222 222</td>
</tr>
<tr class="row-even"><td>4</td>
<td>3</td>
<td>John Smith</td>
<td>333 333</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>3</td>
<td>John Smith</td>
<td>444 444</td>
</tr>
</tbody>
</table>
<p>Here Jack Daniels has two <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt>, John Beer has one whereas
John Smith has three. You may notice how clumsy this result set is. Its
hard to iterate over it as you would need some duplicate data checking
logic here and there.</p>
<p>Doctrine hydration removes all duplicated data. It also performs many
other things such as:</p>
<ul class="simple">
<li>Custom indexing of result set elements</li>
<li>Value casting and preparation</li>
<li>Value assignment listening</li>
<li>Makes multi-dimensional array out of the two-dimensional result set array, the number of dimensions is equal to the number of nested joins</li>
</ul>
<p>Now consider the DQL equivalent of the SQL query we used:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
      <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.id, u.username, p.phonenumber&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">);</span>

<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">HYDRATE_ARRAY</span><span class="p">);</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$results</span><span class="p">);</span>
</pre></div>
</div>
<p>The structure of this hydrated array would look like</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [0] =&gt; Array
        (
            [id] =&gt; 1
            [username] =&gt;
            [Phonenumbers] =&gt; Array
                (
                    [0] =&gt; Array
                        (
                            [id] =&gt; 1
                            [phonenumber] =&gt; 123 123
                        )
                    [1] =&gt; Array
                        (
                            [id] =&gt; 2
                            [phonenumber] =&gt; 456 123
                        )
                    [2] =&gt; Array
                        (
                            [id] =&gt; 3
                            [phonenumber] =&gt; 123 777
                        )
                )
        )
)
</pre></div>
</div>
<p>This structure also applies to the hydration of objects(records) which is the
default hydration mode of Doctrine. The only differences are that the
individual elements are represented as <a href="#id19"><span class="problematic" id="id20">:php:class:`Doctrine_Record`</span></a> objects and
the arrays converted into <a href="#id21"><span class="problematic" id="id22">:php:class:`Doctrine_Collection`</span></a> objects. Whether
dealing with arrays or objects you can:</p>
<ul class="simple">
<li>Iterate over the results using <tt class="docutils literal"><span class="pre">foreach</span></tt></li>
<li>Access individual elements using array access brackets</li>
<li>Get the number of elements using <tt class="docutils literal"><span class="pre">count()</span></tt> function</li>
<li>Check if given element exists using <tt class="docutils literal"><span class="pre">isset()</span></tt></li>
<li>Unset given element using <tt class="docutils literal"><span class="pre">unset()</span></tt></li>
</ul>
<p>You should always use array hydration when you only need to data for
access-only purposes, whereas you should use the record hydration when
you need to change the fetched data.</p>
<p>The constant O(n) performance of the hydration algorithm is ensured by a
smart identifier caching solution.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Doctrine uses an identity map internally to make sure that multiple objects
for one record in a database don&#8217;t ever exist. If you fetch an object and
modify some of its properties, then re-fetch that same object later, the
modified properties will be overwritten by default. You can change this
behavior by changing the <tt class="docutils literal"><span class="pre">ATTR_HYDRATE_OVERWRITE</span></tt> attribute to <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</div>
<div class="section" id="sample-queries">
<h3>Sample Queries<a class="headerlink" href="#sample-queries" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Count number of records for a relationship:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.*, COUNT(DISTINCT p.id) AS num_phonenumbers&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Phonenumbers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;num_phonenumbers&#39;</span><span class="p">];</span>
</pre></div>
</div>
</li>
<li><p class="first">Retrieve Users and the Groups they belong to:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Groups&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$group</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$group</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Simple WHERE with one parameter value:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = ?&#39;</span><span class="p">,</span> <span class="s1">&#39;jwage&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Multiple WHERE with multiple parameters values:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = ? AND p.id = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>You can also optionally use the <a href="#id23"><span class="problematic" id="id24">:php:meth:`andWhere`</span></a> method to add
to the existing where parts.</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">(</span><span class="s1">&#39;p.id = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</div>
<ul>
<li><p class="first">Using <a href="#id25"><span class="problematic" id="id26">:php:meth:`whereIn`</span></a> convenience method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">whereIn</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">The following is the same as above example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id IN (1, 2, 3)&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Using DBMS function in your WHERE:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userEncryptedKey</span> <span class="o">=</span> <span class="s1">&#39;a157a558ac00449c92294c7fab684ae0&#39;</span><span class="p">;</span>

<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;MD5(CONCAT(u.username, &#39;secret_key&#39;)) = ?&quot;</span><span class="p">,</span> <span class="nv">$userEncryptedKey</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>

<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;LOWER(u.username) = LOWER(?)&#39;</span><span class="p">,</span> <span class="s1">&#39;jwage&#39;</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Limiting result sets using aggregate functions. Limit to users with more than one phonenumber:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.*, COUNT(DISTINCT p.id) AS num_phonenumbers&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">having</span><span class="p">(</span><span class="s1">&#39;num_phonenumbers &gt; 1&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Join only primary phonenumbers using WITH:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p WITH p.primary_num = ?&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Selecting certain columns for optimization:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username, p.phone&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Using a wildcard to select all <tt class="docutils literal"><span class="pre">User</span></tt> columns but only one <tt class="docutils literal"><span class="pre">Phonenumber</span></tt> column:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.*, p.phonenumber&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Perform DQL delete with simple WHERE:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;Phonenumber&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">addWhere</span><span class="p">(</span><span class="s1">&#39;user_id = 5&#39;</span><span class="p">);</span>

<span class="nv">$deleted</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Perform simple DQL update for a column:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;u.is_active&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nv">$updated</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Perform DQL update with DBMS function. Make all usernames lowercase:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">,</span> <span class="s1">&#39;LOWER(u.username)&#39;</span><span class="p">);</span>

<span class="nv">$updated</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Using mysql LIKE to search for records:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username LIKE ?&#39;</span><span class="p">,</span> <span class="s1">&#39;%jwage%&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Use the INDEXBY keyword to hydrate the data where the key of record
entry is the name of the column you assign:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u INDEXBY u.username&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
<p>Now we can print the user with the username of jwage:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nb">print_r</span><span class="p">(</span><span class="nv">$users</span><span class="p">[</span><span class="s1">&#39;jwage&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</li>
<li><p class="first">Using positional parameters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Arnold&#39;</span><span class="p">));</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Using named parameters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = :username&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;:username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Arnold&#39;</span><span class="p">));</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Using subqueries in your WHERE. Find users not in group named Group
2:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id NOT IN (</span>
<span class="s1">                SELECT u.id FROM User u2 INNER JOIN u2.Groups g WHERE g.name = ?</span>
<span class="s1">            )&#39;</span><span class="p">,</span> <span class="s1">&#39;Group 2&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>You can accomplish this without using subqueries. The two
examples below would have the same result as the example above.</p>
<ul class="last">
<li><p class="first">Use INNER JOIN to retrieve users who have groups, excluding the group
named Group 2:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g WITH g.name != ?&#39;</span><span class="p">,</span> <span class="s1">&#39;Group 2&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">Use WHERE condition to retrieve users who have groups, excluding the
group named Group 2:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;g.name != ?&#39;</span><span class="p">,</span> <span class="s1">&#39;Group 2&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Doctrine has many different ways you can execute queries and retrieve
the data. Below are examples of all the different ways you can execute a
query:</p>
<ul>
<li><p class="first">First lets create a sample query to test with:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span> <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">You can use array hydration with the <a href="#id27"><span class="problematic" id="id28">:php:meth:`fetchArray`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p class="first">You can also use array hydration by specifying the hydration method to
the second argument of the <a href="#id29"><span class="problematic" id="id30">:php:meth:`execute`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">HYDRATE_ARRAY</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">You can also specify the hydration method by using the
<a href="#id31"><span class="problematic" id="id32">:php:meth:`setHydrationMethod`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">setHydrationMode</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">HYDRATE_ARRAY</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span> <span class="c1">// So is this</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Custom accessors and mutators will not work when hydrating
data as anything except records. When you hydrate as an array it is
only a static array of data and is not object oriented. If you need
to add custom values to your hydrated arrays you can use the some of
the events such as <tt class="docutils literal"><span class="pre">preHydrate</span></tt> and <tt class="docutils literal"><span class="pre">postHydrate</span></tt></p>
</div>
<ul>
<li><p class="first">Sometimes you may want to totally bypass hydration and return the raw
data that PDO returns:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">HYDRATE_NONE</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">More can be read about skipping hydration in the <a class="reference internal" href="improving-performance.html"><em>improving performance</em></a> chapter.</p>
</div>
<ul>
<li><p class="first">If you want to just fetch one record from the query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>

<span class="c1">// Fetch all and get the first from collection</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getFirst</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="field-lazy-loading">
<h3>Field Lazy Loading<a class="headerlink" href="#field-lazy-loading" title="Permalink to this headline">¶</a></h3>
<p>Whenever you fetch an object that has not all of its fields loaded from
database then the state of this object is called proxy. Proxy objects
can load the unloaded fields lazily.</p>
<p>In the following example we fetch all the Users with the <tt class="docutils literal"><span class="pre">username</span></tt>
field loaded directly. Then we lazy load the password field:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>
</pre></div>
</div>
<p>The following lazy-loads the <tt class="docutils literal"><span class="pre">password</span></tt> field and executes one
additional database query to retrieve the value:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">;</span>
</pre></div>
</div>
<p>Doctrine does the proxy evaluation based on loaded field count. It does not
evaluate which fields are loaded on field-by-field basis. The reason for this
is simple: performance. Field lazy-loading is very rarely needed in PHP world,
hence introducing some kind of variable to check which fields are loaded would
introduce unnecessary overhead to basic fetching.</p>
</div>
</div>
<div class="section" id="arrays-and-objects">
<h2>Arrays and Objects<a class="headerlink" href="#arrays-and-objects" title="Permalink to this headline">¶</a></h2>
<p><a href="#id33"><span class="problematic" id="id34">:php:class:`Doctrine_Record`</span></a> and <a href="#id35"><span class="problematic" id="id36">:php:class:`Doctrine_Collection`</span></a> provide methods to
facilitate working with arrays: <a href="#id37"><span class="problematic" id="id38">:php:meth:`toArray`</span></a>, <a href="#id39"><span class="problematic" id="id40">:php:meth:`fromArray`</span></a> and
<a href="#id41"><span class="problematic" id="id42">:php:meth:`synchronizeWithArray`</span></a>.</p>
<div class="section" id="to-array">
<h3>To Array<a class="headerlink" href="#to-array" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id43"><span class="problematic" id="id44">:php:meth:`toArray`</span></a> method returns an array representation of your records
or collections. It also accesses the relationships the objects may have.
If you need to print a record for debugging purposes you can get an
array representation of the object and print that.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nb">print_r</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
</pre></div>
</div>
<p>If you do not want to include the relationships in the array then you
need to pass the <tt class="docutils literal"><span class="pre">$deep</span></tt> argument with a value of <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nb">print_r</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">(</span><span class="k">false</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="from-array">
<h3>From Array<a class="headerlink" href="#from-array" title="Permalink to this headline">¶</a></h3>
<p>If you have an array of values you want to use to fill a record or even
a collection, the <a href="#id45"><span class="problematic" id="id46">:php:meth:`fromArray`</span></a> method simplifies this common task.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="s1">&#39;age&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;25&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Emails&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;address&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john@mail.com&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;address&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john@work.com&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">fromArray</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="synchronize-with-array">
<h3>Synchronize With Array<a class="headerlink" href="#synchronize-with-array" title="Permalink to this headline">¶</a></h3>
<p><a href="#id47"><span class="problematic" id="id48">:php:meth:`synchronizeWithArray`</span></a> allows you to... well, synchronize a record
with an array. So if have an array representation of your model and modify a
field, modify a relationship field or even delete or create a relationship,
this changes will be applied to the record.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.*, g.*&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>
</pre></div>
</div>
<p>Now convert it to an array and modify some of the properties:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$arrayUser</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="nv">$arrayUser</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;New name&#39;</span><span class="p">;</span>
<span class="nv">$arrayUser</span><span class="p">[</span><span class="s1">&#39;Group&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Renamed Group&#39;</span><span class="p">;</span>
<span class="nv">$arrayUser</span><span class="p">[</span><span class="s1">&#39;Group&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New Group&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now use the same query to retrieve the record and synchronize the record
with the <tt class="docutils literal"><span class="pre">$arrayUser</span></tt> variable:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u.*, g.*&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id = ?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">();</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">synchronizeWithArray</span><span class="p">(</span><span class="nv">$arrayUser</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="overriding-the-constructor">
<h2>Overriding the Constructor<a class="headerlink" href="#overriding-the-constructor" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you want to do some operations at the creation time of your objects.
Doctrine doesn&#8217;t allow you to override the
<a href="#id49"><span class="problematic" id="id50">:php:meth:`Doctrine_Record::__construct`</span></a> method but provides an alternative:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Doctrine_Record</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Test Name&#39;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The only drawback is that it doesn&#8217;t provide a way to pass parameters to
the constructor.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>By now we should know absolutely everything there is to know about
models. We know how to create them, load them and most importantly we
know how to use them and work with columns and relationships. Now we are
ready to move on to learn about how to use the <a class="reference internal" href="dql-doctrine-query-language.html"><em>DQL: Doctrine Query Language</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Working with Models</a><ul>
<li><a class="reference internal" href="#define-test-schema">Define Test Schema</a></li>
<li><a class="reference internal" href="#dealing-with-relations">Dealing with Relations</a><ul>
<li><a class="reference internal" href="#creating-related-records">Creating Related Records</a></li>
<li><a class="reference internal" href="#retrieving-related-records">Retrieving Related Records</a></li>
<li><a class="reference internal" href="#updating-related-records">Updating Related Records</a></li>
<li><a class="reference internal" href="#clearing-related-records">Clearing Related Records</a></li>
<li><a class="reference internal" href="#deleting-related-records">Deleting Related Records</a></li>
<li><a class="reference internal" href="#working-with-related-records">Working with Related Records</a><ul>
<li><a class="reference internal" href="#testing-the-existence-of-a-relation">Testing the Existence of a Relation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#many-to-many-relations">Many-to-Many Relations</a><ul>
<li><a class="reference internal" href="#creating-a-new-link">Creating a New Link</a></li>
<li><a class="reference internal" href="#deleting-a-link">Deleting a Link</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fetching-objects">Fetching Objects</a><ul>
<li><a class="reference internal" href="#sample-queries">Sample Queries</a></li>
<li><a class="reference internal" href="#field-lazy-loading">Field Lazy Loading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arrays-and-objects">Arrays and Objects</a><ul>
<li><a class="reference internal" href="#to-array">To Array</a></li>
<li><a class="reference internal" href="#from-array">From Array</a></li>
<li><a class="reference internal" href="#synchronize-with-array">Synchronize With Array</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overriding-the-constructor">Overriding the Constructor</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="defining-models.html"
                        title="previous chapter">Defining Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dql-doctrine-query-language.html"
                        title="next chapter">DQL: Doctrine Query Language</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/en/manual/working-with-models.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="dql-doctrine-query-language.html" title="DQL: Doctrine Query Language"
             >next</a> |</li>
        <li class="right" >
          <a href="defining-models.html" title="Defining Models"
             >previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" >Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jonathan Wage and Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>