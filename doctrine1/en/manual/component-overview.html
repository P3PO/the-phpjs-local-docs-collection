

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Component Overview &mdash; Doctrine 1.2.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Doctrine 1.2.4 documentation" href="../../index.html" />
    <link rel="up" title="Doctrine 1.2 ORM Manual" href="index.html" />
    <link rel="next" title="Native SQL" href="native-sql.html" />
    <link rel="prev" title="DQL: Doctrine Query Language" href="dql-doctrine-query-language.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="native-sql.html" title="Native SQL"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dql-doctrine-query-language.html" title="DQL: Doctrine Query Language"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="component-overview">
<h1>Component Overview<a class="headerlink" href="#component-overview" title="Permalink to this headline">¶</a></h1>
<p>This chapter is intended to give you a birds eye view of all the main
components that make up Doctrine and how they work together. We&#8217;ve
discussed most of the components in the previous chapters but after this
chapter you will have a better idea of all the components and what their
jobs are.</p>
<div class="section" id="manager">
<span id="component-overview-manager"></span><h2>Manager<a class="headerlink" href="#manager" title="Permalink to this headline">¶</a></h2>
<p>The <a href="#id1"><span class="problematic" id="id2">:php:class:`Doctrine_Manager`</span></a> class is a singleton and is the root of the
configuration hierarchy and is used as a facade for controlling several
aspects of Doctrine. You can retrieve the singleton instance with the
following code.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$manager</span> <span class="o">=</span> <span class="nx">Doctrine_Manager</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="retrieving-connections">
<h3>Retrieving Connections<a class="headerlink" href="#retrieving-connections" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$connections</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">getConnections</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nx">connections</span> <span class="k">as</span> <span class="nv">$connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a href="#id3"><span class="problematic" id="id4">:php:class:`Doctrine_Manager`</span></a> implements an iterator so you can simple loop
over the $manager variable to loop over the connections.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">foreach</span> <span class="p">(</span><span class="nv">$manager</span> <span class="k">as</span> <span class="nv">$connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="connection">
<span id="component-overview-connection"></span><h2>Connection<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h2>
<p><a href="#id5"><span class="problematic" id="id6">:php:class:`Doctrine_Connection`</span></a> is a wrapper for database connection. The
connection is typically an instance of PDO but because of how Doctrine
is designed, it is possible to design your own adapters that mimic the
functionality that PDO provides.</p>
<p>The <a href="#id7"><span class="problematic" id="id8">:php:class:`Doctrine_Connection`</span></a> class handles several things:</p>
<ul class="simple">
<li>Handles database portability things missing from PDO (eg. LIMIT /
OFFSET emulation)</li>
<li>Keeps track of <a href="#id9"><span class="problematic" id="id10">:php:class:`Doctrine_Table`</span></a> objects</li>
<li>Keeps track of records</li>
<li>Keeps track of records that need to be updated / inserted / deleted</li>
<li>Handles transactions and transaction nesting</li>
<li>Handles the actual querying of the database in the case of INSERT /
UPDATE / DELETE operations</li>
<li>Can query the database using DQL. You will learn more about DQL in
the <a class="reference internal" href="dql-doctrine-query-language.html"><em>DQL: Doctrine Query Language</em></a> chapter.</li>
<li>Optionally validates transactions using Doctrine_Validator and gives
full information of possible errors.</li>
</ul>
<div class="section" id="available-drivers">
<h3>Available Drivers<a class="headerlink" href="#available-drivers" title="Permalink to this headline">¶</a></h3>
<p>Doctrine has drivers for every PDO-supported database. The supported
databases are:</p>
<ul class="simple">
<li>FreeTDS / Microsoft SQL Server / Sybase</li>
<li>Firebird/Interbase 6</li>
<li>Informix</li>
<li>Mysql</li>
<li>Oracle</li>
<li>Odbc</li>
<li>PostgreSQL</li>
<li>Sqlite</li>
</ul>
</div>
<div class="section" id="creating-connections">
<h3>Creating Connections<a class="headerlink" href="#creating-connections" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Doctrine_Manager</span><span class="o">::</span><span class="na">connection</span><span class="p">(</span><span class="s1">&#39;mysql://username:password@localhost/test&#39;</span><span class="p">,</span> <span class="s1">&#39;connection 1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We have already created a new connection in the previous chapters. You can
skip the above step and use the connection we&#8217;ve already created. You can
retrieve it by using the <a href="#id11"><span class="problematic" id="id12">:php:meth:`Doctrine_Manager::connection`</span></a> method.</p>
</div>
</div>
<div class="section" id="flushing-the-connection">
<h3>Flushing the Connection<a class="headerlink" href="#flushing-the-connection" title="Permalink to this headline">¶</a></h3>
<p>When you create new <tt class="docutils literal"><span class="pre">User</span></tt> records you can flush the connection and save all
un-saved objects for that connection. Below is an example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Doctrine_Manager</span><span class="o">::</span><span class="na">connection</span><span class="p">();</span>

<span class="nv">$user1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user1</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Jack&#39;</span><span class="p">;</span>

<span class="nv">$user2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user2</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</pre></div>
</div>
<p>Calling <a href="#id13"><span class="problematic" id="id14">:php:meth:`Doctrine_Connection::flush`</span></a> will save all unsaved record
instances for that connection. You could of course optionally call
<a href="#id15"><span class="problematic" id="id16">:php:meth:`save`</span></a> on each record instance and it would be the same thing.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user1</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="nv">$user2</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="table">
<span id="component-overview-table"></span><h2>Table<a class="headerlink" href="#table" title="Permalink to this headline">¶</a></h2>
<p><a href="#id17"><span class="problematic" id="id18">:php:class:`Doctrine_Table`</span></a> holds the schema information specified by the given
component (record). For example if you have a <tt class="docutils literal"><span class="pre">User</span></tt> class that extends
<a href="#id19"><span class="problematic" id="id20">:php:class:`Doctrine_Record`</span></a>, each schema definition call gets delegated to a
unique table object that holds the information for later use.</p>
<p>Each <a href="#id21"><span class="problematic" id="id22">:php:class:`Doctrine_Table`</span></a> is registered by
<a href="#id23"><span class="problematic" id="id24">:php:class:`Doctrine_Connection`</span></a>. You can retrieve the table object for each
component easily which is demonstrated right below.</p>
<p>For example, lets say we want to retrieve the table object for the User class.
We can do this by simply giving <tt class="docutils literal"><span class="pre">User</span></tt> as the first argument for the
<a href="#id25"><span class="problematic" id="id26">:php:meth:`Doctrine_Core::getTable`</span></a> method.</p>
<div class="section" id="getting-a-table-object">
<h3>Getting a Table Object<a class="headerlink" href="#getting-a-table-object" title="Permalink to this headline">¶</a></h3>
<p>In order to get table object for specified record just call
<a href="#id27"><span class="problematic" id="id28">:php:meth:`Doctrine_Record::getTable`</span></a>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$accountTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-column-information">
<h3>Getting Column Information<a class="headerlink" href="#getting-column-information" title="Permalink to this headline">¶</a></h3>
<p>You can retrieve the column definitions set in <a href="#id29"><span class="problematic" id="id30">:php:class:`Doctrine_Record`</span></a> by
using the appropriate <a href="#id31"><span class="problematic" id="id32">:php:class:`Doctrine_Table`</span></a> methods. If you need all
information of all columns you can simply use:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$columns</span> <span class="o">=</span> <span class="nv">$accountTable</span><span class="o">-&gt;</span><span class="na">getColumns</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$columns</span> <span class="k">as</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$column</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [type] =&gt; integer
    [length] =&gt; 20
    [autoincrement] =&gt; 1
    [primary] =&gt; 1
)
Array (
    [type] =&gt; string
    [length] =&gt; 255
)
Array (
    [type] =&gt; decimal
    [length] =&gt; 18
)
</pre></div>
</div>
<p>Sometimes this can be an overkill. The following example shows how to
retrieve the column names as an array:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$names</span> <span class="o">=</span> <span class="nv">$accountTable</span><span class="o">-&gt;</span><span class="na">getColumnNames</span><span class="p">();</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$names</span><span class="p">);</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [0] =&gt; id
    [1] =&gt; name
    [2] =&gt; amount
)
</pre></div>
</div>
</div>
<div class="section" id="getting-relation-information">
<h3>Getting Relation Information<a class="headerlink" href="#getting-relation-information" title="Permalink to this headline">¶</a></h3>
<p>You can also get an array of all the <tt class="docutils literal"><span class="pre">Doctrine_Relation</span></tt> objects by
simply calling <a href="#id33"><span class="problematic" id="id34">:php:meth:`Doctrine_Table::getRelations`</span></a> like the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
<span class="nv">$relations</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">getRelations</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$relations</span> <span class="k">as</span> <span class="nv">$name</span> <span class="o">=&gt;</span> <span class="nv">$relation</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;Local - &quot;</span> <span class="o">.</span> <span class="nv">$relation</span><span class="o">-&gt;</span><span class="na">getLocal</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;Foreign - &quot;</span> <span class="o">.</span>    <span class="nv">$relation</span><span class="o">-&gt;</span><span class="na">getForeign</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Email:
Local - id
Foreign - user_id

Phonenumbers:
Local - id
Foreign - user_id

Groups:
Local - user_id
Foreign - group_id

Friends:
Local - user1
Foreign - user2

Addresses:
Local - id
Foreign - user_id

Threads:
Local - id
Foreign - user_id
</pre></div>
</div>
<p>You can get the <tt class="docutils literal"><span class="pre">Doctrine_Relation</span></tt> object for an individual relationship by
using the <a href="#id35"><span class="problematic" id="id36">:php:meth:`Doctrine_Table::getRelation`</span></a> method.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$relation</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">getRelation</span><span class="p">(</span><span class="s1">&#39;Phonenumbers&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="s1">&#39;Name: &#39;</span> <span class="o">.</span> <span class="nv">$relation</span><span class="p">[</span><span class="s1">&#39;alias&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Local - &#39;</span> <span class="o">.</span> <span class="nv">$relation</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Foreign - &#39;</span> <span class="o">.</span>  <span class="nv">$relation</span><span class="p">[</span><span class="s1">&#39;foreign&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Relation Class - &#39;</span> <span class="o">.</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$relation</span><span class="p">);</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Name: Phonenumbers
Local - id
Foreign - user_id
Relation Class - Doctrine_Relation_ForeignKey
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how in the above examples the <tt class="docutils literal"><span class="pre">$relation</span></tt> variable
holds an instance of <tt class="docutils literal"><span class="pre">Doctrine_Relation_ForeignKey</span></tt> yet we can
access it like an array. This is because, like many Doctrine
classes, it implements <tt class="docutils literal"><span class="pre">ArrayAccess</span></tt>.</p>
</div>
<p>You can debug all the information of a relationship by using the
<a href="#id37"><span class="problematic" id="id38">:php:meth:`toArray`</span></a> method and using <a href="#id39"><span class="problematic" id="id40">:php:meth:`print_r`</span></a> to inspect it.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$array</span> <span class="o">=</span> <span class="nv">$relation</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="finder-methods">
<h3>Finder Methods<a class="headerlink" href="#finder-methods" title="Permalink to this headline">¶</a></h3>
<p><a href="#id41"><span class="problematic" id="id42">:php:class:`Doctrine_Table`</span></a> provides basic finder methods. These finder methods
are very fast to write and should be used if you only need to fetch data
from one database table. If you need queries that use several components
(database tables) use <a href="#id43"><span class="problematic" id="id44">:php:meth:`Doctrine_Connection::query`</span></a>.</p>
<p>You can easily find an individual user by its primary key by using the
<a href="#id45"><span class="problematic" id="id46">:php:meth:`find`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [id] =&gt; 2
    [is_active] =&gt; 1
    [is_super_admin] =&gt; 0
    [first_name] =&gt;
    [last_name] =&gt;
    [username] =&gt; jwage
    [password] =&gt;
    [type] =&gt;
    [created_at] =&gt; 2009-01-21 13:29:12
    [updated_at] =&gt; 2009-01-21 13:29:12
)
</pre></div>
</div>
<p>You can also use the <a href="#id47"><span class="problematic" id="id48">:php:meth:`findAll`</span></a> method to retrieve a collection of
all <tt class="docutils literal"><span class="pre">User</span></tt> records in the database:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">foreach</span> <span class="p">(</span><span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Jack
jwage
</pre></div>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">The <a href="#id49"><span class="problematic" id="id50">:php:meth:`findAll`</span></a> method is not recommended as it will
Return all records in the database and if you need to retrieve
information from relationships it will lazily load that data causing
high query counts. You can learn how to retrieve records and their related
records efficiently by reading the <a class="reference internal" href="dql-doctrine-query-language.html"><em>DQL: Doctrine Query Language</em></a>
chapter.</p>
</div>
<p>You can also retrieve a set of records with a DQL where condition by
using the <a href="#id51"><span class="problematic" id="id52">:php:meth:`findByDql`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findByDql</span><span class="p">(</span><span class="s1">&#39;username LIKE ?&#39;</span><span class="p">,</span> <span class="s1">&#39;%jw%&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
jwage
</pre></div>
</div>
<p>Doctrine also offers some additional magic finder methods that can be
read about in the [doc dql-doctrine-query-language:magic-finders :name]
section of the DQL chapter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>All of the finders below provided by <a href="#id53"><span class="problematic" id="id54">:php:class:`Doctrine_Table`</span></a>
use instances of <a href="#id55"><span class="problematic" id="id56">:php:class:`Doctrine_Query`</span></a> for executing the queries. The
objects are built dynamically internally and executed.</p>
<p class="last">Using <a href="#id57"><span class="problematic" id="id58">:php:class:`Doctrine_Query`</span></a> instances are highly recommend when
accessing multiple objects through relationships. If you don&#8217;t you will
have high query counts as the data will be lazily loaded. You can read more
about this in the <a class="reference internal" href="dql-doctrine-query-language.html"><em>DQL: Doctrine Query Language</em></a> chapter.</p>
</div>
<div class="section" id="custom-table-classes">
<h4>Custom Table Classes<a class="headerlink" href="#custom-table-classes" title="Permalink to this headline">¶</a></h4>
<p>Adding custom table classes is very easy. Only thing you need to do is name the
classes as <tt class="docutils literal"><span class="pre">[componentName]Table</span></tt> and make them extend
<a href="#id59"><span class="problematic" id="id60">:php:class:`Doctrine_Table`</span></a>. So for the <tt class="docutils literal"><span class="pre">User</span></tt> model we would create a class
like the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/UserTable.php</span>
<span class="k">class</span> <span class="nc">UserTable</span> <span class="k">extends</span> <span class="nx">Doctrine_Table</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-finders">
<h3>Custom Finders<a class="headerlink" href="#custom-finders" title="Permalink to this headline">¶</a></h3>
<p>You can add custom finder methods to your custom table object. These
finder methods may use fast <a href="#id61"><span class="problematic" id="id62">:php:class:`Doctrine_Table`</span></a> finder methods or [doc
dql-doctrine-query-language DQL API] (<a href="#id63"><span class="problematic" id="id64">:php:meth:`Doctrine_Query::create`</span></a>).</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/UserTable.php</span>
<span class="k">class</span> <span class="nc">UserTable</span> <span class="k">extends</span> <span class="nx">Doctrine_Table</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.name LIKE ?&#39;</span><span class="p">,</span> <span class="s2">&quot;%</span><span class="si">$name</span><span class="s2">%&quot;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Doctrine will check if a child <a href="#id65"><span class="problematic" id="id66">:php:class:`Doctrine_Table`</span></a> class called
<tt class="docutils literal"><span class="pre">UserTable</span></tt> exists when calling <a href="#id67"><span class="problematic" id="id68">:php:meth:`getTable`</span></a> and if it does, it will
return an instance of that instead of the default <a href="#id69"><span class="problematic" id="id70">:php:class:`Doctrine_Table`</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In order for custom {{Doctrine_Table}} classes to be
loaded you must enable the <tt class="docutils literal"><span class="pre">autoload_table_classes</span></tt> attribute in
your <tt class="file docutils literal"><span class="pre">bootstrap.php</span></tt> file like done below.</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="c1">// boostrap.php</span>
<span class="c1">// ...</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_AUTOLOAD_TABLE_CLASSES</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Now when we ask for the <tt class="docutils literal"><span class="pre">User</span></tt> table object we will get the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$userTable</span><span class="p">);</span> <span class="c1">// UserTable</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findByName</span><span class="p">(</span><span class="s2">&quot;Jack&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above example where we add a {{findByName()}} method is
made possible automatically by the magic finder methods. You can
read about them in the [doc
dql-doctrine-query-language:magic-finders :name] section of the DQL
chapter.</p>
</div>
</div>
</div>
<div class="section" id="record">
<span id="component-overview-record"></span><h2>Record<a class="headerlink" href="#record" title="Permalink to this headline">¶</a></h2>
<p>Doctrine represents tables in your RDBMS with child
<a href="#id71"><span class="problematic" id="id72">:php:class:`Doctrine_Record`</span></a> classes. These classes are where you define your
schema information, options, attributes, etc. Instances of these child classes
represents records in the database and you can get and set properties on these
objects.</p>
<div class="section" id="properties">
<h3>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<p>Each assigned column property of <a href="#id73"><span class="problematic" id="id74">:php:class:`Doctrine_Record`</span></a> represents a
database table column. You will learn more about how to define your models in
the <a class="reference internal" href="defining-models.html"><em>Defining Models</em></a> chapter.</p>
<p>Now accessing the columns is easy:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">Access property through overloading:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Access property with get():</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">username</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Access property with ArrayAccess:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="k">echo</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The recommended way to access column values is by using the
ArrayAccess as it makes it easy to switch between record and array
fetching when needed.</p>
</div>
<p>Iterating through the properties of a record can be done in similar way
as iterating through an array - by using the <tt class="docutils literal"><span class="pre">foreach</span></tt> construct. This
is possible since <a href="#id75"><span class="problematic" id="id76">:php:class:`Doctrine_Record`</span></a> implements a magic
<tt class="docutils literal"><span class="pre">IteratorAggregate</span></tt> interface.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">foreach</span> <span class="p">(</span><span class="nv">$user</span> <span class="k">as</span> <span class="nv">$field</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$field</span> <span class="o">.</span> <span class="s1">&#39;: &#39;</span> <span class="o">.</span> <span class="nv">$value</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As with arrays you can use the <a href="#id77"><span class="problematic" id="id78">:php:meth:`isset`</span></a> for checking if given
property exists and <a href="#id79"><span class="problematic" id="id80">:php:meth:`unset`</span></a> for setting given property to null.</p>
<p>We can easily check if a property named &#8216;name&#8217; exists in a if conditional:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If we want to unset the name property we can do it using the <a href="#id81"><span class="problematic" id="id82">:php:meth:`unset`</span></a>
function in php:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nb">unset</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>When you have set values for record properties you can get an array of
the modified fields and values using <a href="#id83"><span class="problematic" id="id84">:php:meth:`Doctrine_Record::getModified`</span></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Jack Daniels&#39;</span><span class="p">;</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getModified</span><span class="p">());</span>
</pre></div>
</div>
<p>The above example would output the following when executed:</p>
<div class="highlight-text"><div class="highlight"><pre>$ php test.php
Array (
    [username] =&gt; Jack Daniels
)
</pre></div>
</div>
<p>You can also simply check if a record is modified by using the
<a href="#id85"><span class="problematic" id="id86">:php:meth:`Doctrine_Record::isModified`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isModified</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;Modified&#39;</span> <span class="o">:</span> <span class="s1">&#39;Not Modified&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Sometimes you may want to retrieve the column count of given record. In
order to do this you can simply pass the record as an argument for the
<a href="#id87"><span class="problematic" id="id88">:php:meth:`count`</span></a> function. This is possible since <a href="#id89"><span class="problematic" id="id90">:php:class:`Doctrine_Record`</span></a>
implements a magic Countable interface. The other way would be calling
the <a href="#id91"><span class="problematic" id="id92">:php:meth:`count`</span></a> method.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$record</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span>
<span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
</pre></div>
</div>
<p><a href="#id93"><span class="problematic" id="id94">:php:class:`Doctrine_Record`</span></a> offers a special method for accessing the
identifier of given record. This method is called <a href="#id95"><span class="problematic" id="id96">:php:meth:`identifier`</span></a> and
it returns an array with identifier field names as keys and values as
the associated property values.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Jack Daniels&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">identifier</span><span class="p">());</span> <span class="c1">// array(&#39;id&#39; =&gt; 1)</span>
</pre></div>
</div>
<p>A common case is that you have an array of values which you need to
assign to a given record. It may feel awkward and clumsy to set these
values separately. No need to worry though, <a href="#id97"><span class="problematic" id="id98">:php:class:`Doctrine_Record`</span></a> offers
a way for merging a given array or record to another</p>
<p>The <a href="#id99"><span class="problematic" id="id100">:php:meth:`merge`</span></a> method iterates through the properties of the given
record or array and assigns the values to the object</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$values</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;someone&#39;</span><span class="p">,</span>
    <span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span>
<span class="p">);</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span> <span class="c1">// someone</span>
<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">;</span> <span class="c1">// 11</span>
</pre></div>
</div>
<p>You can also merge a one records values in to another like the
following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user1</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>

<span class="nv">$user2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user2</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">(</span><span class="nv">$user1</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$user2</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span> <span class="c1">// jwage</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a href="#id101"><span class="problematic" id="id102">:php:class:`Doctrine_Record`</span></a> also has a <a href="#id103"><span class="problematic" id="id104">:php:meth:`fromArray`</span></a> method
which is identical to <a href="#id105"><span class="problematic" id="id106">:php:meth:`merge`</span></a> and only exists for consistency
with the <a href="#id107"><span class="problematic" id="id108">:php:meth:`toArray`</span></a> method.</p>
</div>
</div>
<div class="section" id="updating-records">
<h3>Updating Records<a class="headerlink" href="#updating-records" title="Permalink to this headline">¶</a></h3>
<p>Updating objects is very easy, you just call the
<a href="#id109"><span class="problematic" id="id110">:php:meth:`Doctrine_Record::save`</span></a> method. The other way is to call
<a href="#id111"><span class="problematic" id="id112">:php:meth:`Doctrine_Connection::flush`</span></a> which saves all objects. It should be
noted though that flushing is a much heavier operation than just calling
save method.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$user</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Jack Daniels&#39;</span><span class="p">;</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sometimes you may want to do a direct update. In direct update the
objects aren&#8217;t loaded from database, rather the state of the database is
directly updated. In the following example we use DQL UPDATE statement
to update all users.</p>
<p>Run a query to make all user names lowercase:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;u.username&#39;</span><span class="p">,</span> <span class="s1">&#39;LOWER(u.name)&#39;</span><span class="p">);</span>

<span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>You can also run an update using objects if you already know the identifier of
the record. When you use the <a href="#id113"><span class="problematic" id="id114">:php:meth:`Doctrine_Record::assignIdentifier`</span></a>
method it sets the record identifier and changes the state so that calling
<a href="#id115"><span class="problematic" id="id116">:php:meth:`Doctrine_Record::save`</span></a> performs an update instead of insert.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">assignIdentifier</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="replacing-records">
<h3>Replacing Records<a class="headerlink" href="#replacing-records" title="Permalink to this headline">¶</a></h3>
<p>Replacing records is simple. If you instantiate a new object and save it
and then late instantiate another new object with the same primary key
or unique index value which already exists in the database, then it will
replace/update that row in the database instead of inserting a new one.
Below is an example.</p>
<p>First, imagine a <tt class="docutils literal"><span class="pre">User</span></tt> model where username is a unique index.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;changeme&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>Issues the following query</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">user</span>
    <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="k">VALUES</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;jwage&#39;</span><span class="p">,</span> <span class="s1">&#39;changeme&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now lets create another new object and set the same username but a
different password.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;newpassword&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">replace</span><span class="p">();</span>
</pre></div>
</div>
<p>Issues the following query</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">REPLACE</span> <span class="k">INTO</span> <span class="k">user</span>
    <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="k">VALUES</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
    <span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">&#39;jwage&#39;</span><span class="p">,</span> <span class="s1">&#39;newpassword&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The record is replaced/updated instead of a new one being inserted</p>
</div>
<div class="section" id="refreshing-records">
<h3>Refreshing Records<a class="headerlink" href="#refreshing-records" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may want to refresh your record with data from the
database, use <a href="#id117"><span class="problematic" id="id118">:php:meth:`Doctrine_Record::refresh`</span></a>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;New name&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Now if you use the <a href="#id119"><span class="problematic" id="id120">:php:meth:`Doctrine_Record::refresh`</span></a> method it will select
the data from the database again and update the properties of the
instance.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="refreshing-relationships">
<h3>Refreshing relationships<a class="headerlink" href="#refreshing-relationships" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id121"><span class="problematic" id="id122">:php:meth:`Doctrine_Record::refresh`</span></a> method can also refresh the already
loaded record relationships, but you need to specify them on the
original query.</p>
<p>First lets retrieve a <tt class="docutils literal"><span class="pre">User</span></tt> with its associated <tt class="docutils literal"><span class="pre">Groups</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id = ?&#39;</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
<p>Now lets retrieve a <tt class="docutils literal"><span class="pre">Group</span></tt> with its associated <tt class="docutils literal"><span class="pre">Users</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;Group g&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;g.Users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id = ?&#39;</span><span class="p">);</span>

<span class="nv">$group</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
<p>Now lets link the retrieved <tt class="docutils literal"><span class="pre">User</span></tt> and <tt class="docutils literal"><span class="pre">Group</span></tt> through a
<tt class="docutils literal"><span class="pre">UserGroup</span></tt> instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserGroup</span><span class="p">();</span>
<span class="nv">$userGroup</span><span class="o">-&gt;</span><span class="na">user_id</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
<span class="nv">$userGroup</span><span class="o">-&gt;</span><span class="na">group_id</span> <span class="o">=</span> <span class="nv">$group</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
<span class="nv">$userGroup</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>You can also link a <tt class="docutils literal"><span class="pre">User</span></tt> to a <tt class="docutils literal"><span class="pre">Group</span></tt> in a much simpler way, by
simply adding the <tt class="docutils literal"><span class="pre">Group</span></tt> to the <tt class="docutils literal"><span class="pre">User</span></tt>. Doctrine will take care of
creating the <tt class="docutils literal"><span class="pre">UserGroup</span></tt> instance for you automatically:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$group</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now if we call <tt class="docutils literal"><span class="pre">Doctrine_Record::refresh(true)</span></tt> it will refresh the
record and its relationships loading the newly created reference we made
above:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nv">$group</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p>You can also lazily refresh all defined relationships of a model using
<a href="#id123"><span class="problematic" id="id124">:php:meth:`Doctrine_Record::refreshRelated`</span></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneByName</span><span class="p">(</span><span class="s1">&#39;jon&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">refreshRelated</span><span class="p">();</span>
</pre></div>
</div>
<p>If you want to refresh an individual specified relationship just pass
the name of a relationship to the <a href="#id125"><span class="problematic" id="id126">:php:meth:`refreshRelated`</span></a> function and it
will lazily load the relationship:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">refreshRelated</span><span class="p">(</span><span class="s1">&#39;Phonenumber&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-records">
<h3>Deleting Records<a class="headerlink" href="#deleting-records" title="Permalink to this headline">¶</a></h3>
<p>Deleting records in Doctrine is handled by <a href="#id127"><span class="problematic" id="id128">:php:meth:`Doctrine_Record::delete`</span></a>,
<a href="#id129"><span class="problematic" id="id130">:php:meth:`Doctrine_Collection::delete`</span></a> and
<a href="#id131"><span class="problematic" id="id132">:php:meth:`Doctrine_Connection::delete`</span></a> methods.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s2">&quot;User&quot;</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// deletes user and all related composite objects</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$user</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you have a <a href="#id133"><span class="problematic" id="id134">:php:class:`Doctrine_Collection`</span></a> of <tt class="docutils literal"><span class="pre">User</span></tt> records you can call
<a href="#id135"><span class="problematic" id="id136">:php:meth:`delete`</span></a> and it will loop over all records calling
<a href="#id137"><span class="problematic" id="id138">:php:meth:`Doctrine_Record::delete`</span></a> for you.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>
</pre></div>
</div>
<p>Now you can delete all users and their related composite objects by calling
<a href="#id139"><span class="problematic" id="id140">:php:meth:`Doctrine_Collection::delete`</span></a>. It will loop over all <tt class="docutils literal"><span class="pre">Users</span></tt> in the
collection calling delete one each one:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="using-expression-values">
<span id="component-overview-using-expression-values"></span><h3>Using Expression Values<a class="headerlink" href="#using-expression-values" title="Permalink to this headline">¶</a></h3>
<p>There might be situations where you need to use SQL expressions as
values of columns. This can be achieved by using
<tt class="docutils literal"><span class="pre">Doctrine_Expression</span></tt> which converts portable DQL expressions to your
native SQL expressions.</p>
<p>Lets say we have a class called event with columns
<tt class="docutils literal"><span class="pre">timepoint(datetime)</span></tt> and <tt class="docutils literal"><span class="pre">name(string)</span></tt>. Saving the record with the
current timestamp can be achieved as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;jwage&#39;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">updated_at</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine_Expression</span><span class="p">(</span><span class="s1">&#39;NOW()&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<p>The above code would issue the following SQL query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">user</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;jwage&#39;</span><span class="p">,</span> <span class="n">NOW</span><span class="p">())</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When you use <tt class="docutils literal"><span class="pre">Doctrine_Expression</span></tt> with your objects in
order to get the updated value you will have to manually call
<a href="#id141"><span class="problematic" id="id142">:php:meth:`refresh`</span></a> to get the updated value from the database.</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-record-state">
<h3>Getting Record State<a class="headerlink" href="#getting-record-state" title="Permalink to this headline">¶</a></h3>
<p>Every <a href="#id143"><span class="problematic" id="id144">:php:class:`Doctrine_Record`</span></a> has a state. First of all records can be
transient or persistent. Every record that is retrieved from database is
persistent and every newly created record is considered transient. If a
<a href="#id145"><span class="problematic" id="id146">:php:class:`Doctrine_Record`</span></a> is retrieved from database but the only loaded
property is its primary key, then this record has a state called proxy.</p>
<p>Every transient and persistent <a href="#id147"><span class="problematic" id="id148">:php:class:`Doctrine_Record`</span></a> is either clean or
dirty. <a href="#id149"><span class="problematic" id="id150">:php:class:`Doctrine_Record`</span></a> is clean when none of its properties are
changed and dirty when at least one of its properties has changed.</p>
<p>A record can also have a state called locked. In order to avoid infinite
recursion in some rare circular reference cases Doctrine uses this state
internally to indicate that a record is currently under a manipulation
operation.</p>
<p>Below is a table containing all the different states a record can be in
with a short description of it:</p>
<table border="1" class="docutils">
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a href="#id151"><span class="problematic" id="id152">:php:const:`Doctrine_Record::STATE_PROXY`</span></a></td>
<td>Record is in proxy state meaning
its persistent but not all of its
properties are loaded from the
database.</td>
</tr>
<tr class="row-odd"><td><a href="#id153"><span class="problematic" id="id154">:php:const:`Doctrine_Record::STATE_TCLEAN`</span></a></td>
<td>Record is transient clean, meaning
its transient and none of its
properties are changed.</td>
</tr>
<tr class="row-even"><td><a href="#id155"><span class="problematic" id="id156">:php:const:`Doctrine_Record::STATE_TDIRTY`</span></a></td>
<td>Record is transient dirty, meaning
its transient and some of its
properties are changed.</td>
</tr>
<tr class="row-odd"><td><a href="#id157"><span class="problematic" id="id158">:php:const:`Doctrine_Record::STATE_DIRTY`</span></a></td>
<td>Record is dirty, meaning its
persistent and some of its
properties are changed.</td>
</tr>
<tr class="row-even"><td><a href="#id159"><span class="problematic" id="id160">:php:const:`Doctrine_Record::STATE_CLEAN`</span></a></td>
<td>Record is clean, meaning its
persistent and none of its
properties are changed.</td>
</tr>
<tr class="row-odd"><td><a href="#id161"><span class="problematic" id="id162">:php:const:`Doctrine_Record::STATE_LOCKED`</span></a></td>
<td>Record is locked.</td>
</tr>
</tbody>
</table>
<p>You can easily get the state of a record by using the
<a href="#id163"><span class="problematic" id="id164">:php:meth:`Doctrine_Record::state`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">()</span> <span class="o">==</span> <span class="nx">Doctrine_Record</span><span class="o">::</span><span class="na">STATE_TDIRTY</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;Record is transient dirty&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">values specified in the schema. If we use an object that has no
default values and instantiate a new instance it will return
<tt class="docutils literal"><span class="pre">TCLEAN</span></tt>.</p>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$account</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$account</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">()</span> <span class="o">==</span> <span class="nx">Doctrine_Record</span><span class="o">::</span><span class="na">STATE_TCLEAN</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;Record is transient clean&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-object-copy">
<h3>Getting Object Copy<a class="headerlink" href="#getting-object-copy" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may want to get a copy of your object (a new object with
all properties copied). Doctrine provides a simple method for this:
<a href="#id165"><span class="problematic" id="id166">:php:meth:`Doctrine_Record::copy`</span></a>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$copy</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">();</span>
</pre></div>
</div>
<p>Notice that copying the record with <a href="#id167"><span class="problematic" id="id168">:php:meth:`copy`</span></a> returns a new record
(state <tt class="docutils literal"><span class="pre">TDIRTY</span></tt>) with the values of the old record, and it copies the
relations of that record. If you do not want to copy the relations too,
you need to use <tt class="docutils literal"><span class="pre">copy(false)</span></tt>.</p>
<p>Get a copy of user without the relations:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$copy</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
<p>Using the PHP <tt class="docutils literal"><span class="pre">clone</span></tt> functionality simply uses this <a href="#id169"><span class="problematic" id="id170">:php:meth:`copy`</span></a>
functionality internally:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$copy</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$user</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-a-blank-record">
<h3>Saving a Blank Record<a class="headerlink" href="#saving-a-blank-record" title="Permalink to this headline">¶</a></h3>
<p>By default Doctrine doesn&#8217;t execute when <a href="#id171"><span class="problematic" id="id172">:php:meth:`save`</span></a> is being called on
an unmodified record. There might be situations where you want to
force-insert the record even if it has not been modified. This can be
achieved by assigning the state of the record to
<a href="#id173"><span class="problematic" id="id174">:php:const:`Doctrine_Record::STATE_TDIRTY`</span></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">(</span><span class="s1">&#39;TDIRTY&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When setting the state you can optionally pass a string for
the state and it will be converted to the appropriate state
constant. In the example above, <tt class="docutils literal"><span class="pre">TDIRTY</span></tt> is actually converted to
<a href="#id175"><span class="problematic" id="id176">:php:const:`Doctrine_Record::STATE_TDIRTY`</span></a>.</p>
</div>
</div>
<div class="section" id="mapping-custom-values">
<h3>Mapping Custom Values<a class="headerlink" href="#mapping-custom-values" title="Permalink to this headline">¶</a></h3>
<p>There might be situations where you want to map custom values to
records. For example values that depend on some outer sources and you
only want these values to be available at runtime not persisting those
values into database. This can be achieved as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">mapValue</span><span class="p">(</span><span class="s1">&#39;isRegistered&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isRegistered</span><span class="p">;</span> <span class="c1">// true</span>
</pre></div>
</div>
</div>
<div class="section" id="serializing">
<h3>Serializing<a class="headerlink" href="#serializing" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may want to serialize your record objects (possibly for
caching purposes):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$string</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-existence">
<h3>Checking Existence<a class="headerlink" href="#checking-existence" title="Permalink to this headline">¶</a></h3>
<p>Very commonly you&#8217;ll need to know if given record exists in the
database. You can use the <a href="#id177"><span class="problematic" id="id178">:php:meth:`exists`</span></a> method for checking if given
record has a database row equivalent:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$record</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$record</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;Exists&#39;</span> <span class="o">:</span> <span class="s1">&#39;Does Not Exist&#39;</span><span class="p">;</span> <span class="c1">// Does Not Exist</span>

<span class="nv">$record</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;someone&#39;</span><span class="p">;</span> <span class="nv">$record</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$record</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;Exists&#39;</span> <span class="o">:</span> <span class="s1">&#39;Does Not Exist&#39;</span><span class="p">;</span> <span class="c1">// Exists</span>
</pre></div>
</div>
</div>
<div class="section" id="function-callbacks-for-columns">
<h3>Function Callbacks for Columns<a class="headerlink" href="#function-callbacks-for-columns" title="Permalink to this headline">¶</a></h3>
<p><a href="#id179"><span class="problematic" id="id180">:php:class:`Doctrine_Record`</span></a> offers a way for attaching callback calls for
column values. For example if you want to trim certain column, you can
simply use:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$record</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="s1">&#39;trim&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="collection">
<span id="component-overview-collection"></span><h2>Collection<a class="headerlink" href="#collection" title="Permalink to this headline">¶</a></h2>
<p><a href="#id181"><span class="problematic" id="id182">:php:class:`Doctrine_Collection`</span></a> is a collection of records (see
Doctrine_Record). As with records the collections can be deleted and
saved using <a href="#id183"><span class="problematic" id="id184">:php:meth:`Doctrine_Collection::delete`</span></a> and
<a href="#id185"><span class="problematic" id="id186">:php:meth:`Doctrine_Collection::save`</span></a> accordingly.</p>
<p>When fetching data from database with either DQL API (see
<a href="#id187"><span class="problematic" id="id188">:php:class:`Doctrine_Query`</span></a>) or rawSql API (see <tt class="docutils literal"><span class="pre">Doctrine_RawSql</span></tt>) the
methods return an instance of <a href="#id189"><span class="problematic" id="id190">:php:class:`Doctrine_Collection`</span></a> by default.</p>
<p>The following example shows how to initialize a new collection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine_Collection</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now add some new data to the collection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Arnold&#39;</span><span class="p">;</span>
<span class="nv">$users</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Somebody&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Now just like we can delete a collection we can save it:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="accessing-elements">
<h3>Accessing Elements<a class="headerlink" href="#accessing-elements" title="Permalink to this headline">¶</a></h3>
<p>You can access the elements of <a href="#id191"><span class="problematic" id="id192">:php:class:`Doctrine_Collection`</span></a> with
<a href="#id193"><span class="problematic" id="id194">:php:meth:`set`</span></a> and <a href="#id195"><span class="problematic" id="id196">:php:meth:`get`</span></a> methods or with ArrayAccess interface.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>
</pre></div>
</div>
<ul>
<li><p class="first">Accessing elements with ArrayAccess interface:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&quot;Jack Daniels&quot;</span><span class="p">;</span>
<span class="nv">$users</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&quot;John Locke&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Accessing elements with <a href="#id197"><span class="problematic" id="id198">:php:meth:`get`</span></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="adding-new-elements">
<h3>Adding new Elements<a class="headerlink" href="#adding-new-elements" title="Permalink to this headline">¶</a></h3>
<p>When accessing single elements of the collection and those elements
(records) don&#8217;t exist Doctrine auto-adds them.</p>
<p>In the following example we fetch all users from database (there are 5)
and then add couple of users in the collection.</p>
<p>As with PHP arrays the indexes start from zero.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$users</span><span class="p">);</span> <span class="c1">// 5</span>

<span class="nv">$users</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&quot;new user 1&quot;</span><span class="p">;</span>
<span class="nv">$users</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&quot;new user 2&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>You could also optionally omit the 5 and 6 from the array index and it
will automatically increment just as a PHP array would:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span><span class="p">[]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;new user 3&#39;</span><span class="p">;</span> <span class="c1">// key is 7</span>
<span class="nv">$users</span><span class="p">[]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;new user 4&#39;</span><span class="p">;</span> <span class="c1">// key is 8</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-collection-count">
<h3>Getting Collection Count<a class="headerlink" href="#getting-collection-count" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id199"><span class="problematic" id="id200">:php:meth:`Doctrine_Collection::count`</span></a> method returns the number of
elements currently in the collection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span>
</pre></div>
</div>
<p>Since <a href="#id201"><span class="problematic" id="id202">:php:class:`Doctrine_Collection`</span></a> implements Countable interface a valid
alternative for the previous example is to simply pass the collection as
an argument for the count() function:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$users</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-the-collection">
<h3>Saving the Collection<a class="headerlink" href="#saving-the-collection" title="Permalink to this headline">¶</a></h3>
<p>Similar to <a href="#id203"><span class="problematic" id="id204">:php:class:`Doctrine_Record`</span></a> the collection can be saved by calling
the <a href="#id205"><span class="problematic" id="id206">:php:meth:`save`</span></a> method. When <a href="#id207"><span class="problematic" id="id208">:php:meth:`save`</span></a> gets called Doctrine issues
<a href="#id209"><span class="problematic" id="id210">:php:meth:`save`</span></a> operations an all records and wraps the whole procedure in a
transaction.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;Jack Daniels&#39;</span><span class="p">;</span>
<span class="nv">$users</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;John Locke&#39;</span><span class="p">;</span>

<span class="nv">$users</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-the-collection">
<h3>Deleting the Collection<a class="headerlink" href="#deleting-the-collection" title="Permalink to this headline">¶</a></h3>
<p>Doctrine Collections can be deleted in very same way is Doctrine Records
you just call <a href="#id211"><span class="problematic" id="id212">:php:meth:`delete`</span></a> method. As for all collections Doctrine knows
how to perform single-shot-delete meaning it only performs one database
query for the each collection.</p>
<p>For example if we have collection of users. When deleting the collection
of users doctrine only performs one query for this whole transaction.
The query would look something like:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">user</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span> <span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="key-mapping">
<h3>Key Mapping<a class="headerlink" href="#key-mapping" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may not want to use normal indexing for collection elements. For
example in some cases mapping primary keys as collection keys might be useful.
The following example demonstrates how this can be achieved.</p>
<ul>
<li><p class="first">Map the <tt class="docutils literal"><span class="pre">id</span></tt> column:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
<span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_COLL_KEY</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Now user collections will use the values of id column as element indexes:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$id</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$id</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">You may want to map the <tt class="docutils literal"><span class="pre">name</span></tt> column:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userTable</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
<span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_COLL_KEY</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Now user collections will use the values of <tt class="docutils literal"><span class="pre">name</span></tt> column as element
indexes:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$username</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$username</span> <span class="o">.</span> <span class="s1">&#39; - &#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">created_at</span> <span class="o">.</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Note this would only be advisable if the <tt class="docutils literal"><span class="pre">username</span></tt> column is specified
as unique in your schema otherwise you will have cases where data cannot be
hydrated properly due to duplicate collection keys.</p>
</div>
</div>
<div class="section" id="loading-related-records">
<h3>Loading Related Records<a class="headerlink" href="#loading-related-records" title="Permalink to this headline">¶</a></h3>
<p>Doctrine provides means for efficiently retrieving all related records
for all record elements. That means when you have for example a
collection of users you can load all phonenumbers for all users by
simple calling the <a href="#id213"><span class="problematic" id="id214">:php:meth:`loadRelated`</span></a> method.</p>
<p>However, in most cases you don&#8217;t need to load related elements
explicitly, rather what you should do is try to load everything at once
by using the DQL API and JOINS.</p>
<p>The following example uses three queries for retrieving users, their
phonenumbers and the groups they belong to.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Now lets load phonenumbers for all users:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span><span class="o">-&gt;</span><span class="na">loadRelated</span><span class="p">(</span><span class="s1">&#39;Phonenumbers&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">phonenumber</span><span class="p">;</span>
    <span class="c1">// no additional db queries needed here</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a href="#id215"><span class="problematic" id="id216">:php:meth:`loadRelated`</span></a> works an any relation, even associations:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span><span class="o">-&gt;</span><span class="na">loadRelated</span><span class="p">(</span><span class="s1">&#39;Groups&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The example below shows how to do this more efficiently by using the DQL
API.</p>
<p>Write a <a href="#id217"><span class="problematic" id="id218">:php:class:`Doctrine_Query`</span></a> that loads everything in one query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumbers p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Groups g&#39;</span><span class="p">);</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Now when we use the <tt class="docutils literal"><span class="pre">Phonenumbers</span></tt> and <tt class="docutils literal"><span class="pre">Groups</span></tt> no additional database
queries are needed:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Phonenumbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">phonenumber</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="validator">
<h2>Validator<a class="headerlink" href="#validator" title="Permalink to this headline">¶</a></h2>
<p>Validation in Doctrine is a way to enforce your business rules in the model
part of the MVC architecture. You can think of this validation as a gateway
that needs to be passed right before data gets into the persistent data store.
The definition of these business rules takes place at the record level, that
means in your active record model classes (classes derived from
<a href="#id219"><span class="problematic" id="id220">:php:class:`Doctrine_Record`</span></a>). The first thing you need to do to be able to use
this kind of validation is to enable it globally. This is done through the
<a href="#id221"><span class="problematic" id="id222">:php:class:`Doctrine_Manager`</span></a>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_VALIDATE</span><span class="p">,</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">VALIDATE_ALL</span><span class="p">);</span>
</pre></div>
</div>
<p>Once you enabled validation, you&#8217;ll get a bunch of validations
automatically:</p>
<ul class="simple">
<li>Data type validations: All values assigned to columns are checked for
the right type. That means if you specified a column of your record
as type &#8216;integer&#8217;, Doctrine will validate that any values assigned to
that column are of this type. This kind of type validation tries to
be as smart as possible since PHP is a loosely typed language. For
example 2 as well as &#8220;7&#8221; are both valid integers whilst &#8220;3f&#8221; is not.
Type validations occur on every column (since every column definition
needs a type).</li>
<li>Length validation: As the name implies, all values assigned to
columns are validated to make sure that the value does not exceed the
maximum length.</li>
</ul>
<p>You can combine the following constants by using bitwise operations:
<tt class="docutils literal"><span class="pre">VALIDATE_ALL</span></tt>, <tt class="docutils literal"><span class="pre">VALIDATE_TYPES</span></tt>, <tt class="docutils literal"><span class="pre">VALIDATE_LENGTHS</span></tt>,
<tt class="docutils literal"><span class="pre">VALIDATE_CONSTRAINTS</span></tt>, <tt class="docutils literal"><span class="pre">VALIDATE_NONE</span></tt>.</p>
<p>For example to enable all validations except length validations you
would use:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// bootstrap.php</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">ATTR_VALIDATE</span><span class="p">,</span> <span class="nx">VALIDATE_ALL</span> <span class="o">&amp;</span> <span class="o">~</span><span class="nx">VALIDATE_LENGTHS</span><span class="p">);</span>
</pre></div>
</div>
<p>You can read more about this topic in the <a class="reference internal" href="data-validation.html"><em>Data Validation</em></a>
chapter.</p>
<div class="section" id="more-validation">
<h3>More Validation<a class="headerlink" href="#more-validation" title="Permalink to this headline">¶</a></h3>
<p>The type and length validations are handy but most of the time they&#8217;re
not enough. Therefore Doctrine provides some mechanisms that can be used
to validate your data in more detail.</p>
<p>Validators are an easy way to specify further validations. Doctrine has
a lot of predefined validators that are frequently needed such as
<tt class="docutils literal"><span class="pre">email</span></tt>, <tt class="docutils literal"><span class="pre">country</span></tt>, <tt class="docutils literal"><span class="pre">ip</span></tt>, <tt class="docutils literal"><span class="pre">range</span></tt> and <tt class="docutils literal"><span class="pre">regexp</span></tt> validators. You
find a full list of available validators in the [doc data-validation
:name] chapter. You can specify which validators apply to which column
through the 4th argument of the <a href="#id223"><span class="problematic" id="id224">:php:meth:`hasColumn`</span></a> method. If that is still
not enough and you need some specialized validation that is not yet
available as a predefined validator you have three options:</p>
<ul class="simple">
<li>You can write the validator on your own.</li>
<li>You can propose your need for a new validator to a Doctrine
developer.</li>
<li>You can use validation hooks.</li>
</ul>
<p>The first two options are advisable if it is likely that the validation
is of general use and is potentially applicable in many situations. In
that case it is a good idea to implement a new validator. However if the
validation is special it is better to use hooks provided by Doctrine:</p>
<ul class="simple">
<li><a href="#id225"><span class="problematic" id="id226">:php:meth:`validate`</span></a> (Executed every time the record gets validated)</li>
<li><a href="#id227"><span class="problematic" id="id228">:php:meth:`validateOnInsert`</span></a> (Executed when the record is new and gets
validated)</li>
<li><a href="#id229"><span class="problematic" id="id230">:php:meth:`validateOnUpdate`</span></a> (Executed when the record is not new and gets
validated)</li>
</ul>
<p>If you need a special validation in your active record you can simply override
one of these methods in your active record class (a descendant of
<a href="#id231"><span class="problematic" id="id232">:php:class:`Doctrine_Record`</span></a>). Within these methods you can use all the power
of PHP to validate your fields. When a field does not pass your validation you
can then add errors to the record&#8217;s error stack. The following code snippet
shows an example of how to define validators together with custom validation:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/User.php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">validate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">==</span> <span class="s1">&#39;God&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Blasphemy! Stop that! ;-)</span>
            <span class="c1">// syntax: add(&lt;fieldName&gt;, &lt;error code/identifier&gt;)</span>
            <span class="nv">$errorStack</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getErrorStack</span><span class="p">();</span>
            <span class="nv">$errorStack</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;You cannot use this username!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// models/Email.php</span>
<span class="k">class</span> <span class="nc">Email</span> <span class="k">extends</span> <span class="nx">BaseEmail</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTableDefinition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setTableDefinition</span><span class="p">();</span>

        <span class="c1">// ...</span>

        <span class="c1">// validators &#39;email&#39; and &#39;unique&#39; used</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasColumn</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;unique&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the same example in YAML format. You can read more about YAML in
the <a class="reference internal" href="yaml-schema-files.html"><em>YAML Schema Files</em></a> chapter:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># schema.yml</span>
<span class="l-Scalar-Plain">Email</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">columns</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">address</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(150)</span>
      <span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
      <span class="l-Scalar-Plain">unique</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<div class="section" id="valid-or-not-valid">
<h3>Valid or Not Valid<a class="headerlink" href="#valid-or-not-valid" title="Permalink to this headline">¶</a></h3>
<p>Now that you know how to specify your business rules in your models, it
is time to look at how to deal with these rules in the rest of your
application.</p>
<div class="section" id="implicit-validation">
<h4>Implicit Validation<a class="headerlink" href="#implicit-validation" title="Permalink to this headline">¶</a></h4>
<p>Whenever a record is going to be saved to the persistent data store (i.e.
through calling <a href="#id233"><span class="problematic" id="id234">:php:meth:`$record-&gt;save`</span></a>) the full validation procedure is
executed. If errors occur during that process an exception of the type
<a href="#id235"><span class="problematic" id="id236">:php:exc:`Doctrine_Validator_Exception`</span></a> will be thrown. You can catch that
exception and analyze the errors by using the instance method
<a href="#id237"><span class="problematic" id="id238">:php:meth:`Doctrine_Validator_Exception::getInvalidRecords`</span></a>. This method
returns an ordinary array with references to all records that did not pass
validation. You can then further explore the errors of each record by analyzing
the error stack of each record. The error stack of a record can be obtained
with the instance method <a href="#id239"><span class="problematic" id="id240">:php:meth:`Doctrine_Record::getErrorStack`</span></a>. Each error
stack is an instance of the class <tt class="docutils literal"><span class="pre">Doctrine_Validator_ErrorStack</span></tt>. The error
stack provides an easy to use interface to inspect the errors.</p>
</div>
<div class="section" id="explicit-validation">
<h4>Explicit Validation<a class="headerlink" href="#explicit-validation" title="Permalink to this headline">¶</a></h4>
<p>You can explicitly trigger the validation for any record at any time.
For this purpose <a href="#id241"><span class="problematic" id="id242">:php:class:`Doctrine_Record`</span></a> provides the instance method
<a href="#id243"><span class="problematic" id="id244">:php:meth:`Doctrine_Record::isValid`</span></a>. This method returns a boolean value
indicating the result of the validation. If the method returns false,
you can inspect the error stack in the same way as seen above except
that no exception is thrown, so you simply obtain the error stack of the
record that didnt pass validation through
<a href="#id245"><span class="problematic" id="id246">:php:meth:`Doctrine_Record::getErrorStack`</span></a>.</p>
<p>The following code snippet shows an example of handling implicit
validation which caused a <a href="#id247"><span class="problematic" id="id248">:php:exc:`Doctrine_Validator_Exception`</span></a>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="o">-&gt;</span><span class="na">address</span> <span class="o">=</span> <span class="s2">&quot;drink@@notvalid..&quot;</span><span class="p">;</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Doctrine_Validator_Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$userErrors</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getErrorStack</span><span class="p">();</span>
    <span class="nv">$emailErrors</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">Email</span><span class="o">-&gt;</span><span class="na">getErrorStack</span><span class="p">();</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$userErrors</span> <span class="k">as</span> <span class="nv">$fieldName</span> <span class="o">=&gt;</span> <span class="nv">$errorCodes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$fieldName</span> <span class="o">.</span> <span class="s2">&quot; - &quot;</span> <span class="o">.</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$errorCodes</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$emailErrors</span> <span class="k">as</span> <span class="nv">$fieldName</span> <span class="o">=&gt;</span> <span class="nv">$errorCodes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$fieldName</span> <span class="o">.</span> <span class="s2">&quot; - &quot;</span> <span class="o">.</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$errorCodes</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You could also use <a href="#id249"><span class="problematic" id="id250">:php:meth:`$e-&gt;getInvalidRecords`</span></a>. The direct
way used above is just more simple when you know the records you&#8217;re
dealing with.</p>
</div>
<p>You can also retrieve the error stack as a nicely formatted string for
easy use in your applications:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getErrorStackAsString</span><span class="p">();</span>
</pre></div>
</div>
<p>It would output an error string that looks something like the following:</p>
<div class="highlight-text"><div class="highlight"><pre>Validation failed in class User

1 field had validation error:

* 1 validator failed on username (length)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="profiler">
<h2>Profiler<a class="headerlink" href="#profiler" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">Doctrine_Connection_Profiler</span></tt> is an event listener for
<a href="#id251"><span class="problematic" id="id252">:php:class:`Doctrine_Connection`</span></a>. It provides flexible query profiling. Besides
the SQL strings the query profiles include elapsed time to run the queries.
This allows inspection of the queries that have been performed without the need
for adding extra debugging code to model classes.</p>
<p><tt class="docutils literal"><span class="pre">Doctrine_Connection_Profiler</span></tt> can be enabled by adding it as an event
listener for Doctrine_Connection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$profiler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine_Connection_Profiler</span><span class="p">();</span>

<span class="nv">$conn</span> <span class="o">=</span> <span class="nx">Doctrine_Manager</span><span class="o">::</span><span class="na">connection</span><span class="p">();</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">setListener</span><span class="p">(</span><span class="nv">$profiler</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<p>Perhaps some of your pages is loading slowly. The following shows how to
build a complete profiler report from the connection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$profiler</span> <span class="k">as</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$time</span> <span class="o">+=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getElapsedSecs</span><span class="p">();</span>

    <span class="nb">printf</span><span class="p">(</span>
        <span class="s2">&quot;%s %f</span><span class="se">\n</span><span class="s2">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">(),</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getElapsedSecs</span><span class="p">(),</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">()</span>
    <span class="p">);</span>

    <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$params</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">print_r</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="s2">&quot;Total time: &quot;</span> <span class="o">.</span> <span class="nv">$time</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Frameworks like <a class="reference external" href="http://www.symfony-project.com">symfony</a>, <a class="reference external" href="http://framework.zend.com">Zend</a>, etc. offer web debug toolbars that use this
functionality provided by Doctrine for reporting the number of queries
executed on every page as well as the time it takes for each query.</p>
</div>
</div>
</div>
<div class="section" id="locking-manager">
<h2>Locking Manager<a class="headerlink" href="#locking-manager" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The term &#8216;Transaction&#8217; does not refer to database transactions here but to
the general meaning of this term.</p>
</div>
<p>Locking is a mechanism to control concurrency. The two most well known locking
strategies are optimistic and pessimistic locking. The following is a short
description of these two strategies from which only pessimistic locking is
currently supported by Doctrine.</p>
<div class="section" id="optimistic-locking">
<h3>Optimistic Locking<a class="headerlink" href="#optimistic-locking" title="Permalink to this headline">¶</a></h3>
<p>The state/version of the object(s) is noted when the transaction begins.  When
the transaction finishes the noted state/version of the participating objects
is compared to the current state/version. When the states/versions differ the
objects have been modified by another transaction and the current transaction
should fail. This approach is called &#8216;optimistic&#8217; because it is assumed that it
is unlikely that several users will participate in transactions on the same
objects at the same time.</p>
</div>
<div class="section" id="pessimistic-locking">
<h3>Pessimistic Locking<a class="headerlink" href="#pessimistic-locking" title="Permalink to this headline">¶</a></h3>
<p>The objects that need to participate in the transaction are locked at the
moment the user starts the transaction. No other user can start a transaction
that operates on these objects while the locks are active.  This ensures that
the user who starts the transaction can be sure that no one else modifies the
same objects until he has finished his work.</p>
<p>Doctrine&#8217;s pessimistic offline locking capabilities can be used to control
concurrency during actions or procedures that take several HTTP request and
response cycles and/or a lot of time to complete.</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>The following code snippet demonstrates the use of Doctrine&#8217;s pessimistic
offline locking capabilities.</p>
<p>At the page where the lock is requested get a locking manager instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$lockingManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine_Locking_Manager_Pessimistic</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Ensure that old locks which timed out are released before we
try to acquire our lock 300 seconds = 5 minutes timeout. This can be
done by using the <a href="#id253"><span class="problematic" id="id254">:php:meth:`releaseAgedLocks`</span></a> method:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$lockingManager</span><span class="o">-&gt;</span><span class="na">releaseAgedLocks</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
    <span class="nv">$gotLock</span> <span class="o">=</span> <span class="nv">$lockingManager</span><span class="o">-&gt;</span><span class="na">getLock</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="s1">&#39;jwage&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$gotLock</span><span class="p">){</span>
        <span class="k">echo</span> <span class="s2">&quot;Got lock!&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Sorry, someone else is currently working on this record&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Doctrine_Locking_Exception</span> <span class="nv">$dle</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$dle</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span> <span class="c1">// handle the error</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>At the page where the transaction finishes get a locking manager
instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// test.php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nx">Doctrine_Core</span><span class="o">::</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nv">$lockingManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine_Locking_Manager_Pessimistic</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$lockingManager</span><span class="o">-&gt;</span><span class="na">releaseLock</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="s1">&#39;jwage&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Lock released&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Record was not locked. No locks released.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Doctrine_Locking_Exception</span> <span class="nv">$dle</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$dle</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span> <span class="c1">// handle the error</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="technical-details">
<h3>Technical Details<a class="headerlink" href="#technical-details" title="Permalink to this headline">¶</a></h3>
<p>The pessimistic offline locking manager stores the locks in the database
(therefore &#8216;offline&#8217;). The required locking table is automatically
created when you try to instantiate an instance of the manager and the
<tt class="docutils literal"><span class="pre">ATTR_CREATE_TABLES</span></tt> is set to TRUE. This behavior may change in the
future to provide a centralized and consistent table creation procedure
for installation purposes.</p>
</div>
</div>
<div class="section" id="views">
<span id="component-overview-views"></span><h2>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p>Database views can greatly increase the performance of complex queries.  You
can think of them as cached queries. <tt class="docutils literal"><span class="pre">Doctrine_View</span></tt> provides integration
between database views and DQL queries.</p>
<div class="section" id="using-views">
<h3>Using Views<a class="headerlink" href="#using-views" title="Permalink to this headline">¶</a></h3>
<p>Using views on your database using Doctrine is easy. We provide a nice
<tt class="docutils literal"><span class="pre">Doctrine_View</span></tt> class which provides functionality for creating,
dropping and executing views.</p>
<p>The <tt class="docutils literal"><span class="pre">Doctrine_View</span></tt> class integrates with the <a href="#id255"><span class="problematic" id="id256">:php:class:`Doctrine_Query`</span></a>
class by saving the SQL that would be executed by <a href="#id257"><span class="problematic" id="id258">:php:class:`Doctrine_Query`</span></a>.</p>
<p>First lets create a new <a href="#id259"><span class="problematic" id="id260">:php:class:`Doctrine_Query`</span></a> instance to work with:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$q</span> <span class="o">=</span> <span class="nx">Doctrine_Query</span><span class="o">::</span><span class="na">create</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.Phonenumber p&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
<p>Now lets create the <tt class="docutils literal"><span class="pre">Doctrine_View</span></tt> instance and pass it the
<a href="#id261"><span class="problematic" id="id262">:php:class:`Doctrine_Query`</span></a> instance as well as a <tt class="docutils literal"><span class="pre">name</span></tt> for identifying that
database view:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Doctrine_View</span><span class="p">(</span><span class="nv">$q</span><span class="p">,</span> <span class="s1">&#39;RetrieveUsersAndPhonenumbers&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now we can easily create the view by using the
<a href="#id263"><span class="problematic" id="id264">:php:meth:`Doctrine_View::create`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Alternatively if you want to drop the database view you use the
<a href="#id265"><span class="problematic" id="id266">:php:meth:`Doctrine_View::drop`</span></a> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">drop</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using views are extremely easy. Just use the
<a href="#id267"><span class="problematic" id="id268">:php:meth:`Doctrine_View::execute`</span></a> for executing the view and returning the
results just as a normal <a href="#id269"><span class="problematic" id="id270">:php:class:`Doctrine_Query`</span></a> object would:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$users</span> <span class="o">=</span> <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$us</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>We now have been exposed to a very large percentage of the core
functionality provided by Doctrine. The next chapters of this book are
documentation that cover some of the optional functionality that can
help make your life easier on a day to day basis.</p>
<p>Lets move on to the <a class="reference internal" href="native-sql.html"><em>next chapter</em></a> where we can learn
about how to use native SQL to hydrate our data in to arrays and objects
instead of the Doctrine Query Language.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Component Overview</a><ul>
<li><a class="reference internal" href="#manager">Manager</a><ul>
<li><a class="reference internal" href="#retrieving-connections">Retrieving Connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#connection">Connection</a><ul>
<li><a class="reference internal" href="#available-drivers">Available Drivers</a></li>
<li><a class="reference internal" href="#creating-connections">Creating Connections</a></li>
<li><a class="reference internal" href="#flushing-the-connection">Flushing the Connection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#table">Table</a><ul>
<li><a class="reference internal" href="#getting-a-table-object">Getting a Table Object</a></li>
<li><a class="reference internal" href="#getting-column-information">Getting Column Information</a></li>
<li><a class="reference internal" href="#getting-relation-information">Getting Relation Information</a></li>
<li><a class="reference internal" href="#finder-methods">Finder Methods</a><ul>
<li><a class="reference internal" href="#custom-table-classes">Custom Table Classes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-finders">Custom Finders</a></li>
</ul>
</li>
<li><a class="reference internal" href="#record">Record</a><ul>
<li><a class="reference internal" href="#properties">Properties</a></li>
<li><a class="reference internal" href="#updating-records">Updating Records</a></li>
<li><a class="reference internal" href="#replacing-records">Replacing Records</a></li>
<li><a class="reference internal" href="#refreshing-records">Refreshing Records</a></li>
<li><a class="reference internal" href="#refreshing-relationships">Refreshing relationships</a></li>
<li><a class="reference internal" href="#deleting-records">Deleting Records</a></li>
<li><a class="reference internal" href="#using-expression-values">Using Expression Values</a></li>
<li><a class="reference internal" href="#getting-record-state">Getting Record State</a></li>
<li><a class="reference internal" href="#getting-object-copy">Getting Object Copy</a></li>
<li><a class="reference internal" href="#saving-a-blank-record">Saving a Blank Record</a></li>
<li><a class="reference internal" href="#mapping-custom-values">Mapping Custom Values</a></li>
<li><a class="reference internal" href="#serializing">Serializing</a></li>
<li><a class="reference internal" href="#checking-existence">Checking Existence</a></li>
<li><a class="reference internal" href="#function-callbacks-for-columns">Function Callbacks for Columns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collection">Collection</a><ul>
<li><a class="reference internal" href="#accessing-elements">Accessing Elements</a></li>
<li><a class="reference internal" href="#adding-new-elements">Adding new Elements</a></li>
<li><a class="reference internal" href="#getting-collection-count">Getting Collection Count</a></li>
<li><a class="reference internal" href="#saving-the-collection">Saving the Collection</a></li>
<li><a class="reference internal" href="#deleting-the-collection">Deleting the Collection</a></li>
<li><a class="reference internal" href="#key-mapping">Key Mapping</a></li>
<li><a class="reference internal" href="#loading-related-records">Loading Related Records</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validator">Validator</a><ul>
<li><a class="reference internal" href="#more-validation">More Validation</a></li>
<li><a class="reference internal" href="#valid-or-not-valid">Valid or Not Valid</a><ul>
<li><a class="reference internal" href="#implicit-validation">Implicit Validation</a></li>
<li><a class="reference internal" href="#explicit-validation">Explicit Validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#profiler">Profiler</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#locking-manager">Locking Manager</a><ul>
<li><a class="reference internal" href="#optimistic-locking">Optimistic Locking</a></li>
<li><a class="reference internal" href="#pessimistic-locking">Pessimistic Locking</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#technical-details">Technical Details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#views">Views</a><ul>
<li><a class="reference internal" href="#using-views">Using Views</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dql-doctrine-query-language.html"
                        title="previous chapter">DQL: Doctrine Query Language</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="native-sql.html"
                        title="next chapter">Native SQL</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/en/manual/component-overview.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="native-sql.html" title="Native SQL"
             >next</a> |</li>
        <li class="right" >
          <a href="dql-doctrine-query-language.html" title="DQL: Doctrine Query Language"
             >previous</a> |</li>
        <li><a href="../../index.html">Doctrine 1.2.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >English Documentation</a> &raquo;</li>
          <li><a href="index.html" >Doctrine 1.2 ORM Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jonathan Wage and Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>