
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">

  <title>Git Magic - Capítulo 8. Segredos Revelados</title>
  <link rel="stylesheet" type="text/css" href="default.css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.76.1">
  <link rel="home" href="index.html" title="Magia Git">
  <link rel="up" href="index.html" title="Magia Git">
  <link rel="prev" href="ch07.html" title=
  "Capítulo 7. Grão-Mestre Git">
  <link rel="next" href="ch09.html" title=
  "Capítulo 9. Apêndice A: Deficiências do Git">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
    <div class="toc">
      <ul>
<li><b>Git Magic</b></li>
        <li>
          <span class="preface"><a href=
          "index.html">Prefácio</a></span>

          <ul>
            <li><span class="section"><a href=
            "index.html#_agradecimentos">Agradecimentos!</a></span></li>

            <li><span class="section"><a href=
            "index.html#_licen%C3%A7a">Licença</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch01.html">1.
          Introdução</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch01.html#_trabalhar_%C3%A9_divertido">Trabalhar é
            Divertido</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_controle_de_vers%C3%B5es">Controle de
            Versões</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_controle_distribu%C3%ADdo">Controle
            distribuído</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_uma_supersti%C3%A7%C3%A3o">Uma
            superstição</a></span></li>

            <li><span class="section"><a href=
            "ch01.html#_conflitos_de_mesclagem_merge">Conflitos de
            mesclagem (Merge)</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch02.html">2. Truques
          básicos</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch02.html#_salvando_estados">Salvando
            estados</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_adicionar_remover_renomear">Adicionar,
            Remover, Renomear</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_desfazer_refazer_avan%C3%A7ado">Desfazer/Refazer
            avançado</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_revertendo">Revertendo</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_gera%C3%A7%C3%A3o_do_changelog">Geração do
            Changelog</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_download_de_arquivos">Download de
            arquivos</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_a_%C3%BAltima_vers%C3%A3o">A Última
            Versão</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_publica%C3%A7%C3%A3o_instant%C3%A2nea">Publicação
            instantânea</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_o_que_eu_fiz">O que eu fiz?</a></span></li>

            <li><span class="section"><a href=
            "ch02.html#_exerc%C3%ADcios">Exercícios</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch03.html">3. Um pouco de
          clonagem</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch03.html#_sincronizando_computadores">Sincronizando
            Computadores</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_controle_cl%C3%A1ssico_de_c%C3%B3digo">Controle
            clássico de código</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_codigo_fonte_secreto">Codigo-fonte
            secreto</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_repositorios_vazios">Repositorios
            Vazios</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_push_versus_pull">Push versus
            Pull</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_fazendo_um_fork_do_projeto">Fazendo um Fork
            do Projeto</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_backup_supremos">Backup
            Supremos</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_multitarefa_na_velocidade_da_luz">Multitarefa
            na velocidade da luz</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_controle_de_vers%C3%B5es_de_guerrilha">Controle
            de Versões de Guerrilha</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_mercurial">Mercurial</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_bazaar">Bazaar</a></span></li>

            <li><span class="section"><a href=
            "ch03.html#_por_que_uso_o_git">Por que uso o
            Git?</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch04.html">4. Bruxarias
          com branch</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch04.html#_a_tecla_chefe">A “tecla”
            chefe</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_trabalho_porco">Trabalho
            porco</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_corre%C3%A7%C3%B5es_r%C3%A1pidas">Correções
            rápidas</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_merging">Merging</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_fluxo_ininterrupto">Fluxo
            ininterrupto</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_reorganizando_uma_bagun%C3%A7a">Reorganizando
            uma Bagunça</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_gerenciando_os_branches">Gerenciando os
            Branches</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_branches_tempor%C3%A1rios">Branches
            Temporários</a></span></li>

            <li><span class="section"><a href=
            "ch04.html#_trabalhe_como_quiser">Trabalhe como
            quiser</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch05.html">5. Lições de
          historia</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch05.html#_eu_corrijo">Eu corrijo</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_8230_e_tem_mais">… e tem
            mais</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_altera%C3%A7%C3%B5es_locais_por_%C3%BAltimo">
            Alterações locais por último</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_reescrevendo_o_hist%C3%B3rico">Reescrevendo
            o histórico</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_fazendo_hist%C3%B3ria">Fazendo
            história</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_onde_foi_que_tudo_deu_errado">Onde foi que
            tudo deu errado?</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_quem_fez_tudo_dar_errado">Quem fez tudo dar
            errado?</a></span></li>

            <li><span class="section"><a href=
            "ch05.html#_experi%C3%AAncia_pessoal">Experiência
            pessoal</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch06.html">6. Git
          Multiplayer</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch06.html#_quem_sou_eu">Quem sou eu?</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_sob_ssh_http">Git sob SSH,
            HTTP</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_git_sobre_qualquer_coisa">Git sobre
            qualquer coisa</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_patches_a_moeda_universal">Patches: A moeda
            Universal</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_sinto_muito_mas_mudamos">Sinto muito, mas
            mudamos</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_branches_remotos">Branches
            Remotos</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_remotos_m%C3%BAltiplos">Remotos
            Múltiplos</a></span></li>

            <li><span class="section"><a href=
            "ch06.html#_minhas_preferencias">Minhas
            preferencias</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch07.html">7. Grão-Mestre
          Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch07.html#_disponibiliza%C3%A7%C3%A3o_de_c%C3%B3digo">Disponibilização
            de Código</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_commit_do_que_mudou">Commit do que
            Mudou</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_meu_commit_%C3%A9_muito_grande">Meu Commit
            é muito Grande!</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_o_indice_a_%C3%A1rea_de_atua%C3%A7%C3%A3o_do_git">
            O Indice: A Área de Atuação do Git</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_n%C3%A3o_perca_a_cabe%C3%A7a_head">Não
            perca a CABEÇA (HEAD)</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_explorando_o_head">Explorando o
            HEAD</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_baseando_se_no_git">Baseando se no
            Git</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_manobras_radicais">Manobras
            Radicais</a></span></li>

            <li><span class="section"><a href=
            "ch07.html#_preven%C3%A7%C3%A3o_a_maus_commits">Prevenção
            a maus Commits</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch08.html">8. Segredos
          Revelados</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch08.html#_invisibilidade">Invisibilidade</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_integridade">Integridade</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_intelig%C3%AAncia">Inteligência</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_indexando">Indexando</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_origem_do_git">Origem do
            Git</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_o_banco_de_dados_de_objetos">O Banco de
            Dados de Objetos</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_blobs">Blobs</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_%C3%A1rvores">Árvores</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_commits">Commits</a></span></li>

            <li><span class="section"><a href=
            "ch08.html#_indistingu%C3%ADvel_da_magia">Indistinguível
            da Magia</a></span></li>
          </ul>
        </li>

        <li>
          <span class="chapter"><a href="ch09.html">9. Apêndice A:
          Deficiências do Git</a></span>

          <ul>
            <li><span class="section"><a href=
            "ch09.html#_pontos_fracos_do_sha1">Pontos fracos do
            SHA1</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_microsoft_windows">Microsoft
            Windows</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_arquivos_independentes">Arquivos
            Independentes</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_quem_est%C3%A1_editando_o_que">Quem Está
            Editando O Que?</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_arquivo_do_hist%C3%B3rico">Arquivo do
            Histórico</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_clone_inicial">Clone
            Inicial</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_projetos_vol%C3%A1teis">Projetos
            Voláteis</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_contador_global">Contador
            Global</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_subdiret%C3%B3rios_vazios">Subdiretórios
            Vazios</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_commit_inicial">Commit
            Inicial</a></span></li>

            <li><span class="section"><a href=
            "ch09.html#_peculiaridades_da_interface">Peculiaridades
            da Interface</a></span></li>
          </ul>
        </li>

        <li><span class="chapter"><a href="ch10.html">10. Apendice
        B: Traduzindo esse guia</a></span></li>
      </ul>
    </div>
<div class="content">
  <div class="chapter" title="Capítulo 8. Segredos Revelados">
    <div class="titlepage">
      <div>
        <div>
          <h2 class="title"><a name=
          "_segredos_revelados"></a>Capítulo 8. Segredos
          Revelados</h2>
        </div>
      </div>
    </div>

    <p>Vamos dar uma espiada sob o capô e explicar como o Git
    realiza seus milagres. Será uma explicação superficial. Para
    detalhes mais aprofundados consultar o <a class="ulink" href=
    "http://schacon.github.com/git/user-manual.html" target=
    "_top">manual do usuário</a>.</p>

    <div class="section" title="Invisibilidade">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_invisibilidade"></a>Invisibilidade</h2>
          </div>
        </div>
      </div>

      <p>Como pode o Git ser tão discreto? Fora ocasionais commit e
      merge, você pode trabalhar como se desconhecesse que existe
      um controle de versões. Isto é, até que precise dele, e é
      quando você ficará agradecido ao Git por estar vigiando o que
      faz o tempo todo.</p>

      <p>Outros sistemas de controle de versões não deixam você
      esquecê-los. As permissões dos arquivos são apenas de
      leitura, a menos que você diga ao servidor quais arquivos tem
      a intenção de editar. Os comandos mais básicos podem demorar
      muito quando o número de usuários aumenta. O trabalho pode
      ser interrompido quando a rede ou o servidor central
      para.</p>

      <p>Ao contrário, o Git guarda o histórico do seu projeto no
      diretório <code class="literal">.git</code> no diretório de
      trabalho. Essa é a sua cópia do histórico, de modo que você
      pode ficar offline até que deseje se comunicar com os outros.
      Você tem total controle sobre o destino de seus arquivos,
      pois o Git pode facilmente recriar um estado salvo a partir
      do <code class="literal">.git</code> a qualquer hora.</p>
    </div>

    <div class="section" title="Integridade">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_integridade"></a>Integridade</h2>
          </div>
        </div>
      </div>

      <p>A maioria das pessoas associam criptografia com manter
      informações secretas, mas outra aplicação igualmente
      importante é manter a integridade da informação. O uso
      correto das funções criptográficas de hash pode prevenir o
      corrupção acidental ou intencional dos dados.</p>

      <p>Um hash SHA1 pode ser entendido como um número
      identificador único de 160 bits para cada sequência de bytes
      que você vai encontrar na vida. Na verdade mais que isso:
      para cada sequência de bytes que qualquer ser humano jamais
      usará durante várias vidas.</p>

      <p>Como um hash SHA1 é, ele mesmo, uma sequência de bytes,
      podemos gerar um hash de sequências de bytes formada por
      outros hash. Essa observação simples é surpreendentemente
      útil: a procura por <span class="emphasis"><em>cadeias
      hash</em></span> (<span class="emphasis"><em>hash
      chains</em></span>). Vamos ver mais adiante como o Git a
      utiliza para garantir com eficiência a integridade de
      dados.</p>

      <p>A grosso modo, o Git mantém os seus arquivos no
      subdiretório <code class="literal">.git/objects</code>, onde
      ao invés de ter arquivos com nomes “normais”, vamos encontrar
      somente identificadores (Ids). Utilizando os Ids como nomes
      de arquivos, bem como uns poucos lockfiles e alguns truques
      com o timestamp, o Git transforma qualquer sistema de
      arquivos simples em um poderoso banco de dados.</p>
    </div>

    <div class="section" title="Inteligência">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_intelig%C3%AAncia"></a>Inteligência</h2>
          </div>
        </div>
      </div>

      <p>Como o Git sabe que um arquivo foi renomeado, mesmo que
      você nunca tenha mencionado o fato explicitamente? Com
      certeza, você executou <span class="strong"><strong>git
      mv</strong></span>, mas isto é exatamente o mesmo que um
      <span class="strong"><strong>git rm</strong></span> seguido
      por um <span class="strong"><strong>git
      add</strong></span>.</p>

      <p>A análise heurística do Git verifica além das ações de
      renomear e de cópias sucessivas entre versões. De fato, ele
      pode detectar até pedaços de código sendo movidos ou copiados
      entre arquivos! Embora não cubra todos os casos, faz um
      trabalho decente, e esta característica está sendo sempre
      aprimorada. Caso não funcione com você, tente habilitar
      opções mais refinadas para detecção de cópias e considere uma
      atualização.</p>
    </div>

    <div class="section" title="Indexando">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_indexando"></a>Indexando</h2>
          </div>
        </div>
      </div>

      <p>Para cada arquivo monitorado, o Git armazena informações
      como: tamanho, hora de criação e última modificação, em um
      arquivo conhecido como <span class=
      "emphasis"><em>index</em></span>. Para determinar se um
      arquivo foi modificado, o Git compara seus status atual com o
      que tem no index. Se coincidem, então ele pode ignorar o
      arquivo.</p>

      <p>Já que verificações de status são imensamente mais baratas
      que ler o conteúdo do arquivo, se você editar poucos
      arquivos, o Git vai atualizar seus status quase que
      instantaneamente.</p>

      <p>Falamos anteriormente que o index é uma área de atuação
      (staging). Por que um monte de status de arquivos é uma area
      de atuação (staging)? É porque o comando add coloca os
      arquivos no banco de dados do Git e atualiza esse status,
      enquanto o comando commit, sem opções, cria um commit baseado
      somente no status e arquivos já existentes no banco de
      dados.</p>
    </div>

    <div class="section" title="Origem do Git">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_origem_do_git"></a>Origem
            do Git</h2>
          </div>
        </div>
      </div>

      <p>Esta <a class="ulink" href=
      "http://lkml.org/lkml/2005/4/6/121" target="_top">mensagem na
      lista de discussão do Linux Kernel</a> descreve a sequência
      de eventos que levaram ao Git. A discussão inteira é um sitio
      arqueológico fascinante para historiadores do Git.</p>
    </div>

    <div class="section" title="O Banco de Dados de Objetos">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_o_banco_de_dados_de_objetos"></a>O Banco de Dados de
            Objetos</h2>
          </div>
        </div>
      </div>

      <p>Cada versão de seus dados é mantida em um <span class=
      "emphasis"><em>bando de dados de objetos</em></span>, que
      reside no subdiretório <code class=
      "literal">.git/objects</code>: os outros residentes de
      <code class="literal">.git/</code> armazenam menos dados: o
      index, nomes dos branchs, etiquetas (tags), configurações de
      opções, logs, a localização do commit HEAD, e outros. O bando
      de dados objeto é elementar e elegante, e a origem do poder
      do Git.</p>

      <p>Cada arquivo dentro de <code class=
      "literal">.git/objects</code> é um <span class=
      "emphasis"><em>objeto</em></span>. Existem 3 tipos de objetos
      que nos interessam: objetos <span class=
      "emphasis"><em>blob</em></span>, objetos <span class=
      "emphasis"><em>árvores</em></span> (<span class=
      "emphasis"><em>tree</em></span>), e objetos <span class=
      "emphasis"><em>commit</em></span>.</p>
    </div>

    <div class="section" title="Blobs">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_blobs"></a>Blobs</h2>
          </div>
        </div>
      </div>

      <p>Primeiro, um truque mágico. Peque um nome de arquivo,
      qualquer arquivo. Em um diretório vazio, execute</p>
      <pre class="literallayout">
$ echo sweet &gt; YOUR_FILENAME
$ git init
$ git add .
$ find .git/objects -type f
</pre>

      <p>Voce verá <code class=
      "literal">.git/objects/aa/823728ea7d592acc69b36875a482cdf3fd5c8d</code>.</p>

      <p>Como eu posso saber disso, sem saber o nome do arquivo? É
      por que o hash SHA1 de:</p>
      <pre class="literallayout">
"blob" SP "6" NUL "sweet" LF
</pre>

      <p>é aa823728ea7d592acc69b36875a482cdf3fd5c8d, onde SP é
      espaço, NUL é o byte zero e LF é um linefeed. Você pode
      verificar isso, digitando:</p>
      <pre class="literallayout">
$ printf "blob 6\000sweet\n" | sha1sum
</pre>

      <p>O Git é <span class=
      "emphasis"><em>endereçável-por-conteúdo</em></span>: os
      arquivos não são armazenados de acordo com seus nomes de
      arquivos, e sim pelo hash de seus dados, em um arquivo que
      chamamos de <span class="emphasis"><em>objeto
      blob</em></span> (<span class="emphasis"><em>blob
      object</em></span>). Podemos pensar que o hash é um
      identificador único para o conteúdo do arquivo, de modo que
      estamos endereçando os arquivos pelo seu conteúdo. O
      <code class="literal">blob 6</code> inicial é meramente um
      header que consiste do tipo do objeto e seu tamanho em bytes;
      isso simplifica a organização interna.</p>

      <p>Assim eu poderia prever o que você irá ver. O nome do
      arquivo é irrelevante: somente os dados internos são
      utilizados para construir o objeto blob.</p>

      <p>Você pode estar se perguntando o que acontece com os
      arquivos idênticos. Tente adicionar cópias de seu arquivo,
      com qualquer nome de arquivo. O conteúdo do <code class=
      "literal">.git/objects</code> continua o mesmo não importa
      quantos você adiciona. O Git somente armazena o dado uma
      única vez.</p>

      <p>A propósito, os arquivos dentro de <code class=
      "literal">.git/objects</code> são comprimidos com a zlib de
      modo que você não consegue examiná-los diretamente. Faça uma
      filtragem por meio do <a class="ulink" href=
      "http://www.zlib.net/zpipe.c" target="_top">zpipe -d</a>, ou
      digite:</p>
      <pre class="literallayout">
$ git cat-file -p aa823728ea7d592acc69b36875a482cdf3fd5c8d
</pre>

      <p>que mostra o objeto em um formato legível.</p>
    </div>

    <div class="section" title="Árvores">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_%C3%A1rvores"></a>Árvores</h2>
          </div>
        </div>
      </div>

      <p>Mas onde estão os nomes de arquivos? Eles precisam ser
      armazenados em algum lugar. Git fica sabendo o nome do
      arquivo durante um commit:</p>
      <pre class="literallayout">
$ git commit  # Type some message.
$ find .git/objects -type f
</pre>

      <p>Você pode ver agora 3 objetos. Dessa vez eu não consigo
      dizer quais os dois nomes de arquivos, já que eles dependem
      parcialmente do nome do arquivo que você escolheu. Vamos
      prosseguir assumindo que você escolheu “rose”. Se não
      escolheu esse nome, você pode reescrever o histórico para
      ficar parecido com o que você fez:</p>
      <pre class="literallayout">
$ git filter-branch --tree-filter 'mv YOUR_FILENAME rose'
$ find .git/objects -type f
</pre>

      <p>Agora você poderá ver o arquivo <code class=
      "literal">.git/objects/05/b217bb859794d08bb9e4f7f04cbda4b207fbe9</code>,
      porque esse é o hash SHA 1 de seu conteudo:</p>
      <pre class="literallayout">
"tree" SP "32" NUL "100644 rose" NUL 0xaa823728ea7d592acc69b36875a482cdf3fd5c8d
</pre>

      <p>Verifique que este arquivo contém efetivamente o que
      falamos acima, digitando:</p>
      <pre class="literallayout">
$ echo 05b217bb859794d08bb9e4f7f04cbda4b207fbe9 | git cat-file --batch
</pre>

      <p>Com o zpipe, é fácil verificar o hash:</p>
      <pre class="literallayout">
$ zpipe -d &lt; .git/objects/05/b217bb859794d08bb9e4f7f04cbda4b207fbe9 | sha1sum
</pre>

      <p>A verificação do hash é mais complicada via cat-file
      porque sua saida contem mais do que os dados descomprimidos
      do arquivo object.</p>

      <p>Esse arquivo é um objeto <span class=
      "emphasis"><em>árvore</em></span> (<span class=
      "emphasis"><em>tree</em></span>): uma lista de tuplas que
      consiste em um tipo de arquivo, um nome de arquivo e um hash.
      Em nosso exemplo, este tipo de arquivo é 100644, que
      significa que ‘rose` é um arquivo normal, e o hash é o objeto
      blob que contém o termo `rose’. Outros tipos possíveis de
      arquivos são executáveis, symlinks e diretorios. No ultimo
      exemplo, o hash aponta para um objeto árvore.</p>

      <p>Se você executar o filter-branch, você obterá objetos
      antigos que não precisa mais. Embora sejam eliminados
      automaticamente quando o período de armazenamento expirar,
      iremos deletá-los agora para tornar o nosso exemplo mais
      fácil de seguir:</p>
      <pre class="literallayout">
$ rm -r .git/refs/original
$ git reflog expire --expire=now --all
$ git prune
</pre>

      <p>Para projetos reais você deve tipicamente evitar comandos
      como esses, já que eles destroem os backups. Se você deseja
      um repositório limpo, é geralmente melhor criar um novo
      clone. Também, tome cuidado quando manipular diretamente o
      <code class="literal">.git</code>: e se um comando Git esta
      executando ao mesmo tempo, ou uma falha na alimentação
      eletrica ocorre? Geralmente, as referências podem ser
      deletadas com <span class="strong"><strong>git update-ref
      -d</strong></span>, embora seja mais seguro remover
      manualmente o <code class="literal">refs/original</code>.</p>
    </div>

    <div class="section" title="Commits">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="_commits"></a>Commits</h2>
          </div>
        </div>
      </div>

      <p>Explicamos 2 dos 3 objetos. O terceiro é o objeto
      <span class="emphasis"><em>commit</em></span>. Seu conteúdo
      depende da mensagem de commit bem como da data e hora em que
      foi criado. Para combinar com o que temos aqui, vamos ter que
      fazer um pequeno truque:</p>
      <pre class="literallayout">
$ git commit --amend -m Shakespeare  # Change the commit message.
$ git filter-branch --env-filter 'export
    GIT_AUTHOR_DATE="Fri 13 Feb 2009 15:31:30 -0800"
    GIT_AUTHOR_NAME="Alice"
    GIT_AUTHOR_EMAIL="alice@example.com"
    GIT_COMMITTER_DATE="Fri, 13 Feb 2009 15:31:30 -0800"
    GIT_COMMITTER_NAME="Bob"
    GIT_COMMITTER_EMAIL="bob@example.com"'  # Rig timestamps and authors.
$ find .git/objects -type f
</pre>

      <p>Agora você pode ver <code class=
      "literal">.git/objects/49/993fe130c4b3bf24857a15d7969c396b7bc187</code>
      que é o hash SHA 1 de seu conteúdo:</p>
      <pre class="literallayout">
"commit 158" NUL
"tree 05b217bb859794d08bb9e4f7f04cbda4b207fbe9" LF
"author Alice &lt;alice@example.com&gt; 1234567890 -0800" LF
"committer Bob &lt;bob@example.com&gt; 1234567890 -0800" LF
LF
"Shakespeare" LF
</pre>

      <p>Como anteriormente, você pode executar o zpipe ou cat-file
      para ver você mesmo.</p>

      <p>Esse é o primeiro commit, de modo que não existe nenhum
      commit pai, mas commit posteriores irão sempre conter no
      mínimo uma linha identificando o seu commit pai.</p>
    </div>

    <div class="section" title="Indistinguível da Magia">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name=
            "_indistingu%C3%ADvel_da_magia"></a>Indistinguível da
            Magia</h2>
          </div>
        </div>
      </div>

      <p>O segredo do Git parece ser tão simples. Parece que você
      pode misturar um pouco de script shell e adicionar uma pitada
      de código C para cozinha-lo em questão de horas: uma mistura
      de operações básicas do sistema de arquivos e hash SHA 1,
      guarnecido com arquivos lock e fsyncs para robustez. De fato,
      isso descreve acuradamente as primeiras versões do Git. No
      entanto, além de truques engenhosos de empacotamento para
      economizar espaço, e truques engenhosos de indexação para
      economizar espaço, agora sabemos como o Git habilmente
      transforma um sistema de arquivos em um banco de dados
      perfeito para o controle de versões.</p>

      <p>Por exemplo, se algum arquivo dentro do banco de dados de
      objetos é corrompido por um erro de disco, então o seu hash
      não irá corresponder mais, alertando-nos sobre o problema.
      Fazendo hash de hash de outros objetos, mantemos a
      integridade em todos os níveis. Os commits são atomicos, isto
      é, um commit nunca pode armazenar parcialmente as mudanças:
      só podemos calcular o hash de um commit e armazenar ele no
      banco de dados após ter armazenado todas as árvores
      relevantes, blobs e os commits pais. O banco de dados de
      objetos é imune a interrupções inesperadas tais como falha de
      alimentação eletrica.</p>

      <p>Nós derrotamos até mesmo os adversários mais tortuosos.
      Suponha que alguem tente de maneira escondida, modificar o
      conteudo de um arquivo em uma versão antiga do projeto. Para
      manter o banco de dados dos objetos com uma aparência
      saudável, ele deve também alterar o hash do objeto blob
      correspondente, já que ele contem agora uma cadeia de bytes
      diferente. Isso significa que ele terá que alterar o hash de
      qualquer objeto árvore que referencia o arquivo, e em seguida
      alterar o hash de todos os objetos commit que estão
      envolvidos com esses objetos árvores, além dos hash de todos
      os descendentes desses commits. Isso significa que o hash do
      Head oficial será diferente do hash do repositório alterado.
      Seguindo a trilha dos hash não correspondentes podemos
      apontar o arquivo alterado, bem como o commit onde ele foi
      corrompido.</p>

      <p>Resumindo, graças aos 20 bytes que representam o ultimo
      commit seguro, é impossível adulterar um repositório Git.</p>

      <p>É sobre as famosas características do Git? Branching,
      Merging? Tags? Meros detalhes. O cabeçalho atual é mantido em
      um arquivo <code class="literal">.git/HEAD</code>, que contém
      um hash de um objeto commit. O hash é atualizado durante um
      commit bem como com muitos outros comandos. Branch são quase
      a mesma coisa: eles são arquivos em <code class=
      "literal">.git/refs/heads</code>. Tags também: elas estão em
      <code class="literal">.git/refs/tags</code> mas são
      atualizadas por um conjunto diferente de comandos.</p>
    </div>
  </div><script type="text/javascript" src="find_selflink.js">
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1901330-2");
  pageTracker._initData();
  pageTracker._trackPageview();
  </script>
</div>
</div><div class="footer"><a href="/~blynn/">Ben Lynn</a></div>
</body>
</html>

