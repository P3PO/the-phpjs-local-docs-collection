<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head><title>Production Notes &mdash; MongoDB Manual 2.4.3</title><link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index" />
  <meta name="release" content="2.4.3"/>
  <meta name="DC.Source" content="https://github.com/mongodb/docs/blob/master/source/administration/production-notes.txt"/>
      <link rel="canonical" href="http://docs.mongodb.org/manual/administration/production-notes" />
  
   <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
   <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      
   <script type="text/javascript">
     var DOCUMENTATION_OPTIONS = {
         URL_ROOT:    '../',
         VERSION:     '2.4',
         COLLAPSE_INDEX: false,
         FILE_SUFFIX: '.html',
         HAS_SOURCE:  false,
     };
   </script>
       <script type="text/javascript" src="../_static/jquery.js"></script>
       <script type="text/javascript" src="../_static/underscore.js"></script>
       <script type="text/javascript" src="../_static/doctools.js"></script>
          <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help"/>
<link rel="author" title="About these documents" href="../about.html" />
<link rel="top" title="MongoDB Manual" href="../index.html" />
<link rel="up" title="Administration" href="../administration.html" />
<link rel="next" title="Use Database Commands" href="../tutorial/use-database-commands.html" />
<link rel="prev" title="Linux ulimit Settings" href="../reference/ulimit.html" />
          <script>
            (function() {
               var cx = '017213726194841070573:WMX6838984';
               var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
               gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
               var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
            })();
          </script></head>
<body>
      <div id="header-db" class="spread">
        <div class="split">
          <div id="logo">
            <div><a href="http://www.mongodb.org/"><img class="logo" src="http://media.mongodb.org/logo-mongodb.png" alt="MongoDB Logo"/></a></div>
          </div>
        </div>
      </div>  
      <div class="document">
           <div class="documentwrapper"><div class="bodywrapper">
               <div class="body">
                 
    <div class="bc">
      <ul>
          <li><a href="../administration.html">Administration</a><span class="bcpoint"> > </span></li>
          <li>Production Notes</li> 
      </ul>
    </div>
                 <div id="cse-results">
                   <gcse:searchresults linkTarget="_top"></gcse:searchresults>
                 </div>
                 
  <div class="section" id="production-notes">
<h1>Production Notes<a class="headerlink" href="#production-notes" title="Permalink to this headline">¶</a></h1>
<p>This page details system configurations that affect MongoDB,
especially in production.</p>
<div class="section" id="backups">
<h2>Backups<a class="headerlink" href="#backups" title="Permalink to this headline">¶</a></h2>
<p>To make backups of your MongoDB database, please refer to
<a class="reference internal" href="../core/backups.html"><em>Backup Strategies for MongoDB Systems</em></a>.</p>
</div>
<div class="section" id="networking">
<h2>Networking<a class="headerlink" href="#networking" title="Permalink to this headline">¶</a></h2>
<p>Always run MongoDB in a <em>trusted environment</em>, with network rules that
prevent access from <em>all</em> unknown machines, systems, or networks. As
with any sensitive system dependent on network access, your MongoDB
deployment should only be accessible to specific systems that require
access: application servers, monitoring services, and other MongoDB
components.</p>
<p>See documents in the <a class="reference internal" href="../security.html"><em>Security</em></a> section for additional
information, specifically:</p>
<ul class="simple">
<li><a class="reference internal" href="../core/security.html#security-port-numbers"><em>Interfaces and Port Numbers</em></a></li>
<li><a class="reference internal" href="../core/security.html#security-firewalls"><em>Firewalls</em></a></li>
<li><a class="reference internal" href="../tutorial/configure-linux-iptables-firewall.html"><em>Configure Linux iptables Firewall for MongoDB</em></a></li>
<li><a class="reference internal" href="../tutorial/configure-windows-netsh-firewall.html"><em>Configure Windows netsh Firewall for MongoDB</em></a></li>
</ul>
<p>For Windows users, consider the <a class="reference external" href="http://technet.microsoft.com/en-us/library/dd349797.aspx">Windows Server Technet Article on TCP
Configuration</a>
when deploying MongoDB on Windows.</p>
</div>
<div class="section" id="mongodb-on-linux">
<h2>MongoDB on Linux<a class="headerlink" href="#mongodb-on-linux" title="Permalink to this headline">¶</a></h2>
<p>If you use the Linux kernel, the MongoDB user community has
recommended Linux kernel 2.6.36 or later for running MongoDB in
production.</p>
<p>Because MongoDB preallocates its database files before using them and
because MongoDB uses very large files on average, you should
use the Ext4 and XFS file systems if using the Linux kernel:</p>
<ul class="simple">
<li>If you use the Ext4 file system, use at least version 2.6.23 of the
Linux Kernel.</li>
<li>If you use the XFS file system, use at least version 2.6.25 of the
Linux Kernel.</li>
<li>If you are using a Red Hat derived distribution, use at least
version <tt class="docutils literal"><span class="pre">2.6.245.el5</span></tt> of the Linux Kernel.</li>
</ul>
<p>For MongoDB on Linux use the following recommended configurations:</p>
<ul class="simple">
<li>Turn off <tt class="docutils literal"><span class="pre">atime</span></tt> for the storage volume with the <a class="reference internal" href="../reference/glossary.html#term-dbpath"><em class="xref std std-term">database
files</em></a>.</li>
<li>Set the file descriptor limit and the user process limit above 20,000,
according to the suggestions in <a class="reference internal" href="../reference/ulimit.html"><em>Linux ulimit Settings</em></a>. A low
ulimit will affect MongoDB when under heavy use and will produce
weird errors.</li>
<li>Do not use <tt class="docutils literal"><span class="pre">hugepages</span></tt> virtual memory pages, MongoDB performs
better with normal virtual memory pages.</li>
<li>Disable NUMA in your BIOS. If that is not possible see <a class="reference internal" href="#production-numa"><em>NUMA</em></a>.</li>
<li>Ensure that readahead settings for the block devices that store the
database files are acceptable. See the <a class="reference internal" href="#production-readahead"><em>Readahead</em></a> section</li>
<li>Use NTP to synchronize time among your hosts. This is especially
important in sharded clusters.</li>
</ul>
</div>
<div class="section" id="readahead">
<span id="production-readahead"></span><h2>Readahead<a class="headerlink" href="#readahead" title="Permalink to this headline">¶</a></h2>
<p>For random access use patterns set readahead values low, for example
setting readahead to a small value such as 32 (16KB) often works well.</p>
</div>
<div class="section" id="mongodb-on-virtual-environments">
<span id="production-virtualization"></span><h2>MongoDB on Virtual Environments<a class="headerlink" href="#mongodb-on-virtual-environments" title="Permalink to this headline">¶</a></h2>
<p>The section describes considerations when running MongoDB in some of the
more common virtual environments.</p>
<div class="section" id="ec2">
<h3>EC2<a class="headerlink" href="#ec2" title="Permalink to this headline">¶</a></h3>
<p>MongoDB is compatible with EC2 and requires no configuration changes
specific to the environment.</p>
</div>
<div class="section" id="vmware">
<h3>VMWare<a class="headerlink" href="#vmware" title="Permalink to this headline">¶</a></h3>
<p>MongoDB is compatible with VMWare. Some in the MongoDB community have
run into issues with VMWare&#8217;s memory overcommit feature and suggest
disabling the feature.</p>
<p>You can clone a virtual machine running MongoDB. You might use this to
spin up a new virtual host that will be added as a member of a replica
set. If journaling is enabled, the clone snapshot will be consistent. If
not using journaling, stop <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>, clone, and then restart.</p>
</div>
<div class="section" id="openvz">
<h3>OpenVZ<a class="headerlink" href="#openvz" title="Permalink to this headline">¶</a></h3>
<p>The MongoDB community has encountered issues running MongoDB on OpenVZ.</p>
</div>
</div>
<div class="section" id="disk-and-storage-systems">
<h2>Disk and Storage Systems<a class="headerlink" href="#disk-and-storage-systems" title="Permalink to this headline">¶</a></h2>
<div class="section" id="swap">
<h3>Swap<a class="headerlink" href="#swap" title="Permalink to this headline">¶</a></h3>
<p>Configure swap space for your systems. Having swap can prevent issues
with memory contention and can prevent the OOM Killer on Linux systems
from killing <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>. Because of the way <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
maps memory files to memory, the operating system will never store
MongoDB data in swap.</p>
</div>
<div class="section" id="raid">
<h3>RAID<a class="headerlink" href="#raid" title="Permalink to this headline">¶</a></h3>
<p>Most MongoDB deployments should use disks backed by RAID-10.</p>
<p>RAID-5 and RAID-6 do not typically provide sufficient performance to
support a MongoDB deployment.</p>
<p>RAID-0 provides good write performance but provides limited
availability, and reduced performance on read operations, particularly
using Amazon&#8217;s EBS volumes: as a result, avoid RAID-0 with MongoDB
deployments.</p>
</div>
<div class="section" id="remote-filesystems">
<span id="production-nfs"></span><h3>Remote Filesystems<a class="headerlink" href="#remote-filesystems" title="Permalink to this headline">¶</a></h3>
<p>Some versions of NFS perform very poorly with MongoDB and NFS is not
recommended for use with MongoDB. Performance problems arise when both
the data files and the journal files are both hosted on NFS: you may
experience better performance if you place the journal on local or
<tt class="docutils literal"><span class="pre">iscsi</span></tt> volumes. If you must use NFS, add the following NFS options
to your <tt class="docutils literal"><span class="pre">/etc/fstab</span></tt> file: <tt class="docutils literal"><span class="pre">bg</span></tt>, <tt class="docutils literal"><span class="pre">nolock</span></tt>, and <tt class="docutils literal"><span class="pre">noatime</span></tt>.</p>
<p>Many MongoDB deployments work successfully with Amazon&#8217;s <em>Elastic
Block Store</em> (EBS) volumes. There are certain intrinsic performance
characteristics, with EBS volumes that users should consider.</p>
</div>
</div>
<div class="section" id="hardware-requirements-and-limitations">
<h2>Hardware Requirements and Limitations<a class="headerlink" href="#hardware-requirements-and-limitations" title="Permalink to this headline">¶</a></h2>
<p>MongoDB is designed specifically with commodity hardware in mind and
has few hardware requirements or limitations. MongoDB core components
runs on little-endian hardware primarily x86/x86_64 processors. Client
libraries (i.e. drivers) can run on big or little endian systems.</p>
<p>When installing hardware for MongoDB, consider the following:</p>
<ul class="simple">
<li>As with all software, more RAM and a faster CPU clock speed are
important to productivity.</li>
<li>Because databases do not perform high amounts of computation,
increasing the number cores helps but does not provide a high level of
marginal return.</li>
<li>MongoDB has good results and good price/performance with SATA SSD
(Solid State Disk) and with PCI (Peripheral Component Interconnect).</li>
<li>Commodity (SATA) spinning drives are often a good option as the
speed increase for random I/O for more expensive drives is not that
dramatic (only on the order of 2x), spending that money on SSDs or
RAM may be more effective.</li>
</ul>
<div class="section" id="mongodb-on-numa-hardware">
<span id="production-numa"></span><h3>MongoDB on NUMA Hardware<a class="headerlink" href="#mongodb-on-numa-hardware" title="Permalink to this headline">¶</a></h3>
<p>MongoDB and NUMA, Non-Uniform Access Memory, do not work well
together. When running MongoDB on NUMA hardware, disable NUMA for
MongoDB and run with an interleave memory policy. NUMA can cause a
number of operational problems with MongoDB, including slow
performance for periods of time or high system processor usage.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On Linux, MongoDB version 2.0 and greater checks these
settings on start up and prints a warning if the system is
NUMA-based.</p>
</div>
<p>To disable NUMA for MongoDB, use the <tt class="docutils literal"><span class="pre">numactl</span></tt> command and start
<a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> in the following manner:</p>
<div class="highlight-sh"><div class="highlight"><pre>numactl --interleave<span class="o">=</span>all /usr/bin/local/mongod
</pre></div>
</div>
<p>Adjust the <tt class="docutils literal"><span class="pre">proc</span></tt> settings using the following command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">echo </span>0 &gt; /proc/sys/vm/zone_reclaim_mode
</pre></div>
</div>
<p>To fully disable NUMA you must perform both operations. However, you can
change <tt class="docutils literal"><span class="pre">zone_reclaim_mode</span></tt> without restarting mongod. For more
information, see documentation on <a class="reference external" href="http://www.kernel.org/doc/Documentation/sysctl/vm.txt">Proc/sys/vm</a>.</p>
<p>See the <a class="reference external" href="http://jcole.us/blog/archives/2010/09/28/mysql-swap-insanity-and-the-numa-architecture/">The MySQL &#8220;swap insanity&#8221; problem and the effects of NUMA</a>
post, which describes the effects of NUMA on databases. This blog post
addresses the impact of NUMA for MySQL; however, the issues for
MongoDB are similar. The post introduces NUMA its goals, and
illustrates how these goals are not compatible with production
databases.</p>
</div>
</div>
<div class="section" id="performance-monitoring">
<h2>Performance Monitoring<a class="headerlink" href="#performance-monitoring" title="Permalink to this headline">¶</a></h2>
<div class="section" id="iostat">
<h3>iostat<a class="headerlink" href="#iostat" title="Permalink to this headline">¶</a></h3>
<p>On Linux, use the iostat command to check if disk I/O is a bottleneck
for your database. Specify a number of seconds when running iostat to
avoid displaying stats covering the time since server boot.</p>
<p>For example:</p>
<div class="highlight-bash"><div class="highlight"><pre>iostat -xm 2
</pre></div>
</div>
<p>Use the mount command to see what device your <a class="reference internal" href="../reference/configuration-options.html#dbpath" title="dbpath"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">data</span> <span class="pre">directory</span></tt></a> resides on.</p>
<p>Key fields from <tt class="docutils literal"><span class="pre">iostat</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">%util</span></tt>: this is the most useful field for a quick check, it
indicates what percent of the time the device/drive is in use.</li>
<li><tt class="docutils literal"><span class="pre">avgrq-sz</span></tt>: average request size. Smaller number for this value
reflect more random IO operations.</li>
</ul>
</div>
<div class="section" id="bwm-ng">
<h3>bwm-ng<a class="headerlink" href="#bwm-ng" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.gropp.org/?id=projects&amp;sub=bwm-ng">bwm-ng</a> is a
command-line tool for monitoring network use. If you suspect a
network-based bottleneck, you may use <tt class="docutils literal"><span class="pre">bwm-ng</span></tt> to begin your
diagnostic process.</p>
</div>
</div>
<div class="section" id="production-checklist">
<span id="gotchas"></span><h2>Production Checklist<a class="headerlink" href="#production-checklist" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bit-builds-for-production">
<h3>64-bit Builds for Production<a class="headerlink" href="#bit-builds-for-production" title="Permalink to this headline">¶</a></h3>
<p>Always use 64-bit Builds for Production. MongoDB uses memory mapped
files. See the <a class="reference internal" href="../faq/fundamentals.html#faq-32-bit-limitations"><em>32-bit limitations</em></a> for
more information.</p>
<p>32-bit builds exist to support use on development machines and also for
other miscellaneous things such as replica set arbiters.</p>
</div>
<div class="section" id="bson-document-size-limit">
<h3>BSON Document Size Limit<a class="headerlink" href="#bson-document-size-limit" title="Permalink to this headline">¶</a></h3>
<p>There is a <a class="reference internal" href="../reference/limits.html#BSON Document Size" title="BSON Document Size"><tt class="xref mongodb mongodb-limit docutils literal"><span class="pre">BSON</span> <span class="pre">Document</span> <span class="pre">Size</span></tt></a> limit &#8211; at the time of this writing
16MB per document. If you have large objects, use <a class="reference internal" href="../core/gridfs.html"><em>GridFS</em></a> instead.</p>
</div>
<div class="section" id="set-appropriate-write-concern-for-write-operations">
<h3>Set Appropriate Write Concern for Write Operations<a class="headerlink" href="#set-appropriate-write-concern-for-write-operations" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="../core/write-concern.html"><em>Write Concern</em></a> for more information.</p>
</div>
<div class="section" id="dynamic-schema">
<h3>Dynamic Schema<a class="headerlink" href="#dynamic-schema" title="Permalink to this headline">¶</a></h3>
<p>Data in MongoDB has a <em>dynamic schema</em>. <a class="reference internal" href="../reference/glossary.html#term-collection"><em class="xref std std-term">Collections</em></a> do not enforce <a class="reference internal" href="../reference/glossary.html#term-document"><em class="xref std std-term">document</em></a> structure. This
facilitates iterative development and polymorphism. However,
collections often hold documents with highly homogeneous
structures. See <a class="reference internal" href="../core/data-modeling.html"><em>Data Modeling Considerations for MongoDB Applications</em></a> for more information.</p>
<p>Some operational considerations include:</p>
<ul class="simple">
<li>the exact set of collections to be used</li>
<li>the indexes to be used, which are created explicitly except for the
<tt class="docutils literal"><span class="pre">_id</span></tt> index</li>
<li>shard key declarations, which are explicit and quite important as it
is hard to change shard keys later</li>
</ul>
<p>One very simple rule-of-thumb is not to import data from a
relational database unmodified: you will generally want to &#8220;roll up&#8221;
certain data into richer documents that use some embedding of nested
documents and arrays (and/or arrays of subdocuments).</p>
</div>
<div class="section" id="updates-by-default-affect-only-one-document">
<h3>Updates by Default Affect Only <strong>one</strong> Document<a class="headerlink" href="#updates-by-default-affect-only-one-document" title="Permalink to this headline">¶</a></h3>
<p>Set the <tt class="docutils literal"><span class="pre">multi</span></tt> parameter to <tt class="docutils literal"><span class="pre">true</span></tt> to
<a class="reference internal" href="../reference/method/db.collection.update.html#db.collection.update" title="db.collection.update()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> multiple documents that meet the
query criteria. The <a class="reference internal" href="../reference/program/mongo.html#bin.mongo" title="mongo"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt></a> shell syntax is:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">my_query</span><span class="p">,</span> <span class="nx">my_update_expression</span><span class="p">,</span> <span class="nx">bool_upsert</span><span class="p">,</span> <span class="nx">bool_multi</span><span class="p">)</span>
</pre></div>
</div>
<p>Set <tt class="docutils literal"><span class="pre">bool_multi</span></tt> to <tt class="docutils literal"><span class="pre">true</span></tt> when updating many documents. Otherwise
only the first matched will update.</p>
</div>
<div class="section" id="case-sensitive-strings">
<h3>Case Sensitive Strings<a class="headerlink" href="#case-sensitive-strings" title="Permalink to this headline">¶</a></h3>
<p>MongoDB strings are case sensitive. So a search for <tt class="docutils literal"><span class="pre">&quot;joe&quot;</span></tt> will not
find <tt class="docutils literal"><span class="pre">&quot;Joe&quot;</span></tt>.</p>
<p>Consider:</p>
<ul class="simple">
<li>storing data in a normalized case format, or</li>
<li>using regular expressions ending with <tt class="docutils literal"><span class="pre">/i</span></tt></li>
<li>and/or using <a class="reference internal" href="../reference/aggregation/toLower.html"><em>$toLower</em></a> or
<a class="reference internal" href="../reference/aggregation/toUpper.html"><em>$toUpper</em></a> in the
<a class="reference internal" href="../core/aggregation.html"><em>aggregation framework</em></a></li>
</ul>
</div>
<div class="section" id="type-sensitive-fields">
<h3>Type Sensitive Fields<a class="headerlink" href="#type-sensitive-fields" title="Permalink to this headline">¶</a></h3>
<p>MongoDB data &#8211; which is JSON-style, specifically, <a class="reference external" href="http://docs.mongodb.org/meta-driver/latest/legacy/bson/">BSON</a> format &#8211; have several data types.</p>
<p>Consider the following document which has a field <tt class="docutils literal"><span class="pre">x</span></tt> with the
<em>string</em> value <tt class="docutils literal"><span class="pre">&quot;123&quot;</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">x</span> <span class="o">:</span> <span class="s2">&quot;123&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Then the following query which looks for a <em>number</em> value <tt class="docutils literal"><span class="pre">123</span></tt> will
<strong>not</strong> return that document:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">mycollection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">:</span> <span class="mi">123</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="locking">
<h3>Locking<a class="headerlink" href="#locking" title="Permalink to this headline">¶</a></h3>
<p>Older versions of MongoDB used a &#8220;global lock&#8221;; use MongoDB v2.2+ for
better results. See the <a class="reference internal" href="../faq/concurrency.html"><em>Concurrency</em></a> page for
more information.</p>
</div>
<div class="section" id="packages">
<h3>Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h3>
<p>Be sure you have the latest stable release if you are using a package
manager. You can see what is current on the Downloads page, even if you
then choose to install via a package manager.</p>
</div>
<div class="section" id="use-odd-number-of-replica-set-members">
<h3>Use Odd Number of Replica Set Members<a class="headerlink" href="#use-odd-number-of-replica-set-members" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../replication.html"><em>Replica sets</em></a> perform consensus elections. Use
either an odd number of members (e.g., three) or else use an arbiter to
get up to an odd number of votes.</p>
</div>
<div class="section" id="don-t-disable-journaling">
<h3>Don&#8217;t disable journaling<a class="headerlink" href="#don-t-disable-journaling" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="../core/journaling.html"><em>Journaling</em></a> for more information.</p>
</div>
<div class="section" id="keep-replica-set-members-up-to-date">
<h3>Keep Replica Set Members Up-to-Date<a class="headerlink" href="#keep-replica-set-members-up-to-date" title="Permalink to this headline">¶</a></h3>
<p>This is important as MongoDB replica sets support automatic failover.
Thus you want your secondaries to be up-to-date. You have a few options
here:</p>
<ol class="arabic simple">
<li>Monitoring and alerts for any lagging can be done via various means.
MMS shows a graph of replica set lag</li>
<li>Using <a class="reference internal" href="../core/write-concern.html"><em>getLastError</em></a> with
<tt class="docutils literal"><span class="pre">w:'majority'</span></tt>, you will get a timeout or no return if a majority of
the set is lagging. This is thus another way to guard against lag and
get some reporting back of its occurrence.</li>
<li>Or, if you want to fail over manually, you can set your secondaries
to <tt class="docutils literal"><span class="pre">priority:0</span></tt> in their configuration. Then manual action would be
required for a failover. This is practical for a small cluster; for a
large cluster you will want automation.</li>
</ol>
<p>Additionally, see information on <a class="reference internal" href="../core/replication.html#replica-set-rollback"><em>replica set rollbacks</em></a>.</p>
</div>
<div class="section" id="additional-deployment-considerations">
<h3>Additional Deployment Considerations<a class="headerlink" href="#additional-deployment-considerations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Pick your shard keys carefully! There is no way to modify a shard
key on a collection that is already sharded.</li>
<li>You cannot shard an existing collection over 256 gigabytes. To shard
large amounts of data, create a new empty sharded collection, and
ingest the data from the source collection using an application
level import operation.</li>
<li>Unique indexes are not enforced across shards except for the shard
key itself. See <a class="reference internal" href="../tutorial/enforce-unique-keys-for-sharded-collections.html"><em>Enforce Unique Keys for Sharded Collections</em></a>.</li>
<li>Consider <a class="reference internal" href="sharded-clusters.html"><em>pre-splitting</em></a> a
sharded collection before a massive bulk import. Usually this isn&#8217;t
necessary but on a bulk import of size it is helpful.</li>
<li>Use <a class="reference internal" href="../core/security.html"><em>security/auth</em></a> mode if you
need it. By default <a class="reference internal" href="../reference/configuration-options.html#auth" title="auth"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">auth</span></tt></a> is not enabled and
<a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> assumes a trusted environment.</li>
<li>You do not have <a class="reference internal" href="../tutorial/isolate-sequence-of-operations.html"><em>fully generalized transactions</em></a>. Create rich documents
and read the preceding link and consider the use case &#8211; often there
is a good fit.</li>
<li>Disable NUMA for best results. If you have NUMA enabled,
<a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> will print a warning when it starts.</li>
<li>Avoid excessive prefetch/readahead on the filesystem. Check your
prefetch settings. Note on linux the parameter is in <em>sectors</em>, not
bytes. 32KBytes (a setting of 64 sectors) is pretty reasonable.</li>
<li>Check <a class="reference internal" href="../reference/ulimit.html"><em>ulimits</em></a> settings.</li>
<li>Use SSD if available and economical. Spinning disks can work well
but SSDs&#8217; capacity for random I/O operations work well with the update
model of <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>. See <a class="reference internal" href="#production-nfs"><em>Remote Filesystems</em></a> for more info.</li>
<li>Ensure that clients keep reasonable pool sizes to avoid overloading
the connection tracking capacity of a single <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> or
<a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance.</li>
</ul>
</div>
</div>
</div>


    <div id="btnv">
        <ul id="btnvl">
              <li id="btnvpr"><a href="../reference/ulimit.html" title="Previous Section: Linux ulimit Settings">&lt; &nbsp; Linux ulimit Settings</a></li>
              <li id="btnvup"><a href="../administration.html" title="Parent Section: Administration" >&#47;&#92;&nbsp; Administration</a></li>
              <li id="btnvnx"><a href="../tutorial/use-database-commands.html" title="Next Section: Use Database Commands">Use Database Commands &nbsp;&gt;</a></li>
        </ul>
    </div></div></div>
           </div>
       <div class="sphinxsidebar">
         <div class="sphinxsidebarwrapper">
  <h3>
    <a href="../index.html">MongoDB Manual</a> <span id="vn">2.4</span>
  </h3>



<div class="site-contents"><a href="../contents.html">Contents</a></div>


<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install MongoDB</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../administration.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Run-time Database Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="backups.html">Backup and Recovery Operations for MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-center-awareness.html">Data Center Awareness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core/journaling.html">Journaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/configure-ssl.html">Connect to MongoDB with SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/monitor-with-snmp.html">Monitor MongoDB with SNMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/manage-mongodb-processes.html">Manage <tt class="docutils literal"><span class="pre">mongod</span></tt> Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/rotate-log-files.html">Rotate Log Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">Monitoring for MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/manage-the-database-profiler.html">Analyze Performance of Database Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core/import-export.html">Import and Export MongoDB Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/ulimit.html">Linux <tt class="docutils literal"><span class="pre">ulimit</span></tt> Settings</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Production Notes</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/use-database-commands.html">Use Database Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html">MongoDB Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crud.html">Core MongoDB Operations (CRUD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-modeling.html">Data Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aggregation.html">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indexes.html">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sharding.html">Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mongo.html">The <tt class="docutils literal"><span class="pre">mongo</span></tt> Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use-cases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About MongoDB Documentation</a></li>
</ul>



<div class="site-index"><a href="../genindex.html">Index</a></div>
<h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="/manual/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul>
<h3><a href="http://www.mongodb.org/about/">About MongoDB</a></h3>
<ul>
  <li><a href="http://www.mongodb.org/about/introduction">Introduction</a></li>
  <li><a href="http://www.mongodb.org/about/community">User Community</a></li>
  <li><a href="http://mongodb.org/about/community/masters">MongoDB Masters</a></li>
  <li><a href="http://planet.mongodb.org">Planet MongoDB</a></li>
</ul>
<h3><a href="http://docs.mongodb.org/ecosystem/">MongoDB Ecosystem</a></h3>
<ul>
 <li><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers and Client libraries</a>
   <ul>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/c">C</a> (<a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/cpp">C++</a> (<a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/csharp">C#</a> (<a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/erlang">Erlang</a> (<a href="http://api.mongodb.org/erlang">docs</a>)</li>
     <li><a href="http://hackage.haskell.org/package/mongoDB">Haskell</a> (<a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/java">Java</a> (<a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/javascript">JavaScript</a> (<a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/perl">Perl</a> (<a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/php">PHP</a> (<a href="http://php.net/mongo/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/python">Python</a> (<a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/ruby">Ruby</a> (<a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/scala">Scala</a> (<a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
   </ul>
 </li>
 <li><a href="http://docs.mongodb.org/ecosystem/tools/">Tools and Integration</a></li>
 <li><a href="http://docs.mongodb.org/ecosystem/platforms/">Platform Integration</a></li>
</ul><h3>MongoDB Resources</h3>
<ul>
  <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
  <li><a href="http://www.10gen.com/events">MongoDB Events</a></li>
  <li><a href="http://www.10gen.com/presentations">Slides and Video</a></li>
  <li><a href="http://www.10gen.com/products/mms/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
</ul>
         </div>
       </div>
        <div class="clearer"></div>
      </div><div id="top-right">
        <div class="user-right">
          <ul id="header-menu-bar" class="ajs-menu-bar">
            <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
            <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
            <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
            <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
            <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
            <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
          </ul>
        </div>
      </div>
      <div class="search-db"><gcse:searchbox></gcse:searchbox></div>
          <div id="etp">
            <ul>
              <li><a href="https://github.com/mongodb/docs/blob/master/source/administration/production-notes.txt" target="_blank" title="Edit administration/production-notes.txt on GitHub">Edit this Page</a></li>
              <li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
              <li><a id="jirafeedback" href="https://jira.mongodb.org/secure/CreateIssueDetails!init.jspa?pid=10380&issuetype=4&priority=4&summary=Comment+on%3a+%22administration/production-notes%2Etxt%22" target="_blank" title="Report a problem with administration/production-notes.txt on Jira">Report a Problem</a></li>
            </ul>
          </div>
      <div class="footer">
        <p>
          &copy; <a href="">Copyright</a> 2011-2013, 10gen, Inc. 
          MongoDB&reg;, Mongo&reg;, and the leaf logo are registered trademarks of <a href="http://www.10gen.com/">10gen, Inc.</a>
        </p>
      </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">var _kiq = _kiq || [];</script>
<script type="text/javascript">
(function(){
setTimeout(function(){ var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//s3.amazonaws.com/ki.js/49119/a7n.js'; f.parentNode.insertBefore(s, f); }, 1);
})();
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-7301842-14', 'mongodb.org');
ga('send', 'pageview');
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script><script type="text/javascript">
jQuery.ajax({
	 url: "https://jira.mongodb.org/s/en_UScn8g8x/782/6/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId=298ba4e7",
	 type: "get",
	 cache: true,
	 dataType: "script"
	});
window.ATL_JQ_PAGE_PROPS =  {
	"triggerFunction": function(showCollectorDialog) {
		jQuery("#jirafeedback").click(function(e) {e.preventDefault();showCollectorDialog();});},
		fieldValues: {component: 'mongodb-manual', summary: 'Comment on: "manual/administration/production-notes.txt"'},
		environment: {'repo': 'docs','source': 'administration/production-notes'}
		};
</script><script type="text/javascript">
var versions = [{'t': '2.4 (current)', 'v': 'v2.4'}, {'t': '2.2', 'v': 'v2.2'}]
var pagename = 'administration/production-notes'
var stable = 'v2.4'

function vfnav() {
    if ( pagename=='index' ) {
        pn = ''
    }
    else {
        pn = pagename
    }

    v = $(this).children("option:selected").attr('value')

    if ( (v==0) || (v==stable) ) {
        uri = '/manual/' + pn
    }
    else {
        uri = '/' + v + '/' + pn
    }
    window.location.href= uri;
}

$(document).ready(function(){
    $("#vn").html(function(){
        s=$("<select/>");
        o='<option/>';

        $.each(versions,function(index, version) {
            if ( version.v==stable ) {
                dv=true;
            }
            $(o,{value:version.v,text: version.t}).appendTo(s);
        });

        if ( dv==false ) {
            $(o, {value:0,text:'(stable)'}).appendTo(s);
        }
        return(s);
    });

    $("#vn select").bind('change', vfnav);
    $('#vn select').val('v2.4');
});
</script>
</body>
</html>