<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head><title>Sharded Cluster Architectures &mdash; MongoDB Manual 2.4.3</title><link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index" />
  <meta name="release" content="2.4.3"/>
  <meta name="DC.Source" content="https://github.com/mongodb/docs/blob/master/source/core/sharded-cluster-architectures.txt"/>
      <link rel="canonical" href="http://docs.mongodb.org/manual/core/sharded-cluster-architectures" />
  
   <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
   <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      
   <script type="text/javascript">
     var DOCUMENTATION_OPTIONS = {
         URL_ROOT:    '../',
         VERSION:     '2.4',
         COLLAPSE_INDEX: false,
         FILE_SUFFIX: '.html',
         HAS_SOURCE:  false,
     };
   </script>
       <script type="text/javascript" src="../_static/jquery.js"></script>
       <script type="text/javascript" src="../_static/underscore.js"></script>
       <script type="text/javascript" src="../_static/doctools.js"></script>
          <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help"/>
<link rel="author" title="About these documents" href="../about.html" />
<link rel="top" title="MongoDB Manual" href="../index.html" />
<link rel="up" title="Sharding" href="../sharding.html" />
<link rel="next" title="Query Routing in Sharded Clusters" href="sharded-cluster-query-routing.html" />
<link rel="prev" title="Sharded Cluster Overview" href="sharded-clusters.html" />
          <script>
            (function() {
               var cx = '017213726194841070573:WMX6838984';
               var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
               gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
               var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
            })();
          </script></head>
<body>
      <div id="header-db" class="spread">
        <div class="split">
          <div id="logo">
            <div><a href="http://www.mongodb.org/"><img class="logo" src="http://media.mongodb.org/logo-mongodb.png" alt="MongoDB Logo"/></a></div>
          </div>
        </div>
      </div>  
      <div class="document">
           <div class="documentwrapper"><div class="bodywrapper">
               <div class="body">
                 
    <div class="bc">
      <ul>
          <li><a href="../sharding.html">Sharding</a><span class="bcpoint"> > </span></li>
          <li>Sharded Cluster Architectures</li> 
      </ul>
    </div>
                 <div id="cse-results">
                   <gcse:searchresults linkTarget="_top"></gcse:searchresults>
                 </div>
                 
  <span class="target" id="index-0"></span><div class="section" id="sharded-cluster-architectures">
<span id="sharding-architecture"></span><span id="index-1"></span><h1>Sharded Cluster Architectures<a class="headerlink" href="#sharded-cluster-architectures" title="Permalink to this headline">¶</a></h1>
<p>This document describes requirements, organization and design of
<a class="reference internal" href="../reference/glossary.html#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> deployments.</p>
<div class="section" id="infrastructure-requirements-for-sharded-clusters">
<span id="sharding-requirements-infrastructure"></span><h2>Infrastructure Requirements for Sharded Clusters<a class="headerlink" href="#infrastructure-requirements-for-sharded-clusters" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="../reference/glossary.html#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> has the following components:</p>
<ul>
<li><p class="first">Three <a class="reference internal" href="../reference/glossary.html#term-config-database"><em class="xref std std-term">config servers</em></a>.</p>
<p>These special <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances store the metadata for the
cluster. The <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances cache this data and use it
to determine which <a class="reference internal" href="../reference/glossary.html#term-shard"><em class="xref std std-term">shard</em></a> is responsible for which
<a class="reference internal" href="../reference/glossary.html#term-chunk"><em class="xref std std-term">chunk</em></a>.</p>
<p>For development and testing purposes you may deploy a cluster with a single
configuration server process, but always use exactly three config
servers for redundancy and safety in production.</p>
</li>
<li><p class="first">Two or more shards. Each shard consists of one or more <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
instances that store the data for the shard.</p>
<p>These &#8220;normal&#8221; <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances hold all of the
actual data for the cluster.</p>
<p>Typically each shard is a <a class="reference internal" href="../reference/glossary.html#term-replica-set"><em class="xref std std-term">replica sets</em></a>. Each
replica set consists of multiple <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances. The
members of the replica set provide redundancy and high availability
for the data in each shard.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">MongoDB enables data <a class="reference internal" href="../reference/glossary.html#term-partition"><em class="xref std std-term">partitioning</em></a>, or
sharding, on a <em>per collection</em> basis. You <em>must</em> access all data
in a sharded cluster via the <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances as below.
If you connect directly to a <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> in a sharded cluster
you will see its fraction of the cluster&#8217;s data. The data on any
given shard may be somewhat random: MongoDB provides no guarantee
that any two contiguous chunks will reside on a single shard.</p>
</div>
</li>
<li><p class="first">One or more <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances.</p>
<p>These instance direct queries from the application layer to the
shards that hold the data. The <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances have no
persistent state or data files and only cache metadata in RAM from
the config servers.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In most situations <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances use minimal
resources, and you can run them on your application servers
without impacting application performance. However, if you use
the <a class="reference internal" href="../reference/glossary.html#term-aggregation-framework"><em class="xref std std-term">aggregation framework</em></a> some processing may occur on
the <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances, causing that <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
to require more system resources.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="data-quantity-requirements-for-sharded-clusters">
<span id="sharding-requirements-data"></span><h2>Data Quantity Requirements for Sharded Clusters<a class="headerlink" href="#data-quantity-requirements-for-sharded-clusters" title="Permalink to this headline">¶</a></h2>
<p>Your cluster must manage a significant quantity of data for sharding
to have an effect on your collection. The default <a class="reference internal" href="../reference/glossary.html#term-chunk"><em class="xref std std-term">chunk</em></a> size
is 64 megabytes, and the <a class="reference internal" href="sharded-clusters.html#sharding-balancing"><em>balancer</em></a> will not begin moving data until the imbalance
of chunks in the cluster exceeds the <a class="reference internal" href="sharded-cluster-internals.html#sharding-migration-thresholds"><em>migration threshold</em></a>.</p>
<p>Practically, this means that unless your cluster has many hundreds of
megabytes of data, chunks will remain on a single shard.</p>
<p>While there are some exceptional situations where you may need to
shard a small collection of data, most of the time the additional
complexity added by sharding the small collection is not worth the
additional complexity and overhead unless you need additional
concurrency or capacity for some reason. If you have a small data set,
usually a properly configured single MongoDB instance or replica set
will be more than sufficient for your persistence layer needs.</p>
<p><a class="reference internal" href="../reference/glossary.html#term-chunk"><em class="xref std std-term">Chunk</em></a> size is <a class="reference internal" href="../reference/program/mongos.html#cmdoption-mongos--chunkSize"><em class="xref std std-option">user configurable</em></a>.
However, the default value is of 64 megabytes is ideal
for most deployments. See the <a class="reference internal" href="sharded-cluster-internals.html#sharding-chunk-size"><em>Chunk Size</em></a> section in the
<a class="reference internal" href="sharded-cluster-internals.html"><em>Sharded Cluster Internals</em></a> document for more information.</p>
</div>
<div class="section" id="restriction-on-the-use-of-the-localhost-interface">
<span id="sharding-localhost"></span><span id="index-2"></span><h2>Restriction on the Use of the <tt class="docutils literal"><span class="pre">localhost</span></tt> Interface<a class="headerlink" href="#restriction-on-the-use-of-the-localhost-interface" title="Permalink to this headline">¶</a></h2>
<p>Because all components of a <a class="reference internal" href="../reference/glossary.html#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> must communicate
with each other over the network, there are special restrictions
regarding the use of localhost addresses:</p>
<p>If you use either &#8220;localhost&#8221; or &#8220;<tt class="docutils literal"><span class="pre">127.0.0.1</span></tt>&#8221; as the host
identifier, then you must use &#8220;localhost&#8221; or &#8220;<tt class="docutils literal"><span class="pre">127.0.0.1</span></tt>&#8221; for <em>all</em>
host settings for any MongoDB instances in the cluster.  This applies
to both the <tt class="docutils literal"><span class="pre">host</span></tt> argument to <a class="reference internal" href="../reference/command/addShard.html#dbcmd.addShard" title="addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a> and the value
to the <a class="reference internal" href="../reference/program/mongos.html#cmdoption-mongos--configdb"><em class="xref std std-option">mongos --configdb</em></a> run time option. If you mix
localhost addresses with remote host address, MongoDB will produce
errors.</p>
</div>
<div class="section" id="test-cluster-architecture">
<h2>Test Cluster Architecture<a class="headerlink" href="#test-cluster-architecture" title="Permalink to this headline">¶</a></h2>
<p>You can deploy a very minimal cluster for testing and
development. These <em>non-production</em> clusters have the following
components:</p>
<ul class="simple">
<li>One <a class="reference internal" href="sharded-cluster-internals.html#sharding-config-server"><em>config server</em></a>.</li>
<li>At least one <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance (either <a class="reference internal" href="../reference/glossary.html#term-replica-set"><em class="xref std std-term">replica sets</em></a> or as a standalone node.)</li>
<li>One <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Use the test cluster architecture for testing and development only.</p>
</div>
</div>
<div class="section" id="production-cluster-architecture">
<span id="sharding-production-architecture"></span><h2>Production Cluster Architecture<a class="headerlink" href="#production-cluster-architecture" title="Permalink to this headline">¶</a></h2>
<p>In a production cluster, you must ensure that data is redundant and that
your systems are highly available. To that end, a production-level
cluster must have the following components:</p>
<ul>
<li><p class="first">Three <a class="reference internal" href="sharded-cluster-internals.html#sharding-config-server"><em>config servers</em></a>, each residing on a
discrete system.</p>
<p>A single <a class="reference internal" href="../reference/glossary.html#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> must have exclusive use of its
<a class="reference internal" href="sharded-cluster-internals.html#sharding-config-server"><em>config servers</em></a>. If you have multiple
sharded clusters, you will need to have a group of config servers
for each cluster.</p>
</li>
<li><p class="first">Two or more <a class="reference internal" href="../reference/glossary.html#term-replica-set"><em class="xref std std-term">replica sets</em></a> to serve as
<a class="reference internal" href="../reference/glossary.html#term-shard"><em class="xref std std-term">shards</em></a>. For information on replica sets, see
<a class="reference internal" href="../replication.html"><em>Replication</em></a>.</p>
</li>
<li><p class="first">Two or more <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances. Typically, you deploy a
single <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance on each application server.
Alternatively, you may deploy several <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> nodes and let
your application connect to these via a load balancer.</p>
</li>
</ul>
</div>
<div class="section" id="sharded-and-non-sharded-data">
<h2>Sharded and Non-Sharded Data<a class="headerlink" href="#sharded-and-non-sharded-data" title="Permalink to this headline">¶</a></h2>
<p>Sharding operates on the collection level. You can shard multiple
collections within a database, or have multiple databases with
sharding enabled. <a class="footnote-reference" href="#sharding-databases" id="id1">[1]</a> However, in production
deployments some databases and collections will use sharding, while
other databases and collections will only reside on a single database
instance or replica set (i.e. a <a class="reference internal" href="../reference/glossary.html#term-shard"><em class="xref std std-term">shard</em></a>.)</p>
<p>Regardless of the data architecture of your <a class="reference internal" href="../reference/glossary.html#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>,
ensure that all queries and operations use the <a class="reference internal" href="../reference/glossary.html#term-mongos"><em class="xref std std-term">mongos</em></a> router to
access the data cluster. Use the <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> even for operations
that do not impact the sharded data.</p>
<p>Every database has a &#8220;primary&#8221; <a class="footnote-reference" href="#overloaded-primary-term" id="id2">[2]</a> shard that
holds all un-sharded collections in that database. All collections
that <em>are not</em> sharded reside on the primary for their database. Use
the <a class="reference internal" href="../reference/command/movePrimary.html#dbcmd.movePrimary" title="movePrimary"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">movePrimary</span></tt></a> command to change the primary shard for a
database. Use the <a class="reference internal" href="../reference/method/db.printShardingStatus.html#db.printShardingStatus" title="db.printShardingStatus()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.printShardingStatus()</span></tt></a> command or the
<a class="reference internal" href="../reference/method/sh.status.html#sh.status" title="sh.status()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.status()</span></tt></a> to see an overview of the cluster, which contains
information about the <a class="reference internal" href="../reference/glossary.html#term-chunk"><em class="xref std std-term">chunk</em></a> and database distribution within the
cluster.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <a class="reference internal" href="../reference/command/movePrimary.html#dbcmd.movePrimary" title="movePrimary"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">movePrimary</span></tt></a> command can be expensive because
it copies all non-sharded data to the new shard, during which
that data will be unavailable for other operations.</p>
</div>
<p>When you deploy a new <a class="reference internal" href="../reference/glossary.html#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>, the &#8220;first shard&#8221; becomes
the primary for all databases before enabling sharding. Databases
created subsequently, may reside on any shard in the cluster.</p>
<table class="docutils footnote" frame="void" id="sharding-databases" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>As you configure sharding, you will use the
<a class="reference internal" href="../reference/command/enableSharding.html#dbcmd.enableSharding" title="enableSharding"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">enableSharding</span></tt></a> command to enable sharding for a
database. This simply makes it possible to use the
<a class="reference internal" href="../reference/command/shardCollection.html#dbcmd.shardCollection" title="shardCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shardCollection</span></tt></a> command on a collection within that database.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="overloaded-primary-term" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>The term &#8220;primary&#8221; in the context of
databases and sharding, has nothing to do with the term
<a class="reference internal" href="../reference/glossary.html#term-primary"><em class="xref std std-term">primary</em></a> in the context of <a class="reference internal" href="../reference/glossary.html#term-replica-set"><em class="xref std std-term">replica sets</em></a>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="high-availability-and-mongodb">
<span id="sharding-high-availability"></span><h2>High Availability and MongoDB<a class="headerlink" href="#high-availability-and-mongodb" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="#sharding-production-architecture"><em>production</em></a>
<a class="reference internal" href="../reference/glossary.html#term-cluster"><em class="xref std std-term">cluster</em></a> has no single point of failure. This section introduces the
availability concerns for MongoDB deployments and highlights
potential failure scenarios and available resolutions:</p>
<ul>
<li><p class="first">Application servers or <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances become unavailable.</p>
<p>If each application server has its own <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance,
other application servers can continue access the
database. Furthermore, <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances do not maintain
persistent state, and they can restart and become unavailable
without loosing any state or data. When a <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance
starts, it retrieves a copy of the <a class="reference internal" href="../reference/glossary.html#term-config-database"><em class="xref std std-term">config database</em></a> and can
begin routing queries.</p>
</li>
<li><p class="first">A single <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> becomes unavailable in a shard.</p>
<p><a class="reference internal" href="../replication.html"><em>Replica sets</em></a> provide high availability for
shards. If the unavailable <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> is a <a class="reference internal" href="../reference/glossary.html#term-primary"><em class="xref std std-term">primary</em></a>,
then the replica set will <a class="reference internal" href="replication.html#replica-set-elections"><em>elect</em></a> a new
primary. If the unavailable <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> is a
<a class="reference internal" href="../reference/glossary.html#term-secondary"><em class="xref std std-term">secondary</em></a>, and it disconnects the primary and secondary will
continue to hold all data. In a three member replica set, even if a
single member of the set experiences catastrophic failure, two other
members have full copies of the data. <a class="footnote-reference" href="#recovery-window" id="id3">[3]</a></p>
<p>Always investigate availability interruptions and failures. If a
system is unrecoverable, replace it and create a new member of the
replica set as soon as possible to replace the lost redundancy.</p>
</li>
<li><p class="first">All members of a replica set become unavailable.</p>
<p>If all members of a replica set within a shard are unavailable, all
data held in that shard is unavailable. However, the data on all
other shards will remain available, and it&#8217;s possible to read and
write data to the other shards. However, your application must be
able to deal with partial results, and you should investigate the
cause of the interruption and attempt to recover the shard as soon
as possible.</p>
</li>
<li><p class="first">One or two <a class="reference internal" href="../reference/glossary.html#term-config-database"><em class="xref std std-term">config database</em></a> become unavailable.</p>
<p>Three distinct <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances provide the <a class="reference internal" href="../reference/glossary.html#term-config-database"><em class="xref std std-term">config
database</em></a> using a special two-phase commits to maintain consistent
state between these <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances. Cluster
operation will continue as normal but <a class="reference internal" href="sharded-clusters.html#sharding-balancing"><em>chunk migration</em></a> and the cluster can create no new <a class="reference internal" href="../tutorial/manage-chunks-in-sharded-cluster.html#sharding-procedure-create-split"><em>chunk
splits</em></a>. Replace the config server
as soon as possible. If all multiple config databases become
unavailable, the cluster can become inoperable.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All config servers must be running and available when you first initiate
a <a class="reference internal" href="../reference/glossary.html#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>.</p>
</div>
</li>
</ul>
<table class="docutils footnote" frame="void" id="recovery-window" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>If an unavailable secondary becomes available
while it still has current oplog entries, it can catch up to the
latest state of the set using the normal <a class="reference internal" href="../reference/glossary.html#term-sync"><em class="xref std std-term">replication process</em></a>, otherwise it must perform an <a class="reference internal" href="../reference/glossary.html#term-initial-sync"><em class="xref std std-term">initial sync</em></a>.</td></tr>
</tbody>
</table>
</div>
</div>


    <div id="btnv">
        <ul id="btnvl">
              <li id="btnvpr"><a href="sharded-clusters.html" title="Previous Section: Sharded Cluster Overview">&lt; &nbsp; Sharded Cluster Overview</a></li>
              <li id="btnvup"><a href="../sharding.html" title="Parent Section: Sharding" >&#47;&#92;&nbsp; Sharding</a></li>
              <li id="btnvnx"><a href="sharded-cluster-query-routing.html" title="Next Section: Query Routing in Sharded Clusters">Query Routing in Sharded Clusters &nbsp;&gt;</a></li>
        </ul>
    </div></div></div>
           </div>
       <div class="sphinxsidebar">
         <div class="sphinxsidebarwrapper">
  <h3>
    <a href="../index.html">MongoDB Manual</a> <span id="vn">2.4</span>
  </h3>



<div class="site-contents"><a href="../contents.html">Contents</a></div>


<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../administration.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crud.html">Core MongoDB Operations (CRUD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-modeling.html">Data Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aggregation.html">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indexes.html">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replication.html">Replication</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../sharding.html">Sharding</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sharded-clusters.html">Sharded Cluster Overview</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Sharded Cluster Architectures</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sharded-cluster-query-routing.html">Query Routing in Sharded Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharded-cluster-security.html">Security Practices for Sharded Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharded-cluster-internals.html">Sharded Cluster Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../administration/sharded-clusters.html">Sharded Cluster Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sharding-commands.html">Sharding Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/config-database.html">Config Database</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mongo.html">The <tt class="docutils literal"><span class="pre">mongo</span></tt> Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use-cases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About MongoDB Documentation</a></li>
</ul>



<div class="site-index"><a href="../genindex.html">Index</a></div>
<h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="/manual/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul>
<h3><a href="http://www.mongodb.org/about/">About MongoDB</a></h3>
<ul>
  <li><a href="http://www.mongodb.org/about/introduction">Introduction</a></li>
  <li><a href="http://www.mongodb.org/about/community">User Community</a></li>
  <li><a href="http://mongodb.org/about/community/masters">MongoDB Masters</a></li>
  <li><a href="http://planet.mongodb.org">Planet MongoDB</a></li>
</ul>
<h3><a href="http://docs.mongodb.org/ecosystem/">MongoDB Ecosystem</a></h3>
<ul>
 <li><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers and Client libraries</a>
   <ul>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/c">C</a> (<a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/cpp">C++</a> (<a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/csharp">C#</a> (<a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/erlang">Erlang</a> (<a href="http://api.mongodb.org/erlang">docs</a>)</li>
     <li><a href="http://hackage.haskell.org/package/mongoDB">Haskell</a> (<a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/java">Java</a> (<a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/javascript">JavaScript</a> (<a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/perl">Perl</a> (<a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/php">PHP</a> (<a href="http://php.net/mongo/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/python">Python</a> (<a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/ruby">Ruby</a> (<a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/scala">Scala</a> (<a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
   </ul>
 </li>
 <li><a href="http://docs.mongodb.org/ecosystem/tools/">Tools and Integration</a></li>
 <li><a href="http://docs.mongodb.org/ecosystem/platforms/">Platform Integration</a></li>
</ul><h3>MongoDB Resources</h3>
<ul>
  <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
  <li><a href="http://www.10gen.com/events">MongoDB Events</a></li>
  <li><a href="http://www.10gen.com/presentations">Slides and Video</a></li>
  <li><a href="http://www.10gen.com/products/mms/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
</ul>
         </div>
       </div>
        <div class="clearer"></div>
      </div><div id="top-right">
        <div class="user-right">
          <ul id="header-menu-bar" class="ajs-menu-bar">
            <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
            <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
            <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
            <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
            <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
            <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
          </ul>
        </div>
      </div>
      <div class="search-db"><gcse:searchbox></gcse:searchbox></div>
          <div id="etp">
            <ul>
              <li><a href="https://github.com/mongodb/docs/blob/master/source/core/sharded-cluster-architectures.txt" target="_blank" title="Edit core/sharded-cluster-architectures.txt on GitHub">Edit this Page</a></li>
              <li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
              <li><a id="jirafeedback" href="https://jira.mongodb.org/secure/CreateIssueDetails!init.jspa?pid=10380&issuetype=4&priority=4&summary=Comment+on%3a+%22core/sharded-cluster-architectures%2Etxt%22" target="_blank" title="Report a problem with core/sharded-cluster-architectures.txt on Jira">Report a Problem</a></li>
            </ul>
          </div>
      <div class="footer">
        <p>
          &copy; <a href="">Copyright</a> 2011-2013, 10gen, Inc. 
          MongoDB&reg;, Mongo&reg;, and the leaf logo are registered trademarks of <a href="http://www.10gen.com/">10gen, Inc.</a>
        </p>
      </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">var _kiq = _kiq || [];</script>
<script type="text/javascript">
(function(){
setTimeout(function(){ var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//s3.amazonaws.com/ki.js/49119/a7n.js'; f.parentNode.insertBefore(s, f); }, 1);
})();
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-7301842-14', 'mongodb.org');
ga('send', 'pageview');
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script><script type="text/javascript">
jQuery.ajax({
	 url: "https://jira.mongodb.org/s/en_UScn8g8x/782/6/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId=298ba4e7",
	 type: "get",
	 cache: true,
	 dataType: "script"
	});
window.ATL_JQ_PAGE_PROPS =  {
	"triggerFunction": function(showCollectorDialog) {
		jQuery("#jirafeedback").click(function(e) {e.preventDefault();showCollectorDialog();});},
		fieldValues: {component: 'mongodb-manual', summary: 'Comment on: "manual/core/sharded-cluster-architectures.txt"'},
		environment: {'repo': 'docs','source': 'core/sharded-cluster-architectures'}
		};
</script><script type="text/javascript">
var versions = [{'t': '2.4 (current)', 'v': 'v2.4'}, {'t': '2.2', 'v': 'v2.2'}]
var pagename = 'core/sharded-cluster-architectures'
var stable = 'v2.4'

function vfnav() {
    if ( pagename=='index' ) {
        pn = ''
    }
    else {
        pn = pagename
    }

    v = $(this).children("option:selected").attr('value')

    if ( (v==0) || (v==stable) ) {
        uri = '/manual/' + pn
    }
    else {
        uri = '/' + v + '/' + pn
    }
    window.location.href= uri;
}

$(document).ready(function(){
    $("#vn").html(function(){
        s=$("<select/>");
        o='<option/>';

        $.each(versions,function(index, version) {
            if ( version.v==stable ) {
                dv=true;
            }
            $(o,{value:version.v,text: version.t}).appendTo(s);
        });

        if ( dv==false ) {
            $(o, {value:0,text:'(stable)'}).appendTo(s);
        }
        return(s);
    });

    $("#vn select").bind('change', vfnav);
    $('#vn select').val('v2.4');
});
</script>
</body>
</html>