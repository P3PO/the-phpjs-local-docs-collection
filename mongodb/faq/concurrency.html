<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head><title>FAQ: Concurrency &mdash; MongoDB Manual 2.4.3</title><link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index" />
  <meta name="release" content="2.4.3"/>
  <meta name="DC.Source" content="https://github.com/mongodb/docs/blob/master/source/faq/concurrency.txt"/>
      <link rel="canonical" href="http://docs.mongodb.org/manual/faq/concurrency" />
  
   <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
   <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      
   <script type="text/javascript">
     var DOCUMENTATION_OPTIONS = {
         URL_ROOT:    '../',
         VERSION:     '2.4',
         COLLAPSE_INDEX: false,
         FILE_SUFFIX: '.html',
         HAS_SOURCE:  false,
     };
   </script>
       <script type="text/javascript" src="../_static/jquery.js"></script>
       <script type="text/javascript" src="../_static/underscore.js"></script>
       <script type="text/javascript" src="../_static/doctools.js"></script>
          <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help"/>
<link rel="author" title="About these documents" href="../about.html" />
<link rel="top" title="MongoDB Manual" href="../index.html" />
<link rel="up" title="Frequently Asked Questions" href="../faq.html" />
<link rel="next" title="FAQ: Sharding with MongoDB" href="sharding.html" />
<link rel="prev" title="FAQ: The mongo Shell" href="mongo.html" />
          <script>
            (function() {
               var cx = '017213726194841070573:WMX6838984';
               var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
               gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
               var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
            })();
          </script></head>
<body>
      <div id="header-db" class="spread">
        <div class="split">
          <div id="logo">
            <div><a href="http://www.mongodb.org/"><img class="logo" src="http://media.mongodb.org/logo-mongodb.png" alt="MongoDB Logo"/></a></div>
          </div>
        </div>
      </div>  
      <div class="document">
           <div class="documentwrapper"><div class="bodywrapper">
               <div class="body">
                 
    <div class="bc">
      <ul>
          <li><a href="../faq.html">Frequently Asked Questions</a><span class="bcpoint"> > </span></li>
          <li>FAQ: Concurrency</li> 
      </ul>
    </div>
                 <div id="cse-results">
                   <gcse:searchresults linkTarget="_top"></gcse:searchresults>
                 </div>
                 
  <div class="section" id="faq-concurrency">
<h1>FAQ: Concurrency<a class="headerlink" href="#faq-concurrency" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="frequently-asked-questions">
<p class="topic-title first">Frequently Asked Questions:</p>
<ul class="simple">
<li><a class="reference internal" href="#what-type-of-locking-does-mongodb-use" id="id2">What type of locking does MongoDB use?</a></li>
<li><a class="reference internal" href="#how-granular-are-locks-in-mongodb" id="id3">How granular are locks in MongoDB?</a></li>
<li><a class="reference internal" href="#how-do-i-see-the-status-of-locks-on-my-mongod-instances" id="id4">How do I see the status of locks on my <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances?</a></li>
<li><a class="reference internal" href="#does-a-read-or-write-operation-ever-yield-the-lock" id="id5">Does a read or write operation ever yield the lock?</a></li>
<li><a class="reference internal" href="#which-operations-lock-the-database" id="id6">Which operations lock the database?</a></li>
<li><a class="reference internal" href="#which-administrative-commands-lock-the-database" id="id7">Which administrative commands lock the database?</a></li>
<li><a class="reference internal" href="#does-a-mongodb-operation-ever-lock-more-than-one-database" id="id8">Does a MongoDB operation ever lock more than one database?</a></li>
<li><a class="reference internal" href="#how-does-sharding-affect-concurrency" id="id9">How does sharding affect concurrency?</a></li>
<li><a class="reference internal" href="#how-does-concurrency-affect-a-replica-set-primary" id="id10">How does concurrency affect a replica set primary?</a></li>
<li><a class="reference internal" href="#how-does-concurrency-affect-secondaries" id="id11">How does concurrency affect secondaries?</a></li>
<li><a class="reference internal" href="#what-kind-of-concurrency-does-mongodb-provide-for-javascript-operations" id="id12">What kind of concurrency does MongoDB provide for JavaScript operations?</a></li>
</ul>
</div>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2.</span></p>
<p>MongoDB allows multiple clients to read and write a single corpus of
data using a locking system to ensure that all clients receive a
consistent view of the data <em>and</em> to prevent multiple applications
from modifying the exact same pieces of data at the same time. Locks
help guarantee that all writes to a single document occur either in
full or not at all.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://www.10gen.com/presentations/concurrency-internals-mongodb-2-2">Presentation on Concurrency and Internals in 2.2</a></p>
</div>
<div class="section" id="what-type-of-locking-does-mongodb-use">
<span id="faq-concurrency-locking"></span><h2>What type of locking does MongoDB use?<a class="headerlink" href="#what-type-of-locking-does-mongodb-use" title="Permalink to this headline">¶</a></h2>
<p>MongoDB uses a readers-writer <a class="footnote-reference" href="#multi-reader-lock-names" id="id1">[1]</a> lock that
allows concurrent reads access to a database but gives exclusive
access to a single write operation.</p>
<p>When a read lock exists, many read operations may use this lock. However, when
a write lock exists, a single write operation holds the lock
exclusively, and no other read <em>or</em> write operations may share the lock.</p>
<p>Locks are &#8220;writer greedy,&#8221; which means writes have preference over
reads. When both a read and write are waiting for a lock, MongoDB
grants the lock to the write.</p>
<table class="docutils footnote" frame="void" id="multi-reader-lock-names" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>You may be familiar with a
&#8220;readers-writer&#8221; lock as &#8220;multi-reader&#8221; or &#8220;shared exclusive&#8221;
lock. See the Wikipedia page on <a class="reference external" href="http://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock">Readers-Writer Locks</a> for
more information.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="how-granular-are-locks-in-mongodb">
<h2>How granular are locks in MongoDB?<a class="headerlink" href="#how-granular-are-locks-in-mongodb" title="Permalink to this headline">¶</a></h2>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2.</span></p>
<p>Beginning with version 2.2, MongoDB implements locks on a per-database
basis for most read and write operations. Some global operations,
typically short lived operations involving multiple databases, still
require a global &#8220;instance&#8221; wide lock. Before 2.2, there is only one
&#8220;global&#8221; lock per <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance.</p>
<p>For example, if you have six databases and one takes a write lock, the
other five are still available for read and write.</p>
</div>
<div class="section" id="how-do-i-see-the-status-of-locks-on-my-mongod-instances">
<h2>How do I see the status of locks on my <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances?<a class="headerlink" href="#how-do-i-see-the-status-of-locks-on-my-mongod-instances" title="Permalink to this headline">¶</a></h2>
<p>For reporting on lock utilization information on locks, use any of the
following methods:</p>
<ul class="simple">
<li><a class="reference internal" href="../reference/method/db.serverStatus.html#db.serverStatus" title="db.serverStatus()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.serverStatus()</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/method/db.currentOp.html#db.currentOp" title="db.currentOp()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/program/mongotop.html"><em>mongotop</em></a>,</li>
<li><a class="reference internal" href="../reference/program/mongostat.html"><em>mongostat</em></a>, and/or</li>
<li>the <a class="reference external" href="http://mms.10gen.com/">MongoDB Monitoring Service (MMS)</a></li>
</ul>
<p>Specifically, the <a class="reference internal" href="../reference/command/serverStatus.html#serverStatus.locks" title="serverStatus.locks"><tt class="xref mongodb mongodb-data docutils literal"><span class="pre">locks</span></tt></a> document in the <a class="reference internal" href="../reference/command/serverStatus.html"><em>output of
serverStatus</em></a>, or the <a class="reference internal" href="../reference/method/db.currentOp.html#currentOp.locks" title="currentOp.locks"><tt class="xref mongodb mongodb-data docutils literal"><span class="pre">locks</span></tt></a> field
in the <a class="reference internal" href="../reference/method/db.currentOp.html"><em>current operation reporting</em></a>
provides insight into the type of locks and amount of lock
contention in your <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance.</p>
<p>To terminate an operation, use <a class="reference internal" href="../reference/method/db.killOp.html#db.killOp" title="db.killOp()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.killOp()</span></tt></a>.</p>
</div>
<div class="section" id="does-a-read-or-write-operation-ever-yield-the-lock">
<span id="faq-concurrency-yielding"></span><h2>Does a read or write operation ever yield the lock?<a class="headerlink" href="#does-a-read-or-write-operation-ever-yield-the-lock" title="Permalink to this headline">¶</a></h2>
<p class="versionadded">
<span class="versionmodified">New in version 2.0.</span></p>
<p>Read and write operations will yield their locks if the
<a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> receives a <a class="reference internal" href="../reference/glossary.html#term-page-fault"><em class="xref std std-term">page fault</em></a> <em>or</em> fetches data that
is unlikely to be in memory. Yielding allows other operations that
only need to access documents that are already in memory to complete
while <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> loads documents into memory.</p>
<p>Additionally, write operations that affect multiple documents
(i.e. <a class="reference internal" href="../reference/method/db.collection.update.html#db.collection.update" title="db.collection.update()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> with the <tt class="docutils literal"><span class="pre">multi</span></tt>
parameter,) will yield periodically to allow read operations during
these long write operations. Similarly, long running read locks will
yield periodically to ensure that write operations have the
opportunity to complete.</p>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2: </span>The use of yielding expanded greatly in MongoDB 2.2. Including the
&#8220;yield for page fault.&#8221; MongoDB tracks the contents of memory and
predicts whether data is available before performing a read. If
MongoDB predicts that the data is not in memory a read operation
yields its lock while MongoDB loads the data to memory. Once data
is available in memory, the read will reacquire the lock to
complete the operation.</p>
</div>
<div class="section" id="which-operations-lock-the-database">
<span id="faq-concurrency-operations-locks"></span><h2>Which operations lock the database?<a class="headerlink" href="#which-operations-lock-the-database" title="Permalink to this headline">¶</a></h2>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2.</span></p>
<p>The following table lists common database operations and the types of
locks they use.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operation</th>
<th class="head">Lock Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Issue a query</td>
<td>Read lock</td>
</tr>
<tr class="row-odd"><td>Get more data from a <a class="reference internal" href="../reference/glossary.html#term-cursor"><em class="xref std std-term">cursor</em></a></td>
<td>Read lock</td>
</tr>
<tr class="row-even"><td>Insert data</td>
<td>Write lock</td>
</tr>
<tr class="row-odd"><td>Remove data</td>
<td>Write lock</td>
</tr>
<tr class="row-even"><td>Update data</td>
<td>Write lock</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../reference/glossary.html#term-map-reduce"><em class="xref std std-term">Map-reduce</em></a></td>
<td>Read lock and write lock, unless operations are specified as
non-atomic. Portions of map-reduce jobs can run concurrently.</td>
</tr>
<tr class="row-even"><td>Create an index</td>
<td>Building an index in the foreground, which is the default, locks
the database for extended periods of time.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../reference/method/db.eval.html#db.eval" title="db.eval()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a></td>
<td>Write lock. <a class="reference internal" href="../reference/method/db.eval.html#db.eval" title="db.eval()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> blocks all other JavaScript
processes.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../reference/command/eval.html#dbcmd.eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a></td>
<td>Write lock. If used with the <tt class="docutils literal"><span class="pre">nolock</span></tt> lock option, the
<a class="reference internal" href="../reference/command/eval.html#dbcmd.eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> option does not take a write lock and
cannot write data to the database.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../reference/method/db.collection.aggregate.html#db.collection.aggregate" title="db.collection.aggregate()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">aggregate()</span></tt></a></td>
<td>Read lock</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="which-administrative-commands-lock-the-database">
<h2>Which administrative commands lock the database?<a class="headerlink" href="#which-administrative-commands-lock-the-database" title="Permalink to this headline">¶</a></h2>
<p>Certain administrative commands can exclusively lock the database for
extended periods of time. In some deployments, for large databases,
you may consider taking the <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance offline so that
clients are not affected. For example, if a <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> is part
of a <a class="reference internal" href="../reference/glossary.html#term-replica-set"><em class="xref std std-term">replica set</em></a>, take the <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> offline and let
other members of the set service load while maintenance is in progress.</p>
<p>The following administrative operations require an exclusive
(i.e. write) lock on the database for extended periods:</p>
<ul class="simple">
<li><a class="reference internal" href="../reference/method/db.collection.ensureIndex.html#db.collection.ensureIndex" title="db.collection.ensureIndex()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.ensureIndex()</span></tt></a>, when issued
<em>without</em> setting <tt class="docutils literal"><span class="pre">background</span></tt> to <tt class="docutils literal"><span class="pre">true</span></tt>,</li>
<li><a class="reference internal" href="../reference/command/reIndex.html#dbcmd.reIndex" title="reIndex"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">reIndex</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/command/compact.html#dbcmd.compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/method/db.repairDatabase.html#db.repairDatabase" title="db.repairDatabase()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.repairDatabase()</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/method/db.createCollection.html#db.createCollection" title="db.createCollection()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.createCollection()</span></tt></a>, when creating a very large
(i.e. many gigabytes) capped collection,</li>
<li><a class="reference internal" href="../reference/method/db.collection.validate.html#db.collection.validate" title="db.collection.validate()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.validate()</span></tt></a>, and</li>
<li><a class="reference internal" href="../reference/method/db.copyDatabase.html#db.copyDatabase" title="db.copyDatabase()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.copyDatabase()</span></tt></a>. This operation may lock all
databases. See <a class="reference internal" href="#faq-concurrency-lock-multiple-dbs"><em>Does a MongoDB operation ever lock more than one database?</em></a>.</li>
</ul>
<p>The following administrative commands lock the database but only hold
the lock for a very short time:</p>
<ul class="simple">
<li><a class="reference internal" href="../reference/method/db.collection.dropIndex.html#db.collection.dropIndex" title="db.collection.dropIndex()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.dropIndex()</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/method/db.getLastError.html#db.getLastError" title="db.getLastError()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.getLastError()</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/method/db.isMaster.html#db.isMaster" title="db.isMaster()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.isMaster()</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/method/rs.status.html#rs.status" title="rs.status()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.status()</span></tt></a> (i.e. <a class="reference internal" href="../reference/command/replSetGetStatus.html#dbcmd.replSetGetStatus" title="replSetGetStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetGetStatus</span></tt></a>,)</li>
<li><a class="reference internal" href="../reference/method/db.serverStatus.html#db.serverStatus" title="db.serverStatus()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.serverStatus()</span></tt></a>,</li>
<li><a class="reference internal" href="../reference/method/db.auth.html#db.auth" title="db.auth()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.auth()</span></tt></a>, and</li>
<li><a class="reference internal" href="../reference/method/db.addUser.html#db.addUser" title="db.addUser()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.addUser()</span></tt></a>.</li>
</ul>
</div>
<div class="section" id="does-a-mongodb-operation-ever-lock-more-than-one-database">
<span id="faq-concurrency-lock-multiple-dbs"></span><h2>Does a MongoDB operation ever lock more than one database?<a class="headerlink" href="#does-a-mongodb-operation-ever-lock-more-than-one-database" title="Permalink to this headline">¶</a></h2>
<p>The following MongoDB operations lock multiple databases:</p>
<ul class="simple">
<li><a class="reference internal" href="../reference/method/db.copyDatabase.html#db.copyDatabase" title="db.copyDatabase()"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.copyDatabase()</span></tt></a> must lock the entire <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
instance at once.</li>
<li><a class="reference internal" href="../reference/glossary.html#term-journal"><em class="xref std std-term">Journaling</em></a>, which is an internal operation, locks
all databases for short intervals. All databases share a single
journal.</li>
<li><a class="reference internal" href="../core/access-control.html"><em>User authentication</em></a> locks the
<tt class="docutils literal"><span class="pre">admin</span></tt> database as well as the database the user is accessing.</li>
<li>All writes to a replica set&#8217;s <a class="reference internal" href="../reference/glossary.html#term-primary"><em class="xref std std-term">primary</em></a> lock both the database
receiving the writes and the <tt class="docutils literal"><span class="pre">local</span></tt> database. The lock for the
<tt class="docutils literal"><span class="pre">local</span></tt> database allows the <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> to write to the
primary&#8217;s <a class="reference internal" href="../reference/glossary.html#term-oplog"><em class="xref std std-term">oplog</em></a>.</li>
</ul>
</div>
<div class="section" id="how-does-sharding-affect-concurrency">
<h2>How does sharding affect concurrency?<a class="headerlink" href="#how-does-sharding-affect-concurrency" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/glossary.html#term-sharding"><em class="xref std std-term">Sharding</em></a> improves concurrency by distributing
collections over multiple <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances, allowing shard
servers (i.e. <a class="reference internal" href="../reference/program/mongos.html#bin.mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> processes) to perform any number of
operations concurrently to the various downstream <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
instances.</p>
<p>Each <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance is independent of the others in the
shard cluster and uses the MongoDB <a class="reference internal" href="#faq-concurrency-locking"><em>readers-writer lock</em></a>). The operations on one <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a>
instance do not block the operations on any others.</p>
</div>
<div class="section" id="how-does-concurrency-affect-a-replica-set-primary">
<span id="faq-concurrency-replication"></span><h2>How does concurrency affect a replica set primary?<a class="headerlink" href="#how-does-concurrency-affect-a-replica-set-primary" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference internal" href="../reference/glossary.html#term-replication"><em class="xref std std-term">replication</em></a>, when MongoDB writes to a collection on the
<a class="reference internal" href="../reference/glossary.html#term-primary"><em class="xref std std-term">primary</em></a>, MongoDB also writes to the primary&#8217;s <a class="reference internal" href="../reference/glossary.html#term-oplog"><em class="xref std std-term">oplog</em></a>,
which is a special collection in the <tt class="docutils literal"><span class="pre">local</span></tt> database.  Therefore,
MongoDB must lock both the collection&#8217;s database and the <tt class="docutils literal"><span class="pre">local</span></tt>
database. The <a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> must lock both databases at the same
time keep both data consistent and ensure that write operations, even
with replication, are &#8220;all-or-nothing&#8221; operations.</p>
</div>
<div class="section" id="how-does-concurrency-affect-secondaries">
<h2>How does concurrency affect secondaries?<a class="headerlink" href="#how-does-concurrency-affect-secondaries" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference internal" href="../reference/glossary.html#term-replication"><em class="xref std std-term">replication</em></a>, MongoDB does not apply writes serially to
<a class="reference internal" href="../reference/glossary.html#term-secondary"><em class="xref std std-term">secondaries</em></a>. Secondaries collect oplog entries in
batches and then apply those batches in parallel. Secondaries do not
allow reads while applying the write operations, and apply write
operations in the order that they appear in the oplog.</p>
<p>MongoDB can apply several writes in parallel on replica set
secondaries, in two phases:</p>
<ol class="arabic simple">
<li>During the first <em>prefer</em> phase, under a read lock, the
<a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> ensures that all documents affected by the
operations are in memory. During this phase, other clients may
execute queries against this member.</li>
<li>A thread pool using write locks applies all write operations in the
batch as part of a coordinated write phase.</li>
</ol>
</div>
<div class="section" id="what-kind-of-concurrency-does-mongodb-provide-for-javascript-operations">
<h2>What kind of concurrency does MongoDB provide for JavaScript operations?<a class="headerlink" href="#what-kind-of-concurrency-does-mongodb-provide-for-javascript-operations" title="Permalink to this headline">¶</a></h2>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.4: </span>The V8 JavaScript engine added in 2.4 allows multiple JavaScript
operations to run at the same time. Prior to 2.4, a single
<a class="reference internal" href="../reference/program/mongod.html#bin.mongod" title="mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> could only run a <em>single</em> JavaScript operation at
once.</p>
</div>
</div>


    <div id="btnv">
        <ul id="btnvl">
              <li id="btnvpr"><a href="mongo.html" title="Previous Section: FAQ: The mongo Shell">&lt; &nbsp; FAQ: The mongo Shell</a></li>
              <li id="btnvup"><a href="../faq.html" title="Parent Section: Frequently Asked Questions" >&#47;&#92;&nbsp; Frequently Asked Questions</a></li>
              <li id="btnvnx"><a href="sharding.html" title="Next Section: FAQ: Sharding with MongoDB">FAQ: Sharding with MongoDB &nbsp;&gt;</a></li>
        </ul>
    </div></div></div>
           </div>
       <div class="sphinxsidebar">
         <div class="sphinxsidebarwrapper">
  <h3>
    <a href="../index.html">MongoDB Manual</a> <span id="vn">2.4</span>
  </h3>



<div class="site-contents"><a href="../contents.html">Contents</a></div>


<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../administration.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crud.html">Core MongoDB Operations (CRUD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-modeling.html">Data Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aggregation.html">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indexes.html">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sharding.html">Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mongo.html">The <tt class="docutils literal"><span class="pre">mongo</span></tt> Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use-cases.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fundamentals.html">FAQ: MongoDB Fundamentals</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html">FAQ: MongoDB for Application Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongo.html">FAQ: The <tt class="docutils literal"><span class="pre">mongo</span></tt> Shell</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">FAQ: Concurrency</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sharding.html">FAQ: Sharding with MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="replica-sets.html">FAQ: Replica Sets and Replication in MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="storage.html">FAQ: MongoDB Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexes.html">FAQ: Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">FAQ: MongoDB Diagnostics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About MongoDB Documentation</a></li>
</ul>



<div class="site-index"><a href="../genindex.html">Index</a></div>
<h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="/manual/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul>
<h3><a href="http://www.mongodb.org/about/">About MongoDB</a></h3>
<ul>
  <li><a href="http://www.mongodb.org/about/introduction">Introduction</a></li>
  <li><a href="http://www.mongodb.org/about/community">User Community</a></li>
  <li><a href="http://mongodb.org/about/community/masters">MongoDB Masters</a></li>
  <li><a href="http://planet.mongodb.org">Planet MongoDB</a></li>
</ul>
<h3><a href="http://docs.mongodb.org/ecosystem/">MongoDB Ecosystem</a></h3>
<ul>
 <li><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers and Client libraries</a>
   <ul>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/c">C</a> (<a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/cpp">C++</a> (<a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/csharp">C#</a> (<a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/erlang">Erlang</a> (<a href="http://api.mongodb.org/erlang">docs</a>)</li>
     <li><a href="http://hackage.haskell.org/package/mongoDB">Haskell</a> (<a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/java">Java</a> (<a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/javascript">JavaScript</a> (<a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/perl">Perl</a> (<a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/php">PHP</a> (<a href="http://php.net/mongo/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/python">Python</a> (<a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/ruby">Ruby</a> (<a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/scala">Scala</a> (<a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
   </ul>
 </li>
 <li><a href="http://docs.mongodb.org/ecosystem/tools/">Tools and Integration</a></li>
 <li><a href="http://docs.mongodb.org/ecosystem/platforms/">Platform Integration</a></li>
</ul><h3>MongoDB Resources</h3>
<ul>
  <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
  <li><a href="http://www.10gen.com/events">MongoDB Events</a></li>
  <li><a href="http://www.10gen.com/presentations">Slides and Video</a></li>
  <li><a href="http://www.10gen.com/products/mms/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
</ul>
         </div>
       </div>
        <div class="clearer"></div>
      </div><div id="top-right">
        <div class="user-right">
          <ul id="header-menu-bar" class="ajs-menu-bar">
            <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
            <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
            <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
            <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
            <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
            <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
          </ul>
        </div>
      </div>
      <div class="search-db"><gcse:searchbox></gcse:searchbox></div>
          <div id="etp">
            <ul>
              <li><a href="https://github.com/mongodb/docs/blob/master/source/faq/concurrency.txt" target="_blank" title="Edit faq/concurrency.txt on GitHub">Edit this Page</a></li>
              <li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
              <li><a id="jirafeedback" href="https://jira.mongodb.org/secure/CreateIssueDetails!init.jspa?pid=10380&issuetype=4&priority=4&summary=Comment+on%3a+%22faq/concurrency%2Etxt%22" target="_blank" title="Report a problem with faq/concurrency.txt on Jira">Report a Problem</a></li>
            </ul>
          </div>
      <div class="footer">
        <p>
          &copy; <a href="">Copyright</a> 2011-2013, 10gen, Inc. 
          MongoDB&reg;, Mongo&reg;, and the leaf logo are registered trademarks of <a href="http://www.10gen.com/">10gen, Inc.</a>
        </p>
      </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">var _kiq = _kiq || [];</script>
<script type="text/javascript">
(function(){
setTimeout(function(){ var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//s3.amazonaws.com/ki.js/49119/a7n.js'; f.parentNode.insertBefore(s, f); }, 1);
})();
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-7301842-14', 'mongodb.org');
ga('send', 'pageview');
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script><script type="text/javascript">
jQuery.ajax({
	 url: "https://jira.mongodb.org/s/en_UScn8g8x/782/6/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId=298ba4e7",
	 type: "get",
	 cache: true,
	 dataType: "script"
	});
window.ATL_JQ_PAGE_PROPS =  {
	"triggerFunction": function(showCollectorDialog) {
		jQuery("#jirafeedback").click(function(e) {e.preventDefault();showCollectorDialog();});},
		fieldValues: {component: 'mongodb-manual', summary: 'Comment on: "manual/faq/concurrency.txt"'},
		environment: {'repo': 'docs','source': 'faq/concurrency'}
		};
</script><script type="text/javascript">
var versions = [{'t': '2.4 (current)', 'v': 'v2.4'}, {'t': '2.2', 'v': 'v2.2'}]
var pagename = 'faq/concurrency'
var stable = 'v2.4'

function vfnav() {
    if ( pagename=='index' ) {
        pn = ''
    }
    else {
        pn = pagename
    }

    v = $(this).children("option:selected").attr('value')

    if ( (v==0) || (v==stable) ) {
        uri = '/manual/' + pn
    }
    else {
        uri = '/' + v + '/' + pn
    }
    window.location.href= uri;
}

$(document).ready(function(){
    $("#vn").html(function(){
        s=$("<select/>");
        o='<option/>';

        $.each(versions,function(index, version) {
            if ( version.v==stable ) {
                dv=true;
            }
            $(o,{value:version.v,text: version.t}).appendTo(s);
        });

        if ( dv==false ) {
            $(o, {value:0,text:'(stable)'}).appendTo(s);
        }
        return(s);
    });

    $("#vn select").bind('change', vfnav);
    $('#vn select').val('v2.4');
});
</script>
</body>
</html>