
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>10. Events &mdash; Doctrine 2 ORM 2 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script src="../_static/bootstrap/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/doctrine.ico"/>
    <link rel="top" title="Doctrine 2 ORM 2 documentation" href="../index.html" />
    <link rel="next" title="11. Doctrine Internals explained" href="unitofwork.html" />
    <link rel="prev" title="9. Working with Associations" href="working-with-associations.html" />
 
<!-- RTD Extra Head -->


<script type="text/javascript" src="//media.readthedocs.org/javascript/rtd.js"></script>
<link rel="stylesheet" href="//media.readthedocs.org/css/rtd-shim.css" type="text/css" />
<!-- end RTD <extrahead> -->

  </head>
  <body>
    <div id="wrapper">
      <div id="header">
        <h1 id="h1title"></h1>
        <div id="logo">
          <a href="http://www.doctrine-project.org/">Doctrine - PHP Database Libraries</a>
        </div>
      </div>
      <div id="nav" class="cls">
        <div class="tl cls">
          <ul>
            <li><a target="_top" href="/">home</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/about">about</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects.html">projects</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/orm">orm</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/dbal">dbal</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/blog">blog</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/jira">development</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/contribute">contribute</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/community">community</a></li>
          </ul>
        </div>
      </div>
      <div id="content" class="cls">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="unitofwork.html" title="11. Doctrine Internals explained"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="working-with-associations.html" title="9. Working with Associations"
             accesskey="P">previous</a> |</li>
        <li><a href="/">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine 2 ORM 2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

        <div class="document">
            <div class="documentwrapper">
                <div class="bodywrapper">

              <div class="body" >
                
  <div class="section" id="events">
<h1>10. Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h1>
<p>Doctrine 2 features a lightweight event system that is part of the
Common package. Doctrine uses it to dispatch system events, mainly
<a class="reference internal" href="#reference-events-lifecycle-events"><em>lifecycle events</em></a>.
You can also use it for your own custom events.</p>
<div class="section" id="the-event-system">
<h2>10.1. The Event System<a class="headerlink" href="#the-event-system" title="Permalink to this headline">¶</a></h2>
<p>The event system is controlled by the <tt class="docutils literal"><span class="pre">EventManager</span></tt>. It is the
central point of Doctrine&#8217;s event listener system. Listeners are
registered on the manager and events are dispatched through the
manager.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$evm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventManager</span><span class="p">();</span>
</pre></div>
</div>
<p>Now we can add some event listeners to the <tt class="docutils literal"><span class="pre">$evm</span></tt>. Let&#8217;s create a
<tt class="docutils literal"><span class="pre">TestEvent</span></tt> class to play around with.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">TestEvent</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="no">preFoo</span> <span class="o">=</span> <span class="s1">&#39;preFoo&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">postFoo</span> <span class="o">=</span> <span class="s1">&#39;postFoo&#39;</span><span class="p">;</span>

    <span class="k">private</span> <span class="nv">$_evm</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$preFooInvoked</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$postFooInvoked</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$evm</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$evm</span><span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">preFoo</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">postFoo</span><span class="p">),</span> <span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">preFoo</span><span class="p">(</span><span class="nx">EventArgs</span> <span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">preFooInvoked</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">postFoo</span><span class="p">(</span><span class="nx">EventArgs</span> <span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postFooInvoked</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Create a new instance</span>
<span class="nv">$test</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TestEvent</span><span class="p">(</span><span class="nv">$evm</span><span class="p">);</span>
</pre></div>
</div>
<p>Events can be dispatched by using the <tt class="docutils literal"><span class="pre">dispatchEvent()</span></tt> method.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$evm</span><span class="o">-&gt;</span><span class="na">dispatchEvent</span><span class="p">(</span><span class="nx">TestEvent</span><span class="o">::</span><span class="na">preFoo</span><span class="p">);</span>
<span class="nv">$evm</span><span class="o">-&gt;</span><span class="na">dispatchEvent</span><span class="p">(</span><span class="nx">TestEvent</span><span class="o">::</span><span class="na">postFoo</span><span class="p">);</span>
</pre></div>
</div>
<p>You can easily remove a listener with the <tt class="docutils literal"><span class="pre">removeEventListener()</span></tt>
method.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$evm</span><span class="o">-&gt;</span><span class="na">removeEventListener</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">preFoo</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">postFoo</span><span class="p">),</span> <span class="nv">$this</span><span class="p">);</span>
</pre></div>
</div>
<p>The Doctrine 2 event system also has a simple concept of event
subscribers. We can define a simple <tt class="docutils literal"><span class="pre">TestEventSubscriber</span></tt> class
which implements the <tt class="docutils literal"><span class="pre">\Doctrine\Common\EventSubscriber</span></tt> interface
and implements a <tt class="docutils literal"><span class="pre">getSubscribedEvents()</span></tt> method which returns an
array of events it should be subscribed to.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">TestEventSubscriber</span> <span class="k">implements</span> <span class="nx">\Doctrine\Common\EventSubscriber</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$preFooInvoked</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">preFoo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">preFooInvoked</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nx">TestEvent</span><span class="o">::</span><span class="na">preFoo</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$eventSubscriber</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TestEventSubscriber</span><span class="p">();</span>
<span class="nv">$evm</span><span class="o">-&gt;</span><span class="na">addEventSubscriber</span><span class="p">(</span><span class="nv">$eventSubscriber</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The array to return in the <tt class="docutils literal"><span class="pre">getSubscribedEvents</span></tt> method is a simple array
with the values being the event names. The subscriber must have a method
that is named exactly like the event.</p>
</div>
<p>Now when you dispatch an event, any event subscribers will be
notified for that event.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$evm</span><span class="o">-&gt;</span><span class="na">dispatchEvent</span><span class="p">(</span><span class="nx">TestEvent</span><span class="o">::</span><span class="na">preFoo</span><span class="p">);</span>
</pre></div>
</div>
<p>Now you can test the <tt class="docutils literal"><span class="pre">$eventSubscriber</span></tt> instance to see if the
<tt class="docutils literal"><span class="pre">preFoo()</span></tt> method was invoked.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$eventSubscriber</span><span class="o">-&gt;</span><span class="na">preFooInvoked</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;pre foo invoked!&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="naming-convention">
<h3>10.1.1. Naming convention<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h3>
<p>Events being used with the Doctrine 2 EventManager are best named
with camelcase and the value of the corresponding constant should
be the name of the constant itself, even with spelling. This has
several reasons:</p>
<ul class="simple">
<li>It is easy to read.</li>
<li>Simplicity.</li>
<li>Each method within an EventSubscriber is named after the
corresponding constant&#8217;s value. If the constant&#8217;s name and value differ
it contradicts the intention of using the constant and makes your code
harder to maintain.</li>
</ul>
<p>An example for a correct notation can be found in the example
<tt class="docutils literal"><span class="pre">TestEvent</span></tt> above.</p>
</div>
</div>
<div class="section" id="lifecycle-events">
<span id="reference-events-lifecycle-events"></span><h2>10.2. Lifecycle Events<a class="headerlink" href="#lifecycle-events" title="Permalink to this headline">¶</a></h2>
<p>The EntityManager and UnitOfWork trigger a bunch of events during
the life-time of their registered entities.</p>
<ul class="simple">
<li>preRemove - The preRemove event occurs for a given entity before
the respective EntityManager remove operation for that entity is
executed.  It is not called for a DQL DELETE statement.</li>
<li>postRemove - The postRemove event occurs for an entity after the
entity has been deleted. It will be invoked after the database
delete operations. It is not called for a DQL DELETE statement.</li>
<li>prePersist - The prePersist event occurs for a given entity
before the respective EntityManager persist operation for that
entity is executed. It should be noted that this event is only triggered on
<em>initial</em> persist of an entity (i.e. it does not trigger on future updates).</li>
<li>postPersist - The postPersist event occurs for an entity after
the entity has been made persistent. It will be invoked after the
database insert operations. Generated primary key values are
available in the postPersist event.</li>
<li>preUpdate - The preUpdate event occurs before the database
update operations to entity data. It is not called for a DQL UPDATE statement.</li>
<li>postUpdate - The postUpdate event occurs after the database
update operations to entity data. It is not called for a DQL UPDATE statement.</li>
<li>postLoad - The postLoad event occurs for an entity after the
entity has been loaded into the current EntityManager from the
database or after the refresh operation has been applied to it.</li>
<li>loadClassMetadata - The loadClassMetadata event occurs after the
mapping metadata for a class has been loaded from a mapping source
(annotations/xml/yaml). This event is not a lifecycle callback.</li>
<li>preFlush - The preFlush event occurs at the very beginning of a flush
operation. This event is not a lifecycle callback.</li>
<li>onFlush - The onFlush event occurs after the change-sets of all
managed entities are computed. This event is not a lifecycle
callback.</li>
<li>postFlush - The postFlush event occurs at the end of a flush operation. This
event is not a lifecycle callback.</li>
<li>onClear - The onClear event occurs when the EntityManager#clear() operation is
invoked, after all references to entities have been removed from the unit of
work. This event is not a lifecycle callback.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Note that the postLoad event occurs for an entity
before any associations have been initialized. Therefore it is not
safe to access associations in a postLoad callback or event
handler.</p>
</div>
<p>You can access the Event constants from the <tt class="docutils literal"><span class="pre">Events</span></tt> class in the
ORM package.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Events</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">Events</span><span class="o">::</span><span class="na">preUpdate</span><span class="p">;</span>
</pre></div>
</div>
<p>These can be hooked into by two different types of event
listeners:</p>
<ul class="simple">
<li>Lifecycle Callbacks are methods on the entity classes that are
called when the event is triggered. As of v2.4 they receive some kind
of <tt class="docutils literal"><span class="pre">EventArgs</span></tt> instance.</li>
<li>Lifecycle Event Listeners and Subscribers are classes with specific callback
methods that receives some kind of <tt class="docutils literal"><span class="pre">EventArgs</span></tt> instance.</li>
</ul>
<p>The EventArgs instance received by the listener gives access to the entity,
EntityManager and other relevant data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All Lifecycle events that happen during the <tt class="docutils literal"><span class="pre">flush()</span></tt> of
an EntityManager have very specific constraints on the allowed
operations that can be executed. Please read the
<a class="reference internal" href="#reference-events-implementing-listeners"><em>Implementing Event Listeners</em></a> section very carefully
to understand which operations are allowed in which lifecycle event.</p>
</div>
</div>
<div class="section" id="lifecycle-callbacks">
<h2>10.3. Lifecycle Callbacks<a class="headerlink" href="#lifecycle-callbacks" title="Permalink to this headline">¶</a></h2>
<p>Lifecycle Callbacks are defined on an entity class. They allow you to
trigger callbacks whenever an instance of that entity class experiences
a relevant lifecycle event. More than one callback can be defined for each
lifecycle event. Lifecycle Callbacks are best used for simple operations
specific to a particular entity class&#8217;s lifecycle.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/** @Entity @HasLifecycleCallbacks */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;, length=255)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$value</span><span class="p">;</span>

    <span class="sd">/** @Column(name=&quot;created_at&quot;, type=&quot;string&quot;, length=255) */</span>
    <span class="k">private</span> <span class="nv">$createdAt</span><span class="p">;</span>

    <span class="sd">/** @PrePersist */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doStuffOnPrePersist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createdAt</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/** @PrePersist */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doOtherStuffOnPrePersist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="s1">&#39;changed from prePersist callback!&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/** @PostPersist */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doStuffOnPostPersist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="s1">&#39;changed from postPersist callback!&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/** @PostLoad */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doStuffOnPostLoad</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="s1">&#39;changed from postLoad callback!&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/** @PreUpdate */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doStuffOnPreUpdate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="s1">&#39;changed from preUpdate callback!&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the methods set as lifecycle callbacks need to be public and,
when using these annotations, you have to apply the
<tt class="docutils literal"><span class="pre">&#64;HasLifecycleCallbacks</span></tt> marker annotation on the entity class.</p>
<p>If you want to register lifecycle callbacks from YAML or XML you
can do it with the following.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
  <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span>
<span class="c1"># ...</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string(50)</span>
  <span class="l-Scalar-Plain">lifecycleCallbacks</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">prePersist</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">doStuffOnPrePersist</span><span class="p-Indicator">,</span> <span class="nv">doOtherStuffOnPrePersist</span> <span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">postPersist</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">doStuffOnPostPersist</span> <span class="p-Indicator">]</span>
</pre></div>
</div>
<p>In YAML the <tt class="docutils literal"><span class="pre">key</span></tt> of the lifecycleCallbacks entry is the event that you
are triggering on and the value is the method (or methods) to call. The allowed
event types are the ones listed in the previous Lifecycle Events section.</p>
<p>XML would look something like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;doctrine-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping&quot;</span>
      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping</span>
<span class="s">                          /Users/robo/dev/php/Doctrine/doctrine-mapping.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;User&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;lifecycle-callbacks&gt;</span>
            <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;prePersist&quot;</span> <span class="na">method=</span><span class="s">&quot;doStuffOnPrePersist&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;postPersist&quot;</span> <span class="na">method=</span><span class="s">&quot;doStuffOnPostPersist&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/lifecycle-callbacks&gt;</span>

    <span class="nt">&lt;/entity&gt;</span>

<span class="nt">&lt;/doctrine-mapping&gt;</span>
</pre></div>
</div>
<p>In XML the <tt class="docutils literal"><span class="pre">type</span></tt> of the lifecycle-callback entry is the event that you
are triggering on and the <tt class="docutils literal"><span class="pre">method</span></tt> is the method to call. The allowed event
types are the ones listed in the previous Lifecycle Events section.</p>
<p>When using YAML or XML you need to remember to create public methods to match the
callback names you defined. E.g. in these examples <tt class="docutils literal"><span class="pre">doStuffOnPrePersist()</span></tt>,
<tt class="docutils literal"><span class="pre">doOtherStuffOnPrePersist()</span></tt> and <tt class="docutils literal"><span class="pre">doStuffOnPostPersist()</span></tt> methods need to be
defined on your <tt class="docutils literal"><span class="pre">User</span></tt> model.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">doStuffOnPrePersist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">doOtherStuffOnPrePersist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">doStuffOnPostPersist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="lifecycle-callbacks-event-argument">
<h2>10.4. Lifecycle Callbacks Event Argument<a class="headerlink" href="#lifecycle-callbacks-event-argument" title="Permalink to this headline">¶</a></h2>
<p class="versionadded">
<span class="versionmodified">New in version 2.4.</span></p>
<p>Since 2.4 the triggered event is given to the lifecycle-callback.</p>
<p>With the additional argument you have access to the
<tt class="docutils literal"><span class="pre">EntityManager</span></tt> and <tt class="docutils literal"><span class="pre">UnitOfWork</span></tt> APIs inside these callback methods.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preUpdate</span><span class="p">(</span><span class="nx">PreUpdateEventArgs</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">hasChangedField</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Do something when the username is changed.</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="listening-and-subscribing-to-lifecycle-events">
<h2>10.5. Listening and subscribing to Lifecycle Events<a class="headerlink" href="#listening-and-subscribing-to-lifecycle-events" title="Permalink to this headline">¶</a></h2>
<p>Lifecycle event listeners are much more powerful than the simple
lifecycle callbacks that are defined on the entity classes. They
sit at a level above the entities and allow you to implement re-usable
behaviors across different entity classes.</p>
<p>Note that they require much more detailed knowledge about the inner
workings of the EntityManager and UnitOfWork. Please read the
<em>Implementing Event Listeners</em> section carefully if you are trying
to write your own listener.</p>
<p>For event subscribers, there are no surprises. They declare the
lifecycle events in their <tt class="docutils literal"><span class="pre">getSubscribedEvents</span></tt> method and provide
public methods that expect the relevant arguments.</p>
<p>A lifecycle event listener looks like the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\Event\LifecycleEventArgs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyEventListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preUpdate</span><span class="p">(</span><span class="nx">LifecycleEventArgs</span> <span class="nv">$args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$entity</span> <span class="o">=</span> <span class="nv">$args</span><span class="o">-&gt;</span><span class="na">getObject</span><span class="p">();</span>
        <span class="nv">$entityManager</span> <span class="o">=</span> <span class="nv">$args</span><span class="o">-&gt;</span><span class="na">getObjectManager</span><span class="p">();</span>

        <span class="c1">// perhaps you only want to act on some &quot;Product&quot; entity</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span> <span class="nx">instanceof</span> <span class="nx">Product</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// do something with the Product</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A lifecycle event subscriber may looks like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Events</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\EventSubscriber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\Event\LifecycleEventArgs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyEventSubscriber</span> <span class="k">implements</span> <span class="nx">EventSubscriber</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">Events</span><span class="o">::</span><span class="na">postUpdate</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">postUpdate</span><span class="p">(</span><span class="nx">LifecycleEventArgs</span> <span class="nv">$args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$entity</span> <span class="o">=</span> <span class="nv">$args</span><span class="o">-&gt;</span><span class="na">getObject</span><span class="p">();</span>
        <span class="nv">$entityManager</span> <span class="o">=</span> <span class="nv">$args</span><span class="o">-&gt;</span><span class="na">getObjectManager</span><span class="p">();</span>

        <span class="c1">// perhaps you only want to act on some &quot;Product&quot; entity</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span> <span class="nx">instanceof</span> <span class="nx">Product</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// do something with the Product</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lifecycle events are triggered for all entities. It is the responsibility
of the listeners and subscribers to check if the entity is of a type
it wants to handle.</p>
</div>
<p>To register an event listener or subscriber, you have to hook it into the
EventManager that is passed to the EntityManager factory:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$eventManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventManager</span><span class="p">();</span>
<span class="nv">$eventManager</span><span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nx">Events</span><span class="o">::</span><span class="na">preUpdate</span><span class="p">),</span> <span class="k">new</span> <span class="nx">MyEventListener</span><span class="p">());</span>
<span class="nv">$eventManager</span><span class="o">-&gt;</span><span class="na">addEventSubscriber</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyEventSubscriber</span><span class="p">());</span>

<span class="nv">$entityManager</span> <span class="o">=</span> <span class="nx">EntityManager</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$dbOpts</span><span class="p">,</span> <span class="nv">$config</span><span class="p">,</span> <span class="nv">$eventManager</span><span class="p">);</span>
</pre></div>
</div>
<p>You can also retrieve the event manager instance after the
EntityManager was created:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nx">Events</span><span class="o">::</span><span class="na">preUpdate</span><span class="p">),</span> <span class="k">new</span> <span class="nx">MyEventListener</span><span class="p">());</span>
<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addEventSubscriber</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyEventSubscriber</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="implementing-event-listeners">
<span id="reference-events-implementing-listeners"></span><h2>10.6. Implementing Event Listeners<a class="headerlink" href="#implementing-event-listeners" title="Permalink to this headline">¶</a></h2>
<p>This section explains what is and what is not allowed during
specific lifecycle events of the UnitOfWork. Although you get
passed the EntityManager in all of these events, you have to follow
these restrictions very carefully since operations in the wrong
event may produce lots of different errors, such as inconsistent
data and lost updates/persists/removes.</p>
<p>For the described events that are also lifecycle callback events
the restrictions apply as well, with the additional restriction
that (prior to version 2.4) you do not have access to the
EntityManager or UnitOfWork APIs inside these events.</p>
<div class="section" id="prepersist">
<h3>10.6.1. prePersist<a class="headerlink" href="#prepersist" title="Permalink to this headline">¶</a></h3>
<p>There are two ways for the <tt class="docutils literal"><span class="pre">prePersist</span></tt> event to be triggered.
One is obviously when you call <tt class="docutils literal"><span class="pre">EntityManager#persist()</span></tt>. The
event is also called for all cascaded associations.</p>
<p>There is another way for <tt class="docutils literal"><span class="pre">prePersist</span></tt> to be called, inside the
<tt class="docutils literal"><span class="pre">flush()</span></tt> method when changes to associations are computed and
this association is marked as cascade persist. Any new entity found
during this operation is also persisted and <tt class="docutils literal"><span class="pre">prePersist</span></tt> called
on it. This is called &#8220;persistence by reachability&#8221;.</p>
<p>In both cases you get passed a <tt class="docutils literal"><span class="pre">LifecycleEventArgs</span></tt> instance
which has access to the entity and the entity manager.</p>
<p>The following restrictions apply to <tt class="docutils literal"><span class="pre">prePersist</span></tt>:</p>
<ul class="simple">
<li>If you are using a PrePersist Identity Generator such as
sequences the ID value will <em>NOT</em> be available within any
PrePersist events.</li>
<li>Doctrine will not recognize changes made to relations in a prePersist
event called by &#8220;reachability&#8221; through a cascade persist unless you
use the internal <tt class="docutils literal"><span class="pre">UnitOfWork</span></tt> API. We do not recommend such
operations in the persistence by reachability context, so do
this at your own risk and possibly supported by unit-tests.</li>
</ul>
</div>
<div class="section" id="preremove">
<h3>10.6.2. preRemove<a class="headerlink" href="#preremove" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">preRemove</span></tt> event is called on every entity when its passed
to the <tt class="docutils literal"><span class="pre">EntityManager#remove()</span></tt> method. It is cascaded for all
associations that are marked as cascade delete.</p>
<p>There are no restrictions to what methods can be called inside the
<tt class="docutils literal"><span class="pre">preRemove</span></tt> event, except when the remove method itself was
called during a flush operation.</p>
</div>
<div class="section" id="preflush">
<h3>10.6.3. preFlush<a class="headerlink" href="#preflush" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">preFlush</span></tt> is called at <tt class="docutils literal"><span class="pre">EntityManager#flush()</span></tt> before
anything else. <tt class="docutils literal"><span class="pre">EntityManager#flush()</span></tt> can be called safely
inside its listeners.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\Event\PreFlushEventArgs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PreFlushExampleListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preFlush</span><span class="p">(</span><span class="nx">PreFlushEventArgs</span> <span class="nv">$args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="onflush">
<h3>10.6.4. onFlush<a class="headerlink" href="#onflush" title="Permalink to this headline">¶</a></h3>
<p>OnFlush is a very powerful event. It is called inside
<tt class="docutils literal"><span class="pre">EntityManager#flush()</span></tt> after the changes to all the managed
entities and their associations have been computed. This means, the
<tt class="docutils literal"><span class="pre">onFlush</span></tt> event has access to the sets of:</p>
<ul class="simple">
<li>Entities scheduled for insert</li>
<li>Entities scheduled for update</li>
<li>Entities scheduled for removal</li>
<li>Collections scheduled for update</li>
<li>Collections scheduled for removal</li>
</ul>
<p>To make use of the onFlush event you have to be familiar with the
internal UnitOfWork API, which grants you access to the previously
mentioned sets. See this example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FlushExampleListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onFlush</span><span class="p">(</span><span class="nx">OnFlushEventArgs</span> <span class="nv">$eventArgs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$em</span> <span class="o">=</span> <span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">();</span>
        <span class="nv">$uow</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getUnitOfWork</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$uow</span><span class="o">-&gt;</span><span class="na">getScheduledEntityInsertions</span><span class="p">()</span> <span class="k">AS</span> <span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$uow</span><span class="o">-&gt;</span><span class="na">getScheduledEntityUpdates</span><span class="p">()</span> <span class="k">AS</span> <span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$uow</span><span class="o">-&gt;</span><span class="na">getScheduledEntityDeletions</span><span class="p">()</span> <span class="k">AS</span> <span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$uow</span><span class="o">-&gt;</span><span class="na">getScheduledCollectionDeletions</span><span class="p">()</span> <span class="k">AS</span> <span class="nv">$col</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$uow</span><span class="o">-&gt;</span><span class="na">getScheduledCollectionUpdates</span><span class="p">()</span> <span class="k">AS</span> <span class="nv">$col</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following restrictions apply to the onFlush event:</p>
<ul class="simple">
<li>If you create and persist a new entity in <tt class="docutils literal"><span class="pre">onFlush</span></tt>, then
calling <tt class="docutils literal"><span class="pre">EntityManager#persist()</span></tt> is not enough.
You have to execute an additional call to
<tt class="docutils literal"><span class="pre">$unitOfWork-&gt;computeChangeSet($classMetadata,</span> <span class="pre">$entity)</span></tt>.</li>
<li>Changing primitive fields or associations requires you to
explicitly trigger a re-computation of the changeset of the
affected entity. This can be done by calling
<tt class="docutils literal"><span class="pre">$unitOfWork-&gt;recomputeSingleEntityChangeSet($classMetadata,</span> <span class="pre">$entity)</span></tt>.</li>
</ul>
</div>
<div class="section" id="postflush">
<h3>10.6.5. postFlush<a class="headerlink" href="#postflush" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">postFlush</span></tt> is called at the end of <tt class="docutils literal"><span class="pre">EntityManager#flush()</span></tt>.
<tt class="docutils literal"><span class="pre">EntityManager#flush()</span></tt> can <strong>NOT</strong> be called safely inside its listeners.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\Event\PostFlushEventArgs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostFlushExampleListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">postFlush</span><span class="p">(</span><span class="nx">PostFlushEventArgs</span> <span class="nv">$args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="preupdate">
<h3>10.6.6. preUpdate<a class="headerlink" href="#preupdate" title="Permalink to this headline">¶</a></h3>
<p>PreUpdate is the most restrictive to use event, since it is called
right before an update statement is called for an entity inside the
<tt class="docutils literal"><span class="pre">EntityManager#flush()</span></tt> method.</p>
<p>Changes to associations of the updated entity are never allowed in
this event, since Doctrine cannot guarantee to correctly handle
referential integrity at this point of the flush operation. This
event has a powerful feature however, it is executed with a
<tt class="docutils literal"><span class="pre">PreUpdateEventArgs</span></tt> instance, which contains a reference to the
computed change-set of this entity.</p>
<p>This means you have access to all the fields that have changed for
this entity with their old and new value. The following methods are
available on the <tt class="docutils literal"><span class="pre">PreUpdateEventArgs</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">getEntity()</span></tt> to get access to the actual entity.</li>
<li><tt class="docutils literal"><span class="pre">getEntityChangeSet()</span></tt> to get a copy of the changeset array.
Changes to this returned array do not affect updating.</li>
<li><tt class="docutils literal"><span class="pre">hasChangedField($fieldName)</span></tt> to check if the given field name
of the current entity changed.</li>
<li><tt class="docutils literal"><span class="pre">getOldValue($fieldName)</span></tt> and <tt class="docutils literal"><span class="pre">getNewValue($fieldName)</span></tt> to
access the values of a field.</li>
<li><tt class="docutils literal"><span class="pre">setNewValue($fieldName,</span> <span class="pre">$value)</span></tt> to change the value of a
field to be updated.</li>
</ul>
<p>A simple example for this event looks like:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">NeverAliceOnlyBobListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preUpdate</span><span class="p">(</span><span class="nx">PreUpdateEventArgs</span> <span class="nv">$eventArgs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">getEntity</span><span class="p">()</span> <span class="nx">instanceof</span> <span class="nx">User</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">hasChangedField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">getNewValue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Alice&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">setNewValue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You could also use this listener to implement validation of all the
fields that have changed. This is more efficient than using a
lifecycle callback when there are expensive validations to call:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">ValidCreditCardListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preUpdate</span><span class="p">(</span><span class="nx">PreUpdateEventArgs</span> <span class="nv">$eventArgs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">getEntity</span><span class="p">()</span> <span class="nx">instanceof</span> <span class="nx">Account</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">hasChangedField</span><span class="p">(</span><span class="s1">&#39;creditCard&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validateCreditCard</span><span class="p">(</span><span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">getNewValue</span><span class="p">(</span><span class="s1">&#39;creditCard&#39;</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">validateCreditCard</span><span class="p">(</span><span class="nv">$no</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// throw an exception to interrupt flush event. Transaction will be rolled back.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Restrictions for this event:</p>
<ul class="simple">
<li>Changes to associations of the passed entities are not
recognized by the flush operation anymore.</li>
<li>Changes to fields of the passed entities are not recognized by
the flush operation anymore, use the computed change-set passed to
the event to modify primitive field values, e.g. use
<tt class="docutils literal"><span class="pre">$eventArgs-&gt;setNewValue($field,</span> <span class="pre">$value);</span></tt> as in the Alice to Bob example above.</li>
<li>Any calls to <tt class="docutils literal"><span class="pre">EntityManager#persist()</span></tt> or
<tt class="docutils literal"><span class="pre">EntityManager#remove()</span></tt>, even in combination with the UnitOfWork
API are strongly discouraged and don&#8217;t work as expected outside the
flush operation.</li>
</ul>
</div>
<div class="section" id="postupdate-postremove-postpersist">
<h3>10.6.7. postUpdate, postRemove, postPersist<a class="headerlink" href="#postupdate-postremove-postpersist" title="Permalink to this headline">¶</a></h3>
<p>The three post events are called inside <tt class="docutils literal"><span class="pre">EntityManager#flush()</span></tt>.
Changes in here are not relevant to the persistence in the
database, but you can use these events to alter non-persistable items,
like non-mapped fields, logging or even associated classes that are
directly mapped by Doctrine.</p>
</div>
<div class="section" id="postload">
<h3>10.6.8. postLoad<a class="headerlink" href="#postload" title="Permalink to this headline">¶</a></h3>
<p>This event is called after an entity is constructed by the
EntityManager.</p>
</div>
</div>
<div class="section" id="entity-listeners">
<h2>10.7. Entity listeners<a class="headerlink" href="#entity-listeners" title="Permalink to this headline">¶</a></h2>
<p class="versionadded">
<span class="versionmodified">New in version 2.4.</span></p>
<p>An entity listener is a lifecycle listener class used for an entity.</p>
<ul class="simple">
<li>The entity listener&#8217;s mapping may be applied to an entity class or mapped superclass.</li>
<li>An entity listener is defined by mapping the entity class with the corresponding mapping.</li>
</ul>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">MyProject\Entity</span><span class="p">;</span>

<span class="sd">/** @Entity @EntityListeners({&quot;UserListener&quot;}) */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ....</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;doctrine-mapping&gt;</span>
    <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;MyProject\Entity\User&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;entity-listeners&gt;</span>
            <span class="nt">&lt;entity-listener</span> <span class="na">class=</span><span class="s">&quot;UserListener&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/entity-listeners&gt;</span>
        <span class="c">&lt;!-- .... --&gt;</span>
    <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/doctrine-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">MyProject\Entity\User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
  <span class="l-Scalar-Plain">entityListeners</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">UserListener</span><span class="p-Indicator">:</span>
  <span class="c1"># ....</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="entity-listeners-class">
<span id="reference-entity-listeners"></span><h3>10.7.1. Entity listeners class<a class="headerlink" href="#entity-listeners-class" title="Permalink to this headline">¶</a></h3>
<p>An <tt class="docutils literal"><span class="pre">Entity</span> <span class="pre">Listener</span></tt> could be any class, by default it should be a class with a no-arg constructor.</p>
<ul class="simple">
<li>Different from <a class="reference internal" href="#reference-events-implementing-listeners"><em>Implementing Event Listeners</em></a> an <tt class="docutils literal"><span class="pre">Entity</span> <span class="pre">Listener</span></tt> is invoked just to the specified entity</li>
<li>An entity listener method receives two arguments, the entity instance and the lifecycle event.</li>
<li>The callback method can be defined by naming convention or specifying a method mapping.</li>
<li>When a listener mapping is not given the parser will use the naming convention to look for a matching method,
e.g. it will look for a public <tt class="docutils literal"><span class="pre">preUpdate()</span></tt> method if you are listening to the <tt class="docutils literal"><span class="pre">preUpdate</span></tt> event.</li>
<li>When a listener mapping is given the parser will not look for any methods using the naming convention.</li>
</ul>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preUpdate</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">PreUpdateEventArgs</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Do something on pre update.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To define a specific event listener method (one that does not follow the naming convention)
you need to map the listener method using the event type mapping:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserListener</span>
<span class="p">{</span>
    <span class="sd">/** @PrePersist */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">prePersistHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">LifecycleEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>

    <span class="sd">/** @PostPersist */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">postPersistHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">LifecycleEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>

    <span class="sd">/** @PreUpdate */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preUpdateHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">PreUpdateEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>

    <span class="sd">/** @PostUpdate */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">postUpdateHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">LifecycleEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>

    <span class="sd">/** @PostRemove */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">postRemoveHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">LifecycleEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>

    <span class="sd">/** @PreRemove */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preRemoveHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">LifecycleEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>

    <span class="sd">/** @PreFlush */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preFlushHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">PreFlushEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>

    <span class="sd">/** @PostLoad */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">postLoadHandler</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">LifecycleEventArgs</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ... }</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;doctrine-mapping&gt;</span>
    <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;MyProject\Entity\User&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;entity-listeners&gt;</span>
            <span class="nt">&lt;entity-listener</span> <span class="na">class=</span><span class="s">&quot;UserListener&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;preFlush&quot;</span>      <span class="na">method=</span><span class="s">&quot;preFlushHandler&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;postLoad&quot;</span>      <span class="na">method=</span><span class="s">&quot;postLoadHandler&quot;</span><span class="nt">/&gt;</span>

                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;postPersist&quot;</span>   <span class="na">method=</span><span class="s">&quot;postPersistHandler&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;prePersist&quot;</span>    <span class="na">method=</span><span class="s">&quot;prePersistHandler&quot;</span><span class="nt">/&gt;</span>

                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;postUpdate&quot;</span>    <span class="na">method=</span><span class="s">&quot;postUpdateHandler&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;preUpdate&quot;</span>     <span class="na">method=</span><span class="s">&quot;preUpdateHandler&quot;</span><span class="nt">/&gt;</span>

                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;postRemove&quot;</span>    <span class="na">method=</span><span class="s">&quot;postRemoveHandler&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;lifecycle-callback</span> <span class="na">type=</span><span class="s">&quot;preRemove&quot;</span>     <span class="na">method=</span><span class="s">&quot;preRemoveHandler&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/entity-listener&gt;</span>
        <span class="nt">&lt;/entity-listeners&gt;</span>
        <span class="c">&lt;!-- .... --&gt;</span>
    <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/doctrine-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">MyProject\Entity\User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
  <span class="l-Scalar-Plain">entityListeners</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">UserListener</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">preFlush</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">preFlushHandler</span><span class="p-Indicator">]</span>
      <span class="l-Scalar-Plain">postLoad</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">postLoadHandler</span><span class="p-Indicator">]</span>

      <span class="l-Scalar-Plain">postPersist</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">postPersistHandler</span><span class="p-Indicator">]</span>
      <span class="l-Scalar-Plain">prePersist</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">prePersistHandler</span><span class="p-Indicator">]</span>

      <span class="l-Scalar-Plain">postUpdate</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">postUpdateHandler</span><span class="p-Indicator">]</span>
      <span class="l-Scalar-Plain">preUpdate</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">preUpdateHandler</span><span class="p-Indicator">]</span>

      <span class="l-Scalar-Plain">postRemove</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">postRemoveHandler</span><span class="p-Indicator">]</span>
      <span class="l-Scalar-Plain">preRemove</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">preRemoveHandler</span><span class="p-Indicator">]</span>
  <span class="c1"># ....</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="entity-listeners-resolver">
<h3>10.7.2. Entity listeners resolver<a class="headerlink" href="#entity-listeners-resolver" title="Permalink to this headline">¶</a></h3>
<p>Doctrine invokes the listener resolver to get the listener instance.</p>
<ul class="simple">
<li>A resolver allows you register a specific entity listener instance.</li>
<li>You can also implement your own resolver by extending <tt class="docutils literal"><span class="pre">Doctrine\ORM\Mapping\DefaultEntityListenerResolver</span></tt> or implementing <tt class="docutils literal"><span class="pre">Doctrine\ORM\Mapping\EntityListenerResolver</span></tt></li>
</ul>
<p>Specifying an entity listener instance :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// User.php</span>

<span class="sd">/** @Entity @EntityListeners({&quot;UserListener&quot;}) */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ....</span>
<span class="p">}</span>

<span class="c1">// UserListener.php</span>
<span class="k">class</span> <span class="nc">UserListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">MyService</span> <span class="nv">$service</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span> <span class="o">=</span> <span class="nv">$service</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">preUpdate</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">PreUpdateEventArgs</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// register a entity listener.</span>
<span class="nv">$listener</span> <span class="o">=</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;user_listener&#39;</span><span class="p">);</span>
<span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getConfiguration</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getEntityListenerResolver</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="nv">$listener</span><span class="p">);</span>
</pre></div>
</div>
<p>Implementing your own resolver :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">MyEntityListenerResolver</span> <span class="k">extends</span> <span class="nx">\Doctrine\ORM\Mapping\DefaultEntityListenerResolver</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$container</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span> <span class="o">=</span> <span class="nv">$container</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">resolve</span><span class="p">(</span><span class="nv">$className</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// resolve the service id by the given class name;</span>
        <span class="nv">$id</span> <span class="o">=</span> <span class="s1">&#39;user_listener&#39;</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// configure the listener resolver.</span>
<span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getConfiguration</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setEntityListenerResolver</span><span class="p">(</span><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;my_resolver&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-classmetadata-event">
<h2>10.8. Load ClassMetadata Event<a class="headerlink" href="#load-classmetadata-event" title="Permalink to this headline">¶</a></h2>
<p>When the mapping information for an entity is read, it is populated
in to a <tt class="docutils literal"><span class="pre">ClassMetadataInfo</span></tt> instance. You can hook in to this
process and manipulate the instance.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$test</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TestEvent</span><span class="p">();</span>
<span class="nv">$metadataFactory</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getMetadataFactory</span><span class="p">();</span>
<span class="nv">$evm</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getEventManager</span><span class="p">();</span>
<span class="nv">$evm</span><span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span><span class="nx">Events</span><span class="o">::</span><span class="na">loadClassMetadata</span><span class="p">,</span> <span class="nv">$test</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">TestEvent</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">loadClassMetadata</span><span class="p">(</span><span class="nx">\Doctrine\ORM\Event\LoadClassMetadataEventArgs</span> <span class="nv">$eventArgs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$classMetadata</span> <span class="o">=</span> <span class="nv">$eventArgs</span><span class="o">-&gt;</span><span class="na">getClassMetadata</span><span class="p">();</span>
        <span class="nv">$fieldMapping</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;fieldName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;about&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span>
        <span class="p">);</span>
        <span class="nv">$classMetadata</span><span class="o">-&gt;</span><span class="na">mapField</span><span class="p">(</span><span class="nv">$fieldMapping</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


              </div>
                </div>

            </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">



             
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:Doctrine ORM">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">10. Events</a><ul>
<li><a class="reference internal" href="#the-event-system">10.1. The Event System</a><ul>
<li><a class="reference internal" href="#naming-convention">10.1.1. Naming convention</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lifecycle-events">10.2. Lifecycle Events</a></li>
<li><a class="reference internal" href="#lifecycle-callbacks">10.3. Lifecycle Callbacks</a></li>
<li><a class="reference internal" href="#lifecycle-callbacks-event-argument">10.4. Lifecycle Callbacks Event Argument</a></li>
<li><a class="reference internal" href="#listening-and-subscribing-to-lifecycle-events">10.5. Listening and subscribing to Lifecycle Events</a></li>
<li><a class="reference internal" href="#implementing-event-listeners">10.6. Implementing Event Listeners</a><ul>
<li><a class="reference internal" href="#prepersist">10.6.1. prePersist</a></li>
<li><a class="reference internal" href="#preremove">10.6.2. preRemove</a></li>
<li><a class="reference internal" href="#preflush">10.6.3. preFlush</a></li>
<li><a class="reference internal" href="#onflush">10.6.4. onFlush</a></li>
<li><a class="reference internal" href="#postflush">10.6.5. postFlush</a></li>
<li><a class="reference internal" href="#preupdate">10.6.6. preUpdate</a></li>
<li><a class="reference internal" href="#postupdate-postremove-postpersist">10.6.7. postUpdate, postRemove, postPersist</a></li>
<li><a class="reference internal" href="#postload">10.6.8. postLoad</a></li>
</ul>
</li>
<li><a class="reference internal" href="#entity-listeners">10.7. Entity listeners</a><ul>
<li><a class="reference internal" href="#entity-listeners-class">10.7.1. Entity listeners class</a></li>
<li><a class="reference internal" href="#entity-listeners-resolver">10.7.2. Entity listeners resolver</a></li>
</ul>
</li>
<li><a class="reference internal" href="#load-classmetadata-event">10.8. Load ClassMetadata Event</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="working-with-associations.html"
                                  title="previous chapter">9. Working with Associations</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="unitofwork.html"
                                  title="next chapter">11. Doctrine Internals explained</a></p>
  
    <h3>This Page</h3>
    <ul class="this-page-menu">
      
        <li><a href="../_sources/reference/events.txt"
               rel="nofollow">Show Source</a></li>
      
      
        <li><a href="https://github.com/doctrine/doctrine2/blob/master/docs/en/reference/events.rst">
          Show on GitHub</a></li>
        <li><a href="https://github.com/doctrine/doctrine2/edit/master/docs/en/reference/events.rst">
          Edit on GitHub</a></li>
      
    </ul>
  

        </div>
      </div>
          <div class="clearer"></div>
        </div>

          <div class="footer">
              &copy; Copyright 2010-12, Doctrine Project Team.
              Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
            <br/>
            <a target="_BLANK" href="http://www.servergrove.com"><img src="http://www.doctrine-project.org/images/servergrove.jpg" /></a>      <br/><br/>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
              <input type="hidden" name="cmd" value="_s-xclick" />
              <input type="hidden" name="hosted_button_id" value="BAE2E3XANQ77Y" />
              <input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" />
              <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
            </form>
          </div>
 <!-- End original user content -->


<br/>
<br/>
<br/>


<style type="text/css">
  #version_menu, .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0.75s;
    transition: all 0.25s 0.75s;
  }
  .footer_popout:hover #version_menu, .footer_popout:hover .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0s;
    transition: all 0.25s 0s;
  }
  .rtd-badge {
    position: fixed;
    display: block;
    bottom: 5px;
    height: 40px;
    text-indent: -9999em;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
  }
  #version_menu {
    position: fixed;
    visibility: hidden;
    opacity: 0;
    bottom: 11px;
    right: 47px;
    list-style-type: none;
    margin: 0;
  }
  .footer_popout:hover #version_menu {
    visibility: visible;
    opacity: 1;
    right: 166px;
  }
  #version_menu li {
    display: block;
    float: right;
  }
  #version_menu li a {
    display: block;
    padding: 6px 10px 4px 10px;
    margin: 7px 7px 0 0;
    font-weight: bold;
    font-size: 14px;
    height: 20px;
    line-height: 17px;
    text-decoration: none;
    color: #fff;
    background: #8ca1af url(//media.readthedocs.org//images/gradient-light.png) bottom left repeat-x;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 1px #465158;
    -moz-box-shadow: 0 1px 1px #465158;
    -webkit-box-shadow: 0 1px 1px #465158;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }
  #version_menu li a:hover {
    text-decoration: none;
    background-color: #697983;
    box-shadow: 0 1px 0px #465158;
    -moz-box-shadow: 0 1px 0px #465158;
    -webkit-box-shadow: 0 1px 0px #465158;
  }
  .rtd-badge.rtd {
    background: #3b4449 url(//media.readthedocs.org//images/badge-rtd.png) scroll top left no-repeat;
    border: 1px solid #282E32;
    width: 41px;
    right: 5px;
  }
  .footer_popout:hover .rtd-badge.rtd {
    width: 160px;
  }
  .rtd-badge.revsys { background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline-sponsored {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys-sm.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 205px;
    right: 173px;
  }

</style>
<div class="rtd_doc_footer">
  <div class="footer_popout">
    <a href="//readthedocs.org/projects/doctrine-orm/?fromdocs=doctrine-orm" class="rtd-badge rtd"> Brought to you by Read the Docs</a>
    <ul id="version_menu">
      
        <li><a href="/en/latest/">latest</a></li>
      
    </ul>
  </div>
</div>
<!-- RTD Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




      </div>

      <div id="bot-rcnr">
        <div class="tl"><!-- corner --></div>
      </div>
    </div>

  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
  </script>
  <script type="text/javascript">
  _uacct = "UA-288343-7";
  urchinTracker();
  </script>
  <a class="githublink" href="http://github.com/doctrine"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>