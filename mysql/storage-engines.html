<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 14. Storage Engines</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1 + chunker.py v1.9.1" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="sql-syntax.html" title="Chapter 13. SQL Statement Syntax" />
<link rel="next" href="ha-overview.html" title="Chapter 15. High Availability and Scalability" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1377579534+*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 14. Storage Engines</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="ha-overview.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="storage-engines"></a>Chapter 14. Storage Engines</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="storage-engines.html#storage-engine-setting">14.1. Setting the Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-storage-engine">14.2. The <code class="literal">InnoDB</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#innodb-getting-started">14.2.1. Getting Started with <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-administration">14.2.2. Administering <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-concepts">14.2.3. <code class="literal">InnoDB</code> Concepts and Architecture</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-tuning-troubleshooting">14.2.4. <code class="literal">InnoDB</code> Performance Tuning and Troubleshooting</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes">14.2.5. <code class="literal">InnoDB</code> Features for Flexibility, Ease of Use and
Reliability</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameters">14.2.6. <code class="literal">InnoDB</code> Startup Options and System Variables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-restrictions">14.2.7. Limits on <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#mysql-acid">14.2.8. MySQL and the ACID Model</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached">14.2.9. InnoDB Integration with memcached</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#myisam-storage-engine">14.3. The <code class="literal">MyISAM</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#myisam-start">14.3.1. <code class="literal">MyISAM</code> Startup Options</a></span></dt><dt><span class="section"><a href="storage-engines.html#key-space">14.3.2. Space Needed for Keys</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-formats">14.3.3. <code class="literal">MyISAM</code> Table Storage Formats</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-problems">14.3.4. <code class="literal">MyISAM</code> Table Problems</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#memory-storage-engine">14.4. The <code class="literal">MEMORY</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#csv-storage-engine">14.5. The <code class="literal">CSV</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#se-csv-repair">14.5.1. Repairing and Checking CSV Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#se-csv-limitations">14.5.2. CSV Limitations</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#archive-storage-engine">14.6. The <code class="literal">ARCHIVE</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#blackhole-storage-engine">14.7. The <code class="literal">BLACKHOLE</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#merge-storage-engine">14.8. The <code class="literal">MERGE</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#merge-table-advantages">14.8.1. <code class="literal">MERGE</code> Table Advantages and Disadvantages</a></span></dt><dt><span class="section"><a href="storage-engines.html#merge-table-problems">14.8.2. <code class="literal">MERGE</code> Table Problems</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#federated-storage-engine">14.9. The <code class="literal">FEDERATED</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#federated-description">14.9.1. <code class="literal">FEDERATED</code> Storage Engine Overview</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-create">14.9.2. How to Create <code class="literal">FEDERATED</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-usagenotes">14.9.3. <code class="literal">FEDERATED</code> Storage Engine Notes and Tips</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-storage-engine-resources">14.9.4. <code class="literal">FEDERATED</code> Storage Engine Resources</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#example-storage-engine">14.10. The <code class="literal">EXAMPLE</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#storage-engines-other">14.11. Other Storage Engines</a></span></dt><dt><span class="section"><a href="storage-engines.html#pluggable-storage-overview">14.12. Overview of MySQL Storage Engine Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#pluggable-storage">14.12.1. Pluggable Storage Engine Architecture</a></span></dt><dt><span class="section"><a href="storage-engines.html#pluggable-storage-common-layer">14.12.2. The Common Database Server Layer</a></span></dt></dl></dd></dl>
</div>
<a class="indexterm" name="idp82304848"></a><a class="indexterm" name="idp82306336"></a><a class="indexterm" name="idp82307824"></a><a class="indexterm" name="idp82309312"></a><a class="indexterm" name="idp82310384"></a><a class="indexterm" name="idp82311456"></a><a class="indexterm" name="idp82312528"></a><a class="indexterm" name="idp82313600"></a><a class="indexterm" name="idp82314672"></a><a class="indexterm" name="idp82315744"></a><a class="indexterm" name="idp82316816"></a><a class="indexterm" name="idp82317888"></a><a class="indexterm" name="idp82318960"></a><a class="indexterm" name="idp82320048"></a><p>
    Storage engines are MySQL components that handle the SQL operations
    for different table types. <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> is
    the most general-purpose storage engine, and Oracle recommends using
    it for tables except for specialized use cases. (The
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement in MySQL
    5.6 creates <code class="literal">InnoDB</code> tables by
    default.)
  </p><p>
    MySQL Server uses a pluggable storage engine architecture that
    enables storage engines to be loaded into and unloaded from a
    running MySQL server.
  </p><p>
    To determine which storage engines your server supports, use the
    <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a> statement. The value in
    the <code class="literal">Support</code> column indicates whether an engine
    can be used. A value of <code class="literal">YES</code>,
    <code class="literal">NO</code>, or <code class="literal">DEFAULT</code> indicates that
    an engine is available, not available, or available and currently
    set as the default storage engine.
  </p><p>
    This chapter primarily describes the features and performance
    characteristics of <code class="literal">InnoDB</code> tables. It also covers
    the use cases for the special-purpose MySQL storage engines, except
    for <code class="literal">NDB</code> which is covered in
    <a class="xref" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3">Chapter 17, <i>MySQL Cluster NDB 7.3</i></a>. For advanced users, it also
    contains a description of the pluggable storage engine architecture
    (see <a class="xref" href="storage-engines.html#pluggable-storage-overview" title="14.12. Overview of MySQL Storage Engine Architecture">Section 14.12, “Overview of MySQL Storage Engine Architecture”</a>).
  </p><p>
    For information about storage engine support offered in commercial
    MySQL Server binaries, see
    <a class="ulink" href="http://www.mysql.com/products/enterprise/server.html" target="_top"><em class="citetitle">MySQL
    Enterprise Server 5.6</em></a>, on the MySQL Web site.
    The storage engines available might depend on which edition of
    Enterprise Server you are using.
  </p><p>
    For answers to some commonly asked questions about MySQL storage
    engines, see <a class="xref" href="faqs.html#faqs-storage-engines" title="B.2. MySQL 5.6 FAQ: Storage Engines">Section B.2, “MySQL 5.6 FAQ: Storage Engines”</a>.
</p>
<h2><a name="idp82334912"></a>
    MySQL 5.6 Supported storage Engines
</h2>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>:
        A transaction-safe (ACID compliant) storage engine for MySQL
        that has commit, rollback, and crash-recovery capabilities to
        protect user data. <code class="literal">InnoDB</code> row-level locking
        (without escalation to coarser granularity locks) and
        Oracle-style consistent nonlocking reads increase multi-user
        concurrency and performance. <code class="literal">InnoDB</code> stores
        user data in clustered indexes to reduce I/O for common queries
        based on primary keys. To maintain data integrity,
        <code class="literal">InnoDB</code> also supports <code class="literal">FOREIGN
        KEY</code> referential-integrity constraints.
        <code class="literal">InnoDB</code> is the default storage engine in MySQL
        5.6.
      </p></li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>:
        These tables have a small footprint.
        <a class="link" href="glossary.html#glos_table_lock" title="table lock">Table-level locking</a>
        limits the performance in read/write workloads, so it is often
        used in read-only or read-mostly workloads in Web and data
        warehousing configurations.
      </p></li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#memory-storage-engine" title="14.4. The MEMORY Storage Engine"><code class="literal">Memory</code></a>:
        Stores all data in RAM, for fast access in environments that
        require quick lookups of non-critical data. This engine was
        formerly known as the <code class="literal">HEAP</code> engine. Its use
        cases are decreasing; <code class="literal">InnoDB</code> with its buffer
        pool memory area provides a general-purpose and durable way to
        keep most or all data in memory, and
        <code class="literal">NDBCLUSTER</code> provides fast key-value lookups
        for huge distributed data sets.
      </p></li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#csv-storage-engine" title="14.5. The CSV Storage Engine"><code class="literal">CSV</code></a>:
        Its tables are really text files with comma-separated values.
        CSV tables let you import or dump data in CSV format, to
        exchange data with scripts and applications that read and write
        that same format. Because CSV tables are not indexed, you
        typically keep the data in <code class="literal">InnoDB</code> tables
        during normal operation, and only use CSV tables during the
        import or export stage.
      </p></li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#archive-storage-engine" title="14.6. The ARCHIVE Storage Engine"><code class="literal">Archive</code></a>:
        These compact, unindexed tables are intended for storing and
        retrieving large amounts of seldom-referenced historical,
        archived, or security audit information.
      </p></li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#blackhole-storage-engine" title="14.7. The BLACKHOLE Storage Engine"><code class="literal">Blackhole</code></a>:
        The Blackhole storage engine accepts but does not store data,
        similar to the Unix <code class="literal">/dev/null</code> device. Queries
        always return an empty set. These tables can be used in
        replication configurations where DML statements are sent to
        slave servers, but the master server does not keep its own copy
        of the data.
      </p></li><li class="listitem"><p>
        <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a> (also known as
        <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDBCLUSTER</code></a>)—This clustered
        database engine is particularly suited for applications that
        require the highest possible degree of uptime and availability.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          The <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a> storage engine is not
          supported in standard MySQL 5.6 releases.
          Currently supported MySQL Cluster releases include MySQL
          Cluster NDB 7.0 and MySQL Cluster NDB 7.1, which are based on
          MySQL 5.1; MySQL Cluster NDB 7.2, which is based on MySQL 5.5;
          and MySQL Cluster NDB 7.3, which is based on MySQL 5.5. While
          based on MySQL Server, these releases also contain support for
          <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a>.
</p>
</div>
</li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#merge-storage-engine" title="14.8. The MERGE Storage Engine"><code class="literal">Merge</code></a>:
        Enables a MySQL DBA or developer to logically group a series of
        identical <code class="literal">MyISAM</code> tables and reference them as
        one object. Good for VLDB environments such as data warehousing.
      </p></li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#federated-storage-engine" title="14.9. The FEDERATED Storage Engine"><code class="literal">Federated</code></a>:
        Offers the ability to link separate MySQL servers to create one
        logical database from many physical servers. Very good for
        distributed or data mart environments.
      </p></li><li class="listitem"><p>
        <a class="link" href="storage-engines.html#example-storage-engine" title="14.10. The EXAMPLE Storage Engine"><code class="literal">Example</code></a>:
        This engine serves as an example in the MySQL source code that
        illustrates how to begin writing new storage engines. It is
        primarily of interest to developers. The storage engine is a
        <span class="quote">“<span class="quote">stub</span>”</span> that does nothing. You can create tables
        with this engine, but no data can be stored in them or retrieved
        from them.
</p></li></ul>
</div>
<p>
    You are not restricted to using the same storage engine for an
    entire server or schema. You can specify the storage engine for any
    table. For example, an application might use mostly
    <code class="literal">InnoDB</code> tables, with one <code class="literal">CSV</code>
    table for exporting data to a spreadsheet and a few
    <code class="literal">MEMORY</code> tables for temporary workspaces.
  </p><p>
    <span class="bold"><strong>Choosing a Storage Engine</strong></span>
  </p><p>
    The various storage engines provided with MySQL are designed with
    different use cases in mind. The following table provides an
    overview of some storage engines provided with MySQL:
</p>
<div class="table">
<a name="idp82374624"></a><p class="title"><b>Table 14.1. Storage Engines Feature Summary</b></p>
<div class="table-contents">
<table summary="Storage Engines Feature Summary" border="1"><colgroup><col class="feature"><col class="myisam"><col class="memory"><col class="innodb"><col class="archive"><col class="ndb"></colgroup><thead><tr><th scope="col">Feature</th><th scope="col">MyISAM</th><th scope="col">Memory</th><th scope="col">InnoDB</th><th scope="col">Archive</th><th scope="col">NDB</th></tr></thead><tbody><tr><td scope="row">Storage limits</td><td>256TB</td><td>RAM</td><td>64TB</td><td>None</td><td>384EB</td></tr><tr><td scope="row">Transactions</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td scope="row">Locking granularity</td><td>Table</td><td>Table</td><td>Row</td><td>Table</td><td>Row</td></tr><tr><td scope="row">MVCC</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td scope="row">Geospatial data type support</td><td>Yes</td><td>No</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Geospatial indexing support</td><td>Yes</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td scope="row">B-tree indexes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td scope="row">T-tree indexes</td><td>No</td><td>No</td><td>No</td><td>No</td><td>Yes</td></tr><tr><td scope="row">Hash indexes</td><td>No</td><td>Yes</td><td>No<a href="#ftn.idp82403744" class="footnote"><sup class="footnote"><a name="idp82403744"></a>[a]</sup></a></td><td>No</td><td>Yes</td></tr><tr><td scope="row">Full-text search indexes</td><td>Yes</td><td>No</td><td>Yes<a href="#ftn.idp82406704" class="footnote"><sup class="footnote"><a name="idp82406704"></a>[b]</sup></a></td><td>No</td><td>No</td></tr><tr><td scope="row">Clustered indexes</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td scope="row">Data caches</td><td>No</td><td>N/A</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td scope="row">Index caches</td><td>Yes</td><td>N/A</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td scope="row">Compressed data</td><td>Yes<a href="#ftn.idp82416320" class="footnote"><sup class="footnote"><a name="idp82416320"></a>[c]</sup></a></td><td>No</td><td>Yes<a href="#ftn.idp82417632" class="footnote"><sup class="footnote"><a name="idp82417632"></a>[d]</sup></a></td><td>Yes</td><td>No</td></tr><tr><td scope="row">Encrypted data<a href="#ftn.idp82419408" class="footnote"><sup class="footnote"><a name="idp82419408"></a>[e]</sup></a></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Cluster database support</td><td>No</td><td>No</td><td>No</td><td>No</td><td>Yes</td></tr><tr><td scope="row">Replication support<a href="#ftn.idp82424848" class="footnote"><sup class="footnote"><a name="idp82424848"></a>[f]</sup></a></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Foreign key support</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td scope="row">Backup / point-in-time recovery<a href="#ftn.idp82430256" class="footnote"><sup class="footnote"><a name="idp82430256"></a>[g]</sup></a></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Query cache support</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Update statistics for data dictionary</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6">
<div id="ftn.idp82403744" class="footnote">
<p><a href="storage-engines.html#idp82403744" class="para"><sup class="para">[a] </sup></a>InnoDB utilizes hash indexes internally for its Adaptive Hash Index feature.</p>
</div>

<div id="ftn.idp82406704" class="footnote">
<p><a href="storage-engines.html#idp82406704" class="para"><sup class="para">[b] </sup></a>InnoDB support for FULLTEXT indexes is available in MySQL 5.6.4 and higher.</p>
</div>

<div id="ftn.idp82416320" class="footnote">
<p><a href="storage-engines.html#idp82416320" class="para"><sup class="para">[c] </sup></a>Compressed MyISAM tables are supported only when using the compressed row format. Tables using the compressed row format with MyISAM are read only.</p>
</div>

<div id="ftn.idp82417632" class="footnote">
<p><a href="storage-engines.html#idp82417632" class="para"><sup class="para">[d] </sup></a>Compressed InnoDB tables require the InnoDB Barracuda file format.</p>
</div>

<div id="ftn.idp82419408" class="footnote">
<p><a href="storage-engines.html#idp82419408" class="para"><sup class="para">[e] </sup></a>Implemented in the server (via encryption functions), rather than in the storage engine.</p>
</div>

<div id="ftn.idp82424848" class="footnote">
<p><a href="storage-engines.html#idp82424848" class="para"><sup class="para">[f] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>

<div id="ftn.idp82430256" class="footnote">
<p><a href="storage-engines.html#idp82430256" class="para"><sup class="para">[g] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>
</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="storage-engine-setting"></a>14.1. Setting the Storage Engine</h2>

</div>

</div>

</div>
<p>
      When you create a new table, you can specify a special-purpose
      storage engine to use by adding an <code class="literal">ENGINE</code> table
      option to the <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
      statement:
    </p><pre class="programlisting">-- ENGINE=INNODB not needed unless you have set a different default storage engine.
CREATE TABLE t1 (i INT) ENGINE = INNODB;
-- Simple table definitions can be switched from one to another.
CREATE TABLE t2 (i INT) ENGINE = CSV;
-- Some storage engines have their own specific clauses in CREATE TABLE syntax.
CREATE TABLE t3 (i INT) ENGINE = MEMORY USING BTREE;</pre><p>
      When you omit the <code class="literal">ENGINE</code> option, the default
      storage engine is used. The default engine is
      <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> in MySQL 5.6. You
      can specify the default engine by using the
      <a class="link" href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a> server
      startup option, or by setting the
      <a class="link" href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">default-storage-engine</code></a> option in
      the <code class="filename">my.cnf</code> configuration file.
    </p><p>
      You can set the default storage engine for the current session by
      setting the
      <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a> variable:
    </p><pre class="programlisting">SET default_storage_engine=NDBCLUSTER;</pre><p>
      As of MySQL 5.6.3, the storage engine for
      <code class="literal">TEMPORARY</code> tables created with
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TEMPORARY
      TABLE</code></a> can be set separately from the engine for
      permanent tables by setting the
      <a class="link" href="server-administration.html#sysvar_default_tmp_storage_engine"><code class="literal">default_tmp_storage_engine</code></a>,
      either at startup or at runtime. Before MySQL 5.6.3,
      <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a> sets the
      engine for both permanent and <code class="literal">TEMPORARY</code> tables.
    </p><p>
      To convert a table from one storage engine to another, use an
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement that
      indicates the new engine:
    </p><pre class="programlisting">ALTER TABLE t ENGINE = InnoDB;</pre><p>
      See <a class="xref" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax">Section 13.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>, and
      <a class="xref" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax">Section 13.1.7, “<code class="literal">ALTER TABLE</code> Syntax”</a>.
    </p><p>
      If you try to use a storage engine that is not compiled in or that
      is compiled in but deactivated, MySQL instead creates a table
      using the default storage engine. For example, in a replication
      setup, perhaps your master server uses <code class="literal">InnoDB</code>
      tables for maximum safety, but the slave servers use other storage
      engines for speed at the expense of durability or concurrency.
    </p><p>
      By default, a warning is generated whenever
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> cannot use the default
      storage engine. To prevent confusing, unintended behavior if the
      desired engine is unavailable, enable the
      <a class="link" href="server-administration.html#sqlmode_no_engine_substitution"><code class="literal">NO_ENGINE_SUBSTITUTION</code></a> SQL mode.
      If the desired engine is unavailable, this setting produces an
      error instead of a warning, and the table is not created or
      altered. See <a class="xref" href="server-administration.html#server-sql-mode" title="5.1.7. Server SQL Modes">Section 5.1.7, “Server SQL Modes”</a>.
    </p><p>
      For new tables, MySQL always creates an <code class="filename">.frm</code>
      file to hold the table and column definitions. The table's index
      and data may be stored in one or more other files, depending on
      the storage engine. The server creates the
      <code class="filename">.frm</code> file above the storage engine level.
      Individual storage engines create any additional files required
      for the tables that they manage. If a table name contains special
      characters, the names for the table files contain encoded versions
      of those characters as described in
      <a class="xref" href="language-structure.html#identifier-mapping" title="9.2.3. Mapping of Identifiers to File Names">Section 9.2.3, “Mapping of Identifiers to File Names”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-storage-engine"></a>14.2. The <code class="literal">InnoDB</code> Storage Engine</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-getting-started">14.2.1. Getting Started with <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-administration">14.2.2. Administering <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-concepts">14.2.3. <code class="literal">InnoDB</code> Concepts and Architecture</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-tuning-troubleshooting">14.2.4. <code class="literal">InnoDB</code> Performance Tuning and Troubleshooting</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes">14.2.5. <code class="literal">InnoDB</code> Features for Flexibility, Ease of Use and
Reliability</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameters">14.2.6. <code class="literal">InnoDB</code> Startup Options and System Variables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-restrictions">14.2.7. Limits on <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#mysql-acid">14.2.8. MySQL and the ACID Model</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached">14.2.9. InnoDB Integration with memcached</a></span></dt></dl>
</div>
<a class="indexterm" name="idp82471632"></a><a class="indexterm" name="idp82473120"></a><a class="indexterm" name="idp82474192"></a><a class="indexterm" name="idp82475680"></a><a class="indexterm" name="idp82476752"></a><a class="indexterm" name="idp82478240"></a><a class="indexterm" name="idp82479312"></a><a class="indexterm" name="idp82480384"></a><a class="indexterm" name="idp82481456"></a><p>
    <code class="literal">InnoDB</code> is a general-purpose storage engine that
    balances high reliability and high performance. As of MySQL 5.5, it
    is the default MySQL storage engine.In MySQL 5.6,
    issuing the <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement
    without an <code class="literal">ENGINE=</code> clause creates an
    <code class="literal">InnoDB</code> table.
  </p><p>
    Key advantages of <code class="literal">InnoDB</code> tables include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Its <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations follow the
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model, with
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> featuring
        <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>,
        <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>, and
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash-recovery</a>
        capabilities to protect user data.
      </p></li><li class="listitem"><p>
        Row-level <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> and
        Oracle-style <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent
        reads</a> increase multi-user concurrency and performance.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> tables arrange your data on disk to
        optimize queries based on
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary keys</a>.
      </p></li><li class="listitem"><p>
        To maintain data
        <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">integrity</a>,
        <code class="literal">InnoDB</code> also supports
        <a class="link" href="glossary.html#glos_foreign_key" title="foreign key"><code class="literal">FOREIGN
        KEY</code></a> constraints. Inserts, updates, and deletes
        are all checked to ensure they do not result in inconsistencies
        across different tables.
      </p></li><li class="listitem"><p>
        You can freely mix <code class="literal">InnoDB</code> tables with tables
        from other MySQL storage engines, even within the same
        statement. For example, you can use a
        <a class="link" href="glossary.html#glos_join" title="join">join</a> operation to combine data
        from <code class="literal">InnoDB</code> and <code class="literal">MEMORY</code>
        tables in a single query.
      </p></li><li class="listitem"><p>
        The latest <code class="literal">InnoDB</code> offers significant new
        features over MySQL 5.1 and earlier. These features focus on
        performance and scalability, reliability, flexibility, and
        usability:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            <a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/innodb-create-index.html" target="_top">Fast index
            creation</a>: add or drop indexes without copying the
            data.
          </p></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#innodb-compression" title="5.4.6. Working with InnoDB Compressed Tables">Data compression</a>:
            shrink tables, to significantly reduce storage and I/O.
          </p></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#innodb-row-format" title="5.4.8. How InnoDB Stores Variable-Length Columns">More efficient storage for
            large column values</a>: fully off-page storage of long
            <code class="literal">BLOB</code>, <code class="literal">TEXT</code>, and
            <code class="literal">VARCHAR</code> columns.
          </p></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#innodb-file-format" title="5.4.7. InnoDB File-Format Management">Barracuda file
            format</a>: enables new features while protecting upward
            and downward compatibility
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#innodb-information-schema" title="14.2.4.3. InnoDB INFORMATION_SCHEMA tables"><code class="literal">INFORMATION_SCHEMA</code>
            tables</a>: information about compression and locking
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#innodb-performance" title="14.2.4.2. InnoDB Performance and Scalability Enhancements">Performance and
            scalability enhancements</a>: includes features such as
            multiple background I/O threads, multiple buffer pools, and
            group commit.
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#innodb-other-changes" title="14.2.5. InnoDB Features for Flexibility, Ease of Use and Reliability">Other changes</a>:
            for flexibility, ease of use and reliability.
</p></li></ul>
</div>
</li></ul>
</div>
<div class="table">
<a name="idp82521280"></a><p class="title"><b>Table 14.2. <code class="literal">InnoDB</code> Storage Engine
Features</b></p>
<div class="table-contents">
<table summary="InnoDB Storage Engine
Features" border="1"><colgroup><col class="featurev0"><col class="featurevalue0"><col class="featurev1"><col class="featurevalue1"><col class="featurev2"><col class="featurevalue2"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Storage limits</strong></span></td><td>64TB</td><td><span class="bold"><strong>Transactions</strong></span></td><td>Yes</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Row</td></tr><tr><td scope="row"><span class="bold"><strong>MVCC</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>T-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No<a href="#ftn.idp82537904" class="footnote"><sup class="footnote"><a name="idp82537904"></a>[a]</sup></a></td></tr><tr><td scope="row"><span class="bold"><strong>Full-text search indexes</strong></span></td><td>Yes<a href="#ftn.idp82539728" class="footnote"><sup class="footnote"><a name="idp82539728"></a>[b]</sup></a></td><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Data caches</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Index caches</strong></span></td><td>Yes</td><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes<a href="#ftn.idp82545136" class="footnote"><sup class="footnote"><a name="idp82545136"></a>[c]</sup></a></td><td><span class="bold"><strong>Encrypted data<a href="#ftn.idp82546416" class="footnote"><sup class="footnote"><a name="idp82546416"></a>[d]</sup></a></strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td><td><span class="bold"><strong>Replication support<a href="#ftn.idp82549456" class="footnote"><sup class="footnote"><a name="idp82549456"></a>[e]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Backup / point-in-time recovery<a href="#ftn.idp82552464" class="footnote"><sup class="footnote"><a name="idp82552464"></a>[f]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6">
<div id="ftn.idp82537904" class="footnote">
<p><a href="storage-engines.html#idp82537904" class="para"><sup class="para">[a] </sup></a>InnoDB utilizes hash indexes internally for its Adaptive Hash Index feature.</p>
</div>

<div id="ftn.idp82539728" class="footnote">
<p><a href="storage-engines.html#idp82539728" class="para"><sup class="para">[b] </sup></a>InnoDB support for FULLTEXT indexes is available in MySQL 5.6.4 and higher.</p>
</div>

<div id="ftn.idp82545136" class="footnote">
<p><a href="storage-engines.html#idp82545136" class="para"><sup class="para">[c] </sup></a>Compressed InnoDB tables require the InnoDB Barracuda file format.</p>
</div>

<div id="ftn.idp82546416" class="footnote">
<p><a href="storage-engines.html#idp82546416" class="para"><sup class="para">[d] </sup></a>Implemented in the server (via encryption functions), rather than in the storage engine.</p>
</div>

<div id="ftn.idp82549456" class="footnote">
<p><a href="storage-engines.html#idp82549456" class="para"><sup class="para">[e] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>

<div id="ftn.idp82552464" class="footnote">
<p><a href="storage-engines.html#idp82552464" class="para"><sup class="para">[f] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>
</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
    <code class="literal">InnoDB</code> has been designed for maximum performance
    when processing large data volumes. Its CPU efficiency is probably
    not matched by any other disk-based relational database engine.
  </p><p>
    The <code class="literal">InnoDB</code> storage engine maintains its own
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> for caching data
    and indexes in main memory. By default, with the
    <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting
    enabled, each new <code class="literal">InnoDB</code> table and its associated
    indexes are stored in a separate file. When the
    <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    disabled, <code class="literal">InnoDB</code> stores all its tables and
    indexes in the single <a class="link" href="glossary.html#glos_tablespace" title="tablespace">system
    tablespace</a>, which may consist of several files (or raw disk
    partitions). <code class="literal">InnoDB</code> tables can handle large
    quantities of data, even on operating systems where file size is
    limited to 2GB.
  </p><p>
    <code class="literal">InnoDB</code> is published under the same GNU GPL
    License Version 2 (of June 1991) as MySQL. For more information on
    MySQL licensing, see http://www.mysql.com/company/legal/licensing/.
</p>
<h3><a name="idp82565344"></a>
    Additional Resources
</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For <code class="literal">InnoDB</code>-related terms and definitions, see
        <a class="xref" href="glossary.html" title="MySQL Glossary">MySQL Glossary</a>.
      </p></li><li class="listitem"><p>
        A forum dedicated to the <code class="literal">InnoDB</code> storage
        engine is available at <a class="ulink" href="http://forums.mysql.com/list.php?22" target="_top">http://forums.mysql.com/list.php?22</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-getting-started"></a>14.2.1. Getting Started with <code class="literal">InnoDB</code> Tables</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-default-se">14.2.1.1. <code class="literal">InnoDB</code> as the Default MySQL Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-configuration">14.2.1.2. Configuring <code class="literal">InnoDB</code></a></span></dt></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-default-se"></a>14.2.1.1. <code class="literal">InnoDB</code> as the Default MySQL Storage Engine</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp82573600"></a><a class="indexterm" name="idp82575088"></a><a class="indexterm" name="idp82576608"></a><p>
    MySQL has a well-earned reputation for being easy-to-use and
    delivering performance and scalability. In previous versions of
    MySQL, MyISAM was the default storage engine. In our experience,
    most users never changed the default settings. With MySQL 5.5,
    InnoDB becomes the default storage engine. Again, we expect most
    users will not change the default settings. But, because of InnoDB,
    the default settings deliver the benefits users expect from their
    RDBMS: ACID Transactions, Referential Integrity, and Crash Recovery.
    Let's explore how using InnoDB tables improves your life as a MySQL
    user, DBA, or developer.
</p>
<h5><a name="idp82578736"></a>
    Trends in Storage Engine Usage
</h5>
<p>
    In the first years of MySQL growth, early web-based applications
    didn't push the limits of concurrency and availability. In 2010,
    hard drive and memory capacity and the performance/price ratio have
    all gone through the roof. Users pushing the performance boundaries
    of MySQL care a lot about reliability and crash recovery. MySQL
    databases are big, busy, robust, distributed, and important.
  </p><p>
    InnoDB hits the sweet spot of these top user priorities. The trend
    of storage engine usage has shifted in favor of the more scalable
    InnoDB. Thus MySQL 5.5 is the logical transition release to make
    InnoDB the default storage engine.
  </p><p>
    MySQL continues to work on addressing use cases that formerly
    required MyISAM tables. In MySQL 5.6 and higher:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        InnoDB can perform full-text search using the
        <code class="literal">FULLTEXT</code> index type. See
        <a class="xref" href="storage-engines.html#innodb-fulltext-index" title="14.2.3.12.3. FULLTEXT Indexes">Section 14.2.3.12.3, “<code class="literal">FULLTEXT</code> Indexes”</a> for details.
      </p></li><li class="listitem"><p>
        InnoDB now performs better with read-only or read-mostly
        workloads. Automatic optimizations apply to InnoDB queries in
        <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode, and you
        can explicitly mark transactions as read-only with the syntax
        <code class="literal">START TRANSACTION READ ONLY</code>. See
        <a class="xref" href="storage-engines.html#innodb-performance-ro-txn" title="14.2.4.2.3. Optimizations for Read-Only Transactions">Section 14.2.4.2.3, “Optimizations for Read-Only Transactions”</a> for details.
      </p></li><li class="listitem"><p>
        Applications distributed on read-only media can now use InnoDB
        tables. See <a class="xref" href="storage-engines.html#innodb-read-only-instance" title="14.2.5.1. Support for Read-Only Media">Section 14.2.5.1, “Support for Read-Only Media”</a> for
        details.
</p></li></ul>
</div>
<h5><a name="idp82588208"></a>
    Consequences of InnoDB as Default MySQL Storage Engine
</h5>
<p>
    Starting from MySQL 5.5.5, the default storage engine for new tables
    is InnoDB. This change applies to newly created tables that don't
    specify a storage engine with a clause such as
    <code class="literal">ENGINE=MyISAM</code>. (Given this change of default
    behavior, MySQL 5.5 might be a logical point to evaluate whether
    your tables that do use MyISAM could benefit from switching to
    InnoDB.)
  </p><p>
    The <code class="literal">mysql</code> and
    <code class="literal">information_schema</code> databases, that implement some
    of the MySQL internals, still use MyISAM. In particular, you cannot
    switch the grant tables to use InnoDB.
</p>
<h5><a name="idp82592128"></a>
    Benefits of InnoDB Tables
</h5>
<p>
    If you use <code class="literal">MyISAM</code> tables but aren't tied to them
    for technical reasons, you'll find many things more convenient when
    you use <code class="literal">InnoDB</code> tables in MySQL 5.5:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If your server crashes because of a hardware or software issue,
        regardless of what was happening in the database at the time,
        you don't need to do anything special after restarting the
        database. InnoDB <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
        recovery</a> automatically finalizes any changes that were
        committed before the time of the crash, and undoes any changes
        that were in process but not committed. Just restart and
        continue where you left off. This process is now much faster
        than in MySQL 5.1 and earlier.
      </p></li><li class="listitem"><p>
        The InnoDB <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
        caches table and index data as the data is accessed. Frequently
        used data is processed directly from memory. This cache applies
        to so many types of information, and speeds up processing so
        much, that dedicated database servers assign up to 80% of their
        physical memory to the InnoDB buffer pool.
      </p></li><li class="listitem"><p>
        If you split up related data into different tables, you can set
        up <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> that
        enforce <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">referential
        integrity</a>. Update or delete data, and the related data in
        other tables is updated or deleted automatically. Try to insert
        data into a secondary table without corresponding data in the
        primary table, and the bad data gets kicked out automatically.
      </p></li><li class="listitem"><p>
        If data becomes corrupted on disk or in memory, a
        <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> mechanism alerts
        you to the bogus data before you use it.
      </p></li><li class="listitem"><p>
        When you design your database with appropriate
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> columns for
        each table, operations involving those columns are automatically
        optimized. It is very fast to reference the primary key columns
        in <code class="literal">WHERE</code> clauses, <code class="literal">ORDER BY</code>
        clauses, <code class="literal">GROUP BY</code> clauses, and
        <a class="link" href="glossary.html#glos_join" title="join">join</a> operations.
      </p></li><li class="listitem"><p>
        Inserts, updates, deletes are optimized by an automatic
        mechanism called <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
        buffering</a>. InnoDB not only allows concurrent read and
        write access to the same table, it caches changed data to
        streamline disk I/O.
      </p></li><li class="listitem"><p>
        Performance benefits are not limited to giant tables with
        long-running queries. When the same rows are accessed over and
        over from a table, a feature called the
        <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">Adaptive Hash
        Index</a> takes over to make these lookups even faster, as if
        they came out of a hash table.
</p></li></ul>
</div>
<h5><a name="idp82611168"></a>
    Best Practices for InnoDB Tables
</h5>
<p>
    If you have been using <code class="literal">InnoDB</code> for a long time,
    you already know about features like transactions and foreign keys.
    If not, read about them throughout this chapter. To make a long
    story short:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Specify a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>
        for every table using the most frequently queried column or
        columns, or
        an<a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
        value if there is no obvious primary key.
      </p></li><li class="listitem"><p>
        Embrace the idea of <a class="link" href="glossary.html#glos_join" title="join">joins</a>,
        where data is pulled from multiple tables based on identical ID
        values from those tables. For fast join performance, define
        <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> on the join
        columns, and declare those columns with the same data type in
        each table. The foreign keys also propagate deletes or updates
        to all affected tables, and prevent insertion of data in a child
        table if the corresponding IDs are not present in the parent
        table.
      </p></li><li class="listitem"><p>
        Turn off <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a>.
        Committing hundreds of times a second puts a cap on performance
        (limited by the write speed of your storage device).
      </p></li><li class="listitem"><p>
        Group sets of related <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
        operations into
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, by
        bracketing them with <code class="literal">START TRANSACTION</code> and
        <code class="literal">COMMIT</code> statements. While you don't want to
        commit too often, you also don't want to issue huge batches of
        <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, or
        <code class="literal">DELETE</code> statements that run for hours without
        committing.
      </p></li><li class="listitem"><p>
        Stop using <code class="literal">LOCK TABLE</code> statements. InnoDB can
        handle multiple sessions all reading and writing to the same
        table at once, without sacrificing reliability or high
        performance. To get exclusive write access to a set of rows, use
        the <code class="literal">SELECT ... FOR UPDATE</code> syntax to lock just
        the rows you intend to update.
      </p></li><li class="listitem"><p>
        Enable the <code class="literal">innodb_file_per_table</code> option to
        put the data and indexes for individual tables into separate
        files, instead of in a single giant
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
        (This setting is required to use some of the other features,
        such as table
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> and fast
        <a class="link" href="glossary.html#glos_truncate" title="truncate">truncation</a>.)
      </p></li><li class="listitem"><p>
        Evaluate whether your data and access patterns benefit from the
        new InnoDB table
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> feature
        (<code class="literal">ROW_FORMAT=COMPRESSED</code> on the <code class="literal">CREATE
        TABLE</code> statement. You can compress InnoDB tables
        without sacrificing read/write capability.
      </p></li><li class="listitem"><p>
        Run your server with the option
        <code class="literal">--sql_mode=NO_ENGINE_SUBSTITUTION</code> to prevent
        tables being created with a different storage engine if there is
        an issue with the one specified in the
        <code class="literal">ENGINE=</code> clause of <code class="literal">CREATE
        TABLE</code>.
</p></li></ul>
</div>
<h5><a name="idp82638640"></a>
    Recent Improvements for InnoDB Tables
</h5>
<p>
    If you have experience with InnoDB, but from MySQL 5.1 or earlier,
    read about the latest InnoDB enhancements in
    <a class="xref" href="storage-engines.html#innodb-performance" title="14.2.4.2. InnoDB Performance and Scalability Enhancements">Section 14.2.4.2, “<code class="literal">InnoDB</code> Performance and Scalability Enhancements”</a> and
    <a class="xref" href="storage-engines.html#innodb-other-changes" title="14.2.5. InnoDB Features for Flexibility, Ease of Use and Reliability">Section 14.2.5, “<code class="literal">InnoDB</code> Features for Flexibility, Ease of Use and
    Reliability”</a>. To make a long story short:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You can compress tables and associated indexes.
      </p></li><li class="listitem"><p>
        You can create and drop indexes with much less performance or
        availability impact than before.
      </p></li><li class="listitem"><p>
        Truncating a table is very fast, and can free up disk space for
        the operating system to reuse, rather than freeing up space
        within the system tablespace that only InnoDB could reuse.
      </p></li><li class="listitem"><p>
        The storage layout for table data is more efficient for BLOBs
        and long text fields, with the <code class="literal">DYNAMIC</code> row
        format.
      </p></li><li class="listitem"><p>
        You can monitor the internal workings of the storage engine by
        querying <code class="literal">INFORMATION_SCHEMA</code> tables.
      </p></li><li class="listitem"><p>
        You can monitor the performance details of the storage engine by
        querying <code class="literal">performance_schema</code> tables.
      </p></li><li class="listitem"><p>
        There are many many performance improvements. In particular,
        crash recovery, the automatic process that makes all data
        consistent when the database is restarted, is fast and reliable.
        (Now much much faster than long-time InnoDB users are used to.)
        The bigger the database, the more dramatic the speedup.
      </p><p>
        Most new performance features are automatic, or at most require
        setting a value for a configuration option. For details, see
        <a class="xref" href="storage-engines.html#innodb-performance" title="14.2.4.2. InnoDB Performance and Scalability Enhancements">Section 14.2.4.2, “<code class="literal">InnoDB</code> Performance and Scalability Enhancements”</a>. For InnoDB-specific tuning
        techniques you can apply in your application code, see
        <a class="xref" href="optimization.html#optimizing-innodb" title="8.5. Optimizing for InnoDB Tables">Section 8.5, “Optimizing for <code class="literal">InnoDB</code> Tables”</a>. Advanced users can review
        <a class="xref" href="storage-engines.html#innodb-parameters" title="14.2.6. InnoDB Startup Options and System Variables">Section 14.2.6, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a>.
</p></li></ul>
</div>
<h5><a name="idp82652160"></a>
    Testing and Benchmarking with InnoDB as Default Storage Engine
</h5>
<p>
    Even before completing your upgrade from MySQL 5.1 or earlier to
    MySQL 5.5 or higher, you can preview whether your database server or
    application works correctly with InnoDB as the default storage
    engine. To set up InnoDB as the default storage engine with an
    earlier MySQL release, either specify on the command line
    <code class="literal">--default-storage-engine=InnoDB</code>, or add to your
    <code class="literal">my.cnf</code> file
    <code class="literal">default-storage-engine=innodb</code> in the
    <code class="literal">[mysqld]</code> section, then restart the server.
  </p><p>
    Since changing the default storage engine only affects new tables as
    they are created, run all your application installation and setup
    steps to confirm that everything installs properly. Then exercise
    all the application features to make sure all the data loading,
    editing, and querying features work. If a table relies on some
    MyISAM-specific feature, you'll receive an error; add the
    <code class="literal">ENGINE=MyISAM</code> clause to the <code class="literal">CREATE
    TABLE</code> statement to avoid the error. (For example, tables
    that rely on full-text search must be MyISAM tables rather than
    InnoDB ones.)
  </p><p>
    If you did not make a deliberate decision about the storage engine,
    and you just want to preview how certain tables work when they're
    created under InnoDB, issue the command <code class="literal">ALTER TABLE
    table_name ENGINE=InnoDB;</code> for each table. Or, to run test
    queries and other statements without disturbing the original table,
    make a copy like so:
  </p><pre class="programlisting">CREATE TABLE InnoDB_Table (...) ENGINE=InnoDB AS SELECT * FROM MyISAM_Table;
        </pre><p>
    Since there are so many performance enhancements in InnoDB in MySQL
    5.5 and higher, to get a true idea of the performance with a full
    application under a realistic workload, install the latest MySQL
    server and run benchmarks.
  </p><p>
    Test the full application lifecycle, from installation, through
    heavy usage, and server restart. Kill the server process while the
    database is busy to simulate a power failure, and verify that the
    data is recovered successfully when you restart the server.
  </p><p>
    Test any replication configurations, especially if you use different
    MySQL versions and options on the master and the slaves.
</p>
<h5><a name="idp82662736"></a>
    Verifying that InnoDB is the Default Storage Engine
</h5>
<p>
    To know what the status of InnoDB is, whether you're doing what-if
    testing with an older MySQL or comprehensive testing with the latest
    MySQL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Issue the command <code class="literal">SHOW ENGINES;</code> to see all
        the different MySQL storage engines. Look for
        <code class="literal">DEFAULT</code> in the InnoDB line.
      </p></li><li class="listitem"><p>
        If InnoDB is not present at all, you have a
        <code class="literal">mysqld</code> binary that was compiled without
        InnoDB support and you need to get a different one.
      </p></li><li class="listitem"><p>
        If InnoDB is present but disabled, go back through your startup
        options and configuration file and get rid of any
        <code class="literal">skip-innodb</code> option.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-configuration"></a>14.2.1.2. Configuring <code class="literal">InnoDB</code></h4>

</div>

</div>

</div>
<a class="indexterm" name="idp82671408"></a><p>
        The first decisions to make about InnoDB configuration involve
        how to lay out InnoDB data files, and how much memory to
        allocate for the InnoDB storage engine. You record these choices
        either by recording them in a configuration file that MySQL
        reads at startup, or by specifying them as command-line options
        in a startup script. The full list of options, descriptions, and
        allowed parameter values is at
        <a class="xref" href="storage-engines.html#innodb-parameters" title="14.2.6. InnoDB Startup Options and System Variables">Section 14.2.6, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a>.
</p>
<h5><a name="idp82674352"></a>
        Overview of InnoDB Tablespace and Log Files
</h5>
<p>
        Two important disk-based resources managed by the
        <code class="literal">InnoDB</code> storage engine are its tablespace data
        files and its log files. If you specify no
        <code class="literal">InnoDB</code> configuration options, MySQL creates
        an auto-extending data file, slightly larger than 12MB, named
        <code class="filename">ibdata1</code> and two log files named
        <code class="filename">ib_logfile0</code> and
        <code class="filename">ib_logfile1</code> in the MySQL data directory.
        Their size is given by the size of the
        <a class="link" href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> system
        variable. To get good performance, explicitly provide
        <code class="literal">InnoDB</code> parameters as discussed in the
        following examples. Naturally, edit the settings to suit your
        hardware and requirements.
      </p><p>
        The examples shown here are representative. See
        <a class="xref" href="storage-engines.html#innodb-parameters" title="14.2.6. InnoDB Startup Options and System Variables">Section 14.2.6, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a> for additional information
        about <code class="literal">InnoDB</code>-related configuration
        parameters.
</p>
<h5><a name="idp82682720"></a>
        Considerations for Storage Devices
</h5>
<p>
        In some cases, database performance improves if the data is not
        all placed on the same physical disk. Putting log files on a
        different disk from data is very often beneficial for
        performance. The example illustrates how to do this. It places
        the two data files on different disks and places the log files
        on the third disk. <code class="literal">InnoDB</code> fills the
        tablespace beginning with the first data file. You can also use
        raw disk partitions (raw devices) as <code class="literal">InnoDB</code>
        data files, which may speed up I/O. See
        <a class="xref" href="storage-engines.html#innodb-raw-devices" title="14.2.2.3. Using Raw Disk Partitions for the Shared Tablespace">Section 14.2.2.3, “Using Raw Disk Partitions for the Shared Tablespace”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p xmlns="">
          <code class="literal">InnoDB</code> is a transaction-safe (ACID
          compliant) storage engine for MySQL that has commit, rollback,
          and crash-recovery capabilities to protect user data.
          <span class="bold"><strong>However, it cannot do so</strong></span> if
          the underlying operating system or hardware does not work as
          advertised. Many operating systems or disk subsystems may
          delay or reorder write operations to improve performance. On
          some operating systems, the very <code class="literal">fsync()</code>
          system call that should wait until all unwritten data for a
          file has been flushed might actually return before the data
          has been flushed to stable storage. Because of this, an
          operating system crash or a power outage may destroy recently
          committed data, or in the worst case, even corrupt the
          database because of write operations having been reordered. If
          data integrity is important to you, perform some
          <span class="quote">“<span class="quote">pull-the-plug</span>”</span> tests before using anything in
          production. On Mac OS X 10.3 and up, <code class="literal">InnoDB</code>
          uses a special <code class="literal">fcntl()</code> file flush method.
          Under Linux, it is advisable to <span class="bold"><strong>disable
          the write-back cache</strong></span>.
        </p><p xmlns="">
          On ATA/SATA disk drives, a command such <code class="literal">hdparm -W0
          /dev/hda</code> may work to disable the write-back cache.
          <span class="bold"><strong>Beware that some drives or disk
          controllers may be unable to disable the write-back
          cache.</strong></span>
</p>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<a xmlns="" class="indexterm" name="idp82694912"></a><a xmlns="" class="indexterm" name="idp82696368"></a><p xmlns="">
          If reliability is a consideration for your data, do not
          configure <code class="literal">InnoDB</code> to use data files or log
          files on NFS volumes. Potential problems vary according to OS
          and version of NFS, and include such issues as lack of
          protection from conflicting writes, and limitations on maximum
          file sizes.
</p>
</div>
<h5><a name="idp82699408"></a>
        Specifying the Location and Size for InnoDB Tablespace Files
</h5>
<p>
        To set up the <code class="literal">InnoDB</code> tablespace files, use
        the <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
        option in the <code class="literal">[mysqld]</code> section of the
        <code class="filename">my.cnf</code> option file. On Windows, you can use
        <code class="filename">my.ini</code> instead. The value of
        <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> should be
        a list of one or more data file specifications. If you name more
        than one data file, separate them by semicolon
        (<span class="quote">“<span class="quote"><code class="literal">;</code></span>”</span>) characters:
      </p><pre class="programlisting">innodb_data_file_path=<em class="replaceable"><code>datafile_spec1</code></em>[;<em class="replaceable"><code>datafile_spec2</code></em>]...
</pre><p>
        For example, the following setting explicitly creates a
        minimally sized system tablespace:
      </p><pre class="programlisting">[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend</pre><p>
        This setting configures a single 12MB data file named
        <code class="filename">ibdata1</code> that is auto-extending. No location
        for the file is given, so by default, <code class="literal">InnoDB</code>
        creates it in the MySQL data directory.
      </p><p>
        Sizes are specified using <code class="literal">K</code>,
        <code class="literal">M</code>, or <code class="literal">G</code> suffix letters to
        indicate units of KB, MB, or GB.
      </p><p>
        A tablespace containing a fixed-size 50MB data file named
        <code class="filename">ibdata1</code> and a 50MB auto-extending file
        named <code class="filename">ibdata2</code> in the data directory can be
        configured like this:
      </p><pre class="programlisting">[mysqld]
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend</pre><p>
        The full syntax for a data file specification includes the file
        name, its size, and several optional attributes:
      </p><pre class="programlisting"><em class="replaceable"><code>file_name</code></em>:<em class="replaceable"><code>file_size</code></em>[:autoextend[:max:<em class="replaceable"><code>max_file_size</code></em>]]
</pre><p>
        The <code class="literal">autoextend</code> and <code class="literal">max</code>
        attributes can be used only for the last data file in the
        <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> line.
      </p><p>
        If you specify the <code class="literal">autoextend</code> option for the
        last data file, <code class="literal">InnoDB</code> extends the data file
        if it runs out of free space in the tablespace. The increment is
        8MB at a time by default. To modify the increment, change the
        <a class="link" href="storage-engines.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
        system variable.
      </p><p>
        If the disk becomes full, you might want to add another data
        file on another disk. For tablespace reconfiguration
        instructions, see
        <a class="xref" href="storage-engines.html#innodb-data-log-reconfiguration" title="14.2.2.2. Adding, Removing, or Resizing InnoDB Data and Log Files">Section 14.2.2.2, “Adding, Removing, or Resizing <code class="literal">InnoDB</code> Data and Log
    Files”</a>.
      </p><p>
        <code class="literal">InnoDB</code> is not aware of the file system
        maximum file size, so be cautious on file systems where the
        maximum file size is a small value such as 2GB. To specify a
        maximum size for an auto-extending data file, use the
        <code class="literal">max</code> attribute following the
        <code class="literal">autoextend</code> attribute. Use the
        <code class="literal">max</code> attribute only in cases where
        constraining disk usage is of critical importance, because
        exceeding the maximum size causes a fatal error, possibly
        including a crash. The following configuration permits
        <code class="filename">ibdata1</code> to grow up to a limit of 500MB:
      </p><pre class="programlisting">[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend:max:500M</pre><p>
        <code class="literal">InnoDB</code> creates tablespace files in the MySQL
        data directory by default. To specify a location explicitly, use
        the <a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>
        option. For example, to use two files named
        <code class="filename">ibdata1</code> and <code class="filename">ibdata2</code>
        but create them in the <code class="filename">/ibdata</code> directory,
        configure <code class="literal">InnoDB</code> like this:
      </p><pre class="programlisting">[mysqld]
innodb_data_home_dir = /ibdata
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          <code class="literal">InnoDB</code> does not create directories, so make
          sure that the <code class="filename">/ibdata</code> directory exists
          before you start the server. This is also true of any log file
          directories that you configure. Use the Unix or DOS
          <code class="literal">mkdir</code> command to create any necessary
          directories.
        </p><p xmlns="">
          Make sure that the MySQL server has the proper access rights
          to create files in the data directory. More generally, the
          server must have access rights in any directory where it needs
          to create data files or log files.
</p>
</div>
<p>
        <code class="literal">InnoDB</code> forms the directory path for each data
        file by textually concatenating the value of
        <a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to the
        data file name, adding a path name separator (slash or
        backslash) between values if necessary. If the
        <a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option is
        not specified in <code class="filename">my.cnf</code> at all, the default
        value is the <span class="quote">“<span class="quote">dot</span>”</span> directory
        <code class="filename">./</code>, which means the MySQL data directory.
        (The MySQL server changes its current working directory to its
        data directory when it begins executing.)
      </p><p>
        If you specify
        <a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> as an
        empty string, you can specify absolute paths for the data files
        listed in the
        <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> value.
        The following example is equivalent to the preceding one:
      </p><pre class="programlisting">[mysqld]
innodb_data_home_dir =
innodb_data_file_path=/ibdata/ibdata1:50M;/ibdata/ibdata2:50M:autoextend</pre>
<h5><a name="idp82748944"></a>
        Specifying InnoDB Configuration Options
</h5>
<p>
        <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file
        for small systems.</strong></span> Suppose that you have a computer
        with 512MB RAM and one hard disk. The following example shows
        possible configuration parameters in <code class="filename">my.cnf</code>
        or <code class="filename">my.ini</code> for <code class="literal">InnoDB</code>,
        including the <code class="literal">autoextend</code> attribute. The
        example suits most users, both on Unix and Windows, who do not
        want to distribute <code class="literal">InnoDB</code> data files and log
        files onto several disks. It creates an auto-extending data file
        <code class="filename">ibdata1</code> and two <code class="literal">InnoDB</code>
        log files <code class="filename">ib_logfile0</code> and
        <code class="filename">ib_logfile1</code> in the MySQL data directory.
      </p><pre class="programlisting">[mysqld]
# You can write your other MySQL server options here
# ...
# Data files must be able to hold your data and indexes.
# Make sure that you have enough free disk space.
innodb_data_file_path = ibdata1:12M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory
innodb_buffer_pool_size=256M
innodb_additional_mem_pool_size=20M
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=64M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1</pre><p>
        Note that data files must be less than 2GB in some file systems.
        The combined size of the log files can be up to 512GB. The
        combined size of data files must be slightly larger than 10MB.
</p>
<h5><a name="idp82760656"></a>
        Setting Up the InnoDB System Tablespace
</h5>
<p>
        When you create an <code class="literal">InnoDB</code> system tablespace
        for the first time, it is best that you start the MySQL server
        from the command prompt. <code class="literal">InnoDB</code> then prints
        the information about the database creation to the screen, so
        you can see what is happening. For example, on Windows, if
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is located in <code class="filename">C:\Program
        Files\MySQL\MySQL Server 5.6\bin</code>, you
        can start it like this:
      </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>"C:\Program Files\MySQL\MySQL Server 5.6\bin\mysqld" --console</code></strong>
</pre><p>
        If you do not send server output to the screen, check the
        server's error log to see what <code class="literal">InnoDB</code> prints
        during the startup process.
      </p><p>
        For an example of what the information displayed by
        <code class="literal">InnoDB</code> should look like, see
        <a class="xref" href="storage-engines.html#innodb-init" title="14.2.2.1. Creating the InnoDB Tablespace">Section 14.2.2.1, “Creating the <code class="literal">InnoDB</code> Tablespace”</a>.
</p>
<h5><a name="idp82769312"></a>
        Editing the MySQL Configuration File
</h5>
<p>
        You can place <code class="literal">InnoDB</code> options in the
        <code class="literal">[mysqld]</code> group of any option file that your
        server reads when it starts. The locations for option files are
        described in <a class="xref" href="programs.html#option-files" title="4.2.3.3. Using Option Files">Section 4.2.3.3, “Using Option Files”</a>.
      </p><p>
        If you installed MySQL on Windows using the installation and
        configuration wizards, the option file will be the
        <code class="filename">my.ini</code> file located in your MySQL
        installation directory. See <a class="xref" href="installing.html#mysql-installer" title="2.3.3. Installing MySQL on Microsoft Windows Using MySQL Installer">Section 2.3.3, “Installing MySQL on Microsoft Windows Using MySQL Installer”</a>.
      </p><p>
        If your PC uses a boot loader where the <code class="filename">C:</code>
        drive is not the boot drive, your only option is to use the
        <code class="filename">my.ini</code> file in your Windows directory
        (typically <code class="filename">C:\WINDOWS</code>). You can use the
        <code class="literal">SET</code> command at the command prompt in a
        console window to print the value of <code class="literal">WINDIR</code>:
      </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>SET WINDIR</code></strong>
windir=C:\WINDOWS
</pre><p>
        To make sure that <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> reads options only
        from a specific file, use the
        <a class="link" href="programs.html#option_general_defaults-file"><code class="option">--defaults-file</code></a> option as the
        first option on the command line when starting the server:
      </p><pre class="programlisting">mysqld --defaults-file=<em class="replaceable"><code>your_path_to_my_cnf</code></em>
</pre><p>
        <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file
        for large systems.</strong></span> Suppose that you have a Linux
        computer with 2GB RAM and three 60GB hard disks at directory
        paths <code class="filename">/</code>, <code class="filename">/dr2</code> and
        <code class="filename">/dr3</code>. The following example shows possible
        configuration parameters in <code class="filename">my.cnf</code> for
        <code class="literal">InnoDB</code>.
      </p><pre class="programlisting">[mysqld]
# You can write your other MySQL server options here
# ...
innodb_data_home_dir =
#
# Data files must be able to hold your data and indexes
innodb_data_file_path = /db/ibdata1:2000M;/dr2/db/ibdata2:2000M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory,
# but make sure on Linux x86 total memory usage is &lt; 2GB
innodb_buffer_pool_size=1G
innodb_additional_mem_pool_size=20M
innodb_log_group_home_dir = /dr3/iblogs
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=250M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1
innodb_lock_wait_timeout=50
#
# Uncomment the next line if you want to use it
#innodb_thread_concurrency=5</pre>
<h5><a name="idp82792272"></a>
        Determining the Maximum Memory Allocation for InnoDB
</h5>
<div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p xmlns="">
          On 32-bit GNU/Linux x86, be careful not to set memory usage
          too high. <code class="literal">glibc</code> may permit the process heap
          to grow over thread stacks, which crashes your server. It is a
          risk if the value of the following expression is close to or
          exceeds 2GB:
        </p><pre class="programlisting">innodb_buffer_pool_size
+ key_buffer_size
+ max_connections*(sort_buffer_size+read_buffer_size+binlog_cache_size)
+ max_connections*2MB</pre><p xmlns="">
          Each thread uses a stack (often 2MB, but only 256KB in MySQL
          binaries provided by Oracle Corporation.) and in the worst
          case also uses <code class="literal">sort_buffer_size +
          read_buffer_size</code> additional memory.
</p>
</div>
<p>
        <span class="bold"><strong>Tuning other <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
        server parameters.</strong></span> The following values are typical
        and suit most users:
      </p><pre class="programlisting">[mysqld]
skip-external-locking
max_connections=200
read_buffer_size=1M
sort_buffer_size=1M
#
# Set key_buffer to 5 - 50% of your RAM depending on how much
# you use MyISAM tables, but keep key_buffer_size + InnoDB
# buffer pool size &lt; 80% of your RAM
key_buffer_size=<em class="replaceable"><code>value</code></em>
</pre><p>
        On Linux, if the kernel is enabled for large page support,
        <code class="literal">InnoDB</code> can use large pages to allocate memory
        for its buffer pool and additional memory pool. See
        <a class="xref" href="optimization.html#large-page-support" title="8.11.4.2. Enabling Large Page Support">Section 8.11.4.2, “Enabling Large Page Support”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-administration"></a>14.2.2. Administering <code class="literal">InnoDB</code></h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-init">14.2.2.1. Creating the <code class="literal">InnoDB</code> Tablespace</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-data-log-reconfiguration">14.2.2.2. Adding, Removing, or Resizing <code class="literal">InnoDB</code> Data and Log
Files</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-raw-devices">14.2.2.3. Using Raw Disk Partitions for the Shared Tablespace</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-backup">14.2.2.4. Backing Up and Recovering an <code class="literal">InnoDB</code> Database</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-migration">14.2.2.5. Moving or Copying <code class="literal">InnoDB</code> Tables to Another Machine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-and-mysql-replication">14.2.2.6. <code class="literal">InnoDB</code> and MySQL Replication</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-check-availability">14.2.2.7. Checking InnoDB Availability</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-turning-off">14.2.2.8. Turning Off InnoDB</a></span></dt></dl>
</div>
<p>
    Administration tasks related to <code class="literal">InnoDB</code> mainly
    involve these aspects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Managing the <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a>
        that represent the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
        tablespace</a>, <code class="literal">InnoDB</code> tables, and their
        associated indexes. You can change the way these files are laid
        out and divided, which affects both performance and the features
        available for specific tables.
      </p></li><li class="listitem"><p>
        Managing the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files
        that are used for <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
        recovery</a>. You can specify the size of these files.
      </p></li><li class="listitem"><p>
        Making sure that <code class="literal">InnoDB</code> is used for the
        tables where it is intended, rather than a different storage
        engine.
      </p></li><li class="listitem"><p>
        General administrative tasks related to performance. You might
        consult with application developers during the application
        design phase, monitor performance on an ongoing basis to ensure
        the system settings are working well, and diagnose and help fix
        performance and capacity issues that arise suddenly.
</p></li></ul>
</div>
<p>
    Since <code class="literal">InnoDB</code> tables are now the default for
    MySQL, much of the associated administration material is now in the
    main <span class="quote">“<span class="quote">Administration</span>”</span> chapter,
    <a class="xref" href="server-administration.html" title="Chapter 5. MySQL Server Administration">Chapter 5, <i>MySQL Server Administration</i></a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-init"></a>14.2.2.1. Creating the <code class="literal">InnoDB</code> Tablespace</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp82818272"></a><p>
    Suppose that you have installed MySQL and have edited your option
    file so that it contains the necessary <code class="literal">InnoDB</code>
    configuration parameters. Before starting MySQL, verify that the
    directories you have specified for <code class="literal">InnoDB</code> data
    files and log files exist and that the MySQL server has access
    rights to those directories. <code class="literal">InnoDB</code> does not
    create directories, only files. Check also that you have enough disk
    space for the data and log files.
  </p><p>
    It is best to run the MySQL server <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> from
    the command prompt when you first start the server with
    <code class="literal">InnoDB</code> enabled, not from
    <a class="link" href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> or as a Windows service. When you run
    from a command prompt you see what <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> prints
    and what is happening. On Unix, just invoke
    <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. On Windows, start
    <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
    <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option to direct the output
    to the console window.
  </p><p>
    When you start the MySQL server after initially configuring
    <code class="literal">InnoDB</code> in your option file,
    <code class="literal">InnoDB</code> creates your data files and log files, and
    prints something like this:
  </p><pre class="programlisting">InnoDB: The first specified datafile /home/heikki/data/ibdata1
did not exist:
InnoDB: a new database to be created!
InnoDB: Setting file /home/heikki/data/ibdata1 size to 134217728
InnoDB: Database physically writes the file full: wait...
InnoDB: datafile /home/heikki/data/ibdata2 did not exist:
new to be created
InnoDB: Setting file /home/heikki/data/ibdata2 size to 262144000
InnoDB: Database physically writes the file full: wait...
InnoDB: Log file /home/heikki/data/logs/ib_logfile0 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile0 size
to 5242880
InnoDB: Log file /home/heikki/data/logs/ib_logfile1 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile1 size
to 5242880
InnoDB: Doublewrite buffer not found: creating new
InnoDB: Doublewrite buffer created
InnoDB: Creating foreign key constraint system tables
InnoDB: Foreign key constraint system tables created
InnoDB: Started
mysqld: ready for connections</pre><p>
    At this point <code class="literal">InnoDB</code> has initialized its
    tablespace and log files. You can connect to the MySQL server with
    the usual MySQL client programs like <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>. When
    you shut down the MySQL server with <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
    shutdown</strong></span></a>, the output is like this:
  </p><pre class="programlisting">010321 18:33:34  mysqld: Normal shutdown
010321 18:33:34  mysqld: Shutdown Complete
InnoDB: Starting shutdown...
InnoDB: Shutdown completed</pre><p>
    You can look at the data file and log directories and you see the
    files created there. When MySQL is started again, the data files and
    log files have been created already, so the output is much briefer:
  </p><pre class="programlisting">InnoDB: Started
mysqld: ready for connections</pre><p>
    If you add the
    <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option to
    <code class="filename">my.cnf</code>, <code class="literal">InnoDB</code> stores each
    table in its own <code class="filename">.ibd</code> file, in the same MySQL
    database directory where the <code class="filename">.frm</code> file is
    created. See <a class="xref" href="server-administration.html#innodb-multiple-tablespaces" title="5.4.1. Managing InnoDB Tablespaces">Section 5.4.1, “Managing InnoDB Tablespaces”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-data-log-reconfiguration"></a>14.2.2.2. Adding, Removing, or Resizing <code class="literal">InnoDB</code> Data and Log
Files</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp82846144"></a><a class="indexterm" name="idp82847632"></a><a class="indexterm" name="idp82849120"></a><p>
    This section describes what you can do when your
    <code class="literal">InnoDB</code>
    <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a> runs
    out of room or when you want to change the size of the
    <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files.
  </p><p>
    The easiest way to increase the size of the
    <code class="literal">InnoDB</code> system tablespace is to configure it from
    the beginning to be auto-extending. Specify the
    <code class="literal">autoextend</code> attribute for the last data file in
    the tablespace definition. Then <code class="literal">InnoDB</code> increases
    the size of that file automatically in 8MB increments when it runs
    out of space. The increment size can be changed by setting the value
    of the <a class="link" href="storage-engines.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
    system variable, which is measured in megabytes.
  </p><p>
    You can expand the system tablespace by a defined amount by adding
    another data file:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Shut down the MySQL server.
      </p></li><li class="listitem"><p>
        If the previous last data file is defined with the keyword
        <code class="literal">autoextend</code>, change its definition to use a
        fixed size, based on how large it has actually grown. Check the
        size of the data file, round it down to the closest multiple of
        1024 × 1024 bytes (= 1MB), and specify this rounded size
        explicitly in
        <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
      </p></li><li class="listitem"><p>
        Add a new data file to the end of
        <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>,
        optionally making that file auto-extending. Only the last data
        file in the
        <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> can be
        specified as auto-extending.
      </p></li><li class="listitem"><p>
        Start the MySQL server again.
</p></li></ul>
</div>
<p>
    For example, this tablespace has just one auto-extending data file
    <code class="filename">ibdata1</code>:
  </p><pre class="programlisting">innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:10M:autoextend</pre><p>
    Suppose that this data file, over time, has grown to 988MB. Here is
    the configuration line after modifying the original data file to use
    a fixed size and adding a new auto-extending data file:
  </p><pre class="programlisting">innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend</pre><p>
    When you add a new data file to the system tablespace configuration,
    make sure that the filename does not refer to an existing file.
    <code class="literal">InnoDB</code> creates and initializes the file when you
    restart the server.
  </p><p>
    Currently, you cannot remove a data file from the system tablespace.
    To decrease the system tablespace size, use this procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Use <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump all your
        <code class="literal">InnoDB</code> tables, including
        <code class="literal">InnoDB</code> tables located in the MySQL database.
        As of 5.6, there are five <code class="literal">InnoDB</code> tables
        included in the MySQL database:
      </p><pre class="programlisting">mysql&gt; select table_name from information_schema.tables where table_schema='mysql' and engine='InnoDB';
+----------------------+
| table_name           |
+----------------------+
| innodb_index_stats   |
| innodb_table_stats   |
| slave_master_info    |
| slave_relay_log_info |
| slave_worker_info    |
+----------------------+
5 rows in set (0.00 sec)
      </pre></li><li class="listitem"><p>
        Stop the server.
      </p></li><li class="listitem"><p>
        Remove all the existing tablespace files
        (<code class="filename">*.ibd</code>), including the
        <code class="filename">ibdata</code> and <code class="filename">ib_log</code>
        files. Do not forget to remove <code class="filename">*.ibd</code> files
        for tables located in the MySQL database.
      </p></li><li class="listitem"><p>
        Remove any <code class="filename">.frm</code> files for
        <code class="literal">InnoDB</code> tables.
      </p></li><li class="listitem"><p>
        Configure a new tablespace.
      </p></li><li class="listitem"><p>
        Restart the server.
      </p></li><li class="listitem"><p>
        Import the dump files.
</p></li></ol>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
      If your databases only use the <code class="literal">InnoDB</code> engine,
      it may be simpler to dump <span class="bold"><strong>all</strong></span>
      databases, stop the server, remove all databases and
      <code class="literal">InnoDB</code> log files, restart the server, and
      import the dump files.
</p>
</div>
<h5><a name="idp82891056"></a>
    Changing the Number or Size of InnoDB Log Files
</h5>
<p>
    To change the number or the size of <code class="literal">InnoDB</code> log
    files in MySQL 5.6.7 or earlier, use the following instructions. The
    procedure to use depends on the value of
    <a class="link" href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a>, which
    determines whether or not to bring the system tablespace fully
    up-to-date before a shutdown operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If <a class="link" href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is not
        set to 2: Stop the MySQL server and make sure that it shuts down
        without errors, to ensure that there is no information for
        outstanding transactions in the redo log. Copy the old redo log
        files to a safe place, in case something went wrong during the
        shutdown and you need them to recover the tablespace. Delete the
        old log files from the log file directory, edit
        <code class="filename">my.cnf</code> to change the log file
        configuration, and start the MySQL server again.
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> sees that no <code class="literal">InnoDB</code>
        log files exist at startup and creates new ones.
      </p></li><li class="listitem"><p>
        If <a class="link" href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is set
        to 2: Set <a class="link" href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a>
        to 1:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_fast_shutdown = 1;</code></strong>
</pre><p>
        Then follow the instructions in the previous item.
</p></li></ul>
</div>
<p>
    As of MySQL 5.6.8, the
    <a class="link" href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> setting is no
    longer relevant when changing the number or the size of
    <code class="literal">InnoDB</code> log files. Additionally, you are no longer
    required remove old log files, although you may still want to copy
    the old log files to a safe place, as a backup. To change the number
    or size of <code class="literal">InnoDB</code> log files, perform the
    following steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Stop the MySQL server and make sure that it shuts down without
        errors.
      </p></li><li class="listitem"><p>
        Edit <code class="filename">my.cnf</code> to change the log file
        configuration. To change the log file size, configure
        <a class="link" href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>. To
        increase the number of log files, configure
        <a class="link" href="storage-engines.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>.
      </p></li><li class="listitem"><p>
        Start the MySQL server again.
</p></li></ol>
</div>
<p>
    If <code class="literal">InnoDB</code> detects that the
    <a class="link" href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> differs from
    the redo log file size, it will write a log checkpoint, close and
    remove the old log files, create new log files at the requested
    size, and open the new log files.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-raw-devices"></a>14.2.2.3. Using Raw Disk Partitions for the Shared Tablespace</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp82916112"></a><a class="indexterm" name="idp82917600"></a><p>
    You can use raw disk partitions as data files in the
    <code class="literal">InnoDB</code>
    <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
    This technique enables nonbuffered I/O on Windows and on some Linux
    and Unix systems without file system overhead. Perform tests with
    and without raw partitions to verify whether this change actually
    improves performance on your system.
  </p><p>
    When you create a new data file, put the keyword
    <code class="literal">newraw</code> immediately after the data file size in
    <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>. The
    partition must be at least as large as the size that you specify.
    Note that 1MB in <code class="literal">InnoDB</code> is 1024 × 1024
    bytes, whereas 1MB in disk specifications usually means 1,000,000
    bytes.
  </p><pre class="programlisting">[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw</pre><p>
    The next time you start the server, <code class="literal">InnoDB</code>
    notices the <code class="literal">newraw</code> keyword and initializes the
    new partition. However, do not create or change any
    <code class="literal">InnoDB</code> tables yet. Otherwise, when you next
    restart the server, <code class="literal">InnoDB</code> reinitializes the
    partition and your changes are lost. (As a safety measure
    <code class="literal">InnoDB</code> prevents users from modifying data when
    any partition with <code class="literal">newraw</code> is specified.)
  </p><p>
    After <code class="literal">InnoDB</code> has initialized the new partition,
    stop the server, change <code class="literal">newraw</code> in the data file
    specification to <code class="literal">raw</code>:
  </p><pre class="programlisting">[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Graw;/dev/hdd2:2Graw</pre><p>
    Then restart the server and <code class="literal">InnoDB</code> permits
    changes to be made.
  </p><p>
    On Windows, you can allocate a disk partition as a data file like
    this:
  </p><pre class="programlisting">[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Gnewraw</pre><p>
    The <code class="filename">//./</code> corresponds to the Windows syntax of
    <code class="filename">\\.\</code> for accessing physical drives.
  </p><p>
    When you use a raw disk partition, ensure that the user ID that runs
    the MySQL server has read and write privileges for that partition.
    For example, if you run the server as the <code class="literal">mysql</code>
    user, the partition must be readable and writeable by
    <code class="literal">mysql</code>. If you run the server with the
    <a class="link" href="server-administration.html#option_mysqld_memlock"><code class="option">--memlock</code></a> option, the server must be
    run as <code class="literal">root</code>, so the partition must be readable
    and writeable by <code class="literal">root</code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-backup"></a>14.2.2.4. Backing Up and Recovering an <code class="literal">InnoDB</code> Database</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp82943536"></a><a class="indexterm" name="idp82945024"></a><p>
    

    The key to safe database management is making regular backups.
    Depending on your data volume, number of MySQL servers, and database
    workload, you can use these techniques, alone or in combination:
    <a class="link" href="glossary.html#glos_hot_backup" title="hot backup">hot backup</a> with MySQL
    Enterprise Backup; <a class="link" href="glossary.html#glos_cold_backup" title="cold backup">cold
    backup</a> by copying files while the MySQL server is shut down;
    <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backup</a> for fast
    operation (especially for restore);
    <a class="link" href="glossary.html#glos_logical_backup" title="logical backup">logical backup</a> with
    <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> for smaller data volumes or to record
    the structure of schema objects.
</p>
<h5><a name="idp82951776"></a>
    Hot Backups
</h5>
<p>
    The <span class="command"><strong>mysqlbackup</strong></span> command, part of the MySQL
    Enterprise Backup component, lets you back up a running MySQL
    instance, including <code class="literal">InnoDB</code> and
    <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables, with minimal disruption
    to operations while producing a consistent snapshot of the database.
    When <span class="command"><strong>mysqlbackup</strong></span> is copying
    <code class="literal">InnoDB</code> tables, reads and writes to both
    <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> tables can
    continue. During the copying of <code class="literal">MyISAM</code> tables,
    reads (but not writes) to those tables are permitted. MySQL
    Enterprise Backup can also create compressed backup files, and back
    up subsets of tables and databases. In conjunction with MySQL’s
    binary log, users can perform point-in-time recovery. MySQL
    Enterprise Backup is part of the MySQL Enterprise subscription. For
    more details, see <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="24.2. MySQL Enterprise Backup">Section 24.2, “MySQL Enterprise Backup”</a>.
</p>
<h5><a name="idp82960032"></a>
    Cold Backups
</h5>
<p>
    If you can shut down your MySQL server, you can make a binary backup
    that consists of all files used by <code class="literal">InnoDB</code> to
    manage its tables. Use the following procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a> of
        the MySQL server and make sure that it stops without errors.
      </p></li><li class="listitem"><p>
        Copy all <code class="literal">InnoDB</code> data files
        (<code class="filename">ibdata</code> files and <code class="filename">.ibd</code>
        files) into a safe place.
      </p></li><li class="listitem"><p>
        Copy all the <code class="filename">.frm</code> files for
        <code class="literal">InnoDB</code> tables to a safe place.
      </p></li><li class="listitem"><p>
        Copy all <code class="literal">InnoDB</code> log files
        (<code class="filename">ib_logfile</code> files) to a safe place.
      </p></li><li class="listitem"><p>
        Copy your <code class="filename">my.cnf</code> configuration file or
        files to a safe place.
</p></li></ol>
</div>
<h5><a name="idp82973312"></a>
    Alternative Backup Types
</h5>
<p>
    In addition to making binary backups as just described, regularly
    make dumps of your tables with <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>. A
    binary file might be corrupted without you noticing it. Dumped
    tables are stored into text files that are human-readable, so
    spotting table corruption becomes easier. Also, because the format
    is simpler, the chance for serious data corruption is smaller.
    <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> also has a
    <a class="link" href="programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a> option for
    making a consistent snapshot without locking out other clients. See
    <a class="xref" href="backup-and-recovery.html#backup-policy" title="7.3.1. Establishing a Backup Policy">Section 7.3.1, “Establishing a Backup Policy”</a>.
  </p><p>
    Replication works with <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables,
    so you can use MySQL replication capabilities to keep a copy of your
    database at database sites requiring high availability.
</p>
<h5><a name="idp82979120"></a>
    Performing Recovery
</h5>
<p>
    To recover your <code class="literal">InnoDB</code> database to the present
    from the time at which the binary backup was made, you must run your
    MySQL server with binary logging turned on, even before taking the
    backup. To achieve point-in-time recovery after restoring a backup,
    you can apply changes from the binary log that occurred after the
    backup was made. See <a class="xref" href="backup-and-recovery.html#point-in-time-recovery" title="7.5. Point-in-Time (Incremental) Recovery Using the Binary Log">Section 7.5, “Point-in-Time (Incremental) Recovery Using the Binary Log”</a>.
  </p><p>
    To recover from a crash of your MySQL server, the only requirement
    is to restart it. <code class="literal">InnoDB</code> automatically checks the
    logs and performs a roll-forward of the database to the present.
    <code class="literal">InnoDB</code> automatically rolls back uncommitted
    transactions that were present at the time of the crash. During
    recovery, <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> displays output something like
    this:
  </p><pre class="programlisting">InnoDB: Database was not shut down normally.
InnoDB: Starting recovery from log files...
InnoDB: Starting log scan based on checkpoint at
InnoDB: log sequence number 0 13674004
InnoDB: Doing recovery: scanned up to log sequence number 0 13739520
InnoDB: Doing recovery: scanned up to log sequence number 0 13805056
InnoDB: Doing recovery: scanned up to log sequence number 0 13870592
InnoDB: Doing recovery: scanned up to log sequence number 0 13936128
...
InnoDB: Doing recovery: scanned up to log sequence number 0 20555264
InnoDB: Doing recovery: scanned up to log sequence number 0 20620800
InnoDB: Doing recovery: scanned up to log sequence number 0 20664692
InnoDB: 1 uncommitted transaction(s) which must be rolled back
InnoDB: Starting rollback of uncommitted transactions
InnoDB: Rolling back trx no 16745
InnoDB: Rolling back of trx no 16745 completed
InnoDB: Rollback of uncommitted transactions completed
InnoDB: Starting an apply batch of log records to the database...
InnoDB: Apply batch completed
InnoDB: Started
mysqld: ready for connections</pre><p>
    If your database becomes corrupted or disk failure occurs, you must
    perform the recovery using a backup. In the case of corruption,
    first find a backup that is not corrupted. After restoring the base
    backup, do a point-in-time recovery from the binary log files using
    <a class="link" href="programs.html#mysqlbinlog" title="4.6.8. mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> and <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> to
    restore the changes that occurred after the backup was made.
  </p><a class="indexterm" name="idp82989024"></a><a class="indexterm" name="idp82990512"></a><a class="indexterm" name="idp82992000"></a><p>
    In some cases of database corruption, it is enough just to dump,
    drop, and re-create one or a few corrupt tables. You can use the
    <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> SQL statement to check
    whether a table is corrupt, although <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
    TABLE</code></a> naturally cannot detect every possible kind of
    corruption. You can use the Tablespace Monitor to check the
    integrity of the file space management inside the tablespace files.
  </p><p>
    In some cases, apparent database page corruption is actually due to
    the operating system corrupting its own file cache, and the data on
    disk may be okay. It is best first to try restarting your computer.
    Doing so may eliminate errors that appeared to be database page
    corruption. If MySQL still has trouble starting because of
    <code class="literal">InnoDB</code> consistency problems, see
    <a class="xref" href="storage-engines.html#forcing-innodb-recovery" title="14.2.4.6. Starting InnoDB on a Corrupted Database">Section 14.2.4.6, “Starting <code class="literal">InnoDB</code> on a Corrupted Database”</a> for steps to start the
    instance in a diagnostic mode where you can dump the data.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-migration"></a>14.2.2.5. Moving or Copying <code class="literal">InnoDB</code> Tables to Another Machine</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp82999888"></a><p>
    This section explains various techniques for moving or copying some
    or all <code class="literal">InnoDB</code> tables to a different server. For
    example, you might move an entire MySQL instance to a larger, faster
    server; you might clone an entire MySQL instance to a new
    replication slave server; you might copy individual tables to
    another server to development and test an application, or to a data
    warehouse server to produce reports.
</p>
<h5><a name="idp83004512"></a>
    Using Lowercase Table Names
</h5>
<p>
    On Windows, <code class="literal">InnoDB</code> always stores database and
    table names internally in lowercase. To move databases in a binary
    format from Unix to Windows or from Windows to Unix, create all
    databases and tables using lowercase names. A convenient way to
    accomplish this is to add the following line to the
    <code class="literal">[mysqld]</code> section of your
    <code class="filename">my.cnf</code> or <code class="filename">my.ini</code> file
    before creating any databases or tables:
  </p><pre class="programlisting">[mysqld]
lower_case_table_names=1</pre>
<h5><a name="idp83009248"></a>
    Using MySQL Enterprise Backup
</h5>
<p>
    The MySQL Enterprise Backup product lets you back up a running MySQL
    database, including <code class="literal">InnoDB</code> and
    <code class="literal">MyISAM</code> tables, with minimal disruption to
    operations while producing a consistent snapshot of the database.
    When MySQL Enterprise Backup is copying <code class="literal">InnoDB</code>
    tables, reads and writes to both <code class="literal">InnoDB</code> and
    <code class="literal">MyISAM</code> tables can continue. During the copying of
    <code class="literal">MyISAM</code> and other non-InnoDB tables, reads (but
    not writes) to those tables are permitted. In addition, MySQL
    Enterprise Backup can create compressed backup files, and back up
    subsets of <code class="literal">InnoDB</code> tables. In conjunction with the
    MySQL binary log, you can perform point-in-time recovery. MySQL
    Enterprise Backup is included as part of the MySQL Enterprise
    subscription.
  </p><p>
    For more details about MySQL Enterprise Backup, see
    <a class="ulink" href="http://dev.mysql.com/doc/mysql-enterprise-backup/3.8/en/index.html" target="_top">MySQL Enterprise Backup User's Guide (Version 3.8.2)</a>.
</p>
<h5><a name="idp83017008"></a>
    Copying Data Files
</h5>
<p>
    Like <code class="literal">MyISAM</code> data files, <code class="literal">InnoDB</code>
    data and log files are binary-compatible on all platforms having the
    same floating-point number format. You can move an
    <code class="literal">InnoDB</code> database simply by copying all the
    relevant files listed in <a class="xref" href="storage-engines.html#innodb-backup" title="14.2.2.4. Backing Up and Recovering an InnoDB Database">Section 14.2.2.4, “Backing Up and Recovering an <code class="literal">InnoDB</code> Database”</a>. If the
    floating-point formats differ but you have not used
    <a class="link" href="data-types.html#floating-point-types" title="11.2.3. Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">FLOAT</code></a> or
    <a class="link" href="data-types.html#floating-point-types" title="11.2.3. Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">DOUBLE</code></a> data types in your tables,
    then the procedure is the same: simply copy the relevant files.
</p>
<h5><a name="idp83022560"></a>
    Portability Considerations for <code class="literal">.ibd</code> Files
</h5>
<p>
    When you move or copy <code class="filename">.ibd</code> files, the database
    directory name must be the same on the source and destination
    systems. The table definition stored in the
    <code class="literal">InnoDB</code> shared tablespace includes the database
    name. The transaction IDs and log sequence numbers stored in the
    tablespace files also differ between databases.
  </p><p>
    To move an <code class="filename">.ibd</code> file and the associated table
    from one database to another, use a <a class="link" href="sql-syntax.html#rename-table" title="13.1.32. RENAME TABLE Syntax"><code class="literal">RENAME
    TABLE</code></a> statement:
  </p><pre class="programlisting">RENAME TABLE <em class="replaceable"><code>db1.tbl_name</code></em> TO <em class="replaceable"><code>db2.tbl_name</code></em>;
</pre><a class="indexterm" name="idp83029440"></a><a class="indexterm" name="idp83030512"></a><p>
    

    If you have a <span class="quote">“<span class="quote">clean</span>”</span> backup of an
    <code class="filename">.ibd</code> file, you can restore it to the MySQL
    installation from which it originated as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        The table must not have been dropped or truncated since you
        copied the <code class="filename">.ibd</code> file, because doing so
        changes the table ID stored inside the tablespace.
      </p></li><li class="listitem"><p>
        Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
        to delete the current <code class="filename">.ibd</code> file:
      </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DISCARD TABLESPACE;
</pre></li><li class="listitem"><p>
        Copy the backup <code class="filename">.ibd</code> file to the proper
        database directory.
      </p></li><li class="listitem"><p>
        Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
        to tell <code class="literal">InnoDB</code> to use the new
        <code class="filename">.ibd</code> file for the table:
      </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> IMPORT TABLESPACE;
</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          The <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE
          ... IMPORT TABLESPACE</code></a> feature does not enforce
          foreign key constraints on imported data.
</p>
</div>
</li></ol>
</div>
<p>
    In this context, a <span class="quote">“<span class="quote">clean</span>”</span> <code class="filename">.ibd</code>
    file backup is one for which the following requirements are
    satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        There are no uncommitted modifications by transactions in the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        There are no unmerged insert buffer entries in the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        Purge has removed all delete-marked index records from the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has flushed all modified pages of the
        <code class="filename">.ibd</code> file from the buffer pool to the file.
</p></li></ul>
</div>
<p>
    You can make a clean backup <code class="filename">.ibd</code> file using the
    following method:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Stop all activity from the <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server and
        commit all transactions.
      </p></li><li class="listitem"><p>
        Wait until <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW
        ENGINE INNODB STATUS</code></a> shows that there are no active
        transactions in the database, and the main thread status of
        <code class="literal">InnoDB</code> is <code class="literal">Waiting for server
        activity</code>. Then you can make a copy of the
        <code class="filename">.ibd</code> file.
</p></li></ol>
</div>
<p>
    Another method for making a clean copy of an
    <code class="filename">.ibd</code> file is to use the MySQL Enterprise Backup
    product:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Use MySQL Enterprise Backup to back up the
        <code class="literal">InnoDB</code> installation.
      </p></li><li class="listitem"><p>
        Start a second <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server on the backup
        and let it clean up the <code class="filename">.ibd</code> files in the
        backup.
</p></li></ol>
</div>
<h5><a name="idp83071184"></a>
    Export and Import
</h5>
<p>
    If you use <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump your tables on one
    machine and then import the dump files on the other machine, it does
    not matter whether the formats differ or your tables contain
    floating-point data.
  </p><p>
    One way to increase performance is to switch off
    <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode when
    importing data, assuming that the tablespace has enough space for
    the big rollback segment that the import transactions generate. Do
    the commit only after importing a whole table or a segment of a
    table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-and-mysql-replication"></a>14.2.2.6. <code class="literal">InnoDB</code> and MySQL Replication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83076112"></a><p>
    MySQL replication works for <code class="literal">InnoDB</code> tables as it
    does for <code class="literal">MyISAM</code> tables. It is also possible to
    use replication in a way where the storage engine on the slave is
    not the same as the original storage engine on the master. For
    example, you can replicate modifications to an
    <code class="literal">InnoDB</code> table on the master to a
    <code class="literal">MyISAM</code> table on the slave.
  </p><p>
    To set up a new slave for a master, make a copy of the
    <code class="literal">InnoDB</code> tablespace and the log files, as well as
    the <code class="filename">.frm</code> files of the <code class="literal">InnoDB</code>
    tables, and move the copies to the slave. If the
    <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    enabled, copy the <code class="filename">.ibd</code> files as well. For the
    proper procedure to do this, see <a class="xref" href="storage-engines.html#innodb-backup" title="14.2.2.4. Backing Up and Recovering an InnoDB Database">Section 14.2.2.4, “Backing Up and Recovering an <code class="literal">InnoDB</code> Database”</a>.
  </p><p>
    To make a new slave without taking down the master or an existing
    slave, use the <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="24.2. MySQL Enterprise Backup">MySQL
    Enterprise Backup</a> product. If you can shut down the master or
    an existing slave, take a <a class="link" href="glossary.html#glos_cold_backup" title="cold backup">cold
    backup</a> of the <code class="literal">InnoDB</code> tablespaces and log
    files and use that to set up a slave.
  </p><p>
    Transactions that fail on the master do not affect replication at
    all. MySQL replication is based on the binary log where MySQL writes
    SQL statements that modify data. A transaction that fails (for
    example, because of a foreign key violation, or because it is rolled
    back) is not written to the binary log, so it is not sent to slaves.
    See <a class="xref" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “<code class="literal">START TRANSACTION</code>,
      <code class="literal">COMMIT</code>, and
      <code class="literal">ROLLBACK</code> Syntax”</a>.
  </p><p><b>Replication and <code class="literal">CASCADE</code>. </b>
      Cascading actions for <code class="literal">InnoDB</code> tables on the
      master are replicated on the slave <span class="emphasis"><em>only</em></span> if
      the tables sharing the foreign key relation use
      <code class="literal">InnoDB</code> on both the master and slave. This is
      true whether you are using statement-based or row-based
      replication. Suppose that you have started replication, and then
      create two tables on the master using the following
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements:
    </p><pre class="programlisting">CREATE TABLE fc1 (
    i INT PRIMARY KEY,
    j INT
) ENGINE = InnoDB;

CREATE TABLE fc2 (
    m INT PRIMARY KEY,
    n INT,
    FOREIGN KEY ni (n) REFERENCES fc1 (i)
        ON DELETE CASCADE
) ENGINE = InnoDB;</pre><p>
    Suppose that the slave does not have <code class="literal">InnoDB</code>
    support enabled. If this is the case, then the tables on the slave
    are created, but they use the <code class="literal">MyISAM</code> storage
    engine, and the <code class="literal">FOREIGN KEY</code> option is ignored.
    Now we insert some rows into the tables on the master:
  </p><pre class="programlisting">master&gt; <strong class="userinput"><code>INSERT INTO fc1 VALUES (1, 1), (2, 2);</code></strong>
Query OK, 2 rows affected (0.09 sec)
Records: 2  Duplicates: 0  Warnings: 0

master&gt; <strong class="userinput"><code>INSERT INTO fc2 VALUES (1, 1), (2, 2), (3, 1);</code></strong>
Query OK, 3 rows affected (0.19 sec)
Records: 3  Duplicates: 0  Warnings: 0
</pre><p>
    At this point, on both the master and the slave, table
    <code class="literal">fc1</code> contains 2 rows, and table
    <code class="literal">fc2</code> contains 3 rows, as shown here:
  </p><pre class="programlisting">master&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)
</pre><p>
    Now suppose that you perform the following
    <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statement on the master:
  </p><pre class="programlisting">master&gt; <strong class="userinput"><code>DELETE FROM fc1 WHERE i=1;</code></strong>
Query OK, 1 row affected (0.09 sec)
</pre><p>
    Due to the cascade, table <code class="literal">fc2</code> on the master now
    contains only 1 row:
  </p><pre class="programlisting">master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 2 | 2 |
+---+---+
1 row in set (0.00 sec)
</pre><p>
    However, the cascade does not propagate on the slave because on the
    slave the <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> for
    <code class="literal">fc1</code> deletes no rows from <code class="literal">fc2</code>.
    The slave's copy of <code class="literal">fc2</code> still contains all of the
    rows that were originally inserted:
  </p><pre class="programlisting">slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 1 | 1 |
| 3 | 1 |
| 2 | 2 |
+---+---+
3 rows in set (0.00 sec)
</pre><p>
    This difference is due to the fact that the cascading deletes are
    handled internally by the <code class="literal">InnoDB</code> storage engine,
    which means that none of the changes are logged.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-check-availability"></a>14.2.2.7. Checking InnoDB Availability</h4>

</div>

</div>

</div>
<p>
      To determine whether your server supports
      <code class="literal">InnoDB</code>, use the <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW
      ENGINES</code></a> statement. (Now that <code class="literal">InnoDB</code>
      is the default MySQL storage engine, only very specialized
      environments might not support it.)
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-turning-off"></a>14.2.2.8. Turning Off InnoDB</h4>

</div>

</div>

</div>
<p>
      Oracle recommends InnoDB as the preferred storage engine for
      typical database applications, from single-user wikis and blogs
      running on a local system, to high-end applications pushing the
      limits of performance. In MySQL 5.6, InnoDB is is the
      default storage engine for new tables.
    </p><p>
      If you do not want to use InnoDB tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Start the server with the
          <a class="link" href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a class="link" href="storage-engines.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
          option to disable the <code class="literal">InnoDB</code> storage
          engine.
        </p></li><li class="listitem"><p>
          Because the default storage engine is
          <code class="literal">InnoDB</code>, the server will not start unless
          you also use
          <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="option">--default-storage-engine</code></a> and
          <a class="link" href="server-administration.html#sysvar_default_tmp_storage_engine"><code class="option">--default-tmp-storage-engine</code></a> to
          set the default to some other engine for both permanent and
          <code class="literal">TEMPORARY</code> tables.
        </p></li><li class="listitem"><p>
          To prevent the server from crashing when the
          <a class="link" href="information-schema.html#innodb-i_s-tables" title="20.30. INFORMATION_SCHEMA Tables for InnoDB"><code class="literal">InnoDB</code>-related
          <code class="literal">information_schema</code> tables</a> are
          queried, also disable the plugins associated with those
          tables. Specify in the <code class="literal">[mysqld]</code> section of
          the MySQL configuration file:
        </p><pre class="programlisting">loose-innodb-trx=0 
loose-innodb-locks=0 
loose-innodb-lock-waits=0 
loose-innodb-cmp=0 
loose-innodb-cmp-per-index=0
loose-innodb-cmp-per-index-reset=0
loose-innodb-cmp-reset=0 
loose-innodb-cmpmem=0 
loose-innodb-cmpmem-reset=0 
loose-innodb-buffer-page=0 
loose-innodb-buffer-page-lru=0 
loose-innodb-buffer-pool-stats=0 
loose-innodb-metrics=0 
loose-innodb-ft-default-stopword=0 
loose-innodb-ft-inserted=0 
loose-innodb-ft-deleted=0 
loose-innodb-ft-being-deleted=0 
loose-innodb-ft-config=0 
loose-innodb-ft-index-cache=0 
loose-innodb-ft-index-table=0 
loose-innodb-sys-tables=0 
loose-innodb-sys-tablestats=0 
loose-innodb-sys-indexes=0 
loose-innodb-sys-columns=0 
loose-innodb-sys-fields=0 
loose-innodb-sys-foreign=0 
loose-innodb-sys-foreign-cols=0 </pre></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-concepts"></a>14.2.3. <code class="literal">InnoDB</code> Concepts and Architecture</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-transaction-model">14.2.3.1. The <code class="literal">InnoDB</code> Transaction Model and Locking</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-lock-modes">14.2.3.2. <code class="literal">InnoDB</code> Lock Modes</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-consistent-read">14.2.3.3. Consistent Nonlocking Reads</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-locking-reads">14.2.3.4. Locking Reads (<code class="literal">SELECT ... FOR
        UPDATE</code> and
        <code class="literal">SELECT ... LOCK IN SHARE
MODE</code>)</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-record-level-locks">14.2.3.5. <code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-next-key-locking">14.2.3.6. Avoiding the Phantom Problem Using Next-Key Locking</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-locks-set">14.2.3.7. Locks Set by Different SQL Statements in <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-implicit-commit">14.2.3.8. Implicit Transaction Commit and Rollback</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-deadlock-detection">14.2.3.9. Deadlock Detection and Rollback</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-deadlocks">14.2.3.10. How to Cope with Deadlocks</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-multi-versioning">14.2.3.11. <code class="literal">InnoDB</code> Multi-Versioning</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-table-and-index">14.2.3.12. <code class="literal">InnoDB</code> Table and Index Structures</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-recovery">14.2.3.13. The <code class="literal">InnoDB</code> Recovery Process</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-error-handling">14.2.3.14. <code class="literal">InnoDB</code> Error Handling</a></span></dt></dl>
</div>
<p>
      The information in this section provides background to help you
      get the most performance and functionality from using
      <code class="literal">InnoDB</code> tables. It is intended for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Anyone switching to MySQL from another database system, to
          explain what things might seem familiar and which might be
          all-new.
        </p></li><li class="listitem"><p>
          Anyone moving from <code class="literal">MyISAM</code> tables to
          <code class="literal">InnoDB</code>, now that <code class="literal">InnoDB</code>
          is the default MySQL storage engine.
        </p></li><li class="listitem"><p>
          Anyone considering their application architecture or software
          stack, to understand the design considerations, performance
          characteristics, and scalability of <code class="literal">InnoDB</code>
          tables at a detailed level.
</p></li></ul>
</div>
<p>
      In this section, you will learn:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          How <code class="literal">InnoDB</code> implements transactions, and how
          the inner workings of transactions compare compare with other
          database systems you might be familiar with.
        </p></li><li class="listitem"><p>
          How <code class="literal">InnoDB</code> implements row-level locking to
          allow queries and DML statements to read and write the same
          table simultaneously.
        </p></li><li class="listitem"><p>
          How multi-version concurrency control (MVCC) keeps
          transactions from viewing or modifying each others' data
          before the appropriate time.
        </p></li><li class="listitem"><p>
          The physical layout of <code class="literal">InnoDB</code>-related
          objects on disk, such as tables, indexes, tablespaces, undo
          logs, and the redo log.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-transaction-model"></a>14.2.3.1. The <code class="literal">InnoDB</code> Transaction Model and Locking</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83158192"></a><a class="indexterm" name="idp83159680"></a><a class="indexterm" name="idp83161168"></a><a class="indexterm" name="idp83162656"></a><a class="indexterm" name="idp83163728"></a><p>
        To implement a large-scale, busy, or highly reliable database
        application, to port substantial code from a different database
        system, or to push MySQL performance to the limits of the laws
        of physics, you must understand the notions of
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> and
        <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> as they relate to
        the InnoDB storage engine.
      </p><p>
        In the <code class="literal">InnoDB</code> transaction model, the goal is
        to combine the best properties of a multi-versioning database
        with traditional two-phase locking. <code class="literal">InnoDB</code>
        does locking on the row level and runs queries as nonlocking
        consistent reads by default, in the style of Oracle. The lock
        information in <code class="literal">InnoDB</code> is stored so
        space-efficiently that lock escalation is not needed: Typically,
        several users are permitted to lock every row in
        <code class="literal">InnoDB</code> tables, or any random subset of the
        rows, without causing <code class="literal">InnoDB</code> memory
        exhaustion.
      </p><p>
        In <code class="literal">InnoDB</code>, all user activity occurs inside a
        transaction. If autocommit mode is enabled, each SQL statement
        forms a single transaction on its own. By default, MySQL starts
        the session for each new connection with autocommit enabled, so
        MySQL does a commit after each SQL statement if that statement
        did not return an error. If a statement returns an error, the
        commit or rollback behavior depends on the error. See
        <a class="xref" href="storage-engines.html#innodb-error-handling" title="14.2.3.14. InnoDB Error Handling">Section 14.2.3.14, “<code class="literal">InnoDB</code> Error Handling”</a>.
      </p><p>
        A session that has autocommit enabled can perform a
        multiple-statement transaction by starting it with an explicit
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
        TRANSACTION</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
        statement and ending it with a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement. See <a class="xref" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “<code class="literal">START TRANSACTION</code>,
      <code class="literal">COMMIT</code>, and
      <code class="literal">ROLLBACK</code> Syntax”</a>.
      </p><p>
        If autocommit mode is disabled within a session with
        <code class="literal">SET autocommit = 0</code>, the session always has a
        transaction open. A <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement ends the current transaction and a new one starts.
      </p><p>
        A <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> means that the changes
        made in the current transaction are made permanent and become
        visible to other sessions. A
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement, on the other hand, cancels all modifications made by
        the current transaction. Both
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        release all <code class="literal">InnoDB</code> locks that were set during
        the current transaction.
      </p><p>
        In terms of the SQL:1992 transaction
        <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation levels</a>,
        the default <code class="literal">InnoDB</code> level is
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>.
        <code class="literal">InnoDB</code> offers all four transaction isolation
        levels described by the SQL standard:
        <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
        <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>,
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>, and
        <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>.
      </p><p>
        A user can change the isolation level for a single session or
        for all subsequent connections with the <a class="link" href="sql-syntax.html#set-transaction" title="13.3.6. SET TRANSACTION Syntax"><code class="literal">SET
        TRANSACTION</code></a> statement. To set the server's default
        isolation level for all connections, use the
        <a class="link" href="server-administration.html#option_mysqld_transaction-isolation"><code class="option">--transaction-isolation</code></a> option on
        the command line or in an option file. For detailed information
        about isolation levels and level-setting syntax, see
        <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6. SET TRANSACTION Syntax">Section 13.3.6, “<code class="literal">SET TRANSACTION</code> Syntax”</a>.
      </p><a class="indexterm" name="idp83197584"></a><a class="indexterm" name="idp83199072"></a><a class="indexterm" name="idp83200560"></a><a class="indexterm" name="idp83202048"></a><a class="indexterm" name="idp83203536"></a><a class="indexterm" name="idp83205024"></a><a class="indexterm" name="idp83206512"></a><a class="indexterm" name="idp83208000"></a><p>
        In <a class="link" href="glossary.html#glos_row_level_locking" title="row-level locking">row-level
        locking</a>, <code class="literal">InnoDB</code> normally uses next-key
        locking. That means that besides index records,
        <code class="literal">InnoDB</code> can also lock the
        <a class="link" href="glossary.html#glos_gap" title="gap">gap</a> preceding an index record to
        block insertions by other sessions where the indexed values
        would be inserted in that gap within the tree data structure. A
        next-key lock refers to a lock that locks an index record and
        the gap before it. A gap lock refers to a lock that locks only
        the gap before some index record.
      </p><p>
        For more information about row-level locking, and the
        circumstances under which gap locking is disabled, see
        <a class="xref" href="storage-engines.html#innodb-record-level-locks" title="14.2.3.5. InnoDB Record, Gap, and Next-Key Locks">Section 14.2.3.5, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-lock-modes"></a>14.2.3.2. <code class="literal">InnoDB</code> Lock Modes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83215904"></a><a class="indexterm" name="idp83217392"></a><p>
        <code class="literal">InnoDB</code> implements standard row-level locking
        where there are two types of locks,
        <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared
        (<em class="replaceable"><code>S</code></em>) locks</a> and
        <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
        (<em class="replaceable"><code>X</code></em>) locks</a>. For information
        about record, gap, and next-key lock types, see
        <a class="xref" href="storage-engines.html#innodb-record-level-locks" title="14.2.3.5. InnoDB Record, Gap, and Next-Key Locks">Section 14.2.3.5, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared
            (<em class="replaceable"><code>S</code></em>) lock</a> permits the
            transaction that holds the lock to read a row.
          </p></li><li class="listitem"><p>
            An <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
            (<em class="replaceable"><code>X</code></em>) lock</a> permits the
            transaction that holds the lock to update or delete a row.
</p></li></ul>
</div>
<p>
        If transaction <code class="literal">T1</code> holds a shared
        (<em class="replaceable"><code>S</code></em>) lock on row <code class="literal">r</code>,
        then requests from some distinct transaction
        <code class="literal">T2</code> for a lock on row <code class="literal">r</code> are
        handled as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A request by <code class="literal">T2</code> for an
            <em class="replaceable"><code>S</code></em> lock can be granted
            immediately. As a result, both <code class="literal">T1</code> and
            <code class="literal">T2</code> hold an <em class="replaceable"><code>S</code></em>
            lock on <code class="literal">r</code>.
          </p></li><li class="listitem"><p>
            A request by <code class="literal">T2</code> for an
            <em class="replaceable"><code>X</code></em> lock cannot be granted
            immediately.
</p></li></ul>
</div>
<p>
        If a transaction <code class="literal">T1</code> holds an exclusive
        (<em class="replaceable"><code>X</code></em>) lock on row <code class="literal">r</code>,
        a request from some distinct transaction <code class="literal">T2</code>
        for a lock of either type on <code class="literal">r</code> cannot be
        granted immediately. Instead, transaction <code class="literal">T2</code>
        has to wait for transaction <code class="literal">T1</code> to release its
        lock on row <code class="literal">r</code>.
</p>
<h5><a name="idp83243248"></a>
        Intention Locks
</h5>
<p>
        Additionally, <code class="literal">InnoDB</code> supports
        <span class="emphasis"><em>multiple granularity locking</em></span> which permits
        coexistence of record locks and locks on entire tables. To make
        locking at multiple granularity levels practical, additional
        types of locks called
        <a class="link" href="glossary.html#glos_intention_lock" title="intention lock">intention locks</a> are
        used. Intention locks are table locks in
        <code class="literal">InnoDB</code> that indicate which type of lock
        (shared or exclusive) a transaction will require later for a row
        in that table. There are two types of intention locks used in
        <code class="literal">InnoDB</code> (assume that transaction
        <code class="literal">T</code> has requested a lock of the indicated type
        on table <code class="literal">t</code>):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_intention_shared_lock" title="intention shared lock">Intention
            shared</a> (<em class="replaceable"><code>IS</code></em>): Transaction
            <code class="literal">T</code> intends to set
            <em class="replaceable"><code>S</code></em> locks on individual rows in
            table <code class="literal">t</code>.
          </p></li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_intention_exclusive_lock" title="intention exclusive lock">Intention
            exclusive</a> (<em class="replaceable"><code>IX</code></em>):
            Transaction <code class="literal">T</code> intends to set
            <em class="replaceable"><code>X</code></em> locks on those rows.
</p></li></ul>
</div>
<p>
        For example, <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ...
        LOCK IN SHARE MODE</code></a> sets an
        <em class="replaceable"><code>IS</code></em> lock and
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> sets an <em class="replaceable"><code>IX</code></em> lock.
      </p><p>
        The intention locking protocol is as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Before a transaction can acquire an
            <em class="replaceable"><code>S</code></em> lock on a row in table
            <code class="literal">t</code>, it must first acquire an
            <em class="replaceable"><code>IS</code></em> or stronger lock on
            <code class="literal">t</code>.
          </p></li><li class="listitem"><p>
            Before a transaction can acquire an
            <em class="replaceable"><code>X</code></em> lock on a row, it must first
            acquire an <em class="replaceable"><code>IX</code></em> lock on
            <code class="literal">t</code>.
</p></li></ul>
</div>
<p>
        These rules can be conveniently summarized by means of the
        following <span class="emphasis"><em>lock type compatibility matrix</em></span>.
</p>
<div class="informaltable">
<table summary=' Compatibility matrix showing which combinations of
          lock types X, IX, S, and IS are allowed. Each cell in the
          matrix is marked as either "Compatible" or "Conflict".
' border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col"> </th><th scope="col"><em class="replaceable"><code>X</code></em></th><th scope="col"><em class="replaceable"><code>IX</code></em></th><th scope="col"><em class="replaceable"><code>S</code></em></th><th scope="col"><em class="replaceable"><code>IS</code></em></th></tr></thead><tbody><tr><td scope="row"><em class="replaceable"><code>X</code></em></td><td>Conflict</td><td>Conflict</td><td>Conflict</td><td>Conflict</td></tr><tr><td scope="row"><em class="replaceable"><code>IX</code></em></td><td>Conflict</td><td>Compatible</td><td>Conflict</td><td>Compatible</td></tr><tr><td scope="row"><em class="replaceable"><code>S</code></em></td><td>Conflict</td><td>Conflict</td><td>Compatible</td><td>Compatible</td></tr><tr><td scope="row"><em class="replaceable"><code>IS</code></em></td><td>Conflict</td><td>Compatible</td><td>Compatible</td><td>Compatible</td></tr></tbody></table>
</div>
<p>
        A lock is granted to a requesting transaction if it is
        compatible with existing locks, but not if it conflicts with
        existing locks. A transaction waits until the conflicting
        existing lock is released. If a lock request conflicts with an
        existing lock and cannot be granted because it would cause
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, an error occurs.
      </p><p>
        Thus, intention locks do not block anything except full table
        requests (for example, <code class="literal">LOCK TABLES ...
        WRITE</code>). The main purpose of
        <em class="replaceable"><code>IX</code></em> and <em class="replaceable"><code>IS</code></em>
        locks is to show that someone is locking a row, or going to lock
        a row in the table.
</p>
<h5><a name="idp83288624"></a>
        Deadlock Example
</h5>
<p>
        The following example illustrates how an error can occur when a
        lock request would cause a deadlock. The example involves two
        clients, A and B.
      </p><p>
        First, client A creates a table containing one row, and then
        begins a transaction. Within the transaction, A obtains an
        <em class="replaceable"><code>S</code></em> lock on the row by selecting it in
        share mode:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (i INT) ENGINE = InnoDB;</code></strong>
Query OK, 0 rows affected (1.07 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t (i) VALUES(1);</code></strong>
Query OK, 1 row affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM t WHERE i = 1 LOCK IN SHARE MODE;</code></strong>
+------+
| i    |
+------+
|    1 |
+------+
1 row in set (0.10 sec)
</pre><p>
        Next, client B begins a transaction and attempts to delete the
        row from the table:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
</pre><p>
        The delete operation requires an <em class="replaceable"><code>X</code></em>
        lock. The lock cannot be granted because it is incompatible with
        the <em class="replaceable"><code>S</code></em> lock that client A holds, so
        the request goes on the queue of lock requests for the row and
        client B blocks.
      </p><p>
        Finally, client A also attempts to delete the row from the
        table:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
        Deadlock occurs here because client A needs an
        <em class="replaceable"><code>X</code></em> lock to delete the row. However,
        that lock request cannot be granted because client B already has
        a request for an <em class="replaceable"><code>X</code></em> lock and is
        waiting for client A to release its <em class="replaceable"><code>S</code></em>
        lock. Nor can the <em class="replaceable"><code>S</code></em> lock held by A be
        upgraded to an <em class="replaceable"><code>X</code></em> lock because of the
        prior request by B for an <em class="replaceable"><code>X</code></em> lock. As
        a result, <code class="literal">InnoDB</code> generates an error for one
        of the clients and releases its locks. The client returns this
        error:
      </p><pre class="programlisting">ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction</pre><p>
        At that point, the lock request for the other client can be
        granted and it deletes the row from the table.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          If the <code class="literal">LATEST DETECTED DEADLOCK</code> section of
          InnoDB Monitor output includes a message stating,
          <span class="quote">“<span class="quote"><span class="errortext">TOO DEEP OR LONG SEARCH IN THE LOCK TABLE
          WAITS-FOR GRAPH, WE WILL ROLL BACK FOLLOWING
          TRANSACTION</span>,</span>”</span> this indicates that the
          number of transactions on the wait-for list has reached a
          limit of 200, which is defined by
          <code class="literal">LOCK_MAX_DEPTH_IN_DEADLOCK_CHECK</code>. A
          wait-for list that exceeds 200 transactions is treated as a
          deadlock and the transaction attempting to check the wait-for
          list is rolled back.
        </p><p xmlns="">
          The same error may also occur if the locking thread must look
          at more than 1,000,000 locks owned by the transactions on the
          wait-for list. The limit of 1,000,000 locks is defined by
          <code class="literal">LOCK_MAX_N_STEPS_IN_DEADLOCK_CHECK</code>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-consistent-read"></a>14.2.3.3. Consistent Nonlocking Reads</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83311936"></a><a class="indexterm" name="idp83313424"></a><p>
        A <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent read</a>
        means that <code class="literal">InnoDB</code> uses multi-versioning to
        present to a query a snapshot of the database at a point in
        time. The query sees the changes made by transactions that
        committed before that point of time, and no changes made by
        later or uncommitted transactions. The exception to this rule is
        that the query sees the changes made by earlier statements
        within the same transaction. This exception causes the following
        anomaly: If you update some rows in a table, a
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> sees the latest version of
        the updated rows, but it might also see older versions of any
        rows. If other sessions simultaneously update the same table,
        the anomaly means that you might see the table in a state that
        never existed in the database.
      </p><p>
        If the transaction
        <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> is
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (the default
        level), all consistent reads within the same transaction read
        the snapshot established by the first such read in that
        transaction. You can get a fresher snapshot for your queries by
        committing the current transaction and after that issuing new
        queries.
      </p><p>
        With <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot.
      </p><p>
        Consistent read is the default mode in which
        <code class="literal">InnoDB</code> processes
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements in
        <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> and
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        levels. A consistent read does not set any locks on the tables
        it accesses, and therefore other sessions are free to modify
        those tables at the same time a consistent read is being
        performed on the table.
      </p><p>
        Suppose that you are running in the default
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        level. When you issue a consistent read (that is, an ordinary
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement),
        <code class="literal">InnoDB</code> gives your transaction a timepoint
        according to which your query sees the database. If another
        transaction deletes a row and commits after your timepoint was
        assigned, you do not see the row as having been deleted. Inserts
        and updates are treated similarly.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          The snapshot of the database state applies to
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements within a
          transaction, not necessarily to
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements. If you insert
          or modify some rows and then commit that transaction, a
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> or
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statement issued from
          another concurrent <code class="literal">REPEATABLE READ</code>
          transaction could affect those just-committed rows, even
          though the session could not query them. If a transaction does
          update or delete rows committed by a different transaction,
          those changes do become visible to the current transaction.
          For example, you might encounter a situation like the
          following:
        </p><pre class="programlisting">SELECT COUNT(c1) FROM t1 WHERE c1 = 'xyz'; -- Returns 0: no rows match.
DELETE FROM t1 WHERE c1 = 'xyz'; -- Deletes several rows recently committed by other transaction.

SELECT COUNT(c2) FROM t1 WHERE c2 = 'abc'; -- Returns 0: no rows match.
UPDATE t1 SET c2 = 'cba' WHERE c2 = 'abc'; -- Affects 10 rows: another txn just committed 10 rows with 'abc' values.
SELECT COUNT(c2) FROM t1 WHERE c2 = 'cba'; -- Returns 10: this txn can now see the rows it just updated.</pre>
</div>
<p>
        You can advance your timepoint by committing your transaction
        and then doing another <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START TRANSACTION WITH
        CONSISTENT SNAPSHOT</code></a>.
      </p><p>
        This is called <em class="firstterm">multi-versioned concurrency
        control</em>.
      </p><p>
        In the following example, session A sees the row inserted by B
        only when B has committed the insert and A has committed as
        well, so that the timepoint is advanced past the commit of B.
      </p><pre class="programlisting">             Session A              Session B

           SET autocommit=0;      SET autocommit=0;
time
|          SELECT * FROM t;
|          empty set
|                                 INSERT INTO t VALUES (1, 2);
|
v          SELECT * FROM t;
           empty set
                                  COMMIT;

           SELECT * FROM t;
           empty set

           COMMIT;

           SELECT * FROM t;
           ---------------------
           |    1    |    2    |
           ---------------------
           1 row in set</pre><p>
        If you want to see the <span class="quote">“<span class="quote">freshest</span>”</span> state of the
        database, use either the <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
        COMMITTED</code></a> isolation level or a
        <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking read</a>:
      </p><pre class="programlisting">SELECT * FROM t LOCK IN SHARE MODE;</pre><p>
        With <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot. With <code class="literal">LOCK IN SHARE
        MODE</code>, a locking read occurs instead: A
        <code class="literal">SELECT</code> blocks until the transaction
        containing the freshest rows ends (see
        <a class="xref" href="storage-engines.html#innodb-locking-reads" title="14.2.3.4. Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)">Section 14.2.3.4, “Locking Reads (<code class="literal">SELECT ... FOR
        UPDATE</code> and
        <code class="literal">SELECT ... LOCK IN SHARE
        MODE</code>)”</a>).
      </p><p>
        Consistent read does not work over certain DDL statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Consistent read does not work over <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP
            TABLE</code></a>, because MySQL cannot use a table that has
            been dropped and <code class="literal">InnoDB</code> destroys the
            table.
          </p></li><li class="listitem"><p>
            Consistent read does not work over
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, because that
            statement makes a temporary copy of the original table and
            deletes the original table when the temporary copy is built.
            When you reissue a consistent read within a transaction,
            rows in the new table are not visible because those rows did
            not exist when the transaction's snapshot was taken. In this
            case, the transaction returns an error as of MySQL 5.6.6:
            <a class="link" href="error-handling.html#error_er_table_def_changed"><code class="literal">ER_TABLE_DEF_CHANGED</code></a>,
            <span class="quote">“<span class="quote">Table definition has changed, please retry
            transaction</span>”</span>.
</p></li></ul>
</div>
<p>
        The type of read varies for selects in clauses like
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT INTO ...
        SELECT</code></a>, <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE
        ... (SELECT)</code></a>, and
        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        SELECT</code></a> that do not specify <code class="literal">FOR
        UPDATE</code> or <code class="literal">LOCK IN SHARE MODE</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            By default, <code class="literal">InnoDB</code> uses stronger locks
            and the <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> part acts like
            <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, where
            each consistent read, even within the same transaction, sets
            and reads its own fresh snapshot.

            
          </p></li><li class="listitem"><p>
            To use a consistent read in such cases, enable the
            <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
            option and set the isolation level of the transaction to
            <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
            <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, or
            <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (that is,
            anything other than
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>). In this
            case, no locks are set on rows read from the selected table.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-locking-reads"></a>14.2.3.4. Locking Reads (<code class="literal">SELECT ... FOR
        UPDATE</code> and
        <code class="literal">SELECT ... LOCK IN SHARE
MODE</code>)</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp83370208"></a><p>
        If you query data and then insert or update related data within
        the same transaction, the regular <code class="literal">SELECT</code>
        statement does not give enough protection. Other transactions
        can update or delete the same rows you just queried.
        <code class="literal">InnoDB</code> supports two types of
        <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking reads</a> that
        offer extra safety:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... LOCK IN
            SHARE MODE</code></a> sets a shared mode lock on any rows
            that are read. Other sessions can read the rows, but cannot
            modify them until your transaction commits. If any of these
            rows were changed by another transaction that has not yet
            committed, your query waits until that transaction ends and
            then uses the latest values.
          </p></li><li class="listitem"><p>
            For index records the search encounters,
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
            UPDATE</code></a> locks the rows and any associated index
            entries, the same as if you issued an
            <code class="literal">UPDATE</code> statement for those rows. Other
            transactions are blocked from updating those rows, from
            doing <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ...
            LOCK IN SHARE MODE</code></a>, or from reading the data in
            certain transaction isolation levels. Consistent reads
            ignore any locks set on the records that exist in the read
            view. (Old versions of a record cannot be locked; they are
            reconstructed by applying <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo
            logs</a> on an in-memory copy of the record.)
</p></li></ul>
</div>
<p>
        These clauses are primarily useful when dealing with
        tree-structured or graph-structured data, either in a single
        table or split across multiple tables. You traverse edges or
        tree branches from one place to another, while reserving the
        right to come back and change any of these
        <span class="quote">“<span class="quote">pointer</span>”</span> values.
      </p><p>
        All locks set by <code class="literal">LOCK IN SHARE MODE</code> and
        <code class="literal">FOR UPDATE</code> queries are released when the
        transaction is committed or rolled back.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          Locking of rows for update using <code class="literal">SELECT FOR
          UPDATE</code> only applies when autocommit is disabled
          (either by beginning transaction with
          <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or by setting
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> to 0. If
          autocommit is enabled, the rows matching the specification are
          not locked.
</p>
</div>
<h5><a name="idp83388016"></a>
        Usage Examples
</h5>
<p>
        Suppose that you want to insert a new row into a table
        <code class="literal">child</code>, and make sure that the child row has a
        parent row in table <code class="literal">parent</code>. Your application
        code can ensure referential integrity throughout this sequence
        of operations.
      </p><p>
        First, use a consistent read to query the table
        <code class="literal">PARENT</code> and verify that the parent row exists.
        Can you safely insert the child row to table
        <code class="literal">CHILD</code>? No, because some other session could
        delete the parent row in the moment between your
        <code class="literal">SELECT</code> and your <code class="literal">INSERT</code>,
        without you being aware of it.
      </p><p>
        To avoid this potential issue, perform the
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> using <code class="literal">LOCK IN
        SHARE MODE</code>:
      </p><pre class="programlisting">SELECT * FROM parent WHERE NAME = 'Jones' LOCK IN SHARE MODE;</pre><p>
        After the <code class="literal">LOCK IN SHARE MODE</code> query returns
        the parent <code class="literal">'Jones'</code>, you can safely add the
        child record to the <code class="literal">CHILD</code> table and commit
        the transaction. Any transaction that tries to read or write to
        the applicable row in the <code class="literal">PARENT</code> table waits
        until you are finished, that is, the data in all tables is in a
        consistent state.
      </p><p>
        For another example, consider an integer counter field in a
        table <code class="literal">CHILD_CODES</code>, used to assign a unique
        identifier to each child added to table
        <code class="literal">CHILD</code>. Do not use either consistent read or a
        shared mode read to read the present value of the counter,
        because two users of the database could see the same value for
        the counter, and a duplicate-key error occurs if two
        transactions attempt to add rows with the same identifier to the
        <code class="literal">CHILD</code> table.
      </p><p>
        Here, <code class="literal">LOCK IN SHARE MODE</code> is not a good
        solution because if two users read the counter at the same time,
        at least one of them ends up in deadlock when it attempts to
        update the counter.
      </p><p>
        Here are two ways to implement reading and incrementing the
        counter without interference from another transaction:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            First update the counter by incrementing it by 1, then read
            it and use the new value in the <code class="literal">CHILD</code>
            table. Any other transaction that tries to read the counter
            waits until your transaction commits. If another transaction
            is in the middle of this same sequence, your transaction
            waits until the other one commits.
          </p></li><li class="listitem"><p>
            First perform a <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking
            read</a> of the counter using <code class="literal">FOR
            UPDATE</code>, and then increment the counter:
          </p><pre class="programlisting">SELECT counter_field FROM child_codes FOR UPDATE;
UPDATE child_codes SET counter_field = counter_field + 1;</pre></li></ul>
</div>
<p>
        A <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> reads the latest available data, setting
        exclusive locks on each row it reads. Thus, it sets the same
        locks a searched SQL <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> would
        set on the rows.
      </p><p>
        The preceding description is merely an example of how
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> works. In MySQL, the specific task of
        generating a unique identifier actually can be accomplished
        using only a single access to the table:
      </p><pre class="programlisting">UPDATE child_codes SET counter_field = LAST_INSERT_ID(counter_field + 1);
SELECT LAST_INSERT_ID();</pre><p>
        The <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement merely
        retrieves the identifier information (specific to the current
        connection). It does not access any table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-record-level-locks"></a>14.2.3.5. <code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83418176"></a><a class="indexterm" name="idp83419664"></a><a class="indexterm" name="idp83421152"></a><a class="indexterm" name="idp83422640"></a><a class="indexterm" name="idp83424128"></a><a class="indexterm" name="idp83425616"></a><a class="indexterm" name="idp83427104"></a><a class="indexterm" name="idp83428592"></a><p>
        <code class="literal">InnoDB</code> has several types of record-level
        locks:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Record lock: This is a lock on an index record.
          </p></li><li class="listitem"><p>
            Gap lock: This is a lock on a gap between index records, or
            a lock on the gap before the first or after the last index
            record.
          </p></li><li class="listitem"><p>
            Next-key lock: This is a combination of a record lock on the
            index record and a gap lock on the gap before the index
            record.
</p></li></ul>
</div>
<p>
        Record locks always lock index records, even if a table is
        defined with no indexes. For such cases,
        <code class="literal">InnoDB</code> creates a hidden clustered index and
        uses this index for record locking. See
        <a class="xref" href="storage-engines.html#innodb-index-types" title="14.2.3.12.2. Clustered and Secondary Indexes">Section 14.2.3.12.2, “Clustered and Secondary Indexes”</a>.
      </p><p>
        By default, <code class="literal">InnoDB</code> operates in
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> transaction
        isolation level and with the
        <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
        system variable disabled. In this case,
        <code class="literal">InnoDB</code> uses next-key locks for searches and
        index scans, which prevents phantom rows (see
        <a class="xref" href="storage-engines.html#innodb-next-key-locking" title="14.2.3.6. Avoiding the Phantom Problem Using Next-Key Locking">Section 14.2.3.6, “Avoiding the Phantom Problem Using Next-Key Locking”</a>).
      </p><p>
        Next-key locking combines index-row locking with gap locking.
        <code class="literal">InnoDB</code> performs row-level locking in such a
        way that when it searches or scans a table index, it sets shared
        or exclusive locks on the index records it encounters. Thus, the
        row-level locks are actually index-record locks. In addition, a
        next-key lock on an index record also affects the
        <span class="quote">“<span class="quote">gap</span>”</span> before that index record. That is, a next-key
        lock is an index-record lock plus a gap lock on the gap
        preceding the index record. If one session has a shared or
        exclusive lock on record <code class="literal">R</code> in an index,
        another session cannot insert a new index record in the gap
        immediately before <code class="literal">R</code> in the index order.
      </p><p>
        Suppose that an index contains the values 10, 11, 13, and 20.
        The possible next-key locks for this index cover the following
        intervals, where <code class="literal">(</code> or <code class="literal">)</code>
        denote exclusion of the interval endpoint and
        <code class="literal">[</code> or <code class="literal">]</code> denote inclusion of
        the endpoint:
      </p><pre class="programlisting">(negative infinity, 10]
(10, 11]
(11, 13]
(13, 20]
(20, positive infinity)</pre><p>
        For the last interval, the next-key lock locks the gap above the
        largest value in the index and the <span class="quote">“<span class="quote">supremum</span>”</span>
        pseudo-record having a value higher than any value actually in
        the index. The supremum is not a real index record, so, in
        effect, this next-key lock locks only the gap following the
        largest index value.
      </p><p>
        The preceding example shows that a gap might span a single index
        value, multiple index values, or even be empty.
      </p><p>
        Gap locking is not needed for statements that lock rows using a
        unique index to search for a unique row. (This does not include
        the case that the search condition includes only some columns of
        a multiple-column unique index; in that case, gap locking does
        occur.) For example, if the <code class="literal">id</code> column has a
        unique index, the following statement uses only an index-record
        lock for the row having <code class="literal">id</code> value 100 and it
        does not matter whether other sessions insert rows in the
        preceding gap:
      </p><pre class="programlisting">SELECT * FROM child WHERE id = 100;</pre><p>
        If <code class="literal">id</code> is not indexed or has a nonunique
        index, the statement does lock the preceding gap.
      </p><p>
        A type of gap lock called an insertion intention gap lock is set
        by <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> operations prior to row
        insertion. This lock signals the intent to insert in such a way
        that multiple transactions inserting into the same index gap
        need not wait for each other if they are not inserting at the
        same position within the gap. Suppose that there are index
        records with values of 4 and 7. Separate transactions that
        attempt to insert values of 5 and 6 each lock the gap between 4
        and 7 with insert intention locks prior to obtaining the
        exclusive lock on the inserted row, but do not block each other
        because the rows are nonconflicting.
      </p><p>
        Gap locking can be disabled explicitly. This occurs if you
        change the transaction isolation level to
        <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> or enable the
        <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
        system variable (which is now deprecated). Under these
        circumstances, gap locking is disabled for searches and index
        scans and is used only for foreign-key constraint checking and
        duplicate-key checking.
      </p><p>
        There are also other effects of using the
        <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level or enabling
        <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>:
        Record locks for nonmatching rows are released after MySQL has
        evaluated the <code class="literal">WHERE</code> condition. For
        <code class="literal">UPDATE</code> statements, <code class="literal">InnoDB</code>
        does a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, such that it returns
        the latest committed version to MySQL so that MySQL can
        determine whether the row matches the <code class="literal">WHERE</code>
        condition of the <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-next-key-locking"></a>14.2.3.6. Avoiding the Phantom Problem Using Next-Key Locking</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83466416"></a><a class="indexterm" name="idp83467488"></a><a class="indexterm" name="idp83468976"></a><a class="indexterm" name="idp83470464"></a><a class="indexterm" name="idp83471952"></a><a class="indexterm" name="idp83473440"></a><a class="indexterm" name="idp83474928"></a><a class="indexterm" name="idp83476416"></a><a class="indexterm" name="idp83477904"></a><p>
        The so-called <em class="firstterm">phantom</em> problem occurs
        within a transaction when the same query produces different sets
        of rows at different times. For example, if a
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is executed twice, but
        returns a row the second time that was not returned the first
        time, the row is a <span class="quote">“<span class="quote">phantom</span>”</span> row.
      </p><p>
        Suppose that there is an index on the <code class="literal">id</code>
        column of the <code class="literal">child</code> table and that you want
        to read and lock all rows from the table having an identifier
        value larger than 100, with the intention of updating some
        column in the selected rows later:
      </p><pre class="programlisting">SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;</pre><p>
        The query scans the index starting from the first record where
        <code class="literal">id</code> is bigger than 100. Let the table contain
        rows having <code class="literal">id</code> values of 90 and 102. If the
        locks set on the index records in the scanned range do not lock
        out inserts made in the gaps (in this case, the gap between 90
        and 102), another session can insert a new row into the table
        with an <code class="literal">id</code> of 101. If you were to execute the
        same <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> within the same
        transaction, you would see a new row with an
        <code class="literal">id</code> of 101 (a <span class="quote">“<span class="quote">phantom</span>”</span>) in the
        result set returned by the query. If we regard a set of rows as
        a data item, the new phantom child would violate the isolation
        principle of transactions that a transaction should be able to
        run so that the data it has read does not change during the
        transaction.
      </p><p>
        To prevent phantoms, <code class="literal">InnoDB</code> uses an algorithm
        called <em class="firstterm">next-key locking</em> that combines
        index-row locking with gap locking. <code class="literal">InnoDB</code>
        performs row-level locking in such a way that when it searches
        or scans a table index, it sets shared or exclusive locks on the
        index records it encounters. Thus, the row-level locks are
        actually index-record locks. In addition, a next-key lock on an
        index record also affects the <span class="quote">“<span class="quote">gap</span>”</span> before that
        index record. That is, a next-key lock is an index-record lock
        plus a gap lock on the gap preceding the index record. If one
        session has a shared or exclusive lock on record
        <code class="literal">R</code> in an index, another session cannot insert
        a new index record in the gap immediately before
        <code class="literal">R</code> in the index order.
      </p><p>
        When <code class="literal">InnoDB</code> scans an index, it can also lock
        the gap after the last record in the index. Just that happens in
        the preceding example: To prevent any insert into the table
        where <code class="literal">id</code> would be bigger than 100, the locks
        set by <code class="literal">InnoDB</code> include a lock on the gap
        following <code class="literal">id</code> value 102.
      </p><p>
        You can use next-key locking to implement a uniqueness check in
        your application: If you read your data in share mode and do not
        see a duplicate for a row you are going to insert, then you can
        safely insert your row and know that the next-key lock set on
        the successor of your row during the read prevents anyone
        meanwhile inserting a duplicate for your row. Thus, the next-key
        locking enables you to <span class="quote">“<span class="quote">lock</span>”</span> the nonexistence of
        something in your table.
      </p><p>
        Gap locking can be disabled as discussed in
        <a class="xref" href="storage-engines.html#innodb-record-level-locks" title="14.2.3.5. InnoDB Record, Gap, and Next-Key Locks">Section 14.2.3.5, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>. This may cause
        phantom problems because other sessions can insert new rows into
        the gaps when gap locking is disabled.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-locks-set"></a>14.2.3.7. Locks Set by Different SQL Statements in <code class="literal">InnoDB</code></h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83502256"></a><p>
        A <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking read</a>, an
        <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, or a
        <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> generally set record locks
        on every index record that is scanned in the processing of the
        SQL statement.

        

        It does not matter whether there are <code class="literal">WHERE</code>
        conditions in the statement that would exclude the row.
        <code class="literal">InnoDB</code> does not remember the exact
        <code class="literal">WHERE</code> condition, but only knows which index
        ranges were scanned. The locks are normally
        <a class="link" href="glossary.html#glos_next_key_lock" title="next-key lock">next-key locks</a> that
        also block inserts into the <span class="quote">“<span class="quote">gap</span>”</span> immediately
        before the record. However, <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap
        locking</a> can be disabled explicitly, which causes next-key
        locking not to be used. For more information, see
        <a class="xref" href="storage-engines.html#innodb-record-level-locks" title="14.2.3.5. InnoDB Record, Gap, and Next-Key Locks">Section 14.2.3.5, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>. The transaction
        isolation level also can affect which locks are set; see
        <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6. SET TRANSACTION Syntax">Section 13.3.6, “<code class="literal">SET TRANSACTION</code> Syntax”</a>.
      </p><p>
        If a secondary index is used in a search and index record locks
        to be set are exclusive, <code class="literal">InnoDB</code> also
        retrieves the corresponding clustered index records and sets
        locks on them.
      </p><p>
        Differences between shared and exclusive locks are described in
        <a class="xref" href="storage-engines.html#innodb-lock-modes" title="14.2.3.2. InnoDB Lock Modes">Section 14.2.3.2, “<code class="literal">InnoDB</code> Lock Modes”</a>.
      </p><p>
        If you have no indexes suitable for your statement and MySQL
        must scan the entire table to process the statement, every row
        of the table becomes locked, which in turn blocks all inserts by
        other users to the table. It is important to create good indexes
        so that your queries do not unnecessarily scan many rows.
      </p><p>
        For <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> or
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... LOCK IN SHARE
        MODE</code></a>, locks are acquired for scanned rows, and
        expected to be released for rows that do not qualify for
        inclusion in the result set (for example, if they do not meet
        the criteria given in the <code class="literal">WHERE</code> clause).
        However, in some cases, rows might not be unlocked immediately
        because the relationship between a result row and its original
        source is lost during query execution. For example, in a
        <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a>, scanned (and locked) rows
        from a table might be inserted into a temporary table before
        evaluation whether they qualify for the result set. In this
        circumstance, the relationship of the rows in the temporary
        table to the rows in the original table is lost and the latter
        rows are not unlocked until the end of query execution.
      </p><p>
        <code class="literal">InnoDB</code> sets specific types of locks as
        follows.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ...
            FROM</code></a> is a consistent read, reading a snapshot of
            the database and setting no locks unless the transaction
            isolation level is set to
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>. For
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> level, the
            search sets shared next-key locks on the index records it
            encounters.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FROM ...
            LOCK IN SHARE MODE</code></a> sets shared next-key locks on
            all index records the search encounters.
          </p></li><li class="listitem"><p>
            For index records the search encounters,
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FROM ...
            FOR UPDATE</code></a> blocks other sessions from doing
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT ... FROM ...
            LOCK IN SHARE MODE</code></a> or from reading in certain
            transaction isolation levels. Consistent reads will ignore
            any locks set on the records that exist in the read view.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE ... WHERE
            ...</code></a> sets an exclusive next-key lock on every
            record the search encounters.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE FROM ...
            WHERE ...</code></a> sets an exclusive next-key lock on every
            record the search encounters.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> sets an exclusive lock
            on the inserted row. This lock is an index-record lock, not
            a next-key lock (that is, there is no gap lock) and does not
            prevent other sessions from inserting into the gap before
            the inserted row.
          </p><p>
            Prior to inserting the row, a type of gap lock called an
            insertion intention gap lock is set. This lock signals the
            intent to insert in such a way that multiple transactions
            inserting into the same index gap need not wait for each
            other if they are not inserting at the same position within
            the gap. Suppose that there are index records with values of
            4 and 7. Separate transactions that attempt to insert values
            of 5 and 6 each lock the gap between 4 and 7 with insert
            intention locks prior to obtaining the exclusive lock on the
            inserted row, but do not block each other because the rows
            are nonconflicting.
          </p><p>
            If a duplicate-key error occurs, a shared lock on the
            duplicate index record is set. This use of a shared lock can
            result in deadlock should there be multiple sessions trying
            to insert the same row if another session already has an
            exclusive lock. This can occur if another session deletes
            the row. Suppose that an <code class="literal">InnoDB</code> table
            <code class="literal">t1</code> has the following structure:
          </p><pre class="programlisting">CREATE TABLE t1 (i INT, PRIMARY KEY (i)) ENGINE = InnoDB;</pre><p>
            Now suppose that three sessions perform the following
            operations in order:
          </p><p>
            Session 1:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 2:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 3:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 1:
          </p><pre class="programlisting">ROLLBACK;</pre><p>
            The first operation by session 1 acquires an exclusive lock
            for the row. The operations by sessions 2 and 3 both result
            in a duplicate-key error and they both request a shared lock
            for the row. When session 1 rolls back, it releases its
            exclusive lock on the row and the queued shared lock
            requests for sessions 2 and 3 are granted. At this point,
            sessions 2 and 3 deadlock: Neither can acquire an exclusive
            lock for the row because of the shared lock held by the
            other.
          </p><p>
            A similar situation occurs if the table already contains a
            row with key value 1 and three sessions perform the
            following operations in order:
          </p><p>
            Session 1:
          </p><pre class="programlisting">START TRANSACTION;
DELETE FROM t1 WHERE i = 1;</pre><p>
            Session 2:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 3:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 1:
          </p><pre class="programlisting">COMMIT;</pre><p>
            The first operation by session 1 acquires an exclusive lock
            for the row. The operations by sessions 2 and 3 both result
            in a duplicate-key error and they both request a shared lock
            for the row. When session 1 commits, it releases its
            exclusive lock on the row and the queued shared lock
            requests for sessions 2 and 3 are granted. At this point,
            sessions 2 and 3 deadlock: Neither can acquire an exclusive
            lock for the row because of the shared lock held by the
            other.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3. INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a> differs from a simple
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> in that an exclusive
            next-key lock rather than a shared lock is placed on the row
            to be updated when a duplicate-key error occurs.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> is done like an
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> if there is no
            collision on a unique key. Otherwise, an exclusive next-key
            lock is placed on the row to be replaced.
          </p></li><li class="listitem"><p>
            <code class="literal">INSERT INTO T SELECT ... FROM S WHERE ...</code>
            sets an exclusive index record without a gap lock on each
            row inserted into <code class="literal">T</code>. If the transaction
            isolation level is <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a> or
            <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
            is enabled, and the transaction isolation level is not
            <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>,
            <code class="literal">InnoDB</code> does the search on
            <code class="literal">S</code> as a consistent read (no locks).
            Otherwise, <code class="literal">InnoDB</code> sets shared next-key
            locks on rows from <code class="literal">S</code>.
            <code class="literal">InnoDB</code> has to set locks in the latter
            case: In roll-forward recovery from a backup, every SQL
            statement must be executed in exactly the same way it was
            done originally.
          </p><p>
            <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE
            ... SELECT ...</code></a> performs the
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> with shared next-key
            locks or as a consistent read, as for
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1. INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>.
          </p><p>
            When a <code class="literal">SELECT</code> is used in the constructs
            <code class="literal">REPLACE INTO t SELECT ... FROM s WHERE
            ...</code> or <code class="literal">UPDATE t ... WHERE col IN (SELECT
            ... FROM s ...)</code>, <code class="literal">InnoDB</code> sets
            shared next-key locks on rows from table
            <code class="literal">s</code>.
          </p></li><li class="listitem"><p>
            While initializing a previously specified
            <code class="literal">AUTO_INCREMENT</code> column on a table,
            <code class="literal">InnoDB</code> sets an exclusive lock on the end
            of the index associated with the
            <code class="literal">AUTO_INCREMENT</code> column. In accessing the
            auto-increment counter, <code class="literal">InnoDB</code> uses a
            specific <code class="literal">AUTO-INC</code> table lock mode where
            the lock lasts only to the end of the current SQL statement,
            not to the end of the entire transaction. Other sessions
            cannot insert into the table while the
            <code class="literal">AUTO-INC</code> table lock is held; see
            <a class="xref" href="storage-engines.html#innodb-transaction-model" title="14.2.3.1. The InnoDB Transaction Model and Locking">Section 14.2.3.1, “The <code class="literal">InnoDB</code> Transaction Model and Locking”</a>.
          </p><p>
            <code class="literal">InnoDB</code> fetches the value of a previously
            initialized <code class="literal">AUTO_INCREMENT</code> column without
            setting any locks.
          </p></li><li class="listitem"><p>
            If a <code class="literal">FOREIGN KEY</code> constraint is defined on
            a table, any insert, update, or delete that requires the
            constraint condition to be checked sets shared record-level
            locks on the records that it looks at to check the
            constraint. <code class="literal">InnoDB</code> also sets these locks
            in the case where the constraint fails.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> sets table locks,
            but it is the higher MySQL layer above the
            <code class="literal">InnoDB</code> layer that sets these locks.
            <code class="literal">InnoDB</code> is aware of table locks if
            <code class="literal">innodb_table_locks = 1</code> (the default) and
            <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the
            MySQL layer above <code class="literal">InnoDB</code> knows about
            row-level locks.
          </p><p>
            Otherwise, <code class="literal">InnoDB</code>'s automatic deadlock
            detection cannot detect deadlocks where such table locks are
            involved. Also, because in this case the higher MySQL layer
            does not know about row-level locks, it is possible to get a
            table lock on a table where another session currently has
            row-level locks. However, this does not endanger transaction
            integrity, as discussed in
            <a class="xref" href="storage-engines.html#innodb-deadlock-detection" title="14.2.3.9. Deadlock Detection and Rollback">Section 14.2.3.9, “Deadlock Detection and Rollback”</a>. See also
            <a class="xref" href="storage-engines.html#innodb-restrictions" title="14.2.7. Limits on InnoDB Tables">Section 14.2.7, “Limits on <code class="literal">InnoDB</code> Tables”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-implicit-commit"></a>14.2.3.8. Implicit Transaction Commit and Rollback</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83592640"></a><p>
        By default, MySQL starts the session for each new connection
        with autocommit mode enabled, so MySQL does a commit after each
        SQL statement if that statement did not return an error. If a
        statement returns an error, the commit or rollback behavior
        depends on the error. See
        <a class="xref" href="storage-engines.html#innodb-error-handling" title="14.2.3.14. InnoDB Error Handling">Section 14.2.3.14, “<code class="literal">InnoDB</code> Error Handling”</a>.
      </p><p>
        If a session that has autocommit disabled ends without
        explicitly committing the final transaction, MySQL rolls back
        that transaction.
      </p><p>
        Some statements implicitly end a transaction, as if you had done
        a <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> before executing the
        statement. For details, see <a class="xref" href="sql-syntax.html#implicit-commit" title="13.3.3. Statements That Cause an Implicit Commit">Section 13.3.3, “Statements That Cause an Implicit Commit”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-deadlock-detection"></a>14.2.3.9. Deadlock Detection and Rollback</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83599008"></a><a class="indexterm" name="idp83600496"></a><a class="indexterm" name="idp83602400"></a><a class="indexterm" name="idp83603888"></a><p>
        <code class="literal">InnoDB</code> automatically detects transaction
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> and rolls back a
        transaction or transactions to break the deadlock.
        <code class="literal">InnoDB</code> tries to pick small transactions to
        roll back, where the size of a transaction is determined by the
        number of rows inserted, updated, or deleted.
      </p><p>
        <code class="literal">InnoDB</code> is aware of table locks if
        <code class="literal">innodb_table_locks = 1</code> (the default) and
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the MySQL
        layer above it knows about row-level locks. Otherwise,
        <code class="literal">InnoDB</code> cannot detect deadlocks where a table
        lock set by a MySQL <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
        statement or a lock set by a storage engine other than
        <code class="literal">InnoDB</code> is involved. Resolve these situations
        by setting the value of the
        <a class="link" href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> system
        variable.
      </p><p>
        When <code class="literal">InnoDB</code> performs a complete rollback of a
        transaction, all locks set by the transaction are released.
        However, if just a single SQL statement is rolled back as a
        result of an error, some of the locks set by the statement may
        be preserved. This happens because <code class="literal">InnoDB</code>
        stores row locks in a format such that it cannot know afterward
        which lock was set by which statement.
      </p><p>
        If a <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> calls a stored
        function in a transaction, and a statement within the function
        fails, that statement rolls back. Furthermore, if
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is
        executed after that, the entire transaction rolls back.
      </p><p>
        For techniques to organize database operations to avoid
        deadlocks, see <a class="xref" href="storage-engines.html#innodb-deadlocks" title="14.2.3.10. How to Cope with Deadlocks">Section 14.2.3.10, “How to Cope with Deadlocks”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-deadlocks"></a>14.2.3.10. How to Cope with Deadlocks</h4>

</div>

</div>

</div>
<p>
        This section builds on the conceptual information about
        deadlocks in <a class="xref" href="storage-engines.html#innodb-deadlock-detection" title="14.2.3.9. Deadlock Detection and Rollback">Section 14.2.3.9, “Deadlock Detection and Rollback”</a>. It
        explains how to organize database operations to minimize
        deadlocks and the subsequent error handling required in
        applications.
      </p><p>
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">Deadlocks</a> are a classic
        problem in transactional databases, but they are not dangerous
        unless they are so frequent that you cannot run certain
        transactions at all. Normally, you must write your applications
        so that they are always prepared to re-issue a transaction if it
        gets rolled back because of a deadlock.
      </p><p>
        <code class="literal">InnoDB</code> uses automatic row-level locking. You
        can get deadlocks even in the case of transactions that just
        insert or delete a single row. That is because these operations
        are not really <span class="quote">“<span class="quote">atomic</span>”</span>; they automatically set
        locks on the (possibly several) index records of the row
        inserted or deleted.
      </p><p>
        You can cope with deadlocks and reduce the likelihood of their
        occurrence with the following techniques:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            At any time, issue the
            <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a> command to determine the cause of
            the most recent deadlock. That can help you to tune your
            application to avoid deadlocks.
          </p></li><li class="listitem"><p>
            If frequent deadlock warnings cause concern, collect more
            extensive debugging information by restarting the server
            with the
            <a class="link" href="storage-engines.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
            configuration option enabled. Information about each
            deadlock, not just the latest one, is recorded in the MySQL
            <a class="link" href="glossary.html#glos_error_log" title="error log">error log</a>. Remove this
            option and restart the server again once the debugging is
            finished.
          </p></li><li class="listitem"><p>
            Always be prepared to re-issue a transaction if it fails due
            to deadlock. Deadlocks are not dangerous. Just try again.
          </p></li><li class="listitem"><p>
            Commit your transactions immediately after making a set of
            related changes. Small transactions are less prone to
            collision. In particular, do not leave an interactive
            <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> session open for a long time with
            an uncommitted transaction.
          </p></li><li class="listitem"><p>
            If you use <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking
            reads</a> (<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT
            ... FOR UPDATE</code></a> or
            <code class="literal">SELECT ... LOCK IN SHARE
            MODE</code>), try using a lower isolation level such as
            <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>.
          </p></li><li class="listitem"><p>
            When modifying multiple tables within a transaction, or
            different sets of rows in the same table, do those
            operations in a consistent order each time. Then
            transactions form well-defined queues and do not deadlock.
            For example, organize database operations into functions
            within your application, or call stored routines, rather
            than coding multiple similar sequences of
            <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and
            <code class="literal">DELETE</code> statements in different places.
          </p></li><li class="listitem"><p>
            Add well-chosen indexes to your tables. Then your queries
            need to scan fewer index records and consequently set fewer
            locks. Use <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
            SELECT</code></a> to determine which indexes the MySQL server
            regards as the most appropriate for your queries.
          </p></li><li class="listitem"><p>
            Use less locking. If you can afford to permit a
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> to return data from an
            old snapshot, do not add the clause <code class="literal">FOR
            UPDATE</code> or <code class="literal">LOCK IN SHARE MODE</code> to
            it. Using the <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a> isolation level is good here, because
            each consistent read within the same transaction reads from
            its own fresh snapshot.
          </p></li><li class="listitem"><p>
            

            If nothing else helps, serialize your transactions with
            table-level locks. The correct way to use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> with
            transactional tables, such as <code class="literal">InnoDB</code>
            tables, is to begin a transaction with <code class="literal">SET
            autocommit = 0</code> (not
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
            TRANSACTION</code></a>) followed by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a>, and to not call
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> until you commit the transaction
            explicitly. For example, if you need to write to table
            <code class="literal">t1</code> and read from table
            <code class="literal">t2</code>, you can do this:
          </p><pre class="programlisting">SET autocommit=0;
LOCK TABLES t1 WRITE, t2 READ, ...;<em class="replaceable"><code>... do something with tables t1 and t2 here ...</code></em>
COMMIT;
UNLOCK TABLES;
</pre><p>
            Table-level locks prevent concurrent updates to the table,
            avoiding deadlocks at the expense of less responsiveness for
            a busy system.
          </p></li><li class="listitem"><p>
            Another way to serialize transactions is to create an
            auxiliary <span class="quote">“<span class="quote">semaphore</span>”</span> table that contains just
            a single row. Have each transaction update that row before
            accessing other tables. In that way, all transactions happen
            in a serial fashion. Note that the <code class="literal">InnoDB</code>
            instant deadlock detection algorithm also works in this
            case, because the serializing lock is a row-level lock. With
            MySQL table-level locks, the timeout method must be used to
            resolve deadlocks.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-multi-versioning"></a>14.2.3.11. <code class="literal">InnoDB</code> Multi-Versioning</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83662192"></a><a class="indexterm" name="idp83663680"></a><p>
        <code class="literal">InnoDB</code> is a
        <a class="link" href="glossary.html#glos_mvcc" title="MVCC">multi-versioned storage engine</a>:
        it keeps information about old versions of changed rows, to
        support transactional features such as concurrency and
        <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>. This information
        is stored in the tablespace in a data structure called a
        <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a>
        (after an analogous data structure in Oracle).
        <code class="literal">InnoDB</code> uses the information in the rollback
        segment to perform the undo operations needed in a transaction
        rollback. It also uses the information to build earlier versions
        of a row for a <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent
        read</a>.
</p>
<h5><a name="idp83670720"></a>
        Internal Details of Multi-Versioning
</h5>
<p>
        Internally, <code class="literal">InnoDB</code> adds three fields to each
        row stored in the database. A 6-byte
        <code class="literal">DB_TRX_ID</code> field indicates the transaction
        identifier for the last transaction that inserted or updated the
        row. Also, a deletion is treated internally as an update where a
        special bit in the row is set to mark it as deleted. Each row
        also contains a 7-byte <code class="literal">DB_ROLL_PTR</code> field
        called the roll pointer. The roll pointer points to an undo log
        record written to the rollback segment. If the row was updated,
        the undo log record contains the information necessary to
        rebuild the content of the row before it was updated. A 6-byte
        <code class="literal">DB_ROW_ID</code> field contains a row ID that
        increases monotonically as new rows are inserted. If
        <code class="literal">InnoDB</code> generates a clustered index
        automatically, the index contains row ID values. Otherwise, the
        <code class="literal">DB_ROW_ID</code> column does not appear in any
        index.
      </p><p>
        Undo logs in the rollback segment are divided into insert and
        update undo logs. Insert undo logs are needed only in
        transaction rollback and can be discarded as soon as the
        transaction commits. Update undo logs are used also in
        consistent reads, but they can be discarded only after there is
        no transaction present for which <code class="literal">InnoDB</code> has
        assigned a snapshot that in a consistent read could need the
        information in the update undo log to build an earlier version
        of a database row.
</p>
<h5><a name="idp83678384"></a>
        Guidelines for Managing Rollback Segments
</h5>
<p>
        Commit your transactions regularly, including those transactions
        that issue only consistent reads. Otherwise,
        <code class="literal">InnoDB</code> cannot discard data from the update
        undo logs, and the rollback segment may grow too big, filling up
        your tablespace.
      </p><p>
        The physical size of an undo log record in the rollback segment
        is typically smaller than the corresponding inserted or updated
        row. You can use this information to calculate the space needed
        for your rollback segment.
      </p><p>
        In the <code class="literal">InnoDB</code> multi-versioning scheme, a row
        is not physically removed from the database immediately when you
        delete it with an SQL statement. <code class="literal">InnoDB</code> only
        physically removes the corresponding row and its index records
        when it discards the update undo log record written for the
        deletion. This removal operation is called a
        <a class="link" href="glossary.html#glos_purge" title="purge">purge</a>, and it is quite fast,
        usually taking the same order of time as the SQL statement that
        did the deletion.
      </p><p>
        If you insert and delete rows in smallish batches at about the
        same rate in the table, the purge thread can start to lag behind
        and the table can grow bigger and bigger because of all the
        <span class="quote">“<span class="quote">dead</span>”</span> rows, making everything disk-bound and very
        slow. In such a case, throttle new row operations, and allocate
        more resources to the purge thread by tuning the
        <a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a> system
        variable. See <a class="xref" href="storage-engines.html#innodb-parameters" title="14.2.6. InnoDB Startup Options and System Variables">Section 14.2.6, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a> for more
        information.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-table-and-index"></a>14.2.3.12. <code class="literal">InnoDB</code> Table and Index Structures</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83688992"></a><a class="indexterm" name="idp83690480"></a><p>
        This section describes how <code class="literal">InnoDB</code> tables,
        indexes, and their associated metadata is represented at the
        physical level. This information is primarily useful for
        performance tuning and troubleshooting.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-frm-file"></a>14.2.3.12.1. Role of the <code class="filename">.frm</code> File for <code class="literal">InnoDB</code>
Tables</h5>
</div>
</div>
</div>
<p>
          MySQL stores its data dictionary information for tables in
          <a class="link" href="glossary.html#glos_frm_file" title=".frm file">.frm files</a> in database
          directories. Unlike other MySQL storage engines,
          <code class="literal">InnoDB</code> also encodes information about the
          table in its own internal data dictionary inside the
          tablespace. When MySQL drops a table or a database, it deletes
          one or more <code class="filename">.frm</code> files as well as the
          corresponding entries inside the <code class="literal">InnoDB</code>
          data dictionary. You cannot move <code class="literal">InnoDB</code>
          tables between databases simply by moving the
          <code class="filename">.frm</code> files.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-index-types"></a>14.2.3.12.2. Clustered and Secondary Indexes</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp83705168"></a><a class="indexterm" name="idp83706656"></a><a class="indexterm" name="idp83708144"></a><a class="indexterm" name="idp83709632"></a><p>
          Every <code class="literal">InnoDB</code> table has a special index
          called the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered
          index</a> where the data for the rows is stored. Typically,
          the clustered index is synonymous with the
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>. To get
          the best performance from queries, inserts, and other database
          operations, you must understand how InnoDB uses the clustered
          index to optimize the most common lookup and DML operations
          for each table.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              When you define a <code class="literal">PRIMARY KEY</code> on your
              table, <code class="literal">InnoDB</code> uses it as the clustered
              index. Define a primary key for each table that you
              create. If there is no logical unique and non-null column
              or set of columns, add a new
              <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
              column, whose values are filled in automatically.
            </p></li><li class="listitem"><p>
              If you do not define a <code class="literal">PRIMARY KEY</code> for
              your table, MySQL locates the first
              <code class="literal">UNIQUE</code> index where all the key columns
              are <code class="literal">NOT NULL</code> and
              <code class="literal">InnoDB</code> uses it as the clustered index.
            </p></li><li class="listitem"><p>
              If the table has no <code class="literal">PRIMARY KEY</code> or
              suitable <code class="literal">UNIQUE</code> index,
              <code class="literal">InnoDB</code> internally generates a hidden
              clustered index on a synthetic column containing row ID
              values. The rows are ordered by the ID that
              <code class="literal">InnoDB</code> assigns to the rows in such a
              table. The row ID is a 6-byte field that increases
              monotonically as new rows are inserted. Thus, the rows
              ordered by the row ID are physically in insertion order.
</p></li></ul>
</div>
<h6><a name="idp83725648"></a>
          How the Clustered Index Speeds Up Queries
        </h6><p>
          Accessing a row through the clustered index is fast because
          the index search leads directly to the page with all the row
          data. If a table is large, the clustered index architecture
          often saves a disk I/O operation when compared to storage
          organizations that store row data using a different page from
          the index record. (For example, <code class="literal">MyISAM</code> uses
          one file for data rows and another for index records.)
        </p><h6><a name="idp83727696"></a>
          How Secondary Indexes Relate to the Clustered Index
        </h6><p>
          All indexes other than the clustered index are known as
          <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
          In <code class="literal">InnoDB</code>, each record in a secondary index
          contains the primary key columns for the row, as well as the
          columns specified for the secondary index.
          <code class="literal">InnoDB</code> uses this primary key value to
          search for the row in the clustered index.
        </p><p>
          If the primary key is long, the secondary indexes use more
          space, so it is advantageous to have a short primary key.
        </p><p>
          For coding guidelines to take advantage of
          <code class="literal">InnoDB</code> clustered and secondary indexes, see
          <a class="xref" href="optimization.html#optimizing-primary-keys" title="8.3.2. Using Primary Keys">Section 8.3.2, “Using Primary Keys”</a>
          <a class="xref" href="optimization.html#optimization-indexes" title="8.3. Optimization and Indexes">Section 8.3, “Optimization and Indexes”</a>
          <a class="xref" href="optimization.html#optimizing-innodb" title="8.5. Optimizing for InnoDB Tables">Section 8.5, “Optimizing for <code class="literal">InnoDB</code> Tables”</a>
          <a class="xref" href="optimization.html#optimizing-primary-keys" title="8.3.2. Using Primary Keys">Section 8.3.2, “Using Primary Keys”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-fulltext-index"></a>14.2.3.12.3. <code class="literal">FULLTEXT</code> Indexes</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp83736576"></a><a class="indexterm" name="idp83738064"></a><p>
          A special kind of index, the <code class="literal">FULLTEXT</code>
          index, helps <code class="literal">InnoDB</code> deal with queries and
          DML operations involving text-based columns and the words they
          contain. These indexes are physically represented as entire
          <code class="literal">InnoDB</code> tables, which are acted upon by SQL
          keywords such as the <code class="literal">FULLTEXT</code> clause of the
          <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statement, the
          <a class="link" href="functions.html#function_match"><code class="literal">MATCH() ... AGAINST</code></a> syntax in a
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement, and the
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> statement. For
          usage information, see <a class="xref" href="functions.html#fulltext-search" title="12.9. Full-Text Search Functions">Section 12.9, “Full-Text Search Functions”</a>.

          
        </p><p>
          You can examine <code class="literal">FULLTEXT</code> indexes by
          querying tables in the <code class="literal">INFORMATION_SCHEMA</code>
          database. You can see basic index information for
          <code class="literal">FULLTEXT</code> indexes by querying
          <a class="link" href="information-schema.html#innodb-sys-indexes-table" title="20.30.8. The INFORMATION_SCHEMA INNODB_SYS_INDEXES Table"><code class="literal">INNODB_SYS_INDEXES</code></a>. Although
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
          are represented by tables, which show up in
          <a class="link" href="information-schema.html#innodb-sys-tables-table" title="20.30.7. The INFORMATION_SCHEMA INNODB_SYS_TABLES Table"><code class="literal">INNODB_SYS_TABLES</code></a> queries, the
          way to monitor the special text-processing aspects of a
          <code class="literal">FULLTEXT</code> index is to query the tables
          <a class="link" href="information-schema.html#innodb-ft-config-table" title="20.30.20. The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="20.30.22. The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="20.30.23. The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="20.30.21. The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="20.30.24. The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>, and
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="20.30.25. The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a>.
        </p><p>
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
          are updated by the <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> command, using a special mode controlled by
          the configuration options
          <a class="link" href="storage-engines.html#sysvar_innodb_ft_num_word_optimize"><code class="literal">innodb_ft_num_word_optimize</code></a>
          and
          <a class="link" href="storage-engines.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only</code></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-physical-structure"></a>14.2.3.12.4. Physical Structure of an <code class="literal">InnoDB</code> Index</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp83767744"></a><a class="indexterm" name="idp83769232"></a><a class="indexterm" name="idp83770720"></a><a class="indexterm" name="idp83771792"></a><p>
          All <code class="literal">InnoDB</code> indexes are
          <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-trees</a> where the index
          records are stored in the leaf pages of the tree. The default
          size of an index page is 16KB. When new records are inserted,
          <code class="literal">InnoDB</code> tries to leave 1/16 of the page free
          for future insertions and updates of the index records.
        </p><p>
          If index records are inserted in a sequential order (ascending
          or descending), the resulting index pages are about 15/16
          full. If records are inserted in a random order, the pages are
          from 1/2 to 15/16 full. If the
          <a class="link" href="glossary.html#glos_fill_factor" title="fill factor">fill factor</a> of an
          index page drops below 1/2, <code class="literal">InnoDB</code> tries to
          contract the index tree to free the page.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            You can specify the <a class="link" href="glossary.html#glos_page_size" title="page size">page
            size</a> for all <code class="literal">InnoDB</code> tablespaces in
            a MySQL instance by setting the
            <a class="link" href="storage-engines.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
            configuration option before creating the instance. Once the
            page size for a MySQL instance is set, you cannot change it.
            Supported sizes are 16KB, 8KB, and 4KB, corresponding to the
            option values <code class="literal">16k</code>, <code class="literal">8k</code>,
            and <code class="literal">4k</code>.
          </p><p xmlns="">
            A MySQL instance using a particular
            <code class="literal">InnoDB</code> page size cannot use data files or
            log files from an instance that uses a different page size.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-insert-buffering"></a>14.2.3.12.5. Insert Buffering</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp83786512"></a><a class="indexterm" name="idp83788000"></a><p>
          Database applications often insert new rows in the ascending
          order of the primary key. In this case, due to the layout of
          the clustered index in the same order as the primary key,
          insertions into an InnoDB table do not require random reads
          from a disk.
        </p><p>
          On the other hand, secondary indexes are usually nonunique,
          and insertions into secondary indexes happen in a relatively
          random order. In the same way, deletes and updates can affect
          data pages that are not adjacent in secondary indexes. This
          would cause a lot of random disk I/O operations without a
          special mechanism used in <code class="literal">InnoDB</code>.
        </p><p>
          When an index record is inserted, marked for deletion, or
          deleted from a nonunique secondary index,
          <code class="literal">InnoDB</code> checks whether the secondary index
          page is in the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a>. If that is the case, <code class="literal">InnoDB</code>
          applies the change directly to the index page. If the index
          page is not found in the buffer pool,
          <code class="literal">InnoDB</code> records the change in a special
          structure known as the
          <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert buffer</a>. The
          insert buffer is kept small so that it fits entirely in the
          buffer pool, and changes can be applied very quickly. This
          process is known as
          <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change buffering</a>.
          (Formerly, it applied only to inserts and was called insert
          buffering. The data structure is still called the insert
          buffer.)
        </p><h6><a name="idp83796688"></a>
          Disk I/O for Flushing the Insert Buffer
        </h6><p>
          Periodically, the insert buffer is merged into the secondary
          index trees in the database. Often, it is possible to merge
          several changes into the same page of the index tree, saving
          disk I/O operations. It has been measured that the insert
          buffer can speed up insertions into a table up to 15 times.
        </p><p>
          The insert buffer merging may continue to happen
          <span class="emphasis"><em>after</em></span> the transaction has been committed.
          In fact, it may continue to happen after a server shutdown and
          restart (see <a class="xref" href="storage-engines.html#forcing-innodb-recovery" title="14.2.4.6. Starting InnoDB on a Corrupted Database">Section 14.2.4.6, “Starting <code class="literal">InnoDB</code> on a Corrupted Database”</a>).
        </p><p>
          Insert buffer merging may take many hours when many secondary
          indexes must be updated and many rows have been inserted.
          During this time, disk I/O will be increased, which can cause
          significant slowdown on disk-bound queries. Another
          significant background I/O operation is the
          <a class="link" href="glossary.html#glos_purge_thread" title="purge thread">purge thread</a> (see
          <a class="xref" href="storage-engines.html#innodb-multi-versioning" title="14.2.3.11. InnoDB Multi-Versioning">Section 14.2.3.11, “<code class="literal">InnoDB</code> Multi-Versioning”</a>).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-adaptive-hash"></a>14.2.3.12.6. Adaptive Hash Indexes</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp83802576"></a><a class="indexterm" name="idp83804064"></a><p>
          The feature known as the
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          index</a> (AHI) lets <code class="literal">InnoDB</code> perform more
          like an in-memory database on systems with appropriate
          combinations of workload and ample memory for the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, without
          sacrificing any transactional features or reliability. This
          feature is enabled by the
          <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
          option, or turned off by the
          <code class="literal">--skip-innodb_adaptive_hash_index</code> at server
          startup.
        </p><p>
          Based on the observed pattern of searches, MySQL builds a hash
          index using a prefix of the index key. The prefix of the key
          can be any length, and it may be that only some of the values
          in the B-tree appear in the hash index. Hash indexes are built
          on demand for those pages of the index that are often
          accessed.
        </p><p>
          If a table fits almost entirely in main memory, a hash index
          can speed up queries by enabling direct lookup of any element,
          turning the index value into a sort of pointer.
          <code class="literal">InnoDB</code> has a mechanism that monitors index
          searches. If <code class="literal">InnoDB</code> notices that queries
          could benefit from building a hash index, it does so
          automatically.
        </p><p>
          With some <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, the
          speedup from hash index lookups greatly outweighs the extra
          work to monitor index lookups and maintain the hash index
          structure. Sometimes, the read/write lock that guards access
          to the adaptive hash index can become a source of contention
          under heavy workloads, such as multiple concurrent joins.
          Queries with <code class="literal">LIKE</code> operators and
          <code class="literal">%</code> wildcards also tend not to benefit from
          the AHI. For workloads where the adaptive hash index is not
          needed, turning it off reduces unnecessary performance
          overhead. Because it is difficult to predict in advance
          whether this feature is appropriate for a particular system,
          consider running benchmarks with it both enabled and disabled,
          using a realistic workload. The architectural changes in MySQL
          5.6 and higher make more workloads suitable for disabling the
          adaptive hash index than in earlier releases, although it is
          still enabled by default.
        </p><p>
          The hash index is always built based on an existing
          <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> index on the table.
          <code class="literal">InnoDB</code> can build a hash index on a prefix
          of any length of the key defined for the B-tree, depending on
          the pattern of searches that <code class="literal">InnoDB</code>
          observes for the B-tree index. A hash index can be partial,
          covering only those pages of the index that are often
          accessed.
        </p><p>
          You can monitor the use of the adaptive hash index and the
          contention for its use in the <code class="literal">SEMAPHORES</code>
          section of the output of the
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> command. If you see many threads
          waiting on an RW-latch created in
          <code class="filename">btr0sea.c</code>, then it might be useful to
          disable adaptive hash indexing.
        </p><p>
          For more information about the performance characteristics of
          hash indexes, see <a class="xref" href="optimization.html#index-btree-hash" title="8.3.8. Comparison of B-Tree and Hash Indexes">Section 8.3.8, “Comparison of B-Tree and Hash Indexes”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-physical-record"></a>14.2.3.12.7. Physical Row Structure</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp83825888"></a><p>
          The physical row structure for an <code class="literal">InnoDB</code>
          table depends on the row format specified when the table was
          created. By default, <code class="literal">InnoDB</code> uses the
          <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a> file format and
          its <code class="literal">COMPACT</code> row format. The
          <code class="literal">REDUNDANT</code> format is available to retain
          compatibility with older versions of MySQL. When you enable
          the <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          setting, you can also make use of the newer Barracuda file
          format, with its <code class="literal">DYNAMIC</code> and
          <code class="literal">COMPRESSED</code> row formats, as explained in
          <a class="xref" href="server-administration.html#innodb-row-format" title="5.4.8. How InnoDB Stores Variable-Length Columns">Section 5.4.8, “How <code class="literal">InnoDB</code> Stores Variable-Length Columns”</a> and
          <a class="xref" href="server-administration.html#innodb-compression" title="5.4.6. Working with InnoDB Compressed Tables">Section 5.4.6, “Working with <code class="literal">InnoDB</code> Compressed Tables”</a>.
        </p><p>
          To check the row format of an <code class="literal">InnoDB</code> table,
          use <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>.
        </p><p>
          The <code class="literal">COMPACT</code> row format decreases row
          storage space by about 20% at the cost of increasing CPU use
          for some operations. If your workload is a typical one that is
          limited by cache hit rates and disk speed,
          <code class="literal">COMPACT</code> format is likely to be faster. If
          the workload is a rare case that is limited by CPU speed,
          <code class="literal">COMPACT</code> format might be slower.
        </p><p>
          Rows in <code class="literal">InnoDB</code> tables that use
          <code class="literal">REDUNDANT</code> row format have the following
          characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Each index record contains a 6-byte header. The header is
              used to link together consecutive records, and also in
              row-level locking.
            </p></li><li class="listitem"><p>
              Records in the clustered index contain fields for all
              user-defined columns. In addition, there is a 6-byte
              transaction ID field and a 7-byte roll pointer field.
            </p></li><li class="listitem"><p>
              If no primary key was defined for a table, each clustered
              index record also contains a 6-byte row ID field.
            </p></li><li class="listitem"><p>
              Each secondary index record also contains all the primary
              key fields defined for the clustered index key that are
              not in the secondary index.
            </p></li><li class="listitem"><p>
              A record contains a pointer to each field of the record.
              If the total length of the fields in a record is less than
              128 bytes, the pointer is one byte; otherwise, two bytes.
              The array of these pointers is called the record
              directory. The area where these pointers point is called
              the data part of the record.
            </p></li><li class="listitem"><p>
              Internally, <code class="literal">InnoDB</code> stores fixed-length
              character columns such as
              <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
              format. <code class="literal">InnoDB</code> does not truncate
              trailing spaces from
              <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
            </p></li><li class="listitem"><p>
              An SQL <code class="literal">NULL</code> value reserves one or two
              bytes in the record directory. Besides that, an SQL
              <code class="literal">NULL</code> value reserves zero bytes in the
              data part of the record if stored in a variable length
              column. In a fixed-length column, it reserves the fixed
              length of the column in the data part of the record.
              Reserving the fixed space for <code class="literal">NULL</code>
              values enables an update of the column from
              <code class="literal">NULL</code> to a non-<code class="literal">NULL</code>
              value to be done in place without causing fragmentation of
              the index page.
</p></li></ul>
</div>
<p>
          Rows in <code class="literal">InnoDB</code> tables that use
          <code class="literal">COMPACT</code> row format have the following
          characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Each index record contains a 5-byte header that may be
              preceded by a variable-length header. The header is used
              to link together consecutive records, and also in
              row-level locking.
            </p></li><li class="listitem"><p>
              The variable-length part of the record header contains a
              bit vector for indicating <code class="literal">NULL</code> columns.
              If the number of columns in the index that can be
              <code class="literal">NULL</code> is <em class="replaceable"><code>N</code></em>,
              the bit vector occupies
              <code class="literal">CEILING(<em class="replaceable"><code>N</code></em>/8)</code>
              bytes. (For example, if there are anywhere from 9 to 15
              columns that can be <code class="literal">NULL</code>, the bit
              vector uses two bytes.) Columns that are
              <code class="literal">NULL</code> do not occupy space other than the
              bit in this vector. The variable-length part of the header
              also contains the lengths of variable-length columns. Each
              length takes one or two bytes, depending on the maximum
              length of the column. If all columns in the index are
              <code class="literal">NOT NULL</code> and have a fixed length, the
              record header has no variable-length part.
            </p></li><li class="listitem"><p>
              For each non-<code class="literal">NULL</code> variable-length
              field, the record header contains the length of the column
              in one or two bytes. Two bytes will only be needed if part
              of the column is stored externally in overflow pages or
              the maximum length exceeds 255 bytes and the actual length
              exceeds 127 bytes. For an externally stored column, the
              2-byte length indicates the length of the internally
              stored part plus the 20-byte pointer to the externally
              stored part. The internal part is 768 bytes, so the length
              is 768+20. The 20-byte pointer stores the true length of
              the column.
            </p></li><li class="listitem"><p>
              The record header is followed by the data contents of the
              non-<code class="literal">NULL</code> columns.
            </p></li><li class="listitem"><p>
              Records in the clustered index contain fields for all
              user-defined columns. In addition, there is a 6-byte
              transaction ID field and a 7-byte roll pointer field.
            </p></li><li class="listitem"><p>
              If no primary key was defined for a table, each clustered
              index record also contains a 6-byte row ID field.
            </p></li><li class="listitem"><p>
              Each secondary index record also contains all the primary
              key fields defined for the clustered index key that are
              not in the secondary index. If any of these primary key
              fields are variable length, the record header for each
              secondary index will have a variable-length part to record
              their lengths, even if the secondary index is defined on
              fixed-length columns.
            </p></li><li class="listitem"><p>
              Internally, <code class="literal">InnoDB</code> stores fixed-length,
              fixed-width character columns such as
              <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
              format. <code class="literal">InnoDB</code> does not truncate
              trailing spaces from
              <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
            </p></li><li class="listitem"><p>
              Internally, <code class="literal">InnoDB</code> attempts to store
              UTF-8
              <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
              columns in <em class="replaceable"><code>N</code></em> bytes by trimming
              trailing spaces. (With <code class="literal">REDUNDANT</code> row
              format, such columns occupy 3 ×
              <em class="replaceable"><code>N</code></em> bytes.) Reserving the minimum
              space <em class="replaceable"><code>N</code></em> in many cases enables
              column updates to be done in place without causing
              fragmentation of the index page.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-recovery"></a>14.2.3.13. The <code class="literal">InnoDB</code> Recovery Process</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83885184"></a><p>
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
        consists of several steps:
      </p><p>
        The first step, applying the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo
        log</a>, is performed during initialization, before accepting
        any connections. If all changes were flushed from the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> to the
        <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>
        (<code class="filename">ibdata*</code> and <code class="filename">*.ibd</code>
        files) at the time of the shutdown or crash, the redo log
        application can be skipped. If the redo log files are missing at
        startup, <code class="literal">InnoDB</code> skips the redo log
        application.
      </p><p>
        The remaining steps after redo log application do not depend on
        the redo log (other than for logging the writes) and are
        performed in parallel with normal processing. These include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_rollback" title="rollback">Rolling back</a> incomplete
            <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>: Any
            transactions that were active at the time of crash or
            <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>.
          </p></li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">Insert buffer</a>
            merge: Applying changes from the insert buffer (part of the
            <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
            tablespace</a>) to leaf pages of secondary indexes, as
            the index pages are read to the buffer pool.
          </p></li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_purge" title="purge">Purge</a>: Deleting
            delete-marked records that are no longer visible for any
            active transaction.
</p></li></ul>
</div>
<p>
        Of these, only rollback of incomplete transactions is special to
        crash recovery. The insert buffer merge and the purge are
        performed during normal processing.
      </p><p>
        In most situations, even if the MySQL server was killed
        unexpectedly in the middle of heavy activity, the recovery
        process happens automatically and no action is needed from the
        DBA. If a hardware failure or severe system error corrupted
        <code class="literal">InnoDB</code> data, MySQL might refuse to start. In
        that case, see <a class="xref" href="storage-engines.html#forcing-innodb-recovery" title="14.2.4.6. Starting InnoDB on a Corrupted Database">Section 14.2.4.6, “Starting <code class="literal">InnoDB</code> on a Corrupted Database”</a> for the
        steps to troubleshoot such an issue.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-error-handling"></a>14.2.3.14. <code class="literal">InnoDB</code> Error Handling</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp83906640"></a><a class="indexterm" name="idp83908544"></a><p>
        Error handling in <code class="literal">InnoDB</code> is not always the
        same as specified in the SQL standard. According to the
        standard, any error during an SQL statement should cause
        rollback of that statement. <code class="literal">InnoDB</code> sometimes
        rolls back only part of the statement, or the whole transaction.
        The following items describe how <code class="literal">InnoDB</code>
        performs error handling:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you run out of file space in a
            <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>, a MySQL
            <code class="literal">Table is full</code> error occurs and
            <code class="literal">InnoDB</code> rolls back the SQL statement.
          </p></li><li class="listitem"><p>
            A transaction <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>
            causes <code class="literal">InnoDB</code> to
            <a class="link" href="glossary.html#glos_rollback" title="rollback">roll back</a> the entire
            <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>. Retry
            the whole transaction when this happens.
          </p><p>
            A lock wait timeout causes <code class="literal">InnoDB</code> to roll
            back only the single statement that was waiting for the lock
            and encountered the timeout. (To have the entire transaction
            roll back, start the server with the
            <a class="link" href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
            option.) Retry the statement if using the current behavior,
            or the entire transaction if using
            <a class="link" href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>.
          </p><p>
            Both deadlocks and lock wait timeouts are normal on busy
            servers and it is necessary for applications to be aware
            that they may happen and handle them by retrying. You can
            make them less likely by doing as little work as possible
            between the first change to data during a transaction and
            the commit, so the locks are held for the shortest possible
            time and for the smallest possible number of rows. Sometimes
            splitting work between different transactions may be
            practical and helpful.
          </p><p>
            When a transaction rollback occurs due to a deadlock or lock
            wait timeout, it cancels the effect of the statements within
            the transaction. But if the start-transaction statement was
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
            TRANSACTION</code></a> or
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
            statement, rollback does not cancel that statement. Further
            SQL statements become part of the transaction until the
            occurrence of <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>,
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>,
            or some SQL statement that causes an implicit commit.
          </p></li><li class="listitem"><p>
            A duplicate-key error rolls back the SQL statement, if you
            have not specified the <code class="literal">IGNORE</code> option in
            your statement.
          </p></li><li class="listitem"><p>
            A <code class="literal">row too long error</code> rolls back the SQL
            statement.
          </p></li><li class="listitem"><p>
            Other errors are mostly detected by the MySQL layer of code
            (above the <code class="literal">InnoDB</code> storage engine level),
            and they roll back the corresponding SQL statement. Locks
            are not released in a rollback of a single SQL statement.
</p></li></ul>
</div>
<p>
        During implicit rollbacks, as well as during the execution of an
        explicit
        <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> SQL
        statement, <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a>
        displays <code class="literal">Rolling back</code> in the
        <code class="literal">State</code> column for the relevant connection.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-error-codes"></a>14.2.3.14.1. <code class="literal">InnoDB</code> Error Codes</h5>
</div>
</div>
</div>
<a class="indexterm" name="idp83941072"></a><p>
          The following is a nonexhaustive list of common
          <code class="literal">InnoDB</code>-specific errors that you may
          encounter, with information about why each occurs and how to
          resolve the problem.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">1005 (ER_CANT_CREATE_TABLE)</code>
            </p><p>
              Cannot create table. If the error message refers to error
              150, table creation failed because a
              <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
              constraint</a> was not correctly formed. If the error
              message refers to error –1, table creation probably
              failed because the table includes a column name that
              matched the name of an internal <code class="literal">InnoDB</code>
              table.
            </p></li><li class="listitem"><p>
              <code class="literal">1016 (ER_CANT_OPEN_FILE)</code>
            </p><p>
              Cannot find the <code class="literal">InnoDB</code> table from the
              <code class="literal">InnoDB</code>
              <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a>,
              although the <code class="filename">.frm</code> file for the table
              exists. See
              <a class="xref" href="storage-engines.html#innodb-troubleshooting-datadict" title="14.2.4.7. Troubleshooting InnoDB Data Dictionary Operations">Section 14.2.4.7, “Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations”</a>.
            </p></li><li class="listitem"><p>
              <code class="literal">1114 (ER_RECORD_FILE_FULL)</code>
            </p><p>
              

              <code class="literal">InnoDB</code> has run out of free space in the
              tablespace. Reconfigure the tablespace to add a new data
              file.
            </p></li><li class="listitem"><p>
              <code class="literal">1205 (ER_LOCK_WAIT_TIMEOUT)</code>
            </p><p>
              Lock wait timeout expired. The statement that waited too
              long was <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled back</a>
              (not the entire
              <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>). You
              can increase the value of the
              <a class="link" href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>
              configuration option if SQL statements should wait longer
              for other transactions to complete, or decrease it if too
              many long-running transactions are causing
              <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> problems and
              reducing
              <a class="link" href="glossary.html#glos_concurrency" title="concurrency">concurrency</a> on a
              busy system.
            </p></li><li class="listitem"><p>
              <code class="literal">1206 (ER_LOCK_TABLE_FULL)</code>
            </p><p>
              The total number of locks exceeds the amount of memory
              <code class="literal">InnoDB</code> devotes to managing locks. To
              avoid this error, increase the value of
              <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>.
              Within an individual application, a workaround may be to
              break a large operation into smaller pieces. For example,
              if the error occurs for a large
              <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>, perform several
              smaller <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> operations.
            </p></li><li class="listitem"><p>
              <code class="literal">1213 (ER_LOCK_DEADLOCK)</code>
            </p><p>
              The <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>
              encountered a
              <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a> and was
              automatically <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled
              back</a> so that your application could take corrective
              action. To recover from this error, run all the operations
              in this transaction again. A deadlock occurs when requests
              for locks arrive in inconsistent order between
              transactions. The transaction that was rolled back
              released all its locks, and the other transaction can now
              get all the locks it requested. Thus when you re-run the
              transaction that was rolled back, it might have to wait
              for other transactions to complete, but typically the
              deadlock does not recur. If you encounter frequent
              deadlocks, make the sequence of locking operations
              (<code class="literal">LOCK TABLES</code>, <code class="literal">SELECT ... FOR
              UPDATE</code>, and so on) consistent between the
              different transactions or applications that experience the
              issue. See <a class="xref" href="storage-engines.html#innodb-deadlocks" title="14.2.3.10. How to Cope with Deadlocks">Section 14.2.3.10, “How to Cope with Deadlocks”</a> for details.
            </p></li><li class="listitem"><p>
              <code class="literal">1216 (ER_NO_REFERENCED_ROW)</code>
            </p><p>
              

              You are trying to add a row but there is no parent row,
              and a <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign
              key constraint</a> fails. Add the parent row first.
            </p></li><li class="listitem"><p>
              <code class="literal">1217 (ER_ROW_IS_REFERENCED)</code>
            </p><p>
              You are trying to delete a parent row that has children,
              and a <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign
              key constraint</a> fails. Delete the children first.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="operating-system-error-codes"></a>14.2.3.14.2. Operating System Error Codes</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp83985296"></a><a class="indexterm" name="idp83987200"></a><p>
          To print the meaning of an operating system error number, use
          the <a class="link" href="programs.html#perror" title="4.8.1. perror — Explain Error Codes"><span class="command"><strong>perror</strong></span></a> program that comes with the
          MySQL distribution.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="operating-system-error-codes-linux"></a>
              <span class="bold"><strong>Linux System Error Codes</strong></span>
            </p><p>
              The following table provides a list of some common Linux
              system error codes. For a more complete list, see
              <a class="ulink" href="http://www.finalcog.com/c-error-codes-include-errno" target="_top">Linux
              source code</a>.
</p>
<div class="informaltable">
<table summary=" Linux error codes associated with InnoDB file
operations and other system calls. " border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Number</th><th scope="col">Macro</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row">1</td><td><code class="literal">EPERM</code></td><td>Operation not permitted</td></tr><tr><td scope="row">2</td><td><code class="literal">ENOENT</code></td><td>No such file or directory</td></tr><tr><td scope="row">3</td><td><code class="literal">ESRCH</code></td><td>No such process</td></tr><tr><td scope="row">4</td><td><code class="literal">EINTR</code></td><td>Interrupted system call</td></tr><tr><td scope="row">5</td><td><code class="literal">EIO</code></td><td>I/O error</td></tr><tr><td scope="row">6</td><td><code class="literal">ENXIO</code></td><td>No such device or address</td></tr><tr><td scope="row">7</td><td><code class="literal">E2BIG</code></td><td>Arg list too long</td></tr><tr><td scope="row">8</td><td><code class="literal">ENOEXEC</code></td><td>Exec format error</td></tr><tr><td scope="row">9</td><td><code class="literal">EBADF</code></td><td>Bad file number</td></tr><tr><td scope="row">10</td><td><code class="literal">ECHILD</code></td><td>No child processes</td></tr><tr><td scope="row">11</td><td><code class="literal">EAGAIN</code></td><td>Try again</td></tr><tr><td scope="row">12</td><td><code class="literal">ENOMEM</code></td><td>Out of memory</td></tr><tr><td scope="row">13</td><td><code class="literal">EACCES</code></td><td>Permission denied</td></tr><tr><td scope="row">14</td><td><code class="literal">EFAULT</code></td><td>Bad address</td></tr><tr><td scope="row">15</td><td><code class="literal">ENOTBLK</code></td><td>Block device required</td></tr><tr><td scope="row">16</td><td><code class="literal">EBUSY</code></td><td>Device or resource busy</td></tr><tr><td scope="row">17</td><td><code class="literal">EEXIST</code></td><td>File exists</td></tr><tr><td scope="row">18</td><td><code class="literal">EXDEV</code></td><td>Cross-device link</td></tr><tr><td scope="row">19</td><td><code class="literal">ENODEV</code></td><td>No such device</td></tr><tr><td scope="row">20</td><td><code class="literal">ENOTDIR</code></td><td>Not a directory</td></tr><tr><td scope="row">21</td><td><code class="literal">EISDIR</code></td><td>Is a directory</td></tr><tr><td scope="row">22</td><td><code class="literal">EINVAL</code></td><td>Invalid argument</td></tr><tr><td scope="row">23</td><td><code class="literal">ENFILE</code></td><td>File table overflow</td></tr><tr><td scope="row">24</td><td><code class="literal">EMFILE</code></td><td>Too many open files</td></tr><tr><td scope="row">25</td><td><code class="literal">ENOTTY</code></td><td>Inappropriate ioctl for device</td></tr><tr><td scope="row">26</td><td><code class="literal">ETXTBSY</code></td><td>Text file busy</td></tr><tr><td scope="row">27</td><td><code class="literal">EFBIG</code></td><td>File too large</td></tr><tr><td scope="row">28</td><td><code class="literal">ENOSPC</code></td><td>No space left on device</td></tr><tr><td scope="row">29</td><td><code class="literal">ESPIPE</code></td><td>File descriptor does not allow seeking</td></tr><tr><td scope="row">30</td><td><code class="literal">EROFS</code></td><td>Read-only file system</td></tr><tr><td scope="row">31</td><td><code class="literal">EMLINK</code></td><td>Too many links</td></tr></tbody></table>
</div>
</li><li class="listitem"><p><a name="operating-system-error-codes-windows"></a>
              <span class="bold"><strong>Windows System Error
              Codes</strong></span>
            </p><p>
              The following table provides a list of some common Windows
              system error codes. For a complete list, see the
              <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ms681381.aspx" target="_top">Microsoft
              Web site</a>.
</p>
<div class="informaltable">
<table summary=" Windows error codes associated with InnoDB file
                operations and other system calls. " border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Number</th><th scope="col">Macro</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row">1</td><td><code class="literal">ERROR_INVALID_FUNCTION</code></td><td>Incorrect function.</td></tr><tr><td scope="row">2</td><td><code class="literal">ERROR_FILE_NOT_FOUND</code></td><td>The system cannot find the file specified.</td></tr><tr><td scope="row">3</td><td><code class="literal">ERROR_PATH_NOT_FOUND</code></td><td>The system cannot find the path specified.</td></tr><tr><td scope="row">4</td><td><code class="literal">ERROR_TOO_MANY_OPEN_FILES</code></td><td>The system cannot open the file.</td></tr><tr><td scope="row">5</td><td><code class="literal">ERROR_ACCESS_DENIED</code></td><td>Access is denied.</td></tr><tr><td scope="row">6</td><td><code class="literal">ERROR_INVALID_HANDLE</code></td><td>The handle is invalid.</td></tr><tr><td scope="row">7</td><td><code class="literal">ERROR_ARENA_TRASHED</code></td><td>The storage control blocks were destroyed.</td></tr><tr><td scope="row">8</td><td><code class="literal">ERROR_NOT_ENOUGH_MEMORY</code></td><td>Not enough storage is available to process this command.</td></tr><tr><td scope="row">9</td><td><code class="literal">ERROR_INVALID_BLOCK</code></td><td>The storage control block address is invalid.</td></tr><tr><td scope="row">10</td><td><code class="literal">ERROR_BAD_ENVIRONMENT</code></td><td>The environment is incorrect.</td></tr><tr><td scope="row">11</td><td><code class="literal">ERROR_BAD_FORMAT</code></td><td>An attempt was made to load a program with an incorrect format.</td></tr><tr><td scope="row">12</td><td><code class="literal">ERROR_INVALID_ACCESS</code></td><td>The access code is invalid.</td></tr><tr><td scope="row">13</td><td><code class="literal">ERROR_INVALID_DATA</code></td><td>The data is invalid.</td></tr><tr><td scope="row">14</td><td><code class="literal">ERROR_OUTOFMEMORY</code></td><td>Not enough storage is available to complete this operation.</td></tr><tr><td scope="row">15</td><td><code class="literal">ERROR_INVALID_DRIVE</code></td><td>The system cannot find the drive specified.</td></tr><tr><td scope="row">16</td><td><code class="literal">ERROR_CURRENT_DIRECTORY</code></td><td>The directory cannot be removed.</td></tr><tr><td scope="row">17</td><td><code class="literal">ERROR_NOT_SAME_DEVICE</code></td><td>The system cannot move the file to a different disk drive.</td></tr><tr><td scope="row">18</td><td><code class="literal">ERROR_NO_MORE_FILES</code></td><td>There are no more files.</td></tr><tr><td scope="row">19</td><td><code class="literal">ERROR_WRITE_PROTECT</code></td><td>The media is write protected.</td></tr><tr><td scope="row">20</td><td><code class="literal">ERROR_BAD_UNIT</code></td><td>The system cannot find the device specified.</td></tr><tr><td scope="row">21</td><td><code class="literal">ERROR_NOT_READY</code></td><td>The device is not ready.</td></tr><tr><td scope="row">22</td><td><code class="literal">ERROR_BAD_COMMAND</code></td><td>The device does not recognize the command.</td></tr><tr><td scope="row">23</td><td><code class="literal">ERROR_CRC</code></td><td>Data error (cyclic redundancy check).</td></tr><tr><td scope="row">24</td><td><code class="literal">ERROR_BAD_LENGTH</code></td><td>The program issued a command but the command length is incorrect.</td></tr><tr><td scope="row">25</td><td><code class="literal">ERROR_SEEK</code></td><td>The drive cannot locate a specific area or track on the disk.</td></tr><tr><td scope="row">26</td><td><code class="literal">ERROR_NOT_DOS_DISK</code></td><td>The specified disk or diskette cannot be accessed.</td></tr><tr><td scope="row">27</td><td><code class="literal">ERROR_SECTOR_NOT_FOUND</code></td><td>The drive cannot find the sector requested.</td></tr><tr><td scope="row">28</td><td><code class="literal">ERROR_OUT_OF_PAPER</code></td><td>The printer is out of paper.</td></tr><tr><td scope="row">29</td><td><code class="literal">ERROR_WRITE_FAULT</code></td><td>The system cannot write to the specified device.</td></tr><tr><td scope="row">30</td><td><code class="literal">ERROR_READ_FAULT</code></td><td>The system cannot read from the specified device.</td></tr><tr><td scope="row">31</td><td><code class="literal">ERROR_GEN_FAILURE</code></td><td>A device attached to the system is not functioning.</td></tr><tr><td scope="row">32</td><td><code class="literal">ERROR_SHARING_VIOLATION</code></td><td>The process cannot access the file because it is being used by another
                      process.</td></tr><tr><td scope="row">33</td><td><code class="literal">ERROR_LOCK_VIOLATION</code></td><td>The process cannot access the file because another process has locked a
                      portion of the file.</td></tr><tr><td scope="row">34</td><td><code class="literal">ERROR_WRONG_DISK</code></td><td>The wrong diskette is in the drive. Insert %2 (Volume Serial Number: %3)
into drive %1.</td></tr><tr><td scope="row">36</td><td><code class="literal">ERROR_SHARING_BUFFER_EXCEEDED</code></td><td>Too many files opened for sharing.</td></tr><tr><td scope="row">38</td><td><code class="literal">ERROR_HANDLE_EOF</code></td><td>Reached the end of the file.</td></tr><tr><td scope="row">39</td><td><code class="literal">ERROR_HANDLE_DISK_FULL</code></td><td>The disk is full.</td></tr><tr><td scope="row">87</td><td><code class="literal">ERROR_INVALID_PARAMETER</code></td><td>The parameter is incorrect.</td></tr><tr><td scope="row">112</td><td><code class="literal">ERROR_DISK_FULL</code></td><td>The disk is full.</td></tr><tr><td scope="row">123</td><td><code class="literal">ERROR_INVALID_NAME</code></td><td>The file name, directory name, or volume label syntax is incorrect.</td></tr><tr><td scope="row">1450</td><td><code class="literal">ERROR_NO_SYSTEM_RESOURCES</code></td><td>Insufficient system resources exist to complete the requested service.</td></tr></tbody></table>
</div>
</li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-tuning-troubleshooting"></a>14.2.4. <code class="literal">InnoDB</code> Performance Tuning and Troubleshooting</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-tuning">14.2.4.1. <code class="literal">InnoDB</code> Performance Tuning Tips</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance">14.2.4.2. <code class="literal">InnoDB</code> Performance and Scalability Enhancements</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema">14.2.4.3. <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code> tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-monitors">14.2.4.4. <code class="literal">SHOW ENGINE INNODB
STATUS</code> and the <code class="literal">InnoDB</code> Monitors</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-troubleshooting">14.2.4.5. <code class="literal">InnoDB</code> General Troubleshooting</a></span></dt><dt><span class="section"><a href="storage-engines.html#forcing-innodb-recovery">14.2.4.6. Starting <code class="literal">InnoDB</code> on a Corrupted Database</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-troubleshooting-datadict">14.2.4.7. Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations</a></span></dt></dl>
</div>
<p>
      This section explains the actions to take for
      <code class="literal">InnoDB</code> issues. Because much of the
      <code class="literal">InnoDB</code> focus is on performance, many issues are
      performance-related. You can use the tips here to track down
      problems after they occur, or do advance planning to avoid the
      problems entirely.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-tuning"></a>14.2.4.1. <code class="literal">InnoDB</code> Performance Tuning Tips</h4>
</div>
</div>
</div>
<p>
        With <code class="literal">InnoDB</code> becoming the default storage
        engine in MySQL 5.5 and higher, the tips and guidelines for
        <code class="literal">InnoDB</code> tables are now part of the main
        optimization chapter. See <a class="xref" href="optimization.html#optimizing-innodb" title="8.5. Optimizing for InnoDB Tables">Section 8.5, “Optimizing for <code class="literal">InnoDB</code> Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance"></a>14.2.4.2. <code class="literal">InnoDB</code> Performance and Scalability Enhancements</h4>

</div>

</div>

</div>
<p>
    This section summarizes the major InnoDB features and enhancements
    for performance and scalability. This information is useful to any
    DBA or developer who is concerned with performance and scalability.
    Although some of the enhancements do not require any action on your
    part, knowing this information can still help you diagnose
    performance issues more quickly and modernize systems and
    applications that rely on older, inefficient behavior.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-overview"></a>14.2.4.2.1. Overview of InnoDB Performance</h5>
</div>
</div>
</div>
<p>
      InnoDB has always been highly efficient, and includes several
      unique architectural elements to assure high performance and
      scalability. The latest InnoDB storage engine includes new
      features that take advantage of advances in operating systems and
      hardware platforms, such as multi-core processors and improved
      memory allocation systems. In addition, new configuration options
      let you better control some InnoDB internal subsystems to achieve
      the best performance with your workload.
    </p><p>
      Starting with MySQL 5.5 and InnoDB 1.1, the built-in InnoDB
      storage engine within MySQL is upgraded to the full feature set
      and performance of the former InnoDB Plugin. This change makes
      these performance and scalability enhancements available to a much
      wider audience than before, and eliminates the separate
      installation step of the InnoDB Plugin. After learning about the
      InnoDB performance features in this section, continue with
      <a class="xref" href="optimization.html" title="Chapter 8. Optimization">Chapter 8, <i>Optimization</i></a> to learn the best practices for
      overall MySQL performance, and <a class="xref" href="optimization.html#optimizing-innodb" title="8.5. Optimizing for InnoDB Tables">Section 8.5, “Optimizing for <code class="literal">InnoDB</code> Tables”</a>
      in particular for InnoDB tips and guidelines.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-compression-oltp"></a>14.2.4.2.2. Compression Enhancements for OLTP Workloads</h5>

</div>

</div>

</div>
<p>
      Traditionally, the <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> feature was
      recommended primarily for read-only or read-mostly
      <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, such as in a
      <a class="link" href="glossary.html#glos_data_warehouse" title="data warehouse">data warehouse</a>
      configuration. The rise of <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a>
      storage devices, which are fast but relatively small and
      expensive, makes compression attractive also for
      <code class="literal">OLTP</code> workloads: high-traffic, interactive web
      sites can reduce their storage requirements and their I/O
      operations per second (<a class="link" href="glossary.html#glos_iops" title="IOPS">IOPS</a>) by
      using compressed tables with applications that do frequent
      <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
      <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations.
    </p><p>
      New configuration options in MySQL 5.6 let you adjust the way
      compression works for a particular MySQL instance, with an
      emphasis on performance and scalability for write-intensive
      operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_compression_level"><code class="literal">innodb_compression_level</code></a> lets
          you turn the degree of compression up or down. A higher value
          lets you fit more data onto a storage device, at the expense
          of more CPU overhead during compression. A lower value lets
          you reduce CPU overhead when storage space is not critical, or
          you expect the data is not especially compressible.
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>
          specifies a cutoff point for
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a> during updates to a compressed table. When
          this threshold is passed, MySQL begins to leave additional
          free space within each new compressed page, dynamically
          adjusting the amount of free space up to the percentage of
          page size specified by
          <a class="link" href="storage-engines.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
          lets you adjust the maximum amount of space reserved within
          each <a class="link" href="glossary.html#glos_page" title="page">page</a> to record changes
          to compressed rows, without needing to compress the entire
          page again. The higher the value, the more changes can be
          recorded without recompressing the page. MySQL uses a variable
          amount of free space for the pages within each compressed
          table, only when a designated percentage of compression
          operations
          <span class="quote">“<span class="quote"><a class="link" href="glossary.html#glos_compression_failure" title="compression failure">fail</a></span>”</span>
          at runtime, requiring an expensive operation to split the
          compressed page.
</p></li></ul>
</div>
<p>
      Because working with compressed data sometimes involves keeping
      both compressed and uncompressed versions of a page in memory at
      the same time, when using compression with an OLTP-style workload,
      be prepared to increase the value of the
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
      configuration option.
    </p><p>
      For more information on MySQL data compression, see
      <a class="xref" href="server-administration.html#innodb-compression" title="5.4.6. Working with InnoDB Compressed Tables">Section 5.4.6, “Working with <code class="literal">InnoDB</code> Compressed Tables”</a>. For the performance aspects,
      especially see the section
      <a class="xref" href="server-administration.html#innodb-compression-tuning" title="5.4.6.3. Tuning Compression for InnoDB Tables">Section 5.4.6.3, “Tuning Compression for InnoDB Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-ro-txn"></a>14.2.4.2.3. Optimizations for Read-Only Transactions</h5>

</div>

</div>

</div>
<p>
      When a transaction is known to be read-only,
      <code class="literal">InnoDB</code> can avoid the overhead associated with
      setting up the <a class="link" href="glossary.html#glos_transaction_id" title="transaction ID">transaction
      ID</a> (<code class="literal">TRX_ID</code> field). The transaction ID is
      only needed for a
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a> that might
      perform write operations or
      <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking reads</a> such as
      <code class="literal">SELECT ... FOR UPDATE</code>. Eliminating these
      unnecessary transaction IDs reduces the size of internal data
      structures that are consulted each time a query or DML statement
      constructs a <a class="link" href="glossary.html#glos_read_view" title="read view">read view</a>.
    </p><p>
      Currently, <code class="literal">InnoDB</code> detects the read-only nature
      of the transaction and applies this optimization when any of the
      following conditions are met:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The transaction is started with the
          <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START TRANSACTION READ
          ONLY</code></a> statement. In this case, attempting to make any
          changes to the database (for <code class="literal">InnoDB</code>,
          <code class="literal">MyISAM</code>, or other types of tables) causes an
          error, and the transaction continues in read-only state:
        </p><pre class="programlisting">ERROR 1792 (25006): Cannot execute statement in a READ ONLY transaction.</pre><p>
          You can still make changes to session-specific temporary
          tables in a read-only transaction, or issue locking queries
          for them, because those changes and locks are not visible to
          any other transaction.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> setting
          is turned on, so that the transaction is guaranteed to be a
          single statement, and the single statement making up the
          transaction is a <span class="quote">“<span class="quote">non-locking</span>”</span>
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement. That is, a
          <code class="literal">SELECT</code> that does not use a <code class="literal">FOR
          UPDATE</code> or <code class="literal">LOCK IN SHARED MODE</code>
          clause.
</p></li></ul>
</div>
<p>
      Thus, for a read-intensive application such as a report generator,
      you can tune a sequence of <code class="literal">InnoDB</code> queries by
      grouping them inside <code class="literal">START TRANSACTION READ
      ONLY</code> and <code class="literal">COMMIT</code>, or by turning on the
      <code class="literal">autocommit</code> setting before running the
      <code class="literal">SELECT</code> statements, or simply by avoiding any
      <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements interspersed with
      the queries.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
        Transactions that qualify as auto-commit, non-locking, and
        read-only (AC-NL-RO) are kept out of certain internal
        <code class="literal">InnoDB</code> data structures and are therefore not
        listed in <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW
        ENGINE INNODB STATUS</code></a> output. These transactions are
        only visible in the Information Schema.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-undo-tablespace"></a>14.2.4.2.4. Separate Tablespaces for InnoDB Undo Logs</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84219568"></a><a class="indexterm" name="idp84220640"></a><p>
      This feature allows you to store the <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo log</a> in one or more
      separate
      <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a> outside
      of the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a>. The I/O patterns for the undo log make these
      tablespaces good candidates to move to
      <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage, while keeping the
      system tablespace on hard disk storage. Users cannot drop the
      separate tablespaces created to hold <code class="literal">InnoDB</code>
      undo logs, or the individual
      <a class="link" href="glossary.html#glos_segment" title="segment">segments</a> inside those
      tablespaces.
    </p><p>
      Because these files handle I/O operations formerly done inside the
      system tablespace, we broaden the definition of system tablespace
      to include these new files.
    </p><p>
      The undo logs are also known as the
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>.
    </p><p>
      This feature involves the following new or renamed configuration
      options:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>.
        </p></li><li class="listitem"><p>
          <code class="literal">innodb_rollback_segments</code> becomes
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>. The old
          name is still available for compatibility.
</p></li></ul>
</div>
<p>
      Because the <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo log</a> feature involves
      setting two non-dynamic startup variables
      (<a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> and
      <a class="link" href="storage-engines.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>),
      this feature can only be enabled when initializing a MySQL
      instance.
    </p><h6><a name="idp84239408"></a>
      Usage Notes
    </h6><p>
      To use this feature, follow these steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Decide on a path on a fast storage device to hold the undo
          logs. You will specify that path as the argument to the
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> option
          in your MySQL configuration file or startup script.
        </p></li><li class="listitem"><p>
          Decide on a non-zero starting value for the
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> option. You
          can start with a relatively low value and increase it over
          time to examine the effect on performance.
        </p></li><li class="listitem"><p>
          Decide on a non-zero value for the
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          option. The multiple undo logs specified by the
          <code class="literal">innodb_undo_logs</code> value are divided between
          this number of separate tablespaces (represented by
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code></a>
          files). This value is fixed for the life of the MySQL
          instance, so if you are uncertain about the optimal value,
          estimate on the high side.
        </p></li><li class="listitem"><p>
          Create a new MySQL instance, using the values you chose in the
          configuration file or in your MySQL startup script. Use a
          realistic workload with data volume similar to your production
          servers. Alternatively, use the transportable tablespaces
          feature to copy existing database tables to your newly
          configured MySQL instance. See
          <a class="xref" href="server-administration.html#tablespace-copying" title="5.4.1.3. Copying Tablespaces to Another Server (Transportable Tablespaces)">Section 5.4.1.3, “Copying Tablespaces to Another Server (Transportable Tablespaces)”</a> for more information.
        </p></li><li class="listitem"><p>
          Benchmark the performance of I/O intensive workloads.
        </p></li><li class="listitem"><p>
          Periodically increase the value of
          <code class="literal">innodb_undo_logs</code> and re-do the performance
          tests. Find the value where you stop experiencing gains in I/O
          performance.
        </p></li><li class="listitem"><p>
          Deploy a new production instance using the ideal settings for
          these options. Set it up as a
          <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave</a> server in a
          <a class="link" href="glossary.html#glos_replication" title="replication">replication</a>
          configuration, or transfer data from an earlier production
          instance.
</p></li></ol>
</div>
<h6><a name="idp84255456"></a>
      Performance and Scalability Considerations
    </h6><p>
      Keeping the undo logs in separate files allows the MySQL team to
      implement I/O and memory optimizations related to this
      transactional data. For example, because the undo data is written
      to disk and then rarely used (only in case of crash recovery), it
      does not need to be kept in the filesystem memory cache, in turn
      allowing a higher percentage of system memory to be devoted to the
      <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
      pool</a>.
    </p><p>
      The typical SSD best practice of keeping the
      <code class="literal">InnoDB</code> system tablespace on a hard drive and
      moving the per-table tablespaces to SSD, is assisted by moving the
      undo information into separate tablespace files.
    </p><h6><a name="idp84259488"></a>
      Internals
    </h6><p>
      The physical tablespace files are named
      <code class="filename">undo<em class="replaceable"><code>N</code></em></code>, where
      <em class="replaceable"><code>N</code></em> is the space ID, including leading
      zeros.
    </p><p>
      Currently, MySQL instances containing separate undo tablespaces
      cannot be downgraded to earlier releases such as MySQL 5.5 or 5.1.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-fast-file-extension"></a>14.2.4.2.5. Faster Extension for InnoDB Data Files</h5>

</div>

</div>

</div>
<p>
      The benefits of the <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a> setting
      come with the tradeoff that each
      <code class="filename"><a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a></code>
      file is extended as the data inside the table grows. This I/O
      operation can be a bottleneck for busy systems with many
      <code class="literal">InnoDB</code> tables. When all
      <code class="literal">InnoDB</code> tables are stored inside the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>,
      this extension operation happens less frequently, as space freed
      by <code class="literal">DELETE</code> or <code class="literal">TRUNCATE</code>
      operations within one table can be reused by another table.
    </p><p>
      MySQL 5.6 improves the concurrency of the extension operation, so
      that multiple <code class="filename">.ibd</code> files can be extended
      simultaneously, and this operation does not block read or write
      operations performed by other threads.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-nonrecur-deadlock"></a>14.2.4.2.6. Non-Recursive Deadlock Detection</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84272736"></a><p>
      The code that detects
      <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> in
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> has been
      modified to use a fixed-size work area rather than a recursive
      algorithm. The resulting detection operation is faster as a
      result. You do not need to do anything to take advantage of this
      enhancement.
    </p><p>
      Under both the old and new detection mechanisms, you might
      encounter a <code class="literal">search too deep</code> error that is not a
      true deadlock, but requires you to re-try the transaction the same
      way as with a deadlock.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-crc32-checksum"></a>14.2.4.2.7. Fast CRC32 Checksum Algorithm</h5>

</div>

</div>

</div>
<p>
      You can enable the configuration option
      <a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm=crc32</code></a>
      configuration setting to change the
      <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> algorithm to a
      faster one that scans the block 32 bits at a time rather than 8
      bits at a time. When the CRC32 algorithm is enabled, data blocks
      that are written to disk by <code class="literal">InnoDB</code> contain
      different values in their checksum fields than before. This
      process could be gradual, with a mix of old and new checksum
      values within the same table or database.
    </p><p>
      For maximum downward compatibility, this setting is off by
      default:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Current versions of
          <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="24.2. MySQL Enterprise Backup">MySQL Enterprise
          Backup</a> (up to 3.8.0) do not support backing up
          tablespaces that use crc32 checksums.
        </p></li><li class="listitem"><p>
          <code class="literal">.ibd</code> files containing crc32 checksums could
          cause problems downgrading to MySQL versions prior to 5.6.3.
          MySQL 5.6.3 and up recognizes either the new or old checksum
          values for the block as correct when reading the block from
          disk, ensuring that data blocks are compatible during upgrade
          and downgrade regardless of the algorithm setting. If data
          written with new checksum values is processed by an level of
          MySQL earlier than 5.6.3, it could be reported as corrupted.
</p></li></ul>
</div>
<p>
      When you set up a new MySQL instance, and can be sure that all the
      <code class="literal">InnoDB</code> data is created using the CRC32 checksum
      algorithm, you can use the setting
      <a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm=strict_crc32</code></a>,
      which can be faster than the <code class="literal">crc32</code> setting
      because it does not do the extra checksum calculations to support
      both old and new values.
    </p><p>
      The <a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>
      option has other values that allow it to replace the
      <a class="link" href="storage-engines.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a> option.
      <code class="literal">innodb_checksum_algorithm=none</code> is the same as
      <code class="literal">innodb_checksums=OFF</code>.
      <code class="literal">innodb_checksum_algorithm=innodb</code> is the same as
      <code class="literal">innodb_checksums=ON</code>. To avoid conflicts, remove
      references to <code class="literal">innodb_checksums</code> from your
      configuration file and MySQL startup scripts. The new option also
      accepts values <code class="literal">strict_none</code> and
      <code class="literal">strict_innodb</code>, again offering better
      performance in situations where all <code class="literal">InnoDB</code> data
      in an instance is created with the same checksum algorithm.
    </p><p>
      The following table illustrates the difference between the
      <code class="literal">none</code>, <code class="literal">innodb</code>, and
      <code class="literal">crc32</code> option values, and their
      <code class="literal">strict_</code> counterparts. <code class="literal">none</code>,
      <code class="literal">innodb</code>, and <code class="literal">crc32</code> write the
      specified type checksum value into each data block, but for
      compatibility accept any of the other checksum values when
      verifying a block during a read operation. The
      <code class="literal">strict_</code> form of each parameter only recognizes
      one kind of checksum, which makes verification faster but requires
      that all <code class="literal">InnoDB</code> data files in an instance be
      created under the identical
      <code class="literal">innodb_checksum_algorithm</code> value.
</p>
<div class="table">
<a name="idp84305920"></a><p class="title"><b>Table 14.3. Allowed Settings for <code class="literal">innodb_checksum_algorithm</code></b></p>
<div class="table-contents">
<table summary="Allowed Settings for innodb_checksum_algorithm" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Generated checksum (when writing)</th><th scope="col">Allowed checksums (when reading)</th></tr></thead><tbody><tr><td scope="row">none</td><td>A constant number.</td><td>Any of the checksums generated by <code class="literal">none</code>,
              <code class="literal">innodb</code>, or <code class="literal">crc32</code>.</td></tr><tr><td scope="row">innodb</td><td>A checksum calculated in software, using the original algorithm from
              <code class="literal">InnoDB</code>.</td><td>Any of the checksums generated by <code class="literal">none</code>,
              <code class="literal">innodb</code>, or <code class="literal">crc32</code>.</td></tr><tr><td scope="row">crc32</td><td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
              possibly done with a hardware assist.</td><td>Any of the checksums generated by <code class="literal">none</code>,
              <code class="literal">innodb</code>, or <code class="literal">crc32</code>.</td></tr><tr><td scope="row">strict_none</td><td>A constant number</td><td>Only the checksum generated by <code class="literal">none</code>.</td></tr><tr><td scope="row">strict_innodb</td><td>A checksum calculated in software, using the original algorithm from
              <code class="literal">InnoDB</code>.</td><td>Only the checksum generated by <code class="literal">innodb</code>.</td></tr><tr><td scope="row">strict_crc32</td><td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
possibly done with a hardware assist.</td><td>Only the checksum generated by <code class="literal">crc32</code>.</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-preload-buffer-pool"></a>14.2.4.2.8. Faster Restart by Preloading the InnoDB Buffer Pool</h5>

</div>

</div>

</div>
<p>
      After you restart a busy server, there is typically a
      <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmup</a> period with steadily
      increasing throughput, as disk pages that were in the
      <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
      pool</a> are brought back into memory as the same data is
      queried, updated, and so on. Once the buffer pool holds a similar
      set of pages as before the restart, many operations are performed
      in memory rather than involving disk I/O, and throughput
      stabilizes at a high level.
    </p><p>
      This feature shortens the warmup period by immediately reloading
      disk pages that were in the buffer pool before the restart, rather
      than waiting for DML operations to access the corresponding rows.
      The I/O requests can be performed in large batches, making the
      overall I/O faster. The page loading happens in the background,
      and does not delay the database startup.
    </p><p>
      In addition to saving the buffer pool state at shutdown and
      restoring it at startup, you can also save or restore the state at
      any time. For example, you might save the state of the buffer pool
      after reaching a stable throughput under a steady workload. You
      might restore the previous buffer pool state after running reports
      or maintenance jobs that bring data pages into the buffer pool
      that are only needed during the time period for those operations,
      or after some other period with a non-typical workload.
    </p><p>
      Although the buffer pool itself could be many gigabytes in size,
      the data that <code class="literal">InnoDB</code> saves on disk to restore
      the buffer pool is tiny by comparison: just the tablespace and
      page IDs necessary to locate the appropriate pages on disk. This
      information is derived from the
      <code class="literal">information_schema</code> table
      <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="20.30.17. The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">innodb_buffer_page_lru</code></a>.
    </p><p>
      Because the data is cached in and aged out of the buffer pool the
      same as with regular database operations, there is no problem if
      the disk pages were updated recently, or if a DML operation
      involves data that has not yet been loaded. The loading mechanism
      skips any requested pages that no longer exist.
    </p><p>
      This feature involves the configuration variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_now"><code class="literal">innodb_buffer_pool_dump_now</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_filename"><code class="literal">innodb_buffer_pool_filename</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_abort"><code class="literal">innodb_buffer_pool_load_abort</code></a>
</p></li></ul>
</div>
<p>
      and the status variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_dump_status"><code class="literal">Innodb_buffer_pool_dump_status</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_load_status"><code class="literal">Innodb_buffer_pool_load_status</code></a>
</p></li></ul>
</div>
<p>
      To save the current state of the <code class="literal">InnoDB</code> buffer
      pool, issue the statement:
    </p><pre class="programlisting">SET innodb_buffer_pool_dump_now=ON;</pre><p>
      The underlying mechanism involves a background thread that is
      dispatched to perform the dump and load operations.
    </p><p>
      By default, the buffer pool state is saved in a file
      <code class="filename">ib_buffer_pool</code> in the
      <code class="literal">InnoDB</code> data directory.
    </p><p>
      Disk pages from compressed tables are loaded into the buffer pool
      in their compressed form. Uncompression happens as usual when the
      page contents are accessed in the course of DML operations.
      Because decompression is a CPU-intensive process, it is more
      efficient for concurrency to perform that operation in one of the
      connection threads rather than the single thread that performs the
      buffer pool restore operation.
</p>
<div class="example">
<a name="innodb-dump-restore-bp"></a><p class="title"><b>Example 14.1. Examples of Dumping and Restoring the InnoDB Buffer Pool</b></p>
<div class="example-contents">
<p>
        Trigger a dump of the buffer pool manually:
      </p><pre class="programlisting">SET innodb_buffer_pool_dump_now=ON;</pre><p>
        Specify that a dump should be taken at shutdown:
      </p><pre class="programlisting">SET innodb_buffer_pool_dump_at_shutdown=ON;</pre><p>
        Specify that a dump should be loaded at startup:
      </p><pre class="programlisting">SET innodb_buffer_pool_load_at_startup=ON;</pre><p>
        Trigger a load of the buffer pool manually:
      </p><pre class="programlisting">SET innodb_buffer_pool_load_now=ON;</pre><p>
        Specify which filename to use for storing the dump to and
        loading the dump from:
      </p><pre class="programlisting">SET innodb_buffer_pool_filename='filename';</pre><p>
        Display progress of dump:
      </p><pre class="programlisting">SHOW STATUS LIKE 'innodb_buffer_pool_dump_status';</pre><p>
        or:
      </p><pre class="programlisting">SELECT variable_value FROM information_schema.global_status WHERE
variable_name = 'INNODB_BUFFER_POOL_DUMP_STATUS';</pre><p>
        Outputs any of: not started, Dumping buffer pool 5/7, page
        237/2873, Finished at 110505 12:18:02
      </p><p>
        Display progress of load:
      </p><pre class="programlisting">SHOW STATUS LIKE 'innodb_buffer_pool_load_status';</pre><p>
        or:
      </p><pre class="programlisting">SELECT variable_value FROM information_schema.global_status WHERE
variable_name = 'INNODB_BUFFER_POOL_LOAD_STATUS';</pre><p>
        Outputs any of: not started, Loaded 123/22301 pages, Finished at
        110505 12:23:24
      </p><p>
        Abort a buffer pool load:
</p><pre class="programlisting">SET innodb_buffer_pool_load_abort=ON;</pre>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-lru-background-flushing"></a>14.2.4.2.9. Improvements to Buffer Pool Flushing</h5>

</div>

</div>

</div>
<p>
      

      The new configuration options
      <a class="link" href="storage-engines.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a> and
      <a class="link" href="storage-engines.html#sysvar_innodb_lru_scan_depth"><code class="literal">innodb_lru_scan_depth</code></a> let you
      fine-tune certain aspects of the
      <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> process for the
      <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
      pool</a>. These options primarily help write-intensive
      <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>. With heavy
      <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> activity, flushing can fall
      behind if it is not aggressive enough, resulting in excessive
      memory use in the buffer pool; or, disk writes due to flushing can
      saturate your I/O capacity if that mechanism is too aggressive.
      The ideal settings depend on your workload, data access patterns,
      and storage configuration (for example, whether data is stored on
      <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> or
      <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> devices).
    </p><p>
      For systems with constant heavy
      <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, or workloads that
      fluctuate widely, several new configuration options let you
      fine-tune the <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> behavior
      for <code class="literal">InnoDB</code> tables:
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>, and
      <a class="link" href="storage-engines.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>. These
      options feed into an improved formula used by the
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a> option.
    </p><p>
      The existing
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> and
      <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
      options work as before, except that they are limited or extended
      by other options:
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a> and
      <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
          flushing</a> mechanism is not appropriate in all cases. It
          gives the most benefit when the
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> is in danger of
          filling up. The
          <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>
          option specifies a percentage of redo log capacity; when that
          threshold is crossed, <code class="literal">InnoDB</code> turns on
          adaptive flushing even if not specified by the
          <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
          option.
        </p></li><li class="listitem"><p>
          If flushing activity falls far behind,
          <code class="literal">InnoDB</code> can flush more aggressively than
          specified by
          <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>.
          <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
          represents an upper limit on the I/O capacity used in such
          emergency situations, so that the spike in I/O does not
          consume all the capacity of the server.
        </p></li><li class="listitem"><p>
          When the
          <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
          threshold is crossed, <code class="literal">InnoDB</code> can begin
          aggressively flushing pages to disk. The
          <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>
          option specifies a higher value at which
          <code class="literal">InnoDB</code> begins gently flushing pages,
          ideally preventing the percentage of dirty pages from reaching
          <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>. A
          value of
          <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm=0</code></a>
          disables this <span class="quote">“<span class="quote">preflushing</span>”</span> behavior.
</p></li></ul>
</div>
<p>
      All of these options are most applicable for servers running heavy
      workloads for long periods of time, when there is rarely enough
      idle time to catch up with changes waiting to be written to disk.
      The <a class="link" href="storage-engines.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>
      lets you distinguish between a server that is running at full
      capacity 24x7 and one that experiences periodic spikes in
      workload. For a server with a consistently high workload, keep
      this value high so that the adaptive flushing algorithm responds
      immediately to changes in the I/O rate. For a server that
      experiences peaks and troughs in its workload, keep this value low
      so that <code class="literal">InnoDB</code> does not overreact to sudden
      spikes in <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> activity.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats"></a>14.2.4.2.10. Persistent Optimizer Statistics for InnoDB Tables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84421184"></a><a class="indexterm" name="idp84422272"></a><a class="indexterm" name="idp84423360"></a><p>
      <a class="link" href="glossary.html#glos_plan_stability" title="plan stability">Plan stability</a> is a
      desirable goal for your biggest and most important queries. InnoDB
      has always computed statistics for each InnoDB table to help the
      optimizer find the most efficient
      <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query execution
      plan</a>. Now you can make these statistics persistent, so that
      the index usage and join order for a particular query is less
      likely to change.
    </p><p>
      This feature is on by default, enabled by the configuration option
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>.
    </p><p>
      You control how much sampling is done to collect the statistics by
      setting the configuration options
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
      and
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>.
    </p><p>
      The configuration option
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
      determines whether the statistics are calculated automatically
      whenever a table undergoes substantial changes (to more than 10%
      of the rows). If that setting is disabled, ensure the accuracy of
      optimizer statistics by issuing the <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
      TABLE</code></a> statement for each applicable table after creating
      an index or making substantial changes to indexed columns. You
      might run this statement in your setup scripts after
      representative data has been loaded into the table, and run it
      periodically after DML operations significantly change the
      contents of indexed columns, or on a schedule at times of low
      activity.

</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p xmlns="">
        To ensure statistics are gathered when a new index is created,
        either enable the
        <a class="link" href="storage-engines.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
        option, or run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
        after creating each new index when the persistent statistics
        mode is enabled.
</p>
</div>
<p>
      You can also set
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>, and
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
      options at the session level before creating a table, or use the
      <code class="literal">STATS_PERSISTENT</code>,
      <code class="literal">STATS_AUTO_RECALC</code>, and
      <code class="literal">STATS_SAMPLE_PAGES</code> clauses on the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, to override
      the system-wide setting and configure persistent statistics for
      individual tables.
    </p><p>
      Formerly, these statistics were cleared on each server restart and
      after some other operations, and recomputed when the table was
      next accessed. The statistics are computed using a random sampling
      technique that could produce different estimates the next time,
      leading to different choices in the execution plan and thus
      variations in query performance.
    </p><p>
      To revert to the previous method of collecting statistics that are
      periodically erased, run the command <code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em> STATS_PERSISTENT=0</code>.
    </p><p>
      The persistent statistics feature relies on the internally managed
      tables in the <code class="literal">mysql</code> database, named
      <code class="literal">innodb_table_stats</code> and
      <code class="literal">innodb_index_stats</code>. These tables are set up
      automatically in all install, upgrade, and build-from-source
      procedures.
    </p><p>
      The <code class="literal">innodb_table_stats</code> and
      <code class="literal">innodb_index_stats</code> tables both include a
      <code class="literal">last_update</code> column showing when index
      statistics were last updated, as shown in the following example:
    </p><pre class="programlisting">mysql&gt; select * from INNODB_TABLE_STATS \G
*************************** 1. row ***************************
           database_name: sakila
              table_name: actor
             last_update: 2013-05-28 16:16:44
                  n_rows: 200
    clustered_index_size: 1
sum_of_other_index_sizes: 1
...</pre><pre class="programlisting">mysql&gt; select * from INNODB_INDEX_STATS \G
*************************** 1. row ***************************
   database_name: sakila
      table_name: actor
      index_name: PRIMARY
     last_update: 2013-05-28 16:16:44
       stat_name: n_diff_pfx01
      stat_value: 200
     sample_size: 1
     ...</pre><p>
      If you manually update the statistics in the tables during
      troubleshooting or tuning, issue the command <code class="literal">FLUSH TABLE
      <em class="replaceable"><code>tbl_name</code></em></code> to make MySQL reload
      the updated statistics.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-latching"></a>14.2.4.2.11. Faster Locking for Improved Scalability</h5>

</div>

</div>

</div>
<p>
      In MySQL and InnoDB, multiple threads of execution access shared
      data structures. InnoDB synchronizes these accesses with its own
      implementation of <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a> and
      <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">read/write locks</a>. InnoDB has
      historically protected the internal state of a read/write lock
      with an InnoDB mutex. On Unix and Linux platforms, the internal
      state of an InnoDB mutex is protected by a
      <a class="link" href="glossary.html#glos_pthreads" title="Pthreads">Pthreads</a> mutex, as in
      IEEE Std 1003.1c (POSIX.1c).
    </p><p>
      On many platforms, there is a more efficient way to implement
      mutexes and read/write locks.
      <a class="link" href="glossary.html#glos_atomic" title="atomic">Atomic</a> operations can often be
      used to synchronize the actions of multiple threads more
      efficiently than Pthreads. Each operation to acquire or release a
      lock can be done in fewer CPU instructions, and thus result in
      less wasted time when threads are contending for access to shared
      data structures. This in turn means greater scalability on
      multi-core platforms.
    </p><p>
      InnoDB implements mutexes and read/write locks with the
      <a class="ulink" href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a> instead of using the Pthreads approach
      previously used. More specifically, an InnoDB that is compiled
      with GCC version 4.1.2 or later uses the atomic builtins instead
      of a <code class="literal">pthread_mutex_t</code> to implement InnoDB
      mutexes and read/write locks.
    </p><p>
      On 32-bit Microsoft Windows, InnoDB has implemented mutexes (but
      not read/write locks) with hand-written assembler instructions.
      Beginning with Microsoft Windows 2000, functions for
      <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ms684122(VS.85).aspx" target="_top">Interlocked
      Variable Access</a> are available that are similar to the
      built-in functions provided by GCC. On Windows 2000 and higher,
      InnoDB makes use of the Interlocked functions. Unlike the old
      hand-written assembler code, the new implementation supports
      read/write locks and 64-bit platforms.
    </p><p>
      Solaris 10 introduced library functions for atomic operations, and
      InnoDB uses these functions by default. When MySQL is compiled on
      Solaris 10 with a compiler that does not support the
      <a class="ulink" href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a>, InnoDB uses the library functions.
    </p><p>
      This change improves the scalability of InnoDB on multi-core
      systems. This feature is enabled out-of-the-box on the platforms
      where it is supported. You do not have to set any parameter or
      option to take advantage of the improved performance. On platforms
      where the GCC, Windows, or Solaris functions for atomic memory
      access are not available, InnoDB uses the traditional Pthreads
      method of implementing mutexes and read/write locks.
    </p><p>
      When MySQL starts, InnoDB writes a message to the log file
      indicating whether atomic memory access is used for mutexes, for
      mutexes and read/write locks, or neither. If suitable tools are
      used to build InnoDB and the target CPU supports the atomic
      operations required, InnoDB uses the built-in functions for
      mutexing. If, in addition, the compare-and-swap operation can be
      used on thread identifiers (<code class="literal">pthread_t</code>), then
      InnoDB uses the instructions for read-write locks as well.
    </p><p>
      Note: If you are building from source, ensure that the build
      process properly takes advantage of your platform capabilities.

      

    </p><p>
      For more information about the performance implications of
      locking, see <a class="xref" href="optimization.html#locking-issues" title="8.10. Optimizing Locking Operations">Section 8.10, “Optimizing Locking Operations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-use_sys_malloc"></a>14.2.4.2.12. Using Operating System Memory Allocators</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84474032"></a><a class="indexterm" name="idp84475120"></a><a class="indexterm" name="idp84476608"></a><a class="indexterm" name="idp84478112"></a><a class="indexterm" name="idp84479600"></a><a class="indexterm" name="idp84481136"></a><p>
      When InnoDB was developed, the memory allocators supplied with
      operating systems and run-time libraries were often lacking in
      performance and scalability. At that time, there were no memory
      allocator libraries tuned for multi-core CPUs. Therefore, InnoDB
      implemented its own memory allocator in the <code class="literal">mem</code>
      subsystem. This allocator is guarded by a single mutex, which may
      become a <a class="link" href="glossary.html#glos_bottleneck" title="bottleneck">bottleneck</a>. InnoDB
      also implements a wrapper interface around the system allocator
      (<code class="literal">malloc</code> and <code class="literal">free</code>) that is
      likewise guarded by a single mutex.
    </p><p>
      Today, as multi-core systems have become more widely available,
      and as operating systems have matured, significant improvements
      have been made in the memory allocators provided with operating
      systems. New memory allocators perform better and are more
      scalable than they were in the past. The leading high-performance
      memory allocators include <code class="literal">Hoard</code>,
      <code class="literal">libumem</code>, <code class="literal">mtmalloc</code>,
      <code class="literal">ptmalloc</code>, <code class="literal">tbbmalloc</code>, and
      <code class="literal">TCMalloc</code>. Most workloads, especially those
      where memory is frequently allocated and released (such as
      multi-table joins), benefit from using a more highly tuned memory
      allocator as opposed to the internal, InnoDB-specific memory
      allocator.
    </p><p>
      You can control whether InnoDB uses its own memory allocator or an
      allocator of the operating system, by setting the value of the
      system configuration parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> in the
      MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>). If set to <code class="literal">ON</code> or
      <code class="literal">1</code> (the default), InnoDB uses the
      <code class="literal">malloc</code> and <code class="literal">free</code> functions of
      the underlying system rather than manage memory pools itself. This
      parameter is not dynamic, and takes effect only when the system is
      started. To continue to use the InnoDB memory allocator, set
      <a class="link" href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> to
      <code class="literal">0</code>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
        When the InnoDB memory allocator is disabled, InnoDB ignores the
        value of the parameter
        <a class="link" href="storage-engines.html#sysvar_innodb_additional_mem_pool_size"><code class="literal">innodb_additional_mem_pool_size</code></a>.
        The InnoDB memory allocator uses an additional memory pool for
        satisfying allocation requests without having to fall back to
        the system memory allocator. When the InnoDB memory allocator is
        disabled, all such allocation requests are fulfilled by the
        system memory allocator.
      </p><p xmlns="">
        On Unix-like systems that use dynamic linking, replacing the
        memory allocator may be as easy as making the environment
        variable <code class="literal">LD_PRELOAD</code> or
        <code class="literal">LD_LIBRARY_PATH</code> point to the dynamic library
        that implements the allocator. On other systems, some relinking
        may be necessary. Please refer to the documentation of the
        memory allocator library of your choice.
      </p><p xmlns="">
        Since InnoDB cannot track all memory use when the system memory
        allocator is used
        (<a class="link" href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
        <code class="literal">ON</code>), the section <span class="quote">“<span class="quote">BUFFER POOL AND
        MEMORY</span>”</span> in the output of the <code class="literal">SHOW ENGINE INNODB
        STATUS</code> command only includes the buffer pool
        statistics in the <span class="quote">“<span class="quote">Total memory allocated</span>”</span>. Any
        memory allocated using the <code class="literal">mem</code> subsystem or
        using <code class="literal">ut_malloc</code> is excluded.
</p>
</div>
<p>
      For more information about the performance implications of InnoDB
      memory usage, see <a class="xref" href="optimization.html#buffering-caching" title="8.9. Buffering and Caching">Section 8.9, “Buffering and Caching”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-change_buffering"></a>14.2.4.2.13. Controlling InnoDB Change Buffering</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84510944"></a><a class="indexterm" name="idp84512016"></a><a class="indexterm" name="idp84513504"></a><a class="indexterm" name="idp84514992"></a><p>
      When <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and
      <code class="literal">DELETE</code> operations are done to a table, often
      the values of indexed columns (particularly the values of
      secondary keys) are not in sorted order, requiring substantial I/O
      to bring secondary indexes up to date. InnoDB has an
      <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert buffer</a> that
      caches changes to secondary index entries when the relevant
      <a class="link" href="glossary.html#glos_page" title="page">page</a> is not in the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, thus
      avoiding I/O operations by not reading in the page from the disk.
      The buffered changes are merged when the page is loaded to the
      buffer pool, and the updated page is later flushed to disk using
      the normal mechanism. The InnoDB main thread merges buffered
      changes when the server is nearly idle, and during a
      <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      Because it can result in fewer disk reads and writes, this feature
      is most valuable for workloads that are I/O-bound, for example
      applications with a high volume of DML operations such as bulk
      inserts.
    </p><p>
      However, the insert buffer occupies a part of the buffer pool,
      reducing the memory available to cache data pages. If the working
      set almost fits in the buffer pool, or if your tables have
      relatively few secondary indexes, it may be useful to disable
      insert buffering. If the working set entirely fits in the buffer
      pool, insert buffering does not impose any extra overhead, because
      it only applies to pages that are not in the buffer pool.
    </p><p>
      You can control the extent to which InnoDB performs insert
      buffering with the system configuration parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>. You can
      turn on and off buffering for inserts, delete operations (when
      index records are initially marked for deletion) and purge
      operations (when index records are physically deleted). An update
      operation is represented as a combination of an insert and a
      delete. In MySQL 5.5 and higher, the default value is changed from
      <code class="literal">inserts</code> to <code class="literal">all</code>.
    </p><p>
      The allowed values of
      <a class="link" href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
      are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">all</code></strong></span>
        </p><p>
          The default value: buffer inserts, delete-marking operations,
          and purges.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">none</code></strong></span>
        </p><p>
          Do not buffer any operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">inserts</code></strong></span>
        </p><p>
          Buffer insert operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">deletes</code></strong></span>
        </p><p>
          Buffer delete-marking operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">changes</code></strong></span>
        </p><p>
          Buffer both inserts and delete-marking.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">purges</code></strong></span>
        </p><p>
          Buffer the physical deletion operations that happen in the
          background.
</p></li></ul>
</div>
<p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege. Changing
      the setting affects the buffering of new operations; the merging
      of already buffered entries is not affected.
    </p><p>
      For more information about speeding up <code class="literal">INSERT</code>,
      <code class="literal">UPDATE</code>, and <code class="literal">DELETE</code>
      statements, see <a class="xref" href="optimization.html#non-select-optimization" title="8.2.2. Optimizing DML Statements">Section 8.2.2, “Optimizing DML Statements”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-adaptive_hash_index"></a>14.2.4.2.14. Controlling Adaptive Hash Indexing</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84550576"></a><a class="indexterm" name="idp84551664"></a><a class="indexterm" name="idp84552736"></a><p>
      If a table fits almost entirely in main memory, the fastest way to
      perform queries on it is to use
      <a class="link" href="glossary.html#glos_hash_index" title="hash index">hash indexes</a> rather
      than <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> lookups. MySQL
      monitors searches on each index defined for an InnoDB table. If it
      notices that certain index values are being accessed frequently,
      it automatically builds an in-memory hash table for that index.
      See <a class="xref" href="storage-engines.html#innodb-adaptive-hash" title="14.2.3.12.6. Adaptive Hash Indexes">Section 14.2.3.12.6, “Adaptive Hash Indexes”</a> for background
      information and usage guidelines for the
      <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
      index</a> feature and the
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
      configuration option.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-thread_concurrency"></a>14.2.4.2.15. Changes Regarding Thread Concurrency</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84559792"></a><a class="indexterm" name="idp84560880"></a><a class="indexterm" name="idp84561968"></a><a class="indexterm" name="idp84563056"></a><a class="indexterm" name="idp84564560"></a><p>
      InnoDB uses operating system
      <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> to process requests
      from user transactions. (Transactions may issue many requests to
      InnoDB before they commit or roll back.) On modern operating
      systems and servers with multi-core processors, where context
      switching is efficient, most workloads run well without any limit
      on the number of concurrent threads. Scalability improvements in
      MySQL 5.5 and up reduce the need to limit the number of
      concurrently executing threads inside InnoDB.
    </p><p>
      In situations where it is helpful to minimize context switching
      between threads, InnoDB can use a number of techniques to limit
      the number of concurrently executing operating system threads (and
      thus the number of requests that are processed at any one time).
      When InnoDB receives a new request from a user session, if the
      number of threads concurrently executing is at a pre-defined
      limit, the new request sleeps for a short time before it tries
      again. A request that cannot be rescheduled after the sleep is put
      in a first-in/first-out queue and eventually is processed. Threads
      waiting for locks are not counted in the number of concurrently
      executing threads.
    </p><p>
      You can limit the number of concurrent threads by setting the
      configuration parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the number of executing threads reaches this limit,
      additional threads sleep for a number of microseconds, set by the
      configuration parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>,
      before being placed into the queue.
    </p><p>
      Previously, it required experimentation to find the optimal value
      for <code class="literal">innodb_thread_sleep_delay</code>, and the optimal
      value could change depending on the workload. In MySQL 5.6.3 and
      higher, you can set the configuration option
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
      to the highest value you would allow for
      <code class="literal">innodb_thread_sleep_delay</code>, and InnoDB
      automatically adjusts <code class="literal">innodb_thread_sleep_delay</code>
      up or down depending on the current thread-scheduling activity.
      This dynamic adjustment helps the thread scheduling mechanism to
      work smoothly during times when the system is lightly loaded and
      when it is operating near full capacity.
    </p><p>
      The default value for
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      and the implied default limit on the number of concurrent threads
      has been changed in various releases of MySQL and InnoDB.
      Currently, the default value of
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, so that by default there is no limit on the
      number of concurrently executing threads, as shown in
      <a class="xref" href="storage-engines.html#innodb-thread-concurrency-table" title="Table 14.4. Changes to innodb_thread_concurrency">Table 14.4, “Changes to <code class="literal">innodb_thread_concurrency</code>”</a>.
</p>
<div class="table">
<a name="innodb-thread-concurrency-table"></a><p class="title"><b>Table 14.4. Changes to <code class="literal">innodb_thread_concurrency</code></b></p>
<div class="table-contents">
<table summary="Changes to innodb_thread_concurrency" border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">InnoDB Version</th><th scope="col">MySQL Version</th><th scope="col">Default value</th><th scope="col">Default limit of concurrent threads</th><th scope="col">Value to allow unlimited threads</th></tr></thead><tbody><tr><td scope="row">Built-in</td><td>Earlier than 5.1.11</td><td>20</td><td>No limit</td><td>20 or higher</td></tr><tr><td scope="row">Built-in</td><td>5.1.11 and newer</td><td>8</td><td>8</td><td>0</td></tr><tr><td scope="row">InnoDB before 1.0.3</td><td>(corresponding to Plugin)</td><td>8</td><td>8</td><td>0</td></tr><tr><td scope="row">InnoDB 1.0.3 and newer</td><td>(corresponding to Plugin)</td><td>0</td><td>No limit</td><td>0</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      Note that InnoDB causes threads to sleep only when the number of
      concurrent threads is limited. When there is no limit on the
      number of threads, all contend equally to be scheduled. That is,
      if <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, the value of
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> is
      ignored.
    </p><p>
      When there is a limit on the number of threads, InnoDB reduces
      context switching overhead by permitting multiple requests made
      during the execution of a single SQL statement to enter InnoDB
      without observing the limit set by
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Since an SQL statement (such as a join) may comprise multiple row
      operations within InnoDB, InnoDB assigns <span class="quote">“<span class="quote">tickets</span>”</span>
      that allow a thread to be scheduled repeatedly with minimal
      overhead.
    </p><p>
      When a new SQL statement starts, a thread has no tickets, and it
      must observe
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the thread is entitled to enter InnoDB, it is assigned a
      number of tickets that it can use for subsequently entering
      InnoDB. If the tickets run out,
      <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      is observed again and further tickets are assigned. The number of
      tickets to assign is specified by the global option
      <a class="link" href="storage-engines.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
      which is 500 by default. A thread that is waiting for a lock is
      given one ticket once the lock becomes available.
    </p><p>
      The correct values of these variables depend on your environment
      and workload. Try a range of different values to determine what
      value works for your applications. Before limiting the number of
      concurrently executing threads, review configuration options that
      may improve the performance of InnoDB on multi-core and
      multi-processor computers, such as
      <a class="link" href="storage-engines.html#innodb-performance-use_sys_malloc" title="14.2.4.2.12. Using Operating System Memory Allocators">innodb_use_sys_malloc</a>
      and
      <a class="link" href="storage-engines.html#innodb-performance-adaptive_hash_index" title="14.2.4.2.14. Controlling Adaptive Hash Indexing">innodb_adaptive_hash_index</a>.
    </p><p>
      For general performance information about MySQL thread handling,
      see <a class="xref" href="optimization.html#connection-threads" title="8.11.5.1. How MySQL Uses Threads for Client Connections">Section 8.11.5.1, “How MySQL Uses Threads for Client Connections”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-read_ahead"></a>14.2.4.2.16. Changes in the Read-Ahead Algorithm</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84612688"></a><a class="indexterm" name="idp84613776"></a><a class="indexterm" name="idp84615280"></a><a class="indexterm" name="idp84616768"></a><p>
      A <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> request is an
      I/O request to prefetch multiple pages in the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
      asynchronously, in anticipation that these pages will be needed
      soon. The requests bring in all the pages in one
      <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>. InnoDB uses two
      read-ahead algorithms to improve I/O performance:
    </p><p>
      <span class="strong"><strong>Linear</strong></span> read-ahead is a
      technique that predicts what pages might be needed soon based on
      pages in the buffer pool being accessed sequentially. You control
      when InnoDB performs a read-ahead operation by adjusting the
      number of sequential page accesses required to trigger an
      asynchronous read request, using the configuration parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>.
      Before this parameter was added, InnoDB would only calculate
      whether to issue an asynchronous prefetch request for the entire
      next extent when it read in the last page of the current extent.
    </p><p>
      The new configuration parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
      controls how sensitive InnoDB is in detecting patterns of
      sequential page access. If the number of pages read sequentially
      from an extent is greater than or equal to
      <a class="link" href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>,
      InnoDB initiates an asynchronous read-ahead operation of the
      entire following extent. It can be set to any value from 0-64. The
      default value is 56. The higher the value, the more strict the
      access pattern check. For example, if you set the value to 48,
      InnoDB triggers a linear read-ahead request only when 48 pages in
      the current extent have been accessed sequentially. If the value
      is 8, InnoDB would trigger an asynchronous read-ahead even if as
      few as 8 pages in the extent were accessed sequentially. You can
      set the value of this parameter in the MySQL
      <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration file</a>,
      or change it dynamically with the <code class="literal">SET GLOBAL</code>
      command, which requires the <code class="literal">SUPER</code> privilege.
    </p><p>
      <span class="strong"><strong>Random</strong></span> read-ahead is a
      technique that predicts when pages might be needed soon based on
      pages already in the buffer pool, regardless of the order in which
      those pages were read. If 13 consecutive pages from the same
      extent are found in the buffer pool, InnoDB asynchronously issues
      a request to prefetch the remaining pages of the extent. This
      feature was initially turned off in MySQL 5.5. It is available
      once again starting in MySQL 5.1.59 and 5.5.16 and higher, turned
      off by default. To enable this feature, set the configuration
      variable
      <a class="link" href="storage-engines.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>.
    </p><p>
      The <code class="literal">SHOW ENGINE INNODB STATUS</code> command displays
      statistics to help you evaluate the effectiveness of the
      read-ahead algorithm. With the return of random read-ahead in
      MySQL 5.6, the <code class="literal">SHOW ENGINE INNODB STATUS</code>
      command once again includes
      <code class="literal">Innodb_buffer_pool_read_ahead_rnd</code>.
      <code class="literal">Innodb_buffer_pool_read_ahead</code> keeps its current
      name. (In earlier releases, it was listed as
      <code class="literal">Innodb_buffer_pool_read_ahead_seq</code>.) See
      <a class="xref" href="storage-engines.html#innodb-other-changes-readahead-counters" title="14.2.5.11. More Read-Ahead Statistics">Section 14.2.5.11, “More Read-Ahead Statistics”</a> for more
      information.

      
    </p><p></p><p>
      For more information about I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a> and
      <a class="xref" href="optimization.html#disk-issues" title="8.11.3. Optimizing Disk I/O">Section 8.11.3, “Optimizing Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-multiple_io_threads"></a>14.2.4.2.17. Multiple Background InnoDB I/O Threads</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84640048"></a><a class="indexterm" name="idp84641120"></a><a class="indexterm" name="idp84642608"></a><a class="indexterm" name="idp84643680"></a><a class="indexterm" name="idp84645168"></a><a class="indexterm" name="idp84646656"></a><p>
      InnoDB uses background <a class="link" href="glossary.html#glos_thread" title="thread">threads</a>
      to service various types of I/O requests. You can configure the
      number of background threads that service read and write I/O on
      data pages, using the configuration parameters
      <a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a class="link" href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. These
      parameters signify the number of background threads used for read
      and write requests respectively. They are effective on all
      supported platforms. You can set the value of these parameters in
      the MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>); you cannot change them dynamically.
      The default value for these parameters is <code class="literal">4</code> and
      the permissible values range from <code class="literal">1-64</code>.
    </p><p>
      The purpose of this change is to make InnoDB more scalable on high
      end systems. Each background thread can handle up to 256 pending
      I/O requests. A major source of background I/O is the
      <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> requests. InnoDB
      tries to balance the load of incoming requests in such way that
      most of the background threads share work equally. InnoDB also
      attempts to allocate read requests from the same extent to the
      same thread to increase the chances of coalescing the requests
      together. If you have a high end I/O subsystem and you see more
      than 64 ×
      <a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> pending
      read requests in <code class="literal">SHOW ENGINE INNODB STATUS</code>, you
      might gain by increasing the value of
      <a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-aio-linux"></a>14.2.4.2.18. Asynchronous I/O on Linux</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84661152"></a><p>
      Starting in InnoDB 1.1 with MySQL 5.5, the
      <a class="link" href="glossary.html#glos_asynchronous_io" title="asynchronous I/O">asynchronous I/O</a>
      capability that InnoDB has had on Windows systems is now available
      on Linux systems. (Other Unix-like systems continue to use
      synchronous I/O calls.) This feature improves the scalability of
      heavily I/O-bound systems, which typically show many pending
      reads/writes in the output of the command <code class="literal">SHOW ENGINE
      INNODB STATUS\G</code>.
    </p><p>
      Running with a large number of <code class="literal">InnoDB</code> I/O
      threads, and especially running multiple such instances on the
      same server machine, can exceed capacity limits on Linux systems.
      In this case, you can fix the error:
    </p><pre class="programlisting">EAGAIN: The specified maxevents exceeds the user's limit of available events. </pre><p>
      by writing a higher limit to
      <code class="literal">/proc/sys/fs/aio-max-nr</code>.
    </p><p>
      In general, if a problem with the asynchronous I/O subsystem in
      the OS prevents InnoDB from starting, set the option
      <a class="link" href="storage-engines.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a> in the
      configuration file. This new configuration option applies to Linux
      systems only, and cannot be changed once the server is running.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-group_commit"></a>14.2.4.2.19. Group Commit</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84671376"></a><p>
      InnoDB, like any other
      <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a>-compliant database engine,
      flushes the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> of a
      transaction before it is committed. Historically, InnoDB used
      <a class="link" href="glossary.html#glos_group_commit" title="group commit">group commit</a>
      functionality to group multiple such flush requests together to
      avoid one flush for each commit. With group commit, InnoDB issues
      a single write to the log file to perform the commit action for
      multiple user transactions that commit at about the same time,
      significantly improving throughput.
    </p><p>
      Group commit in InnoDB worked until MySQL 4.x, and works once
      again with MySQL 5.1 with the InnoDB Plugin, and MySQL 5.5 and
      higher. The introduction of support for the distributed
      transactions and Two Phase Commit (2PC) in MySQL 5.0 interfered
      with the InnoDB group commit functionality. This issue is now
      resolved.
    </p><p>
      The group commit functionality inside InnoDB works with the Two
      Phase Commit protocol in MySQL. Re-enabling of the group commit
      functionality fully ensures that the ordering of commit in the
      MySQL binlog and the InnoDB logfile is the same as it was before.
      It means it is <span class="strong"><strong>totally safe to use the
      MySQL Enterprise Backup product with InnoDB 1.0.4</strong></span> (that
      is, the InnoDB Plugin with MySQL 5.1) and above. When the binlog
      is enabled, you typically also set the configuration option
      <code class="literal">sync_binlog=0</code>, because group commit for the
      binary log is only supported if it is set to 0.
    </p><p>
      Group commit is transparent; you do not need to do anything to
      take advantage of this significant performance improvement.
    </p><p>
      For more information about performance of
      <code class="literal">COMMIT</code> and other transactional operations, see
      <a class="xref" href="optimization.html#optimizing-innodb-transaction-management" title="8.5.2. Optimizing InnoDB Transaction Management">Section 8.5.2, “Optimizing <code class="literal">InnoDB</code> Transaction Management”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-thread_io_rate"></a>14.2.4.2.20. Controlling the InnoDB Master Thread I/O Rate</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84682080"></a><a class="indexterm" name="idp84683152"></a><a class="indexterm" name="idp84684640"></a><p>
      The <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a> in
      InnoDB is a thread that performs various tasks in the background.
      Most of these tasks are I/O related, such as flushing dirty pages
      from the buffer pool or writing changes from the insert buffer to
      the appropriate secondary indexes. The master thread attempts to
      perform these tasks in a way that does not adversely affect the
      normal working of the server. It tries to estimate the free I/O
      bandwidth available and tune its activities to take advantage of
      this free capacity. Historically, InnoDB has used a hard coded
      value of 100 IOPs (input/output operations per second) as the
      total I/O capacity of the server.
    </p><p>
      The parameter <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      indicates the overall I/O capacity available to InnoDB, per buffer
      pool instance. This parameter should be set to approximately the
      number of I/O operations that the system can perform per second.
      The value depends on your system configuration. When
      <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> is set, the
      master threads estimates the I/O bandwidth available for
      background tasks based on the set value. Setting the value to
      <code class="literal">100</code> reverts to the old behavior.
    </p><p>
      You can set the value of
      <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> to any
      number 100 or greater. The default value is
      <code class="literal">200</code>, reflecting that the performance of typical
      modern I/O devices is higher than in the early days of MySQL.
      Typically, values around the previous default of 100 are
      appropriate for consumer-level storage devices, such as hard
      drives up to 7200 RPMs. Faster hard drives, RAID configurations,
      and SSDs benefit from higher values.
    </p><p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege.
    </p><p>
      Formerly, the <code class="literal">InnoDB</code> master thread also
      performed any needed <a class="link" href="glossary.html#glos_purge" title="purge">purge</a>
      operations. In MySQL 5.6.5 and higher, those I/O operations are
      moved to other background threads, whose number is controlled by
      the <a class="link" href="storage-engines.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a>
      configuration option.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-adaptive_flushing"></a>14.2.4.2.21. Controlling the Flushing Rate of Dirty Pages from the InnoDB Buffer Pool</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84703888"></a><a class="indexterm" name="idp84704976"></a><a class="indexterm" name="idp84706480"></a><a class="indexterm" name="idp84707568"></a><a class="indexterm" name="idp84709088"></a><a class="indexterm" name="idp84710576"></a><p>
      InnoDB performs certain tasks in the background, including
      <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> of
      <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> (those
      pages that have been changed but are not yet written to the
      database files) from the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, a task
      performed by the <a class="link" href="glossary.html#glos_master_thread" title="master thread">master
      thread</a>. Currently, InnoDB aggressively flushes buffer pool
      pages if the percentage of dirty pages in the buffer pool exceeds
      <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>.
    </p><p>
      InnoDB uses a new algorithm to estimate the required rate of
      flushing, based on the speed of redo log generation and the
      current rate of flushing. The intent is to smooth overall
      performance by ensuring that buffer flush activity keeps up with
      the need to keep the buffer pool <span class="quote">“<span class="quote">clean</span>”</span>.
      Automatically adjusting the rate of flushing can help to avoid
      sudden dips in throughput, when excessive buffer pool flushing
      limits the I/O capacity available for ordinary read and write
      activity.
    </p><p>
      InnoDB uses its log files in a circular fashion. Before reusing a
      portion of a log file, InnoDB flushes to disk all dirty buffer
      pool pages whose redo entries are contained in that portion of the
      log file, a process known as a
      <a class="link" href="glossary.html#glos_sharp_checkpoint" title="sharp checkpoint">sharp checkpoint</a>. If
      a workload is write-intensive, it generates a lot of redo
      information, all written to the log file. If all available space
      in the log files is used up, a sharp checkpoint occurs, causing a
      temporary reduction in throughput. This situation can happen even
      though <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
      is not reached.
    </p><p>
      InnoDB uses a heuristic-based algorithm to avoid such a scenario,
      by measuring the number of dirty pages in the buffer pool and the
      rate at which redo is being generated. Based on these numbers,
      InnoDB decides how many dirty pages to flush from the buffer pool
      each second. This self-adapting algorithm is able to deal with
      sudden changes in the workload.
    </p><p>
      Internal benchmarking has also shown that this algorithm not only
      maintains throughput over time, but can also improve overall
      throughput significantly.
    </p><p>
      Because adaptive flushing is a new feature that can significantly
      affect the I/O pattern of a workload, a new configuration
      parameter lets you turn off this feature. The default value of the
      boolean parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a> is
      <code class="literal">TRUE</code>, enabling the new algorithm. You can set
      the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-pause_instruction"></a>14.2.4.2.22. Using the PAUSE Instruction in InnoDB Spin Loops</h5>

</div>

</div>

</div>
<p>
      Synchronization inside InnoDB frequently involves the use of
      <a class="link" href="glossary.html#glos_spin" title="spin">spin</a> loops: while waiting,
      InnoDB executes a tight loop of instructions repeatedly to avoid
      having the InnoDB <a class="link" href="glossary.html#glos_process" title="process">process</a> and
      <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> be rescheduled by the
      operating system. If the spin loops are executed too quickly,
      system resources are wasted, imposing a performance penalty on
      transaction throughput. Most modern processors implement the
      <code class="literal">PAUSE</code> instruction for use in spin loops, so the
      processor can be more efficient.
    </p><p>
      InnoDB uses a <code class="literal">PAUSE</code> instruction in its spin
      loops on all platforms where such an instruction is available.
      This technique increases overall performance with CPU-bound
      workloads, and has the added benefit of minimizing power
      consumption during the execution of the spin loops.
    </p><p>
      You do not have to do anything to take advantage of this
      performance improvement.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a class="xref" href="optimization.html#locking-issues" title="8.10. Optimizing Locking Operations">Section 8.10, “Optimizing Locking Operations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-spin_lock_polling"></a>14.2.4.2.23. Control of Spin Lock Polling</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84737472"></a><a class="indexterm" name="idp84738544"></a><p>
      Many InnoDB <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a> and
      <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">rw-locks</a> are reserved for a
      short time. On a multi-core system, it can be more efficient for a
      thread to continuously check if it can acquire a mutex or rw-lock
      for a while before sleeping. If the mutex or rw-lock becomes
      available during this polling period, the thread can continue
      immediately, in the same time slice. However, too-frequent polling
      by multiple threads of a shared object can cause <span class="quote">“<span class="quote">cache ping
      pong</span>”</span>, different processors invalidating portions of each
      others' cache. InnoDB minimizes this issue by waiting a random
      time between subsequent polls. The delay is implemented as a busy
      loop.
    </p><p>
      You can control the maximum delay between testing a mutex or
      rw-lock using the parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a>. The
      duration of the delay loop depends on the C compiler and the
      target processor. (In the 100MHz Pentium era, the unit of delay
      was one microsecond.) On a system where all processor cores share
      a fast cache memory, you might reduce the maximum delay or disable
      the busy loop altogether by setting
      <code class="literal">innodb_spin_wait_delay=0</code>. On a system with
      multiple processor chips, the effect of cache invalidation can be
      more significant and you might increase the maximum delay.
    </p><p>
      The default value of
      <a class="link" href="storage-engines.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> is
      <code class="literal">6</code>. The spin wait delay is a dynamic global
      parameter that you can specify in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      at runtime with the command <code class="literal">SET GLOBAL
      innodb_spin_wait_delay=<em class="replaceable"><code>delay</code></em></code>,
      where <code class="literal"><em class="replaceable"><code>delay</code></em></code> is the
      desired maximum delay. Changing the setting requires the
      <code class="literal">SUPER</code> privilege.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a class="xref" href="optimization.html#locking-issues" title="8.10. Optimizing Locking Operations">Section 8.10, “Optimizing Locking Operations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-midpoint_insertion"></a>14.2.4.2.24. Making the Buffer Pool Scan Resistant</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84755056"></a><a class="indexterm" name="idp84756128"></a><a class="indexterm" name="idp84757200"></a><a class="indexterm" name="idp84758272"></a><a class="indexterm" name="idp84759344"></a><a class="indexterm" name="idp84760416"></a><p>
      Rather than using a strictly <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a>
      algorithm, InnoDB uses a technique to minimize the amount of data
      that is brought into the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
      pool</a> and never accessed again. The goal is to make sure
      that frequently accessed (<span class="quote">“<span class="quote">hot</span>”</span>) pages remain in the
      buffer pool, even as
      <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> and
      <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scans</a>
      bring in new blocks that might or might not be accessed afterward.
    </p><p>
      Newly read blocks are inserted into the middle of the list
      representing the buffer pool. of the LRU list. All newly read
      pages are inserted at a location that by default is
      <code class="literal">3/8</code> from the tail of the LRU list. The pages
      are moved to the front of the list (the most-recently used end)
      when they are accessed in the buffer pool for the first time. Thus
      pages that are never accessed never make it to the front portion
      of the LRU list, and <span class="quote">“<span class="quote">age out</span>”</span> sooner than with a
      strict LRU approach. This arrangement divides the LRU list into
      two segments, where the pages downstream of the insertion point
      are considered <span class="quote">“<span class="quote">old</span>”</span> and are desirable victims for
      LRU eviction.
    </p><p>
      For an explanation of the inner workings of the InnoDB buffer pool
      and the specifics of its LRU replacement algorithm, see
      <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
    </p><p>
      You can control the insertion point in the LRU list, and choose
      whether InnoDB applies the same optimization to blocks brought
      into the buffer pool by table or index scans. The configuration
      parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
      controls the percentage of <span class="quote">“<span class="quote">old</span>”</span> blocks in the LRU
      list. The default value of
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> is
      <code class="literal">37</code>, corresponding to the original fixed ratio
      of 3/8. The value range is <code class="literal">5</code> (new pages in the
      buffer pool age out very quickly) to <code class="literal">95</code> (only
      5% of the buffer pool is reserved for hot pages, making the
      algorithm close to the familiar LRU strategy).
    </p><p>
      The optimization that keeps the buffer pool from being churned by
      read-ahead can avoid similar problems due to table or index scans.
      In these scans, a data page is typically accessed a few times in
      quick succession and is never touched again. The configuration
      parameter <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      specifies the time window (in milliseconds) after the first access
      to a page during which it can be accessed without being moved to
      the front (most-recently used end) of the LRU list. The default
      value of <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      is <code class="literal">0</code>, corresponding to the original behavior of
      moving a page to the most-recently used end of the buffer pool
      list when it is first accessed in the buffer pool. Increasing this
      value makes more and more blocks likely to age out faster from the
      buffer pool.
    </p><p>
      Both <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> and
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> are
      dynamic, global and can be specified in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or
      changed at runtime with the <code class="literal">SET GLOBAL</code> command.
      Changing the setting requires the <code class="literal">SUPER</code>
      privilege.
    </p><p>
      To help you gauge the effect of setting these parameters, the
      <code class="literal">SHOW ENGINE INNODB STATUS</code> command reports
      additional statistics. The <code class="literal">BUFFER POOL AND
      MEMORY</code> section looks like:
    </p><pre class="programlisting">Total memory allocated 1107296256; in additional pool allocated 0
Dictionary memory allocated 80360
Buffer pool size   65535
Free buffers       0
Database pages     63920
Old database pages 23600
Modified db pages  34969
Pending reads 32
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 414946, not young 2930673
1274.75 youngs/s, 16521.90 non-youngs/s
Pages read 486005, created 3178, written 160585
2132.37 reads/s, 3.40 creates/s, 323.74 writes/s
Buffer pool hit rate 950 / 1000, young-making rate 30 / 1000 not 392 / 1000
Pages read ahead 1510.10/s, evicted without access 0.00/s
LRU len: 63920, unzip_LRU len: 0
I/O sum[43690]:cur[221], unzip sum[0]:cur[0]</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Old database pages</code> is the number of pages
          in the <span class="quote">“<span class="quote">old</span>”</span> segment of the LRU list.
        </p></li><li class="listitem"><p>
          <code class="literal">Pages made young</code> and <code class="literal">not
          young</code> is the total number of <span class="quote">“<span class="quote">old</span>”</span>
          pages that have been made young or not respectively.
        </p></li><li class="listitem"><p>
          <code class="literal">youngs/s</code> and <code class="literal">non-young/s</code>
          is the rate at which page accesses to the <span class="quote">“<span class="quote">old</span>”</span>
          pages have resulted in making such pages young or otherwise
          respectively since the last invocation of the command.
        </p></li><li class="listitem"><p>
          <code class="literal">young-making rate</code> and
          <code class="literal">not</code> provides the same rate but in terms of
          overall buffer pool accesses instead of accesses just to the
          <span class="quote">“<span class="quote">old</span>”</span> pages.
</p></li></ul>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
        Per second averages provided in <code class="literal">InnoDB</code>
        Monitor output are based on the elapsed time between the current
        time and the last time <code class="literal">InnoDB</code> Monitor output
        was printed.
</p>
</div>
<p>
      Because the effects of these parameters can vary widely based on
      your hardware configuration, your data, and the details of your
      workload, always benchmark to verify the effectiveness before
      changing these settings in any performance-critical or production
      environment.
    </p><p>
      In mixed workloads where most of the activity is OLTP type with
      periodic batch reporting queries which result in large scans,
      setting the value of
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      during the batch runs can help keep the working set of the normal
      workload in the buffer pool.
    </p><p>
      When scanning large tables that cannot fit entirely in the buffer
      pool, setting
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> to a
      small value keeps the data that is only read once from consuming a
      significant portion of the buffer pool. For example, setting
      <code class="literal">innodb_old_blocks_pct=5</code> restricts this data
      that is only read once to 5% of the buffer pool.
    </p><p>
      When scanning small tables that do fit into memory, there is less
      overhead for moving pages around within the buffer pool, so you
      can leave <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
      at its default value, or even higher, such as
      <code class="literal">innodb_old_blocks_pct=50</code>.
    </p><p>
      The effect of the
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      parameter is harder to predict than the
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
      parameter, is relatively small, and varies more with the workload.
      To arrive at an optimal value, conduct your own benchmarks if the
      performance improvement from adjusting
      <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> is
      not sufficient.
    </p><p>
      For more information about the InnoDB buffer pool, see
      <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-recovery"></a>14.2.4.2.25. Improvements to Crash Recovery Performance</h5>

</div>

</div>

</div>
<p>
      A number of optimizations speed up certain steps of the
      <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">recovery</a> that happens
      on the next startup after a crash. In particular, scanning the
      <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> and applying the
      redo log are faster than in MySQL 5.1 and earlier, due to improved
      algorithms for memory management. You do not need to take any
      actions to take advantage of this performance enhancement. If you
      kept the size of your redo log files artificially low because
      recovery took a long time, you can consider increasing the file
      size.
    </p><p>
      For more information about InnoDB recovery, see
      <a class="xref" href="storage-engines.html#innodb-recovery" title="14.2.3.13. The InnoDB Recovery Process">Section 14.2.3.13, “The <code class="literal">InnoDB</code> Recovery Process”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-schema"></a>14.2.4.2.26. Integration with the MySQL Performance Schema</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84818224"></a><p>
      Starting with InnoDB 1.1 with MySQL 5.5, you can profile certain
      internal InnoDB operations using the MySQL
      <a class="link" href="performance-schema.html" title="Chapter 21. MySQL Performance Schema">Performance Schema
      feature</a>. This type of tuning is primarily for expert users,
      those who push the limits of MySQL performance, read the MySQL
      source code, and evaluate optimization strategies to overcome
      performance bottlenecks. DBAs can also use this feature for
      capacity planning, to see whether their typical workload
      encounters any performance bottlenecks with a particular
      combination of CPU, RAM, and disk storage; and if so, to judge
      whether performance can be improved by increasing the capacity of
      some part of the system.
    </p><p>
      To use this feature to examine InnoDB performance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You must be running MySQL 5.5 or higher. You must build the
          database server from source, enabling the Performance Schema
          feature by building with the
          <code class="literal">--with-perfschema</code> option. Since the
          Performance Schema feature introduces some performance
          overhead, you should use it on a test or development system
          rather than on a production system.
        </p></li><li class="listitem"><p>
          You must be running InnoDB 1.1 or higher.
        </p></li><li class="listitem"><p>
          You must be generally familiar with how to use the
          <a class="link" href="performance-schema.html" title="Chapter 21. MySQL Performance Schema">Performance Schema
          feature</a>, for example to query tables in the
          <code class="literal">performance_schema</code> database.
        </p></li><li class="listitem"><p>
          Examine the following kinds of InnoDB objects by querying the
          appropriate <code class="literal">performance_schema</code> tables. The
          items associated with InnoDB all contain the substring
          <code class="literal">innodb</code> in the <code class="literal">EVENT_NAME</code>
          column.
        </p><p>
          For the definitions of the <code class="literal">*_instances</code>
          tables, see
          <a class="xref" href="performance-schema.html#performance-schema-instance-tables" title="21.9.3. Performance Schema Instance Tables">Section 21.9.3, “Performance Schema Instance Tables”</a>. For the
          definitions of the <code class="literal">*_summary_*</code> tables, see
          <a class="xref" href="performance-schema.html#performance-schema-summary-tables" title="21.9.9. Performance Schema Summary Tables">Section 21.9.9, “Performance Schema Summary Tables”</a>. For the
          definition of the <code class="literal">thread</code> table, see
          <a class="xref" href="performance-schema.html#performance-schema-miscellaneous-tables" title="21.9.10. Performance Schema Miscellaneous Tables">Section 21.9.10, “Performance Schema Miscellaneous Tables”</a>. For
          the definition of the <code class="literal">*_current_*</code> and
          <code class="literal">*_history_*</code> tables, see
          <a class="xref" href="performance-schema.html#performance-schema-waits-tables" title="21.9.4. Performance Schema Wait Event Tables">Section 21.9.4, “Performance Schema Wait Event Tables”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="glossary.html#glos_mutex" title="mutex">Mutexes</a> in the
              <code class="literal">mutex_instances</code> table. (Mutexes and
              RW-locks related to the <code class="literal">InnoDB</code> buffer
              pool are not included in this coverage; the same applies
              to the output of the <code class="literal">SHOW ENGINE INNODB
              MUTEX</code> command.)
            </p></li><li class="listitem"><p>
              <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">RW-locks</a> in the
              <code class="literal">rwlock_instances</code> table.
            </p></li><li class="listitem"><p>
              RW-locks in the <code class="literal">rwlock_instances</code> table.
            </p></li><li class="listitem"><p>
              File I/O operations in the
              <code class="literal">file_instances</code>,
              <code class="literal">file_summary_by_event_name</code>, and
              <code class="literal">file_summary_by_instance</code> tables.
            </p></li><li class="listitem"><p>
              <a class="link" href="glossary.html#glos_thread" title="thread">Threads</a> in the
              <code class="literal">PROCESSLIST</code> table.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          During performance testing, examine the performance data in
          the <code class="literal">events_waits_current</code> and
          <code class="literal">events_waits_history_long</code> tables. If you
          are interested especially in InnoDB-related objects, use the
          clause <code class="literal">WHERE EVENT_NAME LIKE '%innodb%'</code> to
          see just those entries; otherwise, examine the performance
          statistics for the overall MySQL server.
        </p></li><li class="listitem"><p>
          You must be running MySQL 5.5, with the Performance Schema
          enabled by building with the
          <code class="literal">--with-perfschema</code> build option.
</p></li></ul>
</div>
<p>
      For more information about the MySQL Performance Schema, see
      <a class="xref" href="performance-schema.html" title="Chapter 21. MySQL Performance Schema">Chapter 21, <i>MySQL Performance Schema</i></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-multiple-buffer-pools"></a>14.2.4.2.27. Improvements to Performance from Multiple Buffer Pools</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84856800"></a><p>
      This performance enhancement is primarily useful for people with a
      large <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> size,
      typically in the multi-gigabyte range. To take advantage of this
      speedup, you must set the new
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
      configuration option, and you might also adjust the
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value.
    </p><p>
      When the InnoDB buffer pool is large, many data requests can be
      satisfied by retrieving from memory. You might encounter
      bottlenecks from multiple threads trying to access the buffer pool
      at once. Starting in InnoDB 1.1 and MySQL 5.5, you can enable
      multiple buffer pools to minimize this contention. Each page that
      is stored in or read from the buffer pool is assigned to one of
      the buffer pools randomly, using a hashing function. Each buffer
      pool manages its own free lists, flush lists, LRUs, and all other
      data structures connected to a buffer pool, and is protected by
      its own buffer pool mutex.
    </p><p>
      To enable this feature, set the
      <code class="literal">innodb_buffer_pool_instances</code> configuration
      option to a value greater than 1 (the default) up to 64 (the
      maximum). This option takes effect only when you set the
      <code class="literal">innodb_buffer_pool_size</code> to a size of 1 gigabyte
      or more. The total size you specify is divided among all the
      buffer pools. For best efficiency, specify a combination of
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a> and
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> so that
      each buffer pool instance is at least 1 gigabyte.
    </p><p>
      For more information about the InnoDB buffer pool, see
      <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-multiple-rollback-segments"></a>14.2.4.2.28. Better Scalability with Multiple Rollback Segments</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84868816"></a><p>
      Starting in InnoDB 1.1 with MySQL 5.5, the limit on concurrent
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> is greatly
      expanded, removing a bottleneck with the InnoDB
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a> that
      affected high-capacity systems. The limit applies to concurrent
      transactions that change any data; read-only transactions do not
      count against that maximum.
    </p><p>
      The single rollback segment is now divided into 128 segments, each
      of which can support up to 1023 transactions that perform writes,
      for a total of approximately 128K concurrent transactions. The
      original transaction limit was 1023.
    </p><p>
      Each transaction is assigned to one of the rollback segments, and
      remains tied to that rollback segment for the duration. This
      enhancement improves both scalability (higher number of concurrent
      transactions) and performance (less contention when different
      transactions access the rollback segments).
    </p><p>
      To take advantage of this feature, you do not need to create any
      new database or tables, or reconfigure anything. You must do a
      <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a> before
      upgrading from MySQL 5.1 or earlier, or some time afterward.
      InnoDB makes the required changes inside the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>
      automatically, the first time you restart after performing a slow
      shutdown.
    </p><p>
      If your workload was not constrained by the original limit of 1023
      concurrent transactions, you can reduce the number of rollback
      segments used within a MySQL instance or within a session by
      setting the configuration option
      <a class="link" href="storage-engines.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>.
    </p><p>
      For more information about performance of InnoDB under high
      transactional load, see
      <a class="xref" href="optimization.html#optimizing-innodb-transaction-management" title="8.5.2. Optimizing InnoDB Transaction Management">Section 8.5.2, “Optimizing <code class="literal">InnoDB</code> Transaction Management”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-improved-purge-scheduling"></a>14.2.4.2.29. Better Scalability with Improved Purge Scheduling</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84879376"></a><p>
      The <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations (a type of
      garbage collection) that InnoDB performs automatically is now done
      in one or more separate threads, rather than as part of the
      <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>. This
      change improves scalability, because the main database operations
      run independently from maintenance work happening in the
      background.
    </p><p>
      To control this feature, increase the value of the configuration
      option
      <code class="literal">innodb_purge_threads=<em class="replaceable"><code>n</code></em></code>.
      If DML action is concentrated on a single table or a few tables,
      keep the setting low so that the threads do not contend with each
      other for access to the busy tables. If DML operations are spread
      across many tables, increase the setting. Its maximum is 32.
    </p><p>
      There is another related configuration option,
      <code class="literal">innodb_purge_batch_size</code> with a default of 20
      and maximum of 5000. This option is mainly intended for
      experimentation and tuning of purge operations, and should not be
      interesting to typical users.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-improved-log-sys-mutex"></a>14.2.4.2.30. Improved Log Sys Mutex</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84887840"></a><a class="indexterm" name="idp84888912"></a><p>
      This is another performance improvement that comes for free, with
      no user action or configuration needed. The details here are
      intended for performance experts who delve into the InnoDB source
      code, or interpret reports with keywords such as
      <span class="quote">“<span class="quote">mutex</span>”</span> and <span class="quote">“<span class="quote">log_sys</span>”</span>.
    </p><p>
      The <a class="link" href="glossary.html#glos_mutex" title="mutex">mutex</a> known as the log sys
      mutex has historically done double duty, controlling access to
      internal data structures related to log records and the
      <a class="link" href="glossary.html#glos_lsn" title="LSN">LSN</a>, as well as pages in the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> that are
      changed when a
      <a class="link" href="glossary.html#glos_mini_transaction" title="mini-transaction">mini-transaction</a> is
      committed. Starting in InnoDB 1.1 with MySQL 5.5, these two kinds
      of operations are protected by separate mutexes, with a new
      <code class="literal">log_buf</code> mutex controlling writes to buffer pool
      pages due to mini-transactions.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a class="xref" href="optimization.html#locking-issues" title="8.10. Optimizing Locking Operations">Section 8.10, “Optimizing Locking Operations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-separate-flush-list-mutex"></a>14.2.4.2.31. Separate Flush List Mutex</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp84898048"></a><p>
      Starting with InnoDB 1.1 with MySQL 5.5, concurrent access to the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> is faster.
      Operations involving the <a class="link" href="glossary.html#glos_flush_list" title="flush list">flush
      list</a>, a data structure related to the buffer pool, are now
      controlled by a separate <a class="link" href="glossary.html#glos_mutex" title="mutex">mutex</a>
      and do not block access to the buffer pool. You do not need to
      configure anything to take advantage of this speedup; it is fully
      automatic.
    </p><p>
      For more information about the InnoDB buffer pool, see
      <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-split-kernel-mutex"></a>14.2.4.2.32. Kernel Mutex Split</h5>

</div>

</div>

</div>
<p>
      The <a class="link" href="glossary.html#glos_mutex" title="mutex">mutex</a> controlling concurrent
      access to the <code class="literal">InnoDB</code> kernel is now divided into
      separate mutexes and <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">rw-locks</a>
      to reduce contention. You do not need to configure anything to
      take advantage of this speedup; it is fully automatic.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-table-cache"></a>14.2.4.2.33. InnoDB Configurable Data Dictionary Cache</h5>

</div>

</div>

</div>
<p>
      To ease the memory load on systems with huge numbers of tables,
      InnoDB now frees up the memory associated with an opened table,
      using an LRU algorithm to select tables that have gone the longest
      without being accessed. To reserve more memory to hold metadata
      for open InnoDB tables, increase the value of the
      <a class="link" href="server-administration.html#sysvar_table_definition_cache"><code class="literal">table_definition_cache</code></a>
      configuration option. InnoDB treats this value as a <span class="quote">“<span class="quote">soft
      limit</span>”</span>. The actual number of tables with cached metadata
      could be higher, because metadata for InnoDB system tables, and
      parent and child tables in foreign key relationships, is never
      evicted from memory.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-tablespace-management"></a>14.2.4.2.34. Improved Tablespace Management</h5>

</div>

</div>

</div>
<p>
      Several new features extend the file-per-table mode enabled by the
      <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option, allowing more flexibility in how the
      <code class="filename">.ibd</code> files are placed, exported, and
      restored. We characterize this as a performance enhancement
      because it solves the common customer request to put data from
      different tables onto different storage devices, for best
      price/performance depending on the access patterns of the data.
      For example, tables with high levels of random reads and writes
      might be placed on an <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> device,
      while less-often-accessed data or data processed with large
      batches of sequential I/O might be placed on an
      <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> device. See
      <a class="xref" href="server-administration.html#innodb-multiple-tablespaces" title="5.4.1. Managing InnoDB Tablespaces">Section 5.4.1, “Managing InnoDB Tablespaces”</a> for details.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-memcached"></a>14.2.4.2.35. <span class="command"><strong>memcached</strong></span> Plugin for InnoDB</h5>

</div>

</div>

</div>
<p>
      The <span class="command"><strong>memcached</strong></span> daemon is frequently used as an
      in-memory caching layer in front of a MySQL database server. Now
      MySQL allows direct access to <code class="literal">InnoDB</code> tables
      using the familiar <span class="command"><strong>memcached</strong></span> protocol and
      client libraries. Instead of formulating queries in SQL, you can
      perform simple get, set, and increment operations that avoid the
      performance overhead of SQL parsing and constructing a query
      optimization plan. You can also access the underlying
      <code class="literal">InnoDB</code> tables through SQL to load data,
      generate reports, or perform multi-step transactional
      computations.
    </p><p>
      This technique allows the data to be stored in MySQL for
      reliability and consistency, while coding application logic that
      uses the database as a fast key-value store.
    </p><p>
      This feature combines the best of both worlds:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Data that is written using the <span class="command"><strong>memcached</strong></span>
          protocol is transparently written to an InnoDB table, without
          going through the MySQL SQL layer. You can control the
          frequency of writes to achieve higher raw performance when
          updating non-critical data.
        </p></li><li class="listitem"><p>
          Data that is requested data through the
          <span class="command"><strong>memcached</strong></span> protocol is transparently queried
          from an InnoDB table, without going through the MySQL SQL
          layer.
        </p></li><li class="listitem"><p>
          Subsequent requests for the same data will be served from the
          <code class="literal">InnoDB</code> buffer pool. The buffer pool handles
          the in-memory caching. You can tune the performance of
          data-intensive operations using the familiar
          <code class="literal">InnoDB</code> configuration options.
        </p></li><li class="listitem"><p>
          InnoDB can handle composing and decomposing multiple column
          values into a single <span class="command"><strong>memcached</strong></span> item value,
          reducing the amount of string parsing and concatenation
          required in your application. For example, you might store a
          string value <code class="literal">2|4|6|8</code> in the
          <span class="command"><strong>memcached</strong></span> cache, and InnoDB splits that
          value based on a separator character, then stores the result
          into four numeric columns.
</p></li></ul>
</div>
<p>
      For details on using this NoSQL-style interface to MySQL, see
      <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a>. For additional background on
      <span class="command"><strong>memcached</strong></span> and considerations for writing
      applications for its API, see <a class="xref" href="ha-overview.html#ha-memcached" title="15.6. Using MySQL with memcached">Section 15.6, “Using MySQL with <span class="command"><strong>memcached</strong></span>”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-performance-online-ddl"></a>14.2.4.2.36. Online DDL</h5>

</div>

</div>

</div>
<p>
      This feature is a continuation of the <span class="quote">“<span class="quote">Fast Index
      Creation</span>”</span> feature introduced in
      <a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/innodb-create-index.html" target="_top">Fast Index Creation in the InnoDB Storage Engine</a>. Now you can perform other
      kinds of <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> operations on InnoDB
      tables <a class="link" href="glossary.html#glos_online" title="online">online</a>: that is, with
      minimal delay for operations on that table, without rebuilding the
      entire table, or both. This enhancement improves responsiveness
      and availability in busy production environments, where making a
      table unavailable for minutes or hours whenever its column
      definitions change is not practical.
    </p><p>
      For full details, see <a class="xref" href="server-administration.html#innodb-online-ddl" title="5.5. Online DDL for InnoDB Tables">Section 5.5, “Online DDL for <code class="literal">InnoDB</code> Tables”</a>.
    </p><p>
      The DDL operations enhanced by this feature are these variations
      on the <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Create <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
          indexes</a>: <code class="literal">CREATE INDEX
          <em class="replaceable"><code>name</code></em> ON
          <em class="replaceable"><code>table</code></em>
          (<em class="replaceable"><code>col_list</code></em>)</code> or
          <code class="literal">ALTER TABLE <em class="replaceable"><code>table</code></em> ADD
          INDEX <em class="replaceable"><code>name</code></em>
          (<em class="replaceable"><code>col_list</code></em>)</code>. (Creating a
          primary key or a <code class="literal">FULLTEXT</code> index still
          requires locking the table.)
        </p><p>
          Drop <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
          indexes</a>: <code class="literal">DROP INDEX
          <em class="replaceable"><code>name</code></em> ON
          <em class="replaceable"><code>table</code></em>;</code> or <code class="literal">ALTER
          TABLE <em class="replaceable"><code>table</code></em> DROP INDEX
          <em class="replaceable"><code>name</code></em></code>
        </p><p>
          Creating and dropping secondary indexes on
          <code class="literal">InnoDB</code> tables has avoided the table-copying
          behavior since the days of MySQL 5.1 with the
          <code class="literal">InnoDB</code> Plugin. Now, the table remains
          available for read and write operations while the index is
          being created or dropped. The <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a> or <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>
          statement only finishes after all transactions that are
          modifying the table are completed, so that the initial state
          of the index reflects the most recent contents of the table.
        </p><p>
          Previously, modifying the table while an index was being
          created or dropped typically resulted in a
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a> that cancelled
          the insert, update, or delete statement on the table.
        </p></li><li class="listitem"><p>
          Changing the
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          value for a column: <code class="literal">ALTER TABLE
          <em class="replaceable"><code>table</code></em>
          AUTO_INCREMENT=<em class="replaceable"><code>next_value</code></em>;</code>
        </p><p>
          Especially in a distributed system using replication or
          sharding, you sometimes reset the auto-increment counter for a
          table to a specific value. The next row inserted into the
          table uses the specified value for its auto-increment column.
          You might also use this technique in a data warehousing
          environment where you periodically empty all the tables and
          reload them, and you can restart the auto-increment sequence
          from 1.
        </p></li><li class="listitem"><p>
          Adding or dropping a
          <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
          constraint</a>:
        </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl1</code></em> ADD CONSTRAINT <em class="replaceable"><code>fk_name</code></em> FOREIGN KEY <em class="replaceable"><code>index</code></em> (<em class="replaceable"><code>col1</code></em>) REFERENCES <em class="replaceable"><code>tbl2</code></em>(<em class="replaceable"><code>col2</code></em>) <em class="replaceable"><code>referential_actions</code></em>;
ALTER TABLE <em class="replaceable"><code>tbl</code></em> DROP FOREIGN KEY <em class="replaceable"><code>fk_name</code></em>;
</pre><p>
          Dropping a foreign key can be performed online with the
          <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> option
          enabled or disabled. Creating a foreign key online requires
          <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> to be
          disabled.
        </p><p>
          If you do not know the names of the foreign key constraints on
          a particular table, issue the following statement and find the
          constraint name in the <code class="literal">CONSTRAINT</code> clause
          for each foreign key:
        </p><pre class="programlisting">show create table <em class="replaceable"><code>table</code></em>\G
</pre><p>
          Or, query the
          <a class="link" href="information-schema.html#table-constraints-table" title="20.25. The INFORMATION_SCHEMA TABLE_CONSTRAINTS Table"><code class="literal">information_schema.table_constraints</code></a>
          table and use the <code class="literal">constraint_name</code> and
          <code class="literal">constraint_type</code> columns to identify the
          foreign key names.
        </p><p>
          As a consequence of this enhancement, you can now also drop a
          foreign key and its associated index in a single statement,
          which previously required separate statements in a strict
          order:
        </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>table</code></em> DROP FOREIGN KEY <em class="replaceable"><code>constraint</code></em>, DROP INDEX <em class="replaceable"><code>index</code></em>;
</pre></li><li class="listitem"><p>
          Renaming a column: <code class="literal">ALTER TABLE
          <em class="replaceable"><code>tbl</code></em> CHANGE
          <em class="replaceable"><code>old_col_name</code></em>
          <em class="replaceable"><code>new_col_name</code></em>
          <em class="replaceable"><code>datatype</code></em></code>
        </p><p>
          When you keep the same data type and only change the column
          name, this operation can always be performed online. As part
          of this enhancement, you can now rename a column that is part
          of a foreign key constraint, which was not allowed before.

        </p></li><li class="listitem"><p>
          Some other <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operations are non-blocking, and are faster than before
          because the table-copying operation is optimized, even though
          a table copy is still required:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Changing the <code class="literal">ROW_FORMAT</code> or
              <code class="literal">KEY_BLOCK_SIZE</code> properties for a table.
            </p></li><li class="listitem"><p>
              Changing the nullable status for a column.
            </p></li><li class="listitem"><p>
              Adding, dropping, or reordering columns.
</p></li></ul>
</div>
</li></ul>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
        As your database schema evolves with new columns, data types,
        constraints, indexes, and so on, keep your
        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements up to
        date with the latest table definitions. Even with the
        performance improvements of online DDL, it is more efficient to
        create stable database structures at the beginning, rather than
        creating part of the schema and then issuing
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements afterward.
      </p><p xmlns="">
        The main exception to this guideline is for secondary indexes on
        tables with large numbers of rows. It is typically most
        efficient to create the table with all details specified except
        the secondary indexes, load the data, then create the secondary
        indexes.
      </p><p xmlns="">
        Whatever sequence of <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a>, <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>,
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, and similar
        statements went into putting a table together, you can capture
        the SQL needed to reconstruct the current form of the table by
        issuing the statement <code class="literal">SHOW CREATE TABLE
        <em class="replaceable"><code>table</code></em>\G</code> (uppercase
        <code class="literal">\G</code> required for tidy formatting). This output
        shows clauses such as numeric precision, <code class="literal">NOT
        NULL</code>, and <code class="literal">CHARACTER SET</code> that are
        sometimes added behind the scenes, and you might otherwise leave
        out when cloning the table on a new system or setting up foreign
        key columns with identical type.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema"></a>14.2.4.3. <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code> tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp85001424"></a><p>
    The
    <a class="link" href="information-schema.html" title="Chapter 20. INFORMATION_SCHEMA Tables"><code class="literal">INFORMATION_SCHEMA</code></a>
    is a MySQL feature that helps you monitor server activity to
    diagnose capacity and performance issues. Several InnoDB-related
    <code class="literal">INFORMATION_SCHEMA</code> tables
    (<a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a>,
    <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>,
    <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>,
    <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>,
    <a class="link" href="information-schema.html#innodb-trx-table" title="20.30.4. The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
    <a class="link" href="information-schema.html#innodb-locks-table" title="20.30.5. The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
    <a class="link" href="information-schema.html#innodb-lock-waits-table" title="20.30.6. The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>) contain live
    information about compressed InnoDB tables, the compressed InnoDB
    buffer pool, all transactions currently executing inside InnoDB, the
    locks that transactions hold and those that are blocking
    transactions waiting for access to a resource (a table or row).
  </p><p>
    This section describes the InnoDB-related Information Schema tables
    and shows some examples of their use.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-information-schema-compression-tables"></a>14.2.4.3.1. Information Schema Tables about Compression</h5>
</div>
</div>
</div>
<a class="indexterm" name="idp85013024"></a><p>
      Two new pairs of Information Schema tables can give you some
      insight into how well compression is working overall. One pair of
      tables contains information about the number of compression
      operations and the amount of time spent performing compression.
      Another pair of tables contains information on the way memory is
      allocated for compression.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="innodb-information-schema-innodb_cmp"></a>14.2.4.3.1.1. <code class="literal">INNODB_CMP</code> and <code class="literal">INNODB_CMP_RESET</code></h6>
</div>

</div>

</div>
<a class="indexterm" name="idp85017376"></a><a class="indexterm" name="idp85018864"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables contain status information on the operations related to
        compressed tables, which are covered in
        <a class="xref" href="server-administration.html#innodb-compression" title="5.4.6. Working with InnoDB Compressed Tables">Section 5.4.6, “Working with <code class="literal">InnoDB</code> Compressed Tables”</a>. The compressed
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> is in the column
        <code class="literal">PAGE_SIZE</code>.
      </p><p>
        These two tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        resets the statistics on compression and uncompression
        operations. For example, if you archive the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        every 60 minutes, you see the statistics for each hourly period.
        If you monitor the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> (making sure never to
        read
        <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>),
        you see the cumulated statistics since InnoDB was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-information-schema-innodb_cmp_columns_table" title="Table 20.1. Columns of INNODB_CMP and INNODB_CMP_RESET">Table 20.1, “Columns of <code class="literal">INNODB_CMP</code> and
    <code class="literal">INNODB_CMP_RESET</code>”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="innodb-information-schema-innodb_cmpmem"></a>14.2.4.3.1.2. <code class="literal">INNODB_CMPMEM</code> and
<code class="literal">INNODB_CMPMEM_RESET</code></h6>
</div>

</div>

</div>
<a class="indexterm" name="idp85032832"></a><a class="indexterm" name="idp85034320"></a><a class="indexterm" name="idp85035824"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        tables contain status information on the compressed pages that
        reside in the buffer pool. Please consult
        <a class="xref" href="server-administration.html#innodb-compression" title="5.4.6. Working with InnoDB Compressed Tables">Section 5.4.6, “Working with <code class="literal">InnoDB</code> Compressed Tables”</a> for further information on
        compressed tables and the use of the buffer pool. The
        <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables should provide more useful statistics on compression.
      </p><h7><a name="idp85042320"></a>
        Internal Details
      </h7><p>
        InnoDB uses a <a class="link" href="glossary.html#glos_buddy_allocator" title="buddy allocator">buddy
        allocator</a> system to manage memory allocated to
        <a class="link" href="glossary.html#glos_page_size" title="page size">pages of various sizes</a>,
        from 1KB to 16KB. Each row of the two tables described here
        corresponds to a single page size.
      </p><p>
        These two tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        resets the statistics on relocation operations. For example, if
        every 60 minutes you archived the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>,
        it would show the hourly statistics. If you never read
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        and monitored the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> instead, it would
        show the cumulated statistics since InnoDB was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-information-schema-innodb_cmpmem_columns_table" title="Table 20.3. Columns of INNODB_CMPMEM and INNODB_CMPMEM_RESET">Table 20.3, “Columns of INNODB_CMPMEM and INNODB_CMPMEM_RESET”</a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="innodb-information-schema-examples-compression-sect"></a>14.2.4.3.1.3. Using the Compression Information Schema Tables</h6>
</div>

</div>

</div>

<div class="example">
<a name="innodb-information-schema-examples-compression"></a><p class="title"><b>Example 14.2. Using the Compression Information Schema Tables</b></p>
<div class="example-contents">
<p>
          The following is sample output from a database that contains
          compressed tables (see <a class="xref" href="server-administration.html#innodb-compression" title="5.4.6. Working with InnoDB Compressed Tables">Section 5.4.6, “Working with <code class="literal">InnoDB</code> Compressed Tables”</a>,
          <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a>,
          <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="20.30.2. The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a>, and
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>).
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmp-table" title="20.30.1. The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          The only compressed page size that the buffer pool contains is
          8K. Compressing or uncompressing pages has consumed less than
          a second since the time the statistics were reset, because the
          columns <code class="literal">COMPRESS_TIME</code> and
          <code class="literal">UNCOMPRESS_TIME</code> are zero.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmp"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_CMP
            table, showing the internal workings of InnoDB table
compression under a light workload. " border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">page size</th><th scope="col">compress ops</th><th scope="col">compress ops ok</th><th scope="col">compress time</th><th scope="col">uncompress ops</th><th scope="col">uncompress time</th></tr></thead><tbody><tr><td scope="row">1024</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">2048</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">4096</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">8192</td><td>1048</td><td>921</td><td>0</td><td>61</td><td>0</td></tr><tr><td scope="row">16384</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table>
</div>
<p>
          According to <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>, there
          are 6169 compressed 8KB pages in the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The only
          other allocated block size is 64 bytes. The smallest
          <code class="literal">PAGE_SIZE</code> in
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> is used for block
          descriptors of those compressed pages for which no
          uncompressed page exists in the buffer pool. We see that there
          are 5910 such pages. Indirectly, we see that 259 (6169-5910)
          compressed pages also exist in the buffer pool in uncompressed
          form.
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="20.30.3. The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMPMEM</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          Some memory is unusable due to fragmentation of the memory
          allocator for compressed pages:
          <code class="literal">SUM(PAGE_SIZE*PAGES_FREE)=6784</code>. This is
          because small memory allocation requests are fulfilled by
          splitting bigger blocks, starting from the 16K blocks that are
          allocated from the main buffer pool, using the buddy
          allocation system. The fragmentation is this low because some
          allocated blocks have been relocated (copied) to form bigger
          adjacent free blocks. This copying of
          <code class="literal">SUM(PAGE_SIZE*RELOCATION_OPS)</code> bytes has
          consumed less than a second
          <code class="literal">(SUM(RELOCATION_TIME)=0)</code>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmpmem"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_CMPMEM table, showing buffer pool
            memory operations for InnoDB table compression under a light
workload. " border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">page size</th><th scope="col">pages used</th><th scope="col">pages free</th><th scope="col">relocation ops</th><th scope="col">relocation time</th></tr></thead><tbody><tr><td scope="row">64</td><td>5910</td><td>0</td><td>2436</td><td>0</td></tr><tr><td scope="row">128</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">256</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">512</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">1024</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">2048</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">4096</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">8192</td><td>6169</td><td>0</td><td>5</td><td>0</td></tr><tr><td scope="row">16384</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-information-schema-transactions"></a>14.2.4.3.2. Information Schema Tables about Transactions</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp85127280"></a><p>
      Three InnoDB-related Information Schema tables make it easy to
      monitor transactions and diagnose possible locking problems. The
      three tables are <a class="link" href="information-schema.html#innodb-trx-table" title="20.30.4. The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
      <a class="link" href="information-schema.html#innodb-locks-table" title="20.30.5. The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a>, and
      <a class="link" href="information-schema.html#innodb-lock-waits-table" title="20.30.6. The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="indexterm" name="idp85132640"></a>

          <code class="literal">INNODB_TRX</code>
        </p><p>
          Contains information about every transaction currently
          executing inside InnoDB, including whether the transaction is
          waiting for a lock, when the transaction started, and the
          particular SQL statement the transaction is executing.
        </p><p>
          For the table definition, see
          <a class="xref" href="information-schema.html#innodb-information-schema-innodb_trx_columns_table" title="Table 20.4. INNODB_TRX Columns">Table 20.4, “<code class="literal">INNODB_TRX</code> Columns”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idp85137296"></a>

          <code class="literal">INNODB_LOCKS</code>
        </p><p>
          Each transaction in InnoDB that is waiting for another
          transaction to release a lock
          (<code class="literal">INNODB_TRX.TRX_STATE='LOCK WAIT'</code>) is
          blocked by exactly one <span class="quote">“<span class="quote">blocking lock request</span>”</span>.
          That blocking lock request is for a row or table lock held by
          another transaction in an incompatible mode. The waiting or
          blocked transaction cannot proceed until the other transaction
          commits or rolls back, thereby releasing the requested lock.
          For every blocked transaction,
          <a class="link" href="information-schema.html#innodb-locks-table" title="20.30.5. The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> contains one row
          that describes each lock the transaction has requested, and
          for which it is waiting.
          <a class="link" href="information-schema.html#innodb-locks-table" title="20.30.5. The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> also contains one
          row for each lock that is blocking another transaction,
          whatever the state of the transaction that holds the lock
          (<code class="literal">'RUNNING'</code>, <code class="literal">'LOCK WAIT'</code>,
          <code class="literal">'ROLLING BACK'</code> or
          <code class="literal">'COMMITTING'</code>). The lock that is blocking a
          transaction is always held in a mode (read vs. write, shared
          vs. exclusive) incompatible with the mode of requested lock.
        </p><p>
          For the table definition, see
          <a class="xref" href="information-schema.html#innodb-information-schema-innodb_locks_columns_table" title="Table 20.5. INNODB_LOCKS Columns">Table 20.5, “<code class="literal">INNODB_LOCKS</code> Columns”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idp85148272"></a>

          <code class="literal">INNODB_LOCK_WAITS</code>
        </p><p>
          Using this table, you can tell which transactions are waiting
          for a given lock, or for which lock a given transaction is
          waiting. This table contains one or more rows for each
          <span class="emphasis"><em>blocked</em></span> transaction, indicating the lock
          it has requested and any locks that are blocking that request.
          The <code class="literal">REQUESTED_LOCK_ID</code> refers to the lock
          that a transaction is requesting, and the
          <code class="literal">BLOCKING_LOCK_ID</code> refers to the lock (held
          by another transaction) that is preventing the first
          transaction from proceeding. For any given blocked
          transaction, all rows in
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="20.30.6. The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> have the same
          value for <code class="literal">REQUESTED_LOCK_ID</code> and different
          values for <code class="literal">BLOCKING_LOCK_ID</code>.
        </p><p>
          For the table definition, see
          <a class="xref" href="information-schema.html#innodb-information-schema-innodb_lock_waits_columns_table" title="Table 20.6. INNODB_LOCK_WAITS Columns">Table 20.6, “<code class="literal">INNODB_LOCK_WAITS</code> Columns”</a>.
</p></li></ul>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="innodb-information-schema-examples"></a>14.2.4.3.2.1. Using the Transaction Information Schema Tables</h6>
</div>

</div>

</div>

<div class="example">
<a name="innodb-information-schema-examples-simple-blocking"></a><p class="title"><b>Example 14.3. Identifying Blocking Transactions</b></p>
<div class="example-contents">
<p>
          It is sometimes helpful to be able to identify which
          transaction is blocking another. You can use the Information
          Schema tables to find out which transaction is waiting for
          another, and which resource is being requested.
        </p><p>
          Suppose you have the following scenario, with three users
          running concurrently. Each user (or session) corresponds to a
          MySQL thread, and executes one transaction after another.
          Consider the state of the system when these users have issued
          the following commands, but none has yet committed its
          transaction:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal"> User A: </code>
            </p><pre class="programlisting">BEGIN;
SELECT a FROM t FOR UPDATE;
SELECT SLEEP(100);</pre></li><li class="listitem"><p>
              <code class="literal"> User B: </code>
            </p><pre class="programlisting">SELECT b FROM t FOR UPDATE;</pre></li><li class="listitem"><p>
              <code class="literal"> User C: </code>
</p><pre class="programlisting">SELECT c FROM t FOR UPDATE;</pre></li></ul>
</div>
<p>
          In this scenario, you can use this query to see who is waiting
          for whom:
        </p><pre class="programlisting">SELECT r.trx_id waiting_trx_id,  
       r.trx_mysql_thread_id waiting_thread,
       r.trx_query waiting_query,
       b.trx_id blocking_trx_id, 
       b.trx_mysql_thread_id blocking_thread,
       b.trx_query blocking_query
   FROM       information_schema.innodb_lock_waits w
   INNER JOIN information_schema.innodb_trx b  ON  
    b.trx_id = w.blocking_trx_id
  INNER JOIN information_schema.innodb_trx r  ON  
r.trx_id = w.requesting_trx_id;</pre>
<div class="informaltable">
<table summary=" This table represents the result set of a query
            against the INFORMATION_SCHEMA.INNODB_LOCK_WAITS and
            INFORMATION_SCHEMA.INNODB_TRX tables, shown in the preceding
            text, indicating which InnoDB threads are waiting for which
other threads. " border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">waiting trx id</th><th scope="col">waiting thread</th><th scope="col">waiting query</th><th scope="col">blocking trx id</th><th scope="col">blocking thread</th><th scope="col">blocking query</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr></tbody></table>
</div>
<p>
          In the above result, you can identify users by the
          <span class="quote">“<span class="quote">waiting query</span>”</span> or <span class="quote">“<span class="quote">blocking query</span>”</span>.
          As you can see:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              User B (trx id <code class="literal">'A4'</code>, thread
              <code class="literal">6</code>) and User C (trx id
              <code class="literal">'A5'</code>, thread <code class="literal">7</code>) are
              both waiting for User A (trx id <code class="literal">'A3'</code>,
              thread <code class="literal">5</code>).
            </p></li><li class="listitem"><p>
              User C is waiting for User B as well as User A.
</p></li></ul>
</div>
<p>
          You can see the underlying data in the tables
          <a class="link" href="storage-engines.html#innodb-information-schema-examples-simple-blocking-trx"><code class="literal">INNODB_TRX</code></a>,
          <a class="link" href="storage-engines.html#innodb-information-schema-examples-simple-blocking-locks"><code class="literal">INNODB_LOCKS</code></a>,
          and
          <a class="link" href="storage-engines.html#innodb-information-schema-examples-simple-blocking-waits"><code class="literal">INNODB_LOCK_WAITS</code></a>.
        </p><p>
          The following table shows some sample contents of
          INFORMATION_SCHEMA.INNODB_TRX.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-trx"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_TRX
            table, showing the typical types of entries for each column.
" border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">trx id</th><th scope="col">trx state</th><th scope="col">trx started</th><th scope="col">trx requested lock id</th><th scope="col">trx wait started</th><th scope="col">trx weight</th><th scope="col">trx mysql thread id</th><th scope="col">trx query</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A3</code></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 16:44:54</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">2</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">2</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td></tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-locks"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCKS table, showing the typical
types of entries for each column. " border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">lock id</th><th scope="col">lock trx id</th><th scope="col">lock mode</th><th scope="col">lock type</th><th scope="col">lock table</th><th scope="col">lock index</th><th scope="col">lock space</th><th scope="col">lock page</th><th scope="col">lock rec</th><th scope="col">lock data</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A3:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td scope="row"><code class="literal">A4:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td scope="row"><code class="literal">A5:1:3:2</code></td><td><code class="literal">A5</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-waits"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCK_WAITS table, showing the
typical types of entries for each column. " border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">requesting trx id</th><th scope="col">requested lock id</th><th scope="col">blocking trx id</th><th scope="col">blocking lock id</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-sample-locks"></a><p class="title"><b>Example 14.4. More Complex Example of Transaction Data in Information Schema Tables</b></p>
<div class="example-contents">
<p>
          Sometimes you would like to correlate the internal InnoDB
          locking information with session-level information maintained
          by MySQL. For example, you might like to know, for a given
          InnoDB transaction ID, the corresponding MySQL session ID and
          name of the user that may be holding a lock, and thus blocking
          another transaction.
        </p><p>
          The following output from the
          <code class="literal">INFORMATION_SCHEMA</code> tables is taken from a
          somewhat loaded system.
        </p><p>
          As can be seen in the following tables, there are several
          transactions running.
        </p><p>
          The following <code class="literal">INNODB_LOCKS</code> and
          <code class="literal">INNODB_LOCK_WAITS</code> tables shows that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Transaction
              <span class="color0"><code class="literal">77F</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transactions
              <span class="color1"><code class="literal">77E</code></span>,
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color1"><code class="literal">77E</code></span>
              (executing an INSERT) is waiting for transactions
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color2"><code class="literal">77D</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color3"><code class="literal">77B</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color4"><code class="literal">77A</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color4"><code class="literal">77A</code></span>
              is running, currently executing <code class="literal">SELECT</code>.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color5"><code class="literal">E56</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color6"><code class="literal">E55</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color6"><code class="literal">E55</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color7"><code class="literal">19C</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color7"><code class="literal">19C</code></span>
              is running, currently executing an
              <code class="literal">INSERT</code>.
</p></li></ul>
</div>
<p>
          Note that there may be an inconsistency between queries shown
          in the two tables <code class="literal">INNODB_TRX.TRX_QUERY</code> and
          <code class="literal">PROCESSLIST.INFO</code>. The current transaction
          ID for a thread, and the query being executed in that
          transaction, may be different in these two tables for any
          given thread. See
          <a class="xref" href="storage-engines.html#innodb-information-schema-note_inconsistency" title="14.2.4.3.4.3. Possible Inconsistency with PROCESSLIST">Section 14.2.4.3.4.3, “Possible Inconsistency with <code class="literal">PROCESSLIST</code>”</a>
          for an explanation.
        </p><p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code> in a system
          running a heavy <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-processlist"></a><table summary=" Sample data from the INFORMATION_SCHEMA.PROCESSLIST
            table, showing the internal workings of MySQL processes
under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">ID</th><th scope="col">USER</th><th scope="col">HOST</th><th scope="col">DB</th><th scope="col">COMMAND</th><th scope="col">TIME</th><th scope="col">STATE</th><th scope="col">INFO</th></tr></thead><tbody><tr><td scope="row"><code class="literal">384</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">10</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">257</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">3</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">130</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">61</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">8</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">4</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">preparing</code></td><td><code class="literal">SELECT * FROM processlist</code></td></tr><tr><td scope="row"><code class="literal">2</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Sleep</code></td><td><code class="literal">566</code></td><td><code class="literal"></code></td><td><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code> in a system
          running a heavy <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_trx"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_TRX
            table, showing the internal workings of InnoDB transactions
under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">trx id</th><th scope="col">trx state</th><th scope="col">trx started</th><th scope="col">trx requested lock id</th><th scope="col">trx wait started</th><th scope="col">trx weight</th><th scope="col">trx mysql thread id</th><th scope="col">trx query</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">876</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">875</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">874</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">4</code></td><td><code class="literal">873</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">4</code></td><td><code class="literal">872</code></td><td><code class="literal">select b, c from t09 where …</code></td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><code class="literal">2008-01-15 13:10:06</code></td><td><code class="literal">5</code></td><td><code class="literal">384</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><code class="literal">2008-01-15 13:10:13</code></td><td><code class="literal">965</code></td><td><code class="literal">257</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:09:10</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2900</code></td><td><code class="literal">130</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color8"><code class="literal">E15</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:59</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">5395</code></td><td><code class="literal">61</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color9"><code class="literal">51D</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:47</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">9807</code></td><td><code class="literal">8</code></td><td><code class="literal">insert into t2 values …</code></td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code> in a
          system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.

          
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_lock_waits"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCK_WAITS table, showing the
            internal workings of InnoDB locking under a heavy workload.
" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">requesting trx id</th><th scope="col">requested lock id</th><th scope="col">blocking trx id</th><th scope="col">blocking lock id</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td></tr><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:733:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><span class="color4"><code class="literal">77A</code></span>:733:12:1</td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span></td><td><span class="color5"><code class="literal">E56</code></span>:743:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:6:2</td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><span class="color7"><code class="literal">19C</code></span>:743:38:2</td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code> in a system
          running a heavy <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_locks"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCKS table, showing the internal
workings of InnoDB locking under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">lock id</th><th scope="col">lock trx id</th><th scope="col">lock mode</th><th scope="col">lock type</th><th scope="col">lock table</th><th scope="col">lock index</th><th scope="col">lock space</th><th scope="col">lock page</th><th scope="col">lock rec</th><th scope="col">lock data</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td scope="row"><span class="color4"><code class="literal">77A</code></span>:733​:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span>:743​:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr><tr><td scope="row"><span class="color7"><code class="literal">19C</code></span>:743​:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-information-schema-fts"></a>14.2.4.3.3. Information Schema Tables about Full-Text Search</h5>

</div>

</div>

</div>
<p>
      A set of related <code class="literal">INFORMATION_SCHEMA</code> tables
      contains information about <code class="literal">FULLTEXT</code> search
      indexes on <code class="literal">InnoDB</code> tables:

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-config-table" title="20.30.20. The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="20.30.22. The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="20.30.23. The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="20.30.21. The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="20.30.24. The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="20.30.25. The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a>
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-information-schema-notes"></a>14.2.4.3.4. Special Locking Considerations for InnoDB
<code class="literal">INFORMATION_SCHEMA</code> Tables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp85679056"></a>
<div class="section">

<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="innodb-information-schema-understanding_innodb_locking"></a>14.2.4.3.4.1. Understanding <code class="literal">InnoDB</code> Locking</h6>
</div>

</div>

</div>
<p>
        When a transaction updates a row in a table, or locks it with
        <code class="literal">SELECT FOR UPDATE</code>, InnoDB establishes a list
        or queue of locks on that row. Similarly, InnoDB maintains a
        list of locks on a table for table-level locks transactions
        hold. If a second transaction wants to update a row or lock a
        table already locked by a prior transaction in an incompatible
        mode, InnoDB adds a lock request for the row to the
        corresponding queue. For a lock to be acquired by a transaction,
        all incompatible lock requests previously entered into the lock
        queue for that row or table must be removed (the transactions
        holding or requesting those locks either commit or roll back).
      </p><p>
        A transaction may have any number of lock requests for different
        rows or tables. At any given time, a transaction may be
        requesting a lock that is held by another transaction, in which
        case it is blocked by that other transaction. The requesting
        transaction must wait for the transaction that holds the
        blocking lock to commit or rollback. If a transaction is not
        waiting for a a lock, it is in the <code class="literal">'RUNNING'</code>
        state. If a transaction is waiting for a lock, it is in the
        <code class="literal">'LOCK WAIT'</code> state.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-locks-table" title="20.30.5. The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> table holds one or
        more row for each <code class="literal">'LOCK WAIT'</code> transaction,
        indicating any lock requests that are preventing its progress.
        This table also contains one row describing each lock in a queue
        of locks pending for a given row or table. The
        <a class="link" href="information-schema.html#innodb-lock-waits-table" title="20.30.6. The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> table shows which
        locks already held by a transaction are blocking locks requested
        by other transactions.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="innodb-information-schema-rapidly_changing_internal_data"></a>14.2.4.3.4.2. Granularity of <code class="literal">INFORMATION_SCHEMA</code> Data</h6>
</div>

</div>

</div>
<p>
        The data exposed by the transaction and locking tables represent
        a glimpse into fast-changing data. This is not like other (user)
        tables, where the data changes only when application-initiated
        updates occur. The underlying data is internal system-managed
        data, and can change very quickly.
      </p><p>
        For performance reasons, and to minimize the chance of
        misleading <code class="literal">JOIN</code>s between the
        <code class="literal">INFORMATION_SCHEMA</code> tables, InnoDB collects
        the required transaction and locking information into an
        intermediate buffer whenever a <code class="literal">SELECT</code> on any
        of the tables is issued. This buffer is refreshed only if more
        than 0.1 seconds has elapsed since the last time the buffer was
        read. The data needed to fill the three tables is fetched
        atomically and consistently and is saved in this global internal
        buffer, forming a point-in-time <span class="quote">“<span class="quote">snapshot</span>”</span>. If
        multiple table accesses occur within 0.1 seconds (as they almost
        certainly do when MySQL processes a join among these tables),
        then the same snapshot is used to satisfy the query.
      </p><p>
        A correct result is returned when you <code class="literal">JOIN</code>
        any of these tables together in a single query, because the data
        for the three tables comes from the same snapshot. Because the
        buffer is not refreshed with every query of any of these tables,
        if you issue separate queries against these tables within a
        tenth of a second, the results are the same from query to query.
        On the other hand, two separate queries of the same or different
        tables issued more than a tenth of a second apart may see
        different results, since the data come from different snapshots.
      </p><p>
        Because InnoDB must temporarily stall while the transaction and
        locking data is collected, too frequent queries of these tables
        can negatively impact performance as seen by other users.
      </p><p>
        As these tables contain sensitive information (at least
        <code class="literal">INNODB_LOCKS.LOCK_DATA</code> and
        <code class="literal">INNODB_TRX.TRX_QUERY</code>), for security reasons,
        only the users with the <code class="literal">PROCESS</code> privilege are
        allowed to <code class="literal">SELECT</code> from them.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="innodb-information-schema-note_inconsistency"></a>14.2.4.3.4.3. Possible Inconsistency with <code class="literal">PROCESSLIST</code></h6>
</div>

</div>

</div>
<a class="indexterm" name="idp85705776"></a><p>
        As just described, while the transaction and locking data is
        correct and consistent when these
        <code class="literal">INFORMATION_SCHEMA</code> tables are populated. For
        example, the query in <a class="link" href="information-schema.html#innodb-trx-table" title="20.30.4. The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> is
        always consistent with the rest of
        <a class="link" href="information-schema.html#innodb-trx-table" title="20.30.4. The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
        <a class="link" href="information-schema.html#innodb-locks-table" title="20.30.5. The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
        <a class="link" href="information-schema.html#innodb-lock-waits-table" title="20.30.6. The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> when the data
        comes from the same snapshot. However, the underlying data
        changes so fast that similar glimpses at other, similarly
        fast-changing data, may not be in synchrony. Thus, you should be
        careful in comparing the data in the InnoDB transaction and
        locking tables with that in the
        <a class="link" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table. The data from
        the <a class="link" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table does not come
        from the same snapshot as the data about locking and
        transactions. Even if you issue a single
        <code class="literal">SELECT</code> (joining
        <a class="link" href="information-schema.html#innodb-trx-table" title="20.30.4. The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> and
        <a class="link" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a>, for example), the
        content of those tables is generally not consistent.
        <a class="link" href="information-schema.html#innodb-trx-table" title="20.30.4. The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> may reference rows that
        are not present in <a class="link" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> or
        the currently executing SQL query of a transaction, shown in
        <code class="literal">INNODB_TRX.TRX_QUERY</code> may differ from the one
        in <code class="literal">PROCESSLIST.INFO</code>.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-monitors"></a>14.2.4.4. <code class="literal">SHOW ENGINE INNODB
STATUS</code> and the <code class="literal">InnoDB</code> Monitors</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp85723056"></a><a class="indexterm" name="idp85724544"></a><a class="indexterm" name="idp85726032"></a><a class="indexterm" name="idp85727520"></a><a class="indexterm" name="idp85729008"></a><a class="indexterm" name="idp85730496"></a><p>
        <code class="literal">InnoDB</code> Monitors provide information about the
        <code class="literal">InnoDB</code> internal state. This information is
        useful for performance tuning. Each Monitor can be enabled by
        creating a table with a special name, which causes
        <code class="literal">InnoDB</code> to write Monitor output periodically.
        Also, output for the standard <code class="literal">InnoDB</code> Monitor
        is available on demand through the
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> SQL statement.
      </p><p>
        There are several types of <code class="literal">InnoDB</code> Monitors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The standard <code class="literal">InnoDB</code> Monitor displays the
            following types of information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Table and record locks held by each active transaction.
              </p></li><li class="listitem"><p>
                Lock waits of a transaction.
              </p></li><li class="listitem"><p>
                Semaphore waits of threads.
              </p></li><li class="listitem"><p>
                Pending file I/O requests.
              </p></li><li class="listitem"><p>
                Buffer pool statistics.
              </p></li><li class="listitem"><p>
                Purge and insert buffer merge activity of the main
                <code class="literal">InnoDB</code> thread.
</p></li></ul>
</div>
<p>
            For a discussion of <code class="literal">InnoDB</code> lock modes,
            see <a class="xref" href="storage-engines.html#innodb-lock-modes" title="14.2.3.2. InnoDB Lock Modes">Section 14.2.3.2, “<code class="literal">InnoDB</code> Lock Modes”</a>.
          </p><p>
            To enable the standard <code class="literal">InnoDB</code> Monitor for
            periodic output, create a table named
            <code class="literal">innodb_monitor</code>. To obtain Monitor output
            on demand, use the
            <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a> SQL statement to fetch the output to
            your client program. If you are using the
            <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> interactive client, the output is
            more readable if you replace the usual semicolon statement
            terminator with <code class="literal">\G</code>:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
</pre></li><li class="listitem"><p>
            The <code class="literal">InnoDB</code> Lock Monitor is like the
            standard Monitor but also provides extensive lock
            information. To enable this Monitor for periodic output,
            create a table named <code class="literal">innodb_lock_monitor</code>.
          </p></li><li class="listitem"><p>
            The <code class="literal">InnoDB</code> Tablespace Monitor prints a
            list of file segments in the shared tablespace and validates
            the tablespace allocation data structures. To enable this
            Monitor for periodic output, create a table named
            <code class="literal">innodb_tablespace_monitor</code>.
          </p></li><li class="listitem"><p>
            The <code class="literal">InnoDB</code> Table Monitor prints the
            contents of the <code class="literal">InnoDB</code> internal data
            dictionary. To enable this Monitor for periodic output,
            create a table named
            <code class="literal">innodb_table_monitor</code>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
              As of MySQL 5.6.3, the
              <code class="literal">innodb_table_monitor</code> table is
              deprecated and will be removed in a future MySQL release.
              Similar information can be obtained from
              <code class="literal">InnoDB</code>
              <code class="literal">INFORMATION_SCHEMA</code> tables. See
              <a class="xref" href="information-schema.html#innodb-i_s-tables" title="20.30. INFORMATION_SCHEMA Tables for InnoDB">Section 20.30, “<code class="literal">INFORMATION_SCHEMA</code> Tables for
    <code class="literal">InnoDB</code>”</a>.
</p>
</div>
</li></ul>
</div>
<p>
        To enable an <code class="literal">InnoDB</code> Monitor for periodic
        output, use a <code class="literal">CREATE TABLE</code> statement to
        create the table associated with the Monitor. For example, to
        enable the standard <code class="literal">InnoDB</code> Monitor, create
        the <code class="literal">innodb_monitor</code> table:
      </p><pre class="programlisting">CREATE TABLE innodb_monitor (a INT) ENGINE=INNODB;</pre><p>
        To stop the Monitor, drop the table:
      </p><pre class="programlisting">DROP TABLE innodb_monitor;</pre><p>
        The <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> syntax is just a
        way to pass a command to the <code class="literal">InnoDB</code> engine
        through MySQL's SQL parser: The only things that matter are the
        table name <code class="literal">innodb_monitor</code> and that it be an
        <code class="literal">InnoDB</code> table. The structure of the table is
        not relevant at all for the <code class="literal">InnoDB</code> Monitor.
        If you shut down the server, the Monitor does not restart
        automatically when you restart the server. Drop the Monitor
        table and issue a new <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> statement to start the Monitor. (This syntax may
        change in a future release.)
      </p><p>
        The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege is required
        to start or stop the <code class="literal">InnoDB</code> Monitor tables.
      </p><p>
        When you enable <code class="literal">InnoDB</code> Monitors for periodic
        output, <code class="literal">InnoDB</code> writes their output to the
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server standard error output
        (<code class="literal">stderr</code>). In this case, no output is sent to
        clients. When switched on, <code class="literal">InnoDB</code> Monitors
        print data about every 15 seconds. Server output usually is
        directed to the error log (see <a class="xref" href="server-administration.html#error-log" title="5.2.2. The Error Log">Section 5.2.2, “The Error Log”</a>).
        This data is useful in performance tuning. On Windows, start the
        server from a command prompt in a console window with the
        <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option if you want to
        direct the output to the window rather than to the error log.
      </p><p>
        <code class="literal">InnoDB</code> sends diagnostic output to
        <code class="literal">stderr</code> or to files rather than to
        <code class="literal">stdout</code> or fixed-size memory buffers, to avoid
        potential buffer overflows. As a side effect, the output of
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> is written to a status file in the MySQL data
        directory every fifteen seconds. The name of the file is
        <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>,
        where <em class="replaceable"><code>pid</code></em> is the server process ID.
        <code class="literal">InnoDB</code> removes the file for a normal
        shutdown. If abnormal shutdowns have occurred, instances of
        these status files may be present and must be removed manually.
        Before removing them, you might want to examine them to see
        whether they contain useful information about the cause of
        abnormal shutdowns. The
        <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
        file is created only if the configuration option
        <a class="link" href="storage-engines.html#option_mysqld_innodb-status-file"><code class="option">innodb-status-file=1</code></a> is set.
      </p><p>
        <code class="literal">InnoDB</code> Monitors should be enabled only when
        you actually want to see Monitor information because output
        generation does result in some performance decrement. Also, if
        you enable monitor output by creating the associated table, your
        error log may become quite large if you forget to remove the
        table later.
      </p><p>
        For additional information about <code class="literal">InnoDB</code>
        monitors, see:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Mark Leith:
            <a class="ulink" href="http://www.markleith.co.uk/?p=25" target="_top">InnoDB Table
            and Tablespace Monitors</a>
</p></li></ul>
</div>
<p>
        Each monitor begins with a header containing a timestamp and the
        monitor name. For example:
      </p><pre class="programlisting">================================================
090407 12:06:19 INNODB TABLESPACE MONITOR OUTPUT
================================================</pre><p>
        The header for the standard Monitor (<code class="literal">INNODB MONITOR
        OUTPUT</code>) is also used for the Lock Monitor because the
        latter produces the same output with the addition of extra lock
        information.
      </p><p>
        The following sections describe the output for each Monitor.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-standard-monitor"></a>14.2.4.4.1. <code class="literal">InnoDB</code> Standard Monitor and Lock Monitor Output</h5>
</div>
</div>
</div>
<p>
          The Lock Monitor is the same as the standard Monitor except
          that it includes additional lock information. Enabling either
          monitor for periodic output by creating the associated
          <code class="literal">InnoDB</code> table turns on the same output
          stream, but the stream includes the extra information if the
          Lock Monitor is enabled. For example, if you create the
          <code class="literal">innodb_monitor</code> and
          <code class="literal">innodb_lock_monitor</code> tables, that turns on a
          single output stream. The stream includes extra lock
          information until you disable the Lock Monitor by removing the
          <code class="literal">innodb_lock_monitor</code> table.
        </p><p>
          Example <code class="literal">InnoDB</code> Monitor output:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
*************************** 1. row ***************************
Status:
=====================================
030709 13:00:59 INNODB MONITOR OUTPUT
=====================================
Per second averages calculated from the last 18 seconds
----------
BACKGROUND THREAD
----------
srv_master_thread loops: 53 1_second, 44 sleeps, 5 10_second, 7 background,
  7 flush
srv_master_thread log flush and writes: 48
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 413452, signal count 378357
--Thread 32782 has waited at btr0sea.c line 1477 for 0.00 seconds the
semaphore: X-lock on RW-latch at 41a28668 created in file btr0sea.c line 135
a writer (thread id 32782) has reserved it in mode wait exclusive
number of readers 1, waiters flag 1
Last time read locked in file btr0sea.c line 731
Last time write locked in file btr0sea.c line 1347
Mutex spin waits 0, rounds 0, OS waits 0
RW-shared spins 2, rounds 60, OS waits 2
RW-excl spins 0, rounds 0, OS waits 0
Spin rounds per wait: 0.00 mutex, 20.00 RW-shared, 0.00 RW-excl
------------------------
LATEST FOREIGN KEY ERROR
------------------------
030709 13:00:59 Transaction:
TRANSACTION 0 290328284, ACTIVE 0 sec, process no 3195
inserting
15 lock struct(s), heap size 2496, undo log entries 9
MySQL thread id 25, query id 4668733 localhost heikki update
insert into ibtest11a (D, B, C) values (5, 'khDk' ,'khDk')
Foreign key constraint fails for table test/ibtest11a:
,
  CONSTRAINT `0_219242` FOREIGN KEY (`A`, `D`) REFERENCES `ibtest11b` (`A`,
  `D`) ON DELETE CASCADE ON UPDATE CASCADE
Trying to add in child table, in index PRIMARY tuple:
 0: len 4; hex 80000101; asc ....;; 1: len 4; hex 80000005; asc ....;; 2:
 len 4; hex 6b68446b; asc khDk;; 3: len 6; hex 0000114e0edc; asc ...N..;; 4:
 len 7; hex 00000000c3e0a7; asc .......;; 5: len 4; hex 6b68446b; asc khDk;;
But in parent table test/ibtest11b, in index PRIMARY,
the closest match we can find is record:
RECORD: info bits 0 0: len 4; hex 8000015b; asc ...[;; 1: len 4; hex
80000005; asc ....;; 2: len 3; hex 6b6864; asc khd;; 3: len 6; hex
0000111ef3eb; asc ......;; 4: len 7; hex 800001001e0084; asc .......;; 5:
len 3; hex 6b6864; asc khd;;
------------------------
LATEST DETECTED DEADLOCK
------------------------
030709 12:59:58
*** (1) TRANSACTION:
TRANSACTION 0 290252780, ACTIVE 1 sec, process no 3185
inserting
LOCK WAIT 3 lock struct(s), heap size 320, undo log entries 146
MySQL thread id 21, query id 4553379 localhost heikki update
INSERT INTO alex1 VALUES(86, 86, 794,'aA35818','bb','c79166','d4766t',
'e187358f','g84586','h794',date_format('2001-04-03 12:54:22','%Y-%m-%d
%H:%i'),7
*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 48310 n bits 568 table test/alex1 index
symbole trx id 0 290252780 lock mode S waiting
Record lock, heap no 324 RECORD: info bits 0 0: len 7; hex 61613335383138;
asc aa35818;; 1:
*** (2) TRANSACTION:
TRANSACTION 0 290251546, ACTIVE 2 sec, process no 3190
inserting
130 lock struct(s), heap size 11584, undo log entries 437
MySQL thread id 23, query id 4554396 localhost heikki update
REPLACE INTO alex1 VALUES(NULL, 32, NULL,'aa3572','','c3572','d6012t','',
NULL,'h396', NULL, NULL, 7.31,7.31,7.31,200)
*** (2) HOLDS THE LOCK(S):
RECORD LOCKS space id 0 page no 48310 n bits 568 table test/alex1 index
symbole trx id 0 290251546 lock_mode X locks rec but not gap
Record lock, heap no 324 RECORD: info bits 0 0: len 7; hex 61613335383138;
asc aa35818;; 1:
*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 48310 n bits 568 table test/alex1 index
symbole trx id 0 290251546 lock_mode X locks gap before rec insert intention
waiting
Record lock, heap no 82 RECORD: info bits 0 0: len 7; hex 61613335373230;
asc aa35720;; 1:
*** WE ROLL BACK TRANSACTION (1)
------------
TRANSACTIONS
------------
Trx id counter 0 290328385
Purge done for trx's n:o &lt; 0 290315608 undo n:o &lt; 0 17
History list length 20
Total number of lock structs in row lock hash table 70
LIST OF TRANSACTIONS FOR EACH SESSION:
---TRANSACTION 0 0, not started, process no 3491
MySQL thread id 32, query id 4668737 localhost heikki
show innodb status
---TRANSACTION 0 290328384, ACTIVE 0 sec, process no 3205
38929 inserting
1 lock struct(s), heap size 320
MySQL thread id 29, query id 4668736 localhost heikki update
insert into speedc values (1519229,1, 'hgjhjgghggjgjgjgjgjggjgjgjgjgjgggjgjg
jlhhgghggggghhjhghgggggghjhghghghghghhhhghghghjhhjghjghjkghjghjghjghjfhjfh
---TRANSACTION 0 290328383, ACTIVE 0 sec, process no 3180
28684 committing
1 lock struct(s), heap size 320, undo log entries 1
MySQL thread id 19, query id 4668734 localhost heikki update
insert into speedcm values (1603393,1, 'hgjhjgghggjgjgjgjgjggjgjgjgjgjgggjgj
gjlhhgghggggghhjhghgggggghjhghghghghghhhhghghghjhhjghjghjkghjghjghjghjfhjf
---TRANSACTION 0 290328327, ACTIVE 0 sec, process no 3200
36880 starting index read
LOCK WAIT 2 lock struct(s), heap size 320
MySQL thread id 27, query id 4668644 localhost heikki Searching rows for
update
update ibtest11a set B = 'kHdkkkk' where A = 89572
------- TRX HAS BEEN WAITING 0 SEC FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 65556 n bits 232 table test/ibtest11a index
PRIMARY trx id 0 290328327 lock_mode X waiting
Record lock, heap no 1 RECORD: info bits 0 0: len 9; hex 73757072656d756d00;
asc supremum.;;
------------------
---TRANSACTION 0 290328284, ACTIVE 0 sec, process no 3195
34831 rollback of SQL statement
ROLLING BACK 14 lock struct(s), heap size 2496, undo log entries 9
MySQL thread id 25, query id 4668733 localhost heikki update
insert into ibtest11a (D, B, C) values (5, 'khDk' ,'khDk')
---TRANSACTION 0 290327208, ACTIVE 1 sec, process no 3190
32782
58 lock struct(s), heap size 5504, undo log entries 159
MySQL thread id 23, query id 4668732 localhost heikki update
REPLACE INTO alex1 VALUES(86, 46, 538,'aa95666','bb','c95666','d9486t',
'e200498f','g86814','h538',date_format('2001-04-03 12:54:22','%Y-%m-%d
%H:%i'),
---TRANSACTION 0 290323325, ACTIVE 3 sec, process no 3185
30733 inserting
4 lock struct(s), heap size 1024, undo log entries 165
MySQL thread id 21, query id 4668735 localhost heikki update
INSERT INTO alex1 VALUES(NULL, 49, NULL,'aa42837','','c56319','d1719t','',
NULL,'h321', NULL, NULL, 7.31,7.31,7.31,200)
--------
FILE I/O
--------
I/O thread 0 state: waiting for i/o request (insert buffer thread)
I/O thread 1 state: waiting for i/o request (log thread)
I/O thread 2 state: waiting for i/o request (read thread)
I/O thread 3 state: waiting for i/o request (write thread)
Pending normal aio reads: 0, aio writes: 0,
 ibuf aio reads: 0, log i/o's: 0, sync i/o's: 0
Pending flushes (fsync) log: 0; buffer pool: 0
151671 OS file reads, 94747 OS file writes, 8750 OS fsyncs
25.44 reads/s, 18494 avg bytes/read, 17.55 writes/s, 2.33 fsyncs/s
-------------------------------------
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf for space 0: size 1, free list len 19, seg size 21,
85004 inserts, 85004 merged recs, 26669 merges
Hash table size 207619, used cells 14461, node heap has 16 buffer(s)
1877.67 hash searches/s, 5121.10 non-hash searches/s
---
LOG
---
Log sequence number 18 1212842764
Log flushed up to   18 1212665295
Last checkpoint at  18 1135877290
0 pending log writes, 0 pending chkp writes
4341 log i/o's done, 1.22 log i/o's/second
----------------------
BUFFER POOL AND MEMORY
----------------------
Total memory allocated 84966343; in additional pool allocated 1402624
Buffer pool size   3200
Free buffers       110
Database pages     3074
Modified db pages  2674
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages read 171380, created 51968, written 194688
28.72 reads/s, 20.72 creates/s, 47.55 writes/s
Buffer pool hit rate 999 / 1000
--------------
ROW OPERATIONS
--------------
0 queries inside InnoDB, 0 queries in queue
Main thread process no. 3004, id 7176, state: purging
Number of rows inserted 3738558, updated 127415, deleted 33707, read 755779
1586.13 inserts/s, 50.89 updates/s, 28.44 deletes/s, 107.88 reads/s
----------------------------
END OF INNODB MONITOR OUTPUT
============================
</pre><p>
          <code class="literal">InnoDB</code> Monitor output is limited to 1MB
          when produced using the
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> statement. This limit does not apply
          to output written to the server's error output.
        </p><p>
          Some notes on the output sections:
        </p><p>
          <span class="bold"><strong><code class="literal">Status</code></strong></span>
        </p><p>
          This section shows the timestamp, the monitor name, and the
          number of seconds that per-second averages are based on. The
          number of seconds is the elapsed time between the current time
          and the last time <code class="literal">InnoDB</code> Monitor output was
          printed.
        </p><p>
          <span class="bold"><strong><code class="literal">BACKGROUND
          THREAD</code></strong></span>
        </p><p>
          The <code class="literal">srv_master_thread</code> lines shows work done
          by the main background thread.
        </p><p>
          <span class="bold"><strong><code class="literal">SEMAPHORES</code></strong></span>
        </p><p>
          This section reports threads waiting for a semaphore and
          statistics on how many times threads have needed a spin or a
          wait on a mutex or a rw-lock semaphore. A large number of
          threads waiting for semaphores may be a result of disk I/O, or
          contention problems inside <code class="literal">InnoDB</code>.
          Contention can be due to heavy parallelism of queries or
          problems in operating system thread scheduling. Setting the
          <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
          system variable smaller than the default value might help in
          such situations. The <code class="literal">Spin rounds per wait</code>
          line shows the number of spinlock rounds per OS wait for a
          mutex.
        </p><p>
          <span class="bold"><strong><code class="literal">LATEST FOREIGN KEY
          ERROR</code></strong></span>
        </p><p>
          This section provides information about the most recent
          foreign key constraint error. It is not present if no such
          error has occurred. The contents include the statement that
          failed as well as information about the constraint that failed
          and the referenced and referencing tables.
        </p><p>
          <span class="bold"><strong><code class="literal">LATEST DETECTED
          DEADLOCK</code></strong></span>
        </p><p>
          This section provides information about the most recent
          deadlock. It is not present if no deadlock has occurred. The
          contents show which transactions are involved, the statement
          each was attempting to execute, the locks they have and need,
          and which transaction <code class="literal">InnoDB</code> decided to
          roll back to break the deadlock. The lock modes reported in
          this section are explained in
          <a class="xref" href="storage-engines.html#innodb-lock-modes" title="14.2.3.2. InnoDB Lock Modes">Section 14.2.3.2, “<code class="literal">InnoDB</code> Lock Modes”</a>.
        </p><p>
          <span class="bold"><strong><code class="literal">TRANSACTIONS</code></strong></span>
        </p><p>
          If this section reports lock waits, your applications might
          have lock contention. The output can also help to trace the
          reasons for transaction deadlocks.
        </p><p>
          <span class="bold"><strong><code class="literal">FILE I/O</code></strong></span>
        </p><p>
          This section provides information about threads that
          <code class="literal">InnoDB</code> uses to perform various types of
          I/O. The first few of these are dedicated to general
          <code class="literal">InnoDB</code> processing. The contents also
          display information for pending I/O operations and statistics
          for I/O performance.
        </p><p>
          The number of these threads are controlled by the
          <a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
          <a class="link" href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>
          parameters. See <a class="xref" href="storage-engines.html#innodb-parameters" title="14.2.6. InnoDB Startup Options and System Variables">Section 14.2.6, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a>.
        </p><p>
          <span class="bold"><strong><code class="literal">INSERT BUFFER AND ADAPTIVE HASH
          INDEX</code></strong></span>
        </p><p>
          This section shows the status of the <code class="literal">InnoDB</code>
          insert buffer and adaptive hash index. (See
          <a class="xref" href="storage-engines.html#innodb-insert-buffering" title="14.2.3.12.5. Insert Buffering">Section 14.2.3.12.5, “Insert Buffering”</a>, and
          <a class="xref" href="storage-engines.html#innodb-adaptive-hash" title="14.2.3.12.6. Adaptive Hash Indexes">Section 14.2.3.12.6, “Adaptive Hash Indexes”</a>.) The contents include
          the number of operations performed for each, plus statistics
          for hash index performance.
        </p><p>
          <span class="bold"><strong><code class="literal">LOG</code></strong></span>
        </p><p>
          This section displays information about the
          <code class="literal">InnoDB</code> log. The contents include the
          current log sequence number, how far the log has been flushed
          to disk, and the position at which <code class="literal">InnoDB</code>
          last took a checkpoint. (See
          <a class="xref" href="server-administration.html#innodb-checkpoints" title="5.3.3. InnoDB Checkpoints">Section 5.3.3, “<code class="literal">InnoDB</code> Checkpoints”</a>.) The section also
          displays information about pending writes and write
          performance statistics.
        </p><p>
          <span class="bold"><strong><code class="literal">BUFFER POOL AND
          MEMORY</code></strong></span>
        </p><p>
          This section gives you statistics on pages read and written.
          You can calculate from these numbers how many data file I/O
          operations your queries currently are doing.
        </p><p>
          For additional information about the operation of the buffer
          pool, see <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
        </p><p>
          <span class="bold"><strong><code class="literal">ROW
          OPERATIONS</code></strong></span>
        </p><p>
          This section shows what the main thread is doing, including
          the number and performance rate for each type of row
          operation.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-tablespace-monitor"></a>14.2.4.4.2. <code class="literal">InnoDB</code> Tablespace Monitor Output</h5>

</div>

</div>

</div>
<p>
          The <code class="literal">InnoDB</code> Tablespace Monitor prints
          information about the file segments in the shared tablespace
          and validates the tablespace allocation data structures. If
          you use individual tablespaces by enabling
          <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>, the
          Tablespace Monitor does not describe those tablespaces.
        </p><p>
          Example <code class="literal">InnoDB</code> Tablespace Monitor output:
        </p><pre class="programlisting">================================================
090408 21:28:09 INNODB TABLESPACE MONITOR OUTPUT
================================================
FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845
SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14
SEGMENT id 0 2 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 3 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0
SEGMENT id 0 488 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 17 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 171 space 0; page 2; res 592 used 481; full ext 7
fragm pages 16; free extents 0; not full extents 2: pages 17
SEGMENT id 0 172 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 173 space 0; page 2; res 96 used 44; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 12
...
SEGMENT id 0 601 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
NUMBER of file segments: 73
Validating tablespace
Validation ok
---------------------------------------
END OF INNODB TABLESPACE MONITOR OUTPUT
=======================================</pre><p>
          The Tablespace Monitor output includes information about the
          shared tablespace as a whole, followed by a list containing a
          breakdown for each segment within the tablespace.
        </p><p>
          In this example using the default
          <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>, the
          tablespace consists of database pages that are 16KB each. The
          pages are grouped into
          <a class="link" href="glossary.html#glos_extent" title="extent">extents</a> of size 1MB (64
          consecutive pages).
        </p><p>
          The initial part of the output that displays overall
          tablespace information has this format:
        </p><pre class="programlisting">FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845</pre><p>
          Overall tablespace information includes these values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">id</code>: The tablespace ID. A value of 0
              refers to the shared tablespace.
            </p></li><li class="listitem"><p>
              <code class="literal">size</code>: The current tablespace size in
              pages.
            </p></li><li class="listitem"><p>
              <code class="literal">free limit</code>: The minimum page number for
              which the free list has not been initialized. Pages at or
              above this limit are free.
            </p></li><li class="listitem"><p>
              <code class="literal">free extents</code>: The number of free
              extents.
            </p></li><li class="listitem"><p>
              <code class="literal">not full frag extents</code>, <code class="literal">used
              pages</code>: The number of fragment extents that are
              not completely filled, and the number of pages in those
              extents that have been allocated.
            </p></li><li class="listitem"><p>
              <code class="literal">full frag extents</code>: The number of
              completely full fragment extents.
            </p></li><li class="listitem"><p>
              <code class="literal">first seg id not used</code>: The first unused
              segment ID.
</p></li></ul>
</div>
<p>
          Individual segment information has this format:
        </p><pre class="programlisting">SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0</pre><p>
          Segment information includes these values:
        </p><p>
          <code class="literal">id</code>: The segment ID.
        </p><p>
          <code class="literal">space</code>, <code class="literal">page</code>: The
          tablespace number and page within the tablespace where the
          segment <span class="quote">“<span class="quote">inode</span>”</span> is located. A tablespace number
          of 0 indicates the shared tablespace.
          <code class="literal">InnoDB</code> uses inodes to keep track of
          segments in the tablespace. The other fields displayed for a
          segment (<code class="literal">id</code>, <code class="literal">res</code>, and so
          forth) are derived from information in the inode.
        </p><p>
          <code class="literal">res</code>: The number of pages allocated
          (reserved) for the segment.
        </p><p>
          <code class="literal">used</code>: The number of allocated pages in use
          by the segment.
        </p><p>
          <code class="literal">full ext</code>: The number of extents allocated
          for the segment that are completely used.
        </p><p>
          <code class="literal">fragm pages</code>: The number of initial pages
          that have been allocated to the segment.
        </p><p>
          <code class="literal">free extents</code>: The number of extents
          allocated for the segment that are completely unused.
        </p><p>
          <code class="literal">not full extents</code>: The number of extents
          allocated for the segment that are partially used.
        </p><p>
          <code class="literal">pages</code>: The number of pages used within the
          not-full extents.
        </p><p>
          When a segment grows, it starts as a single page, and
          <code class="literal">InnoDB</code> allocates the first pages for it one
          at a time, up to 32 pages (this is the <code class="literal">fragm
          pages</code> value). After that, <code class="literal">InnoDB</code>
          allocates complete extents. <code class="literal">InnoDB</code> can add
          up to 4 extents at a time to a large segment to ensure good
          sequentiality of data.
        </p><p>
          For the example segment shown earlier, it has 32 fragment
          pages, plus 2 full extents (64 pages each), for a total of 160
          pages used out of 160 pages allocated. The following segment
          has 32 fragment pages and one partially full extent using 14
          pages for a total of 46 pages used out of 96 pages allocated:
        </p><pre class="programlisting">SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14</pre><p>
          It is possible for a segment that has extents allocated to it
          to have a <code class="literal">fragm pages</code> value less than 32 if
          some of the individual pages have been deallocated subsequent
          to extent allocation.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-table-monitor"></a>14.2.4.4.3. <code class="literal">InnoDB</code> Table Monitor Output</h5>

</div>

</div>

</div>
<p>
          The <code class="literal">InnoDB</code> Table Monitor prints the
          contents of the <code class="literal">InnoDB</code> internal data
          dictionary.
        </p><p>
          The output contains one section per table. The
          <code class="literal">SYS_FOREIGN</code> and
          <code class="literal">SYS_FOREIGN_COLS</code> sections are for internal
          data dictionary tables that maintain information about foreign
          keys. There are also sections for the Table Monitor table and
          each user-created <code class="literal">InnoDB</code> table. Suppose
          that the following two tables have been created in the
          <code class="literal">test</code> database:
        </p><pre class="programlisting">CREATE TABLE parent
(
  par_id    INT NOT NULL,
  fname      CHAR(20),
  lname      CHAR(20),
  PRIMARY KEY (par_id),
  UNIQUE INDEX (lname, fname)
) ENGINE = INNODB;

CREATE TABLE child
(
  par_id      INT NOT NULL,
  child_id    INT NOT NULL,
  name        VARCHAR(40),
  birth       DATE,
  weight      DECIMAL(10,2),
  misc_info   VARCHAR(255),
  last_update TIMESTAMP,
  PRIMARY KEY (par_id, child_id),
  INDEX (name),
  FOREIGN KEY (par_id) REFERENCES parent (par_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE = INNODB;</pre><p>
          Then the Table Monitor output will look something like this
          (reformatted slightly):
        </p><pre class="programlisting">===========================================
090420 12:09:32 INNODB TABLE MONITOR OUTPUT
===========================================
--------------------------------------
TABLE: name SYS_FOREIGN, id 0 11, columns 7, indexes 3, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           FOR_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           N_COLS: DATA_INT len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 11, fields 1/6, uniq 1, type 3
   root page 46, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID DB_TRX_ID DB_ROLL_PTR FOR_NAME REF_NAME N_COLS
  INDEX: name FOR_IND, id 0 12, fields 1/2, uniq 2, type 0
   root page 47, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  FOR_NAME ID
  INDEX: name REF_IND, id 0 13, fields 1/2, uniq 2, type 0
   root page 48, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  REF_NAME ID
--------------------------------------
TABLE: name SYS_FOREIGN_COLS, id 0 12, columns 7, indexes 1, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           POS: DATA_INT len 4;
           FOR_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 14, fields 2/6, uniq 2, type 3
   root page 49, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID POS DB_TRX_ID DB_ROLL_PTR FOR_COL_NAME REF_COL_NAME
--------------------------------------
TABLE: name test/child, id 0 14, columns 10, indexes 2, appr.rows 201
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           child_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           name: DATA_VARCHAR prtype 524303 len 40;
           birth: DATA_INT DATA_BINARY_TYPE len 3;
           weight: DATA_FIXBINARY DATA_BINARY_TYPE len 5;
           misc_info: DATA_VARCHAR prtype 524303 len 255;
           last_update: DATA_INT DATA_UNSIGNED DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 17, fields 2/9, uniq 2, type 3
   root page 52, appr.key vals 201, leaf pages 5, size pages 6
   FIELDS:  par_id child_id DB_TRX_ID DB_ROLL_PTR name birth weight misc_info last_update
  INDEX: name name, id 0 18, fields 1/3, uniq 3, type 0
   root page 53, appr.key vals 210, leaf pages 1, size pages 1
   FIELDS:  name par_id child_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
--------------------------------------
TABLE: name test/innodb_table_monitor, id 0 15, columns 4, indexes 1, appr.rows 0
  COLUMNS: i: DATA_INT DATA_BINARY_TYPE len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name GEN_CLUST_INDEX, id 0 19, fields 0/4, uniq 1, type 1
   root page 193, appr.key vals 0, leaf pages 1, size pages 1
   FIELDS:  DB_ROW_ID DB_TRX_ID DB_ROLL_PTR i
--------------------------------------
TABLE: name test/parent, id 0 13, columns 6, indexes 2, appr.rows 299
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           fname: DATA_CHAR prtype 524542 len 20;
           lname: DATA_CHAR prtype 524542 len 20;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 15, fields 1/5, uniq 1, type 3
   root page 50, appr.key vals 299, leaf pages 2, size pages 3
   FIELDS:  par_id DB_TRX_ID DB_ROLL_PTR fname lname
  INDEX: name lname, id 0 16, fields 2/3, uniq 2, type 2
   root page 51, appr.key vals 300, leaf pages 1, size pages 1
   FIELDS:  lname fname par_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
-----------------------------------
END OF INNODB TABLE MONITOR OUTPUT
==================================</pre><p>
          For each table, Table Monitor output contains a section that
          displays general information about the table and specific
          information about its columns, indexes, and foreign keys.
        </p><p>
          The general information for each table includes the table name
          (in
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em></code>
          format except for internal tables), its ID, the number of
          columns and indexes, and an approximate row count.
        </p><p>
          The <code class="literal">COLUMNS</code> part of a table section lists
          each column in the table. Information for each column
          indicates its name and data type characteristics. Some
          internal columns are added by <code class="literal">InnoDB</code>, such
          as <code class="literal">DB_ROW_ID</code> (row ID),
          <code class="literal">DB_TRX_ID</code> (transaction ID), and
          <code class="literal">DB_ROLL_PTR</code> (a pointer to the rollback/undo
          data).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code>:
              These symbols indicate the data type. There may be
              multiple
              <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code>
              symbols for a given column.
            </p></li><li class="listitem"><p>
              <code class="literal">prtype</code>: The column's
              <span class="quote">“<span class="quote">precise</span>”</span> type. This field includes
              information such as the column data type, character set
              code, nullability, signedness, and whether it is a binary
              string. This field is described in the
              <code class="filename">innobase/include/data0type.h</code> source
              file.
            </p></li><li class="listitem"><p>
              <code class="literal">len</code>: The column length in bytes.
</p></li></ul>
</div>
<p>
          Each <code class="literal">INDEX</code> part of the table section
          provides the name and characteristics of one table index:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">name</code>: The index name. If the name is
              <code class="literal">PRIMARY</code>, the index is a primary key. If
              the name is <code class="literal">GEN_CLUST_INDEX</code>, the index
              is the clustered index that is created automatically if
              the table definition doesn't include a primary key or
              non-<code class="literal">NULL</code> unique index. See
              <a class="xref" href="storage-engines.html#innodb-index-types" title="14.2.3.12.2. Clustered and Secondary Indexes">Section 14.2.3.12.2, “Clustered and Secondary Indexes”</a>.
            </p></li><li class="listitem"><p>
              <code class="literal">id</code>: The index ID.
            </p></li><li class="listitem"><p>
              <code class="literal">fields</code>: The number of fields in the
              index, as a value in
              <code class="literal"><em class="replaceable"><code>m</code></em>/<em class="replaceable"><code>n</code></em></code>
              format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>m</code></em> is the number of
                  user-defined columns; that is, the number of columns
                  you would see in the index definition in a
                  <code class="literal">CREATE TABLE</code> statement.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>n</code></em> is the total number of
                  index columns, including those added internally. For
                  the clustered index, the total includes the other
                  columns in the table definition, plus any columns
                  added internally. For a secondary index, the total
                  includes the columns from the primary key that are not
                  part of the secondary index.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              <code class="literal">uniq</code>: The number of leading fields that
              are enough to determine index values uniquely.
            </p></li><li class="listitem"><p>
              <code class="literal">type</code>: The index type. This is a bit
              field. For example, 1 indicates a clustered index and 2
              indicates a unique index, so a clustered index (which
              always contains unique values), will have a
              <code class="literal">type</code> value of 3. An index with a
              <code class="literal">type</code> value of 0 is neither clustered
              nor unique. The flag values are defined in the
              <code class="filename">innobase/include/dict0mem.h</code> source
              file.
            </p></li><li class="listitem"><p>
              <code class="literal">root page</code>: The index root page number.
            </p></li><li class="listitem"><p>
              <code class="literal">appr. key vals</code>: The approximate index
              cardinality.
            </p></li><li class="listitem"><p>
              <code class="literal">leaf pages</code>: The approximate number of
              leaf pages in the index.
            </p></li><li class="listitem"><p>
              <code class="literal">size pages</code>: The approximate total
              number of pages in the index.
            </p></li><li class="listitem"><p>
              <code class="literal">FIELDS</code>: The names of the fields in the
              index. For a clustered index that was generated
              automatically, the field list begins with the internal
              <code class="literal">DB_ROW_ID</code> (row ID) field.
              <code class="literal">DB_TRX_ID</code> and
              <code class="literal">DB_ROLL_PTR</code> are always added internally
              to the clustered index, following the fields that comprise
              the primary key. For a secondary index, the final fields
              are those from the primary key that are not part of the
              secondary index.
</p></li></ul>
</div>
<p>
          The end of the table section lists the <code class="literal">FOREIGN
          KEY</code> definitions that apply to the table. This
          information appears whether the table is a referencing or
          referenced table.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-troubleshooting"></a>14.2.4.5. <code class="literal">InnoDB</code> General Troubleshooting</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp85982928"></a><p>
        The following general guidelines apply to troubleshooting
        <code class="literal">InnoDB</code> problems:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When an operation fails or you suspect a bug, look at the
            MySQL server error log (see <a class="xref" href="server-administration.html#error-log" title="5.2.2. The Error Log">Section 5.2.2, “The Error Log”</a>).
          </p></li><li class="listitem"><p>
            If the failure is related to a
            <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, run with the
            <a class="link" href="storage-engines.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
            option enabled so that details about each
            <code class="literal">InnoDB</code> deadlock are printed to the MySQL
            server error log.
          </p></li><li class="listitem"><p>
            Issues relating to the <code class="literal">InnoDB</code> data
            dictionary include failed <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
            TABLE</code></a> statements (orphaned table files), inability
            to open <code class="filename">.InnoDB</code> files, and
            <span class="errortext">system cannot find the path specified</span>
            errors. For information about these sorts of problems and
            errors, see
            <a class="xref" href="storage-engines.html#innodb-troubleshooting-datadict" title="14.2.4.7. Troubleshooting InnoDB Data Dictionary Operations">Section 14.2.4.7, “Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations”</a>.
          </p></li><li class="listitem"><p>
            When troubleshooting, it is usually best to run the MySQL
            server from the command prompt, rather than through
            <a class="link" href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> or as a Windows service. You
            can then see what <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> prints to the
            console, and so have a better grasp of what is going on. On
            Windows, start <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
            <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option to direct
            the output to the console window.
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idp86000016"></a>

            <a class="indexterm" name="idp86001504"></a>

            

            Use the <code class="literal">InnoDB</code> Monitors to obtain
            information about a problem (see
            <a class="xref" href="storage-engines.html#innodb-monitors" title="14.2.4.4. SHOW ENGINE INNODB STATUS and the InnoDB Monitors">Section 14.2.4.4, “<code class="literal">SHOW ENGINE INNODB
        STATUS</code> and the <code class="literal">InnoDB</code> Monitors”</a>). If the problem is
            performance-related, or your server appears to be hung, use
            the standard Monitor to print information about the internal
            state of <code class="literal">InnoDB</code>. If the problem is with
            locks, use the Lock Monitor. If the problem is in creation
            of tables or other data dictionary operations, use the Table
            Monitor to print the contents of the
            <code class="literal">InnoDB</code> internal data dictionary. To see
            tablespace information use the Tablespace Monitor.
          </p></li><li class="listitem"><p>
            If you suspect that a table is corrupt, run
            <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> on that table.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="error-creating-innodb"></a>14.2.4.5.1. Troubleshooting <code class="literal">InnoDB</code> I/O Problems</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp86011696"></a><p>
          The troubleshooting steps for <code class="literal">InnoDB</code> I/O
          problems depend on when the problem occurs: during startup of
          the MySQL server, or during normal operations when a DML or
          DDL statement fails due to problems at the file system level.
        </p><h6><a name="idp86014976"></a>
          Initialization Problems
        </h6><p>
          If something goes wrong when <code class="literal">InnoDB</code>
          attempts to initialize its tablespace or its log files, delete
          all files created by <code class="literal">InnoDB</code>: all
          <code class="filename">ibdata</code> files and all
          <code class="filename">ib_logfile</code> files. If you already created
          some <code class="literal">InnoDB</code> tables, also delete the
          corresponding <code class="filename">.frm</code> files for these
          tables, and any <code class="filename">.ibd</code> files if you are
          using multiple tablespaces, from the MySQL database
          directories. Then try the <code class="literal">InnoDB</code> database
          creation again. For easiest troubleshooting, start the MySQL
          server from a command prompt so that you see what is
          happening.
        </p><h6><a name="idp86022096"></a>
          Runtime Problems
        </h6><p>
          If <code class="literal">InnoDB</code> prints an operating system error
          during a file operation, usually the problem has one of the
          following solutions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Make sure the <code class="literal">InnoDB</code> data file
              directory and the <code class="literal">InnoDB</code> log directory
              exist.
            </p></li><li class="listitem"><p>
              Make sure <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has access rights to
              create files in those directories.
            </p></li><li class="listitem"><p>
              Make sure <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can read the proper
              <code class="filename">my.cnf</code> or <code class="filename">my.ini</code>
              option file, so that it starts with the options that you
              specified.
            </p></li><li class="listitem"><p>
              Make sure the disk is not full and you are not exceeding
              any disk quota.
            </p></li><li class="listitem"><p>
              Make sure that the names you specify for subdirectories
              and data files do not clash.
            </p></li><li class="listitem"><p>
              Doublecheck the syntax of the
              <a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> and
              <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
              values. In particular, any <code class="literal">MAX</code> value in
              the <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
              option is a hard limit, and exceeding that limit causes a
              fatal error.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="forcing-innodb-recovery"></a>14.2.4.6. Starting <code class="literal">InnoDB</code> on a Corrupted Database</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86039456"></a><a class="indexterm" name="idp86041360"></a><a class="indexterm" name="idp86042864"></a><p>
        To investigate database page corruption, you might dump your
        tables from the database with
        <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1. SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
        OUTFILE</code></a>. Usually, most of the data obtained in this
        way is intact. Serious corruption might cause <code class="literal">SELECT *
        FROM <em class="replaceable"><code>tbl_name</code></em></code> statements or
        <code class="literal">InnoDB</code> background operations to crash or
        assert, or even cause <code class="literal">InnoDB</code> roll-forward
        recovery to crash. In such cases, use the
        <a class="link" href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> option to
        force the <code class="literal">InnoDB</code> storage engine to start up
        while preventing background operations from running, so that you
        can dump your tables. For example, you can add the following
        line to the <code class="literal">[mysqld]</code> section of your option
        file before restarting the server:
      </p><pre class="programlisting">[mysqld]
innodb_force_recovery = 4</pre><p>
        <a class="link" href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is 0 by
        default (normal startup without forced recovery). The
        permissible nonzero values for
        <a class="link" href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> follow. A
        larger number includes all precautions of smaller numbers. If
        you can dump your tables with an option value of at most 4, then
        you are relatively safe that only some data on corrupt
        individual pages is lost. A value of 6 is more drastic because
        database pages are left in an obsolete state, which in turn may
        introduce more corruption into B-trees and other database
        structures.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">1</code>
            (<code class="literal">SRV_FORCE_IGNORE_CORRUPT</code>)
          </p><p>
            Lets the server run even if it detects a corrupt
            <a class="link" href="glossary.html#glos_page" title="page">page</a>. Tries to make
            <code class="literal">SELECT * FROM
            <em class="replaceable"><code>tbl_name</code></em></code> jump over
            corrupt index records and pages, which helps in dumping
            tables.
          </p></li><li class="listitem"><p>
            <code class="literal">2</code>
            (<code class="literal">SRV_FORCE_NO_BACKGROUND</code>)
          </p><p>
            Prevents the <a class="link" href="glossary.html#glos_master_thread" title="master thread">master
            thread</a> and any
            <a class="link" href="glossary.html#glos_purge_thread" title="purge thread">purge threads</a> from
            running. If a crash would occur during the
            <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation, this
            recovery value prevents it.
          </p></li><li class="listitem"><p>
            <code class="literal">3</code>
            (<code class="literal">SRV_FORCE_NO_TRX_UNDO</code>)
          </p><p>
            Does not run transaction
            <a class="link" href="glossary.html#glos_rollback" title="rollback">rollbacks</a> after
            <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">4</code>
            (<code class="literal">SRV_FORCE_NO_IBUF_MERGE</code>)
          </p><p>
            Prevents <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert
            buffer</a> merge operations. If they would cause a crash,
            does not do them. Does not calculate table
            <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">5</code>
            (<code class="literal">SRV_FORCE_NO_UNDO_LOG_SCAN</code>)
          </p><p>
            Does not look at <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo
            logs</a> when starting the database:
            <code class="literal">InnoDB</code> treats even incomplete
            transactions as committed.
          </p></li><li class="listitem"><p>
            <code class="literal">6</code>
            (<code class="literal">SRV_FORCE_NO_LOG_REDO</code>)
          </p><p>
            Does not do the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo
            log</a> roll-forward in connection with recovery.
          </p><p>
            With this value, you might not be able to do queries other
            than a basic <code class="literal">SELECT * FROM t</code>, with no
            <code class="literal">WHERE</code>, <code class="literal">ORDER BY</code>, or
            other clauses. More complex queries could encounter
            corrupted data structures and fail.
          </p><p>
            If corruption within the table data prevents you from
            dumping the entire table contents, a query with an
            <code class="literal">ORDER BY <em class="replaceable"><code>primary_key</code></em>
            DESC</code> clause might be able to dump the portion of
            the table after the corrupted part.
</p></li></ul>
</div>
<p>
        <span class="emphasis"><em>The database must not otherwise be used with any
        nonzero value of
        <a class="link" href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a></em></span>.
        As a safety measure, <code class="literal">InnoDB</code> prevents
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations when
        <a class="link" href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is
        greater than 0.
      </p><p>
        You can <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> from tables to
        dump them, or <code class="literal">DROP</code> or
        <code class="literal">CREATE</code> tables even if forced recovery is
        used. If you know that a given table is causing a crash on
        rollback, you can drop it. You can also use this to stop a
        runaway rollback caused by a failing mass import or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>: kill the
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process and set
        <a class="link" href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> to
        <code class="literal">3</code> to bring the database up without the
        rollback, then <code class="literal">DROP</code> the table that is causing
        the runaway rollback.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-troubleshooting-datadict"></a>14.2.4.7. Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86100144"></a><p>
        Information about table definitions is stored both in the
        <code class="literal">.frm</code> files, and in the InnoDB
        <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>. If
        you move <code class="filename">.frm</code> files around, or if the
        server crashes in the middle of a data dictionary operation,
        these sources of information can become inconsistent.
</p>
<h5><a name="idp86104864"></a>
        Problem with CREATE TABLE
</h5>
<p>
        A symptom of an out-of-sync data dictionary is that a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement fails. If
        this occurs, look in the server's error log. If the log says
        that the table already exists inside the
        <code class="literal">InnoDB</code> internal data dictionary, you have an
        orphaned table inside the <code class="literal">InnoDB</code> tablespace
        files that has no corresponding <code class="filename">.frm</code> file.
        The error message looks like this:
      </p><pre class="programlisting">InnoDB: Error: table test/parent already exists in InnoDB internal
InnoDB: data dictionary. Have you deleted the .frm file
InnoDB: and not used DROP TABLE? Have you used DROP DATABASE
InnoDB: for InnoDB tables in MySQL version &lt;= 3.23.43?
InnoDB: See the Restrictions section of the InnoDB manual.
InnoDB: You can drop the orphaned table inside InnoDB by
InnoDB: creating an InnoDB table with the same name in another
InnoDB: database and moving the .frm file to the current database.
InnoDB: Then MySQL thinks the table exists, and DROP TABLE will
InnoDB: succeed.</pre><p>
        You can drop the orphaned table by following the instructions
        given in the error message. If you are still unable to use
        <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> successfully, the
        problem may be due to name completion in the
        <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client. To work around this problem,
        start the <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client with the
        <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--skip-auto-rehash</code></a>
        option and try <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> again.
        (With name completion on, <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> tries to
        construct a list of table names, which fails when a problem such
        as just described exists.)
</p>
<h5><a name="idp86117248"></a>
        Problem Opening Table
</h5>
<p>
        Another symptom of an out-of-sync data dictionary is that MySQL
        prints an error that it cannot open a
        <code class="filename">.InnoDB</code> file:
      </p><pre class="programlisting">ERROR 1016: Can't open file: 'child2.InnoDB'. (errno: 1)</pre><p>
        In the error log you can find a message like this:
      </p><pre class="programlisting">InnoDB: Cannot find table test/child2 from the internal data dictionary
InnoDB: of InnoDB though the .frm file for the table exists. Maybe you
InnoDB: have deleted and recreated InnoDB data files but have forgotten
InnoDB: to delete the corresponding .frm files of InnoDB tables?</pre><p>
        This means that there is an orphaned <code class="filename">.frm</code>
        file without a corresponding table inside
        <code class="literal">InnoDB</code>. You can drop the orphaned
        <code class="filename">.frm</code> file by deleting it manually.
</p><a class="indexterm" name="idp86123760"></a><a class="indexterm" name="idp86125248"></a><a class="indexterm" name="idp86126736"></a>
<h5><a name="idp86128224"></a>
        Problem with Temporary Table
</h5>
<p>
        If MySQL crashes in the middle of an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> operation, you may end up with an orphaned
        temporary table inside the <code class="literal">InnoDB</code> tablespace.
        Using the Table Monitor, you can see listed a table with a name
        that begins with <code class="filename">#sql-</code>. You can perform SQL
        statements on tables whose name contains the character
        <span class="quote">“<span class="quote"><code class="literal">#</code></span>”</span> if you enclose the name
        within backticks. Thus, you can drop such an orphaned table like
        any other orphaned table using the method described earlier. To
        copy or rename a file in the Unix shell, you need to put the
        file name in double quotation marks if the file name contains
        <span class="quote">“<span class="quote"><code class="literal">#</code></span>”</span>.
</p>
<h5><a name="idp86133584"></a>
        Problem with Missing Tablespace
</h5>
<p>
        With <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        enabled, the following message might occur if the
        <code class="literal">.frm</code> or <code class="literal">.ibd</code> files (or
        both) are missing:
      </p><pre class="programlisting">InnoDB: in InnoDB data dictionary has tablespace id <em class="replaceable"><code>N</code></em>,
InnoDB: but tablespace with that id or name does not exist. Have
InnoDB: you deleted or moved .ibd files?
InnoDB: This may also be a table created with CREATE TEMPORARY TABLE
InnoDB: whose .ibd and .frm files MySQL automatically removed, but the
InnoDB: table still exists in the InnoDB internal data dictionary.
</pre><p>
        If this occurs, try the following procedure to resolve the
        problem:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a matching <code class="filename">.frm</code> file in some
            other database directory and copy it to the database
            directory where the orphan table is located.
          </p></li><li class="listitem"><p>
            Issue <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> for the
            original table. That should successfully drop the table and
            <code class="literal">InnoDB</code> should print a warning to the
            error log that the <code class="filename">.ibd</code> file was
            missing.
</p></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-other-changes"></a>14.2.5. <code class="literal">InnoDB</code> Features for Flexibility, Ease of Use and
Reliability</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-read-only-instance">14.2.5.1. Support for Read-Only Media</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-redo-log-size-increase">14.2.5.2. Larger Size Limit for Redo Log Files</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-two-byte-collation-ids">14.2.5.3. 2-Byte Collation IDs for <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-file-formats">14.2.5.4. The Barracuda File Format</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-dynamic-parameters">14.2.5.5. Dynamic Control of System Configuration Parameters</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-truncate">14.2.5.6. <code class="literal">TRUNCATE TABLE</code> Reclaims Space</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-strict-mode">14.2.5.7. <code class="literal">InnoDB</code> Strict Mode</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-statistics-estimation">14.2.5.8. Controlling Optimizer Statistics Estimation</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-drop-index">14.2.5.9. Better Error Handling when Dropping Indexes</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-show-mutex">14.2.5.10. More Compact Output of <code class="literal">SHOW ENGINE INNODB MUTEX</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-readahead-counters">14.2.5.11. More Read-Ahead Statistics</a></span></dt></dl>
</div>
<p>
    This section describes several recently added InnoDB features that
    offer new flexibility and improve ease of use, reliability and
    performance. The <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>
    file format improves efficiency for storing large variable-length
    columns, and enables table
    <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>. Configuration
    options that once were unchangeable after startup, are now flexible
    and can be changed dynamically. Some improvements are automatic,
    such as faster and more efficient <code class="literal">TRUNCATE TABLE</code>.
    Others allow you the flexibility to control InnoDB behavior; for
    example, you can control whether certain problems cause errors or
    just warnings. And informational messages and error reporting
    continue to be made more user-friendly.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-read-only-instance"></a>14.2.5.1. Support for Read-Only Media</h4>
</div>
</div>
</div>
<p>
      You can now query <code class="literal">InnoDB</code> tables where the MySQL
      data directory is on read-only media, by enabling the
      <a class="link" href="storage-engines.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> configuration
      option at server startup.
</p>
<h5><a name="idp86153600"></a>
      How to Enable
</h5>
<p>
      To prepare an instance for read-only operation, make sure all the
      necessary information is <a class="link" href="glossary.html#glos_flush" title="flush">flushed</a>
      to the data files before storing it on the read-only medium. Run
      the server with change buffering disabled
      (<a class="link" href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=0</code></a>) and
      do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      To enable read-only mode for an entire MySQL instance, specify the
      following configuration options at server startup:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="storage-engines.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only=1</code></a>
        </p></li><li class="listitem"><p>
          If the instance is on read-only media such as a DVD or CD, or
          the <code class="filename">/var</code> directory is not writeable by
          all:
          <code class="literal">--pid-file=<em class="replaceable"><code>path_on_writeable_media</code></em></code>
          and <code class="literal">--event-scheduler=disabled</code>
</p></li></ul>
</div>
<h5><a name="idp86162816"></a>
      Usage Scenarios
</h5>
<p>
      This mode of operation is appropriate in situations such as:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Distributing a MySQL application, or a set of MySQL data, on a
          read-only storage medium such as a DVD or CD.
        </p></li><li class="listitem"><p>
          Multiple MySQL instances querying the same data directory
          simultaneously, typically in a data warehousing configuration.
          You might use this technique to avoid
          <a class="link" href="glossary.html#glos_bottleneck" title="bottleneck">bottlenecks</a> that can
          occur with a heavily loaded MySQL instance, or you might use
          different configuration options for the various instances to
          tune each one for particular kinds of queries.
        </p></li><li class="listitem"><p>
          Querying data that has been put into a read-only state for
          security or data integrity reasons, such as archived backup
          data.
</p></li></ul>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
        This feature is mainly intended for flexibility in distribution
        and deployment, rather than raw performance based on the
        read-only aspect. See
        <a class="xref" href="storage-engines.html#innodb-performance-ro-txn" title="14.2.4.2.3. Optimizations for Read-Only Transactions">Section 14.2.4.2.3, “Optimizations for Read-Only Transactions”</a> for ways to tune the
        performance of read-only queries, which do not require making
        the entire server read-only.
</p>
</div>
<h5><a name="idp86169552"></a>
      How It Works
</h5>
<p>
      When the server is run in read-only mode through the
      <a class="link" href="storage-engines.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> option,
      certain <code class="literal">InnoDB</code> features and components are
      reduced or turned off entirely:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          No <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
          buffering</a> is done, in particular no merges from the
          change buffer. To make sure the change buffer is empty when
          you prepare the instance for read-only operation, disable
          change buffering
          (<a class="link" href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=0</code></a>)
          and do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow
          shutdown</a> first.
        </p></li><li class="listitem"><p>
          There is no <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
          recovery</a> phase at startup. The instance must have
          performed a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow
          shutdown</a> before being put into the read-only state.
        </p></li><li class="listitem"><p>
          Because the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> is
          not used in read-only operation, you can set
          <a class="link" href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> to the
          smallest size possible (1 MB) before making the instance
          read-only.
        </p></li><li class="listitem"><p>
          All background threads other than I/O read threads are turned
          off. As a consequence, a read-only instance cannot encounter
          any <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a>.
        </p></li><li class="listitem"><p>
          Information about deadlocks, monitor output, and so on is not
          written to temporary files. As a consequence,
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> does not produce any output.
        </p></li><li class="listitem"><p>
          If the MySQL server is started with
          <a class="link" href="storage-engines.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> but the
          data directory is still on writeable media, the root user can
          still perform <a class="link" href="glossary.html#glos_dcl" title="DCL">DCL</a> operations
          such as <a class="link" href="sql-syntax.html#grant" title="13.7.1.4. GRANT Syntax"><code class="literal">GRANT</code></a> and
          <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6. REVOKE Syntax"><code class="literal">REVOKE</code></a>.
        </p></li><li class="listitem"><p>
          Changes to configuration option settings that would normally
          change the the behavior of write operations, have no effect
          when the server is in read-only mode.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_mvcc" title="MVCC">MVCC</a> processing to
          enforce <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation
          levels</a> is turned off. All queries read the latest
          version of a record, because update and deletes are not
          possible.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo log</a> is not used.
          Disable any settings for the
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> and
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
          configuration options.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-redo-log-size-increase"></a>14.2.5.2. Larger Size Limit for Redo Log Files</h4>

</div>

</div>

</div>
<p>
      Formerly, the combined size of the <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files was limited to
      4 gigabytes. Starting in MySQL 5.6.3, this size limit is raised to
      512GB.
    </p><p>
      You do not need any special upgrade process or file format to take
      advantage of this feature. The bytes that record the extra size
      information were already reserved and set to zero in the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
    </p><p>
      If you develop applications that interact with the
      <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_lsn" title="LSN">logical
      sequence number (LSN)</a> value, change your code to use
      guaranteed 64-bit variables to store and compare LSN values,
      rather than 32-bit variables.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-two-byte-collation-ids"></a>14.2.5.3. 2-Byte Collation IDs for <code class="literal">InnoDB</code> Tables</h4>

</div>

</div>

</div>
<p>
      <code class="literal">InnoDB</code> tables can now use collation IDs greater
      than 255. Currently, the collation IDs in this range are all
      user-defined. For example, the following <code class="literal">InnoDB</code>
      table can now be created, where formerly the collation ID of 359
      was beyond the range supported by <code class="literal">InnoDB</code>.
    </p><pre class="programlisting">sql&gt; show collation like 'ucs2_vn_ci';
+------------+---------+-----+---------+----------+---------+
| Collation  | Charset | Id  | Default | Compiled | Sortlen |
+------------+---------+-----+---------+----------+---------+
| ucs2_vn_ci | ucs2    | 359 |         |          |       8 |
+------------+---------+-----+---------+----------+---------+
1 row in set (0.00 sec)

mysql&gt; create table two_byte_collation (c1 char(1) character set ucs2 collate ucs2_vn_ci)
  -&gt; engine = InnoDB;
Query OK, 0 rows affected (0.16 sec)</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-file-formats"></a>14.2.5.4. The Barracuda File Format</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86209264"></a><a class="indexterm" name="idp86210768"></a><a class="indexterm" name="idp86212256"></a><a class="indexterm" name="idp86213760"></a><p>
      InnoDB has started using named file formats to improve
      compatibility in upgrade and downgrade situations, or
      heterogeneous systems running different levels of MySQL. Many
      important InnoDB features, such as table compression and the
      <code class="literal">DYNAMIC</code> row format for more efficient BLOB
      storage, require creating tables in the
      <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format. The
      original file format, which previously didn't have a name, is
      known now as <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a>.
    </p><p>
      To create new tables that take advantage of the Barracuda
      features, enable that file format using the configuration
      parameter <a class="link" href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>. The
      value of this parameter determines whether a newly created table
      or index can use compression or the new <code class="literal">DYNAMIC</code>
      row format.
    </p><p>
      To preclude the use of new features that would make your database
      inaccessible to the built-in InnoDB in MySQL 5.1 and prior
      releases, omit <a class="link" href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
      or set it to Antelope.
    </p><p>
      You can set the value of
      <a class="link" href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> on the command
      line when you start <code class="literal">mysqld</code>, or in the option
      file <code class="literal">my.cnf</code> (Unix operating systems) or
      <code class="literal">my.ini</code> (Windows). You can also change it
      dynamically with the <code class="literal">SET GLOBAL</code> statement.
    </p><p>
      For more information about managing file formats, see
      <a class="xref" href="server-administration.html#innodb-file-format" title="5.4.7. InnoDB File-Format Management">Section 5.4.7, “<code class="literal">InnoDB</code> File-Format Management”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-dynamic-parameters"></a>14.2.5.5. Dynamic Control of System Configuration Parameters</h4>

</div>

</div>

</div>
<p>
      In MySQL 5.5 and higher, you can change certain system
      configuration parameters without shutting down and restarting the
      server, as was necessary in MySQL 5.1 and lower. This increases
      uptime, and makes it easier to test and prototype new SQL and
      application code. The following sections explain these parameters.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-other-changes-innodb_file_per_table"></a>14.2.5.5.1. Dynamically Changing <code class="literal">innodb_file_per_table</code></h5>
</div>
</div>
</div>
<a class="indexterm" name="idp86231840"></a><a class="indexterm" name="idp86233328"></a><p>
        Since MySQL version 4.1, InnoDB has provided two alternatives
        for how tables are stored on disk. You can create a new table
        and its indexes in the shared
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>,
        physically stored in the <a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata
        files</a>. Or, you can store a new table and its indexes in a
        separate tablespace (a <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd
        file</a>). The storage layout for each InnoDB table is
        determined by the the configuration parameter
        <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> at the
        time the table is created.
      </p><p>
        In MySQL 5.5 and higher, the configuration parameter
        <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        dynamic, and can be set <code class="literal">ON</code> or
        <code class="literal">OFF</code> using the <code class="literal">SET GLOBAL</code>.
        Previously, the only way to set this parameter was in the MySQL
        <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
        file</a> (<code class="filename">my.cnf</code> or
        <code class="filename">my.ini</code>), and changing it required shutting
        down and restarting the server.
      </p><p>
        The default setting is <code class="literal">OFF</code>, so new tables and
        indexes are created in the system tablespace. Dynamically
        changing the value of this parameter requires the
        <code class="literal">SUPER</code> privilege and immediately affects the
        operation of all connections.
      </p><p>
        Tables created when
        <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        enabled can use the
        <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format, and
        <code class="literal">TRUNCATE</code> returns the disk space for those
        tables to the operating system. The Barracuda file format in
        turn enables features such as table compression and the
        <code class="literal">DYNAMIC</code> row format. Tables created when
        <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is off
        cannot use these features. To take advantage of those features
        for an existing table, you can turn on the file-per-table
        setting and run <code class="literal">ALTER TABLE
        <em class="replaceable"><code>t</code></em> ENGINE=INNODB</code> for that
        table.
      </p><p>
        When you redefine the primary key for an InnoDB table, the table
        is re-created using the current settings for
        <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
        <a class="link" href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>. This
        behavior does not apply when adding or dropping InnoDB secondary
        indexes, as explained in <a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/innodb-create-index.html" target="_top">Fast Index Creation in the InnoDB Storage Engine</a>.
        When a secondary index is created without rebuilding the table,
        the index is stored in the same file as the table data,
        regardless of the current
        <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-other-changes-innodb_stats_on_metadata"></a>14.2.5.5.2. Dynamically Changing <code class="literal">innodb_stats_on_metadata</code></h5>

</div>

</div>

</div>
<a class="indexterm" name="idp86258512"></a><a class="indexterm" name="idp86259616"></a><p>
        In MySQL 5.5 and higher, you can change the setting of
        <a class="link" href="storage-engines.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
        dynamically at runtime, to control whether or not InnoDB
        performs statistics gathering when metadata statements are
        executed. To change the setting, issue the statement
        <code class="literal">SET GLOBAL
        innodb_stats_on_metadata=<em class="replaceable"><code>mode</code></em></code>,
        where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
        either <code class="literal">ON</code> or <code class="literal">OFF</code> (or
        <code class="literal">1</code> or <code class="literal">0</code>). Changing this
        setting requires the <code class="literal">SUPER</code> privilege and
        immediately affects the operation of all connections.
      </p><p>
        This setting is related to the feature described in
        <a class="xref" href="storage-engines.html#innodb-other-changes-statistics-estimation" title="14.2.5.8. Controlling Optimizer Statistics Estimation">Section 14.2.5.8, “Controlling Optimizer Statistics Estimation”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-other-changes-innodb_lock_wait_timeout"></a>14.2.5.5.3. Dynamically Changing <code class="literal">innodb_lock_wait_timeout</code></h5>

</div>

</div>

</div>
<a class="indexterm" name="idp86271328"></a><a class="indexterm" name="idp86272832"></a><p>
        The length of time a transaction waits for a resource, before
        giving up and rolling back the statement, is determined by the
        value of the configuration parameter
        <a class="link" href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>. (In
        MySQL 5.0.12 and earlier, the entire transaction was rolled
        back, not just the statement.) Your application can try the
        statement again (usually after waiting for a while), or roll
        back the entire transaction and restart.
      </p><p>
        The error returned when the timeout period is exceeded is:
      </p><pre class="programlisting">ERROR HY000: Lock wait timeout exceeded; try restarting transaction</pre><p>
        In MySQL 5.5 and higher, the configuration parameter
        <a class="link" href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> can be
        set at runtime with the <code class="literal">SET GLOBAL</code> or
        <code class="literal">SET SESSION</code> statement. Changing the
        <code class="literal">GLOBAL</code> setting requires the
        <code class="literal">SUPER</code> privilege and affects the operation of
        all clients that subsequently connect. Any client can change the
        <code class="literal">SESSION</code> setting for
        <a class="link" href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>, which
        affects only that client.
      </p><p>
        In MySQL 5.1 and earlier, the only way to set this parameter was
        in the MySQL
        <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
        file</a> (<code class="filename">my.cnf</code> or
        <code class="filename">my.ini</code>), and changing it required shutting
        down and restarting the server.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-other-changes-innodb_adaptive_hash_index"></a>14.2.5.5.4. Dynamically Changing <code class="literal">innodb_adaptive_hash_index</code></h5>

</div>

</div>

</div>
<a class="indexterm" name="idp86287264"></a><a class="indexterm" name="idp86288768"></a><p>
        As described in
        <a class="xref" href="storage-engines.html#innodb-performance-adaptive_hash_index" title="14.2.4.2.14. Controlling Adaptive Hash Indexing">Section 14.2.4.2.14, “Controlling Adaptive Hash Indexing”</a>,
        it may be desirable, depending on your workload, to dynamically
        enable or disable the
        <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
        indexing</a> scheme InnoDB uses to improve query performance.
      </p><p>
        The configuration option
        <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a> lets
        you disable the adaptive hash index. It is enabled by default.
        You can modify this parameter through the <code class="literal">SET
        GLOBAL</code> statement, without restarting the server.
        Changing the setting requires the <code class="literal">SUPER</code>
        privilege.
      </p><p>
        Disabling the adaptive hash index empties the hash table
        immediately. Normal operations can continue while the hash table
        is emptied, and executing queries that were using the hash table
        access the index B-trees directly instead. When the adaptive
        hash index is re-enabled, the hash table is populated again
        during normal operation.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-truncate"></a>14.2.5.6. <code class="literal">TRUNCATE TABLE</code> Reclaims Space</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86298080"></a><a class="indexterm" name="idp86299152"></a><p>
      When you <a class="link" href="glossary.html#glos_truncate" title="truncate">truncate</a> a table
      that is stored in a
      <code class="literal"><a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a></code> file
      of its own (because
      <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> was enabled
      when the table was created), and if the table is not referenced in
      a <code class="literal">FOREIGN KEY</code> constraint, the table is dropped
      and re-created in a new <code class="literal">.ibd</code> file. This
      operation is much faster than deleting the rows one by one. The
      operating system can reuse the disk space, in contrast to tables
      within the InnoDB <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a>, where only InnoDB can use the space after they
      are truncated. <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">Physical
      backups</a> can also be smaller, without big blocks of unused
      space in the middle of the system tablespace.
    </p><p>
      MySQL 5.1 and earlier would re-use the existing
      <code class="literal">.ibd</code> file, thus releasing the space only to
      InnoDB for storage management, but not to the operating system.
      Note that when the table is truncated, the count of rows affected
      by the <code class="literal">TRUNCATE TABLE</code> statement is an arbitrary
      number.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
        If there is a
        <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
        constraint</a> between two columns in the same table, that
        table can still be truncated using this fast technique.
      </p><p xmlns="">
        If there are foreign key constraints between the table being
        truncated and other tables, the truncate operation fails. This
        is a change to the previous behavior, which would transform the
        <code class="literal">TRUNCATE</code> operation to a
        <code class="literal">DELETE</code> operation that removed all the rows
        and triggered <code class="literal">ON DELETE</code> operations on
        <a class="link" href="glossary.html#glos_child_table" title="child table">child tables</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-strict-mode"></a>14.2.5.7. <code class="literal">InnoDB</code> Strict Mode</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86317872"></a><a class="indexterm" name="idp86318944"></a><a class="indexterm" name="idp86320016"></a><a class="indexterm" name="idp86321504"></a><p>
      To guard against ignored typos and syntax errors in SQL, or other
      unintended consequences of various combinations of operational
      modes and SQL statements, InnoDB provides a
      <a class="link" href="glossary.html#glos_strict_mode" title="strict mode">strict mode</a> of operations.
      In this mode, InnoDB raises error conditions in certain cases,
      rather than issuing a warning and processing the specified
      statement (perhaps with unintended behavior). This is analogous to
      <a class="link" href="introduction.html#sql-mode" title="1.8.2. Selecting SQL Modes"><code class="literal">sql_mode</code></a> in
      MySQL, which controls what SQL syntax MySQL accepts, and
      determines whether it silently ignores errors, or validates input
      syntax and data values. Since InnoDB strict mode is relatively
      new, some statements that execute without errors with earlier
      versions of MySQL might generate errors unless you disable strict
      mode.
    </p><p>
      The setting of InnoDB strict mode affects the handling of syntax
      errors on the <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> and
      <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements. The strict
      mode also enables a record size check, so that an
      <code class="literal">INSERT</code> or <code class="literal">UPDATE</code> never fails
      due to the record being too large for the selected page size.
    </p><p>
      Oracle recommends enabling
      <a class="link" href="storage-engines.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> when using the
      <code class="literal">ROW_FORMAT</code> and
      <code class="literal">KEY_BLOCK_SIZE</code> clauses on
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, and
      <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements. Without
      strict mode, InnoDB ignores conflicting clauses and creates the
      table or index, with only a warning in the message log. The
      resulting table might have different behavior than you intended,
      such as having no compression when you tried to create a
      compressed table. When InnoDB strict mode is on, such problems
      generate an immediate error and the table or index is not created,
      avoiding a troubleshooting session later.
    </p><p>
      InnoDB strict mode is set with the configuration parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>, which can be
      specified as <code class="literal">ON</code> or <code class="literal">OFF</code>. You
      can set the value on the command line when you start
      <code class="literal">mysqld</code>, or in the
      <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration file</a>
      <code class="filename">my.cnf</code> or <code class="filename">my.ini</code>. You
      can also enable or disable InnoDB strict mode at runtime with the
      statement <code class="literal">SET [GLOBAL|SESSION]
      innodb_strict_mode=<em class="replaceable"><code>mode</code></em></code>,
      where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is either
      <code class="literal">ON</code> or <code class="literal">OFF</code>. Changing the
      <code class="literal">GLOBAL</code> setting requires the
      <code class="literal">SUPER</code> privilege and affects the operation of
      all clients that subsequently connect. Any client can change the
      <code class="literal">SESSION</code> setting for
      <a class="link" href="storage-engines.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>, and the
      setting affects only that client.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-statistics-estimation"></a>14.2.5.8. Controlling Optimizer Statistics Estimation</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86349632"></a><a class="indexterm" name="idp86350720"></a><a class="indexterm" name="idp86351808"></a><a class="indexterm" name="idp86353312"></a><p>
      The MySQL query optimizer uses estimated
      <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> about key
      distributions to choose the indexes for an execution plan, based
      on the relative
      <a class="link" href="glossary.html#glos_selectivity" title="selectivity">selectivity</a> of the index.
      Certain operations cause InnoDB to sample random pages from each
      index on a table to estimate the
      <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> of the index.
      (This technique is known as
      <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a>.) These
      operations include the <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
      TABLE</code></a> statement, the <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE
      STATUS</code></a> statement, and accessing the table for the first
      time after a restart.
    </p><p>
      To give you control over the quality of the statistics estimate
      (and thus better information for the query optimizer), you can now
      change the number of sampled pages using the parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>.
      Previously, the number of sampled pages was always 8, which could
      be insufficient to produce an accurate estimate, leading to poor
      index choices by the query optimizer. This technique is especially
      important for large tables and tables used in
      <a class="link" href="glossary.html#glos_join" title="join">joins</a>. Unnecessary
      <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scans</a> for
      such tables can be a substantial performance issue. See
      <a class="xref" href="optimization.html#how-to-avoid-table-scan" title="8.2.1.20. How to Avoid Full Table Scans">Section 8.2.1.20, “How to Avoid Full Table Scans”</a> for tips on tuning such
      queries.
    </p><p>
      You can set the global parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>,
      at runtime. The default value for this parameter is 8, preserving
      the same behavior as in past releases.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
        The value of
        <a xmlns="" class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        affects the index sampling for <span xmlns="" class="emphasis"><em>all</em></span> InnoDB
        tables and indexes. There are the following potentially
        significant impacts when you change the index sample size:

</p>
<div xmlns="" class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Small values like 1 or 2 can result in very inaccurate
              estimates of cardinality.
            </p></li><li class="listitem"><p>
              Increasing the
              <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
              value might require more disk reads. Values much larger
              than 8 (say, 100), can cause a big slowdown in the time it
              takes to open a table or execute <code class="literal">SHOW TABLE
              STATUS</code>.
            </p></li><li class="listitem"><p>
              The optimizer might choose very different query plans
              based on different estimates of index selectivity.
</p></li></ul>
</div>

</div>
<p>
      To disable the cardinality estimation for metadata statements such
      as <code class="literal">SHOW TABLE STATUS</code>, execute the statement
      <code class="literal">SET GLOBAL innodb_stats_on_metadata=OFF</code> (or
      <code class="literal">0</code>). The ability to set this option dynamically
      is also relatively new.
    </p><p>
      All InnoDB tables are opened, and the statistics are re-estimated
      for all associated indexes, when the <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
      client starts if the auto-rehash setting is set on (the default).
      To improve the start up time of the <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
      client, you can turn auto-rehash off. The auto-rehash feature
      enables automatic name completion of database, table, and column
      names for interactive users.
    </p><p>
      Whatever value of
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
      works best for a system, set the option and leave it at that
      value. Choose a value that results in reasonably accurate
      estimates for all tables in your database without requiring
      excessive I/O. Because the statistics are automatically
      recalculated at various times other than on execution of
      <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, it does not make
      sense to increase the index sample size, run
      <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, then decrease sample
      size again. The more accurate statistics calculated by
      <code class="literal">ANALYZE</code> running with a high value of
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
      can be wiped away later.
    </p><p>
      Although it is not possible to specify the sample size on a
      per-table basis, smaller tables generally require fewer index
      samples than larger tables do. If your database has many large
      tables, consider using a higher value for
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
      than if you have mostly smaller tables.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-drop-index"></a>14.2.5.9. Better Error Handling when Dropping Indexes</h4>

</div>

</div>

</div>
<p>
      For optimal performance with DML statements, InnoDB requires an
      index to exist on <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign
      key</a> columns, so that <code class="literal">UPDATE</code> and
      <code class="literal">DELETE</code> operations on a
      <a class="link" href="glossary.html#glos_parent_table" title="parent table">parent table</a> can easily
      check whether corresponding rows exist in the
      <a class="link" href="glossary.html#glos_child_table" title="child table">child table</a>. MySQL creates
      or drops such indexes automatically when needed, as a side-effect
      of <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>, and
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements.
    </p><p>
      When you drop an index, InnoDB checks whether the index is not
      used for checking a foreign key constraint. It is still OK to drop
      the index if there is another index that can be used to enforce
      the same constraint. InnoDB prevents you from dropping the last
      index that can enforce a particular referential constraint.
    </p><p>
      The message that reports this error condition is:
    </p><pre class="programlisting">ERROR 1553 (HY000): Cannot drop index '<em class="replaceable"><code>fooIdx</code></em>':
needed in a foreign key constraint
</pre><p>
      This message is friendlier than the earlier message it replaces:
    </p><pre class="programlisting">ERROR 1025 (HY000): Error on rename of '<em class="replaceable"><code>./db2/#sql-18eb_3</code></em>'
to '<em class="replaceable"><code>./db2/foo</code></em>'(errno: 150)
</pre><p>
      A similar change in error reporting applies to an attempt to drop
      the primary key index. For tables without an explicit
      <code class="literal">PRIMARY KEY</code>, InnoDB creates an implicit
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a> using
      the first columns of the table that are declared
      <code class="literal">UNIQUE</code> and <code class="literal">NOT NULL</code>. When
      you drop such an index, InnoDB automatically copies the table and
      rebuilds the index using a different <code class="literal">UNIQUE NOT
      NULL</code> group of columns or a system-generated key. Since
      this operation changes the primary key, it uses the slow method of
      copying the table and re-creating the index, rather than the Fast
      Index Creation technique from
      <a class="xref" href="server-administration.html#innodb-create-index-implementation" title="5.5.6. Implementation Details of Online DDL">Section 5.5.6, “Implementation Details of Online DDL”</a>.
    </p><p>
      Previously, an attempt to drop an implicit clustered index (the
      first <code class="literal">UNIQUE NOT NULL</code> index) failed if the
      table did not contain a <code class="literal">PRIMARY KEY</code>:
</p><pre class="programlisting">ERROR 42000: This table type requires a primary key</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-show-mutex"></a>14.2.5.10. More Compact Output of <code class="literal">SHOW ENGINE INNODB MUTEX</code></h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86411344"></a><p>
      The statement <code class="literal">SHOW ENGINE INNODB MUTEX</code> displays
      information about InnoDB <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a>
      and <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">rw-locks</a>. Although this
      information is useful for tuning on multi-core systems, the amount
      of output can be overwhelming on systems with a big
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. There is one
      mutex and one rw-lock in each 16K buffer pool block, and there are
      65,536 blocks per gigabyte. It is unlikely that a single block
      mutex or rw-lock from the buffer pool could become a performance
      bottleneck.
    </p><p>
      <code class="literal">SHOW ENGINE INNODB MUTEX</code> now skips the mutexes
      and rw-locks of buffer pool blocks. It also does not list any
      mutexes or rw-locks that have never been waited on
      (<code class="literal">os_waits=0</code>). Thus, <code class="literal">SHOW ENGINE INNODB
      MUTEX</code> only displays information about mutexes and
      rw-locks outside of the buffer pool that have caused at least one
      OS-level <a class="link" href="glossary.html#glos_wait" title="wait">wait</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-other-changes-readahead-counters"></a>14.2.5.11. More Read-Ahead Statistics</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp86420816"></a><p>
      As described in <a class="xref" href="storage-engines.html#innodb-performance-read_ahead" title="14.2.4.2.16. Changes in the Read-Ahead Algorithm">Section 14.2.4.2.16, “Changes in the Read-Ahead Algorithm”</a>, a
      read-ahead request is an asynchronous I/O request issued in
      anticipation that a page will be used in the near future. Knowing
      how many pages are read through this read-ahead mechanism, and how
      many of them are evicted from the buffer pool without ever being
      accessed, can be useful to help fine-tune the parameter
      <a class="link" href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>.
    </p><p>
      <code class="literal">SHOW ENGINE INNODB STATUS</code> output displays the
      global status variables
      <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>
      and
      <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>.
      These variables indicate the number of pages brought into the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> by read-ahead
      requests, and the number of such pages
      <a class="link" href="glossary.html#glos_eviction" title="eviction">evicted</a> from the buffer pool
      without ever being accessed respectively. These counters provide
      global values since the last server restart.
    </p><p>
      <code class="literal">SHOW ENGINE INNODB STATUS</code> also shows the rate
      at which the read-ahead pages are read in and the rate at which
      such pages are evicted without being accessed. The per-second
      averages are based on the statistics collected since the last
      invocation of <code class="literal">SHOW ENGINE INNODB STATUS</code> and are
      displayed in the <code class="literal">BUFFER POOL AND MEMORY</code> section
      of the output.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-parameters"></a>14.2.6. <code class="literal">InnoDB</code> Startup Options and System Variables</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-parameter-changes">14.2.6.1. List of Parameters Recently Changed in <code class="literal">InnoDB</code></a></span></dt></dl>
</div>
<a class="indexterm" name="idp86434848"></a><a class="indexterm" name="idp86436352"></a><p>
      This section describes the <code class="literal">InnoDB</code>-related
      command options and system variables. System variables that are
      true or false can be enabled at server startup by naming them, or
      disabled by using a <code class="literal">--skip-</code> prefix. For
      example, to enable or disable <code class="literal">InnoDB</code> checksums,
      you can use <a class="link" href="storage-engines.html#sysvar_innodb_checksums"><code class="option">--innodb_checksums</code></a> or
      <a class="link" href="storage-engines.html#sysvar_innodb_checksums"><code class="option">--skip-innodb_checksums</code></a>
      on the command line, or
      <a class="link" href="storage-engines.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a> or
      <code class="literal">skip-innodb_checksums</code> in an option file. System
      variables that take a numeric value can be specified as
      <code class="option">--<em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
      on the command line or as
      <code class="literal"><em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
      in option files. For more information on specifying options and
      system variables, see <a class="xref" href="programs.html#program-options" title="4.2.3. Specifying Program Options">Section 4.2.3, “Specifying Program Options”</a>. Many of
      the system variables can be changed at runtime (see
      <a class="xref" href="server-administration.html#dynamic-system-variables" title="5.1.5.2. Dynamic System Variables">Section 5.1.5.2, “Dynamic System Variables”</a>).
    </p><p>
      Certain options control the locations and layout of the
      <code class="literal">InnoDB</code> data files.
      <a class="xref" href="storage-engines.html#innodb-configuration" title="14.2.1.2. Configuring InnoDB">Section 14.2.1.2, “Configuring <code class="literal">InnoDB</code>”</a> explains how to use these
      options. Many other options, that you might not use initially,
      help to tune <code class="literal">InnoDB</code> performance characteristics
      based on machine capacity and your database
      <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>. The
      performance-related options are explained in
      <a class="xref" href="storage-engines.html#innodb-tuning-troubleshooting" title="14.2.4. InnoDB Performance Tuning and Troubleshooting">Section 14.2.4, “<code class="literal">InnoDB</code> Performance Tuning and Troubleshooting”</a> and
      <a class="xref" href="storage-engines.html#innodb-performance" title="14.2.4.2. InnoDB Performance and Scalability Enhancements">Section 14.2.4.2, “<code class="literal">InnoDB</code> Performance and Scalability Enhancements”</a>.
</p>
<div class="table">
<a name="idp86452928"></a><p class="title"><b>Table 14.5. <code class="literal">InnoDB</code> Option/Variable
Reference</b></p>
<div class="table-contents">
<table summary="InnoDB Option/Variable
Reference" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Cmd-Line</th><th scope="col">Option file</th><th scope="col">System Var</th><th scope="col">Status Var</th><th scope="col">Var Scope</th><th scope="col">Dynamic</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_enable_binlog">daemon_memcached_enable_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_engine_lib_name">daemon_memcached_engine_lib_name</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_engine_lib_path">daemon_memcached_engine_lib_path</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_option">daemon_memcached_option</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size">daemon_memcached_r_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size">daemon_memcached_w_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_foreign_key_checks">foreign_key_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_have_innodb">have_innodb</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#option_mysqld_ignore-builtin-innodb">ignore-builtin-innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="storage-engines.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#option_mysqld_innodb">innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing_lwm">innodb_adaptive_flushing_lwm</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_max_sleep_delay">innodb_adaptive_max_sleep_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_additional_mem_pool_size">innodb_additional_mem_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_api_bk_commit_interval">innodb_api_bk_commit_interval</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_api_disable_rowlock">innodb_api_disable_rowlock</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_api_enable_binlog">innodb_api_enable_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_api_enable_mdl">innodb_api_enable_mdl</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_api_trx_level">innodb_api_trx_level</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_available_undo_logs">Innodb_available_undo_logs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_data">Innodb_buffer_pool_bytes_data</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_dirty">Innodb_buffer_pool_bytes_dirty</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_at_shutdown">innodb_buffer_pool_dump_at_shutdown</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_now">innodb_buffer_pool_dump_now</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_dump_status">Innodb_buffer_pool_dump_status</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_filename">innodb_buffer_pool_filename</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_abort">innodb_buffer_pool_load_abort</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_at_startup">innodb_buffer_pool_load_at_startup</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_now">innodb_buffer_pool_load_now</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_load_status">Innodb_buffer_pool_load_status</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_data">Innodb_buffer_pool_pages_data</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_dirty">Innodb_buffer_pool_pages_dirty</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_flushed">Innodb_buffer_pool_pages_flushed</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_free">Innodb_buffer_pool_pages_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_latched">Innodb_buffer_pool_pages_latched</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_misc">Innodb_buffer_pool_pages_misc</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_total">Innodb_buffer_pool_pages_total</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead">Innodb_buffer_pool_read_ahead</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted">Innodb_buffer_pool_read_ahead_evicted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_requests">Innodb_buffer_pool_read_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_reads">Innodb_buffer_pool_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_wait_free">Innodb_buffer_pool_wait_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_write_requests">Innodb_buffer_pool_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_change_buffer_max_size">innodb_change_buffer_max_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm">innodb_checksum_algorithm</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_checksums">innodb_checksums</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_cmp_per_index_enabled">innodb_cmp_per_index_enabled</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_compression_failure_threshold_pct">innodb_compression_failure_threshold_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_compression_level">innodb_compression_level</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_compression_pad_pct_max">innodb_compression_pad_pct_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs">Innodb_data_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_fsyncs">Innodb_data_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_reads">Innodb_data_pending_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_writes">Innodb_data_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_read">Innodb_data_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_reads">Innodb_data_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_writes">Innodb_data_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_written">Innodb_data_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_pages_written">Innodb_dblwr_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_writes">Innodb_dblwr_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_disable_sort_file_cache">innodb_disable_sort_file_cache</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_file_format">innodb_file_format</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_file_format_max">innodb_file_format_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_timeout">innodb_flush_log_at_timeout</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_flush_method">innodb_flush_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_flush_neighbors">innodb_flush_neighbors</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_flushing_avg_loops">innodb_flushing_avg_loops</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_aux_table">innodb_ft_aux_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_cache_size">innodb_ft_cache_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_diag_print">innodb_ft_enable_diag_print</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_stopword">innodb_ft_enable_stopword</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_max_token_size">innodb_ft_max_token_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_min_token_size">innodb_ft_min_token_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_num_word_optimize">innodb_ft_num_word_optimize</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_server_stopword_table">innodb_ft_server_stopword_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_sort_pll_degree">innodb_ft_sort_pll_degree</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_ft_user_stopword_table">innodb_ft_user_stopword_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_have_atomic_builtins">Innodb_have_atomic_builtins</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_io_capacity_max">innodb_io_capacity_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_large_prefix">innodb_large_prefix</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog">innodb_locks_unsafe_for_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_log_compressed_pages">innodb_log_compressed_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_waits">Innodb_log_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_write_requests">Innodb_log_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_writes">Innodb_log_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_lru_scan_depth">innodb_lru_scan_depth</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct_lwm">innodb_max_dirty_pages_pct_lwm</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag_delay">innodb_max_purge_lag_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_mirrored_log_groups">innodb_mirrored_log_groups</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_disable">innodb_monitor_disable</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_enable">innodb_monitor_enable</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_reset">innodb_monitor_reset</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_reset_all">innodb_monitor_reset_all</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_num_open_files">Innodb_num_open_files</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_online_alter_log_max_size">innodb_online_alter_log_max_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_open_files">innodb_open_files</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_optimize_fulltext_only">innodb_optimize_fulltext_only</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_fsyncs">Innodb_os_log_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_fsyncs">Innodb_os_log_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_writes">Innodb_os_log_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_written">Innodb_os_log_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_page_size">innodb_page_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_page_size">Innodb_page_size</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_created">Innodb_pages_created</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_read">Innodb_pages_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_written">Innodb_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_read_only">innodb_read_only</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_current_waits">Innodb_row_lock_current_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time">Innodb_row_lock_time</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_avg">Innodb_row_lock_time_avg</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_max">Innodb_row_lock_time_max</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_waits">Innodb_row_lock_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_deleted">Innodb_rows_deleted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_inserted">Innodb_rows_inserted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_read">Innodb_rows_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_updated">Innodb_rows_updated</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_sort_buffer_size">innodb_sort_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_stats_auto_recalc">innodb_stats_auto_recalc</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_stats_method">innodb_stats_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent">innodb_stats_persistent</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent_sample_pages">innodb_stats_persistent_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_stats_sample_pages">innodb_stats_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages">innodb_stats_transient_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#option_mysqld_innodb-status-file">innodb-status-file</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_support_xa">innodb_support_xa</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_sync_array_size">innodb_sync_array_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_table_locks">innodb_table_locks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_truncated_status_writes">Innodb_truncated_status_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_undo_directory">innodb_undo_directory</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_undo_logs">innodb_undo_logs</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces">innodb_undo_tablespaces</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_use_sys_malloc">innodb_use_sys_malloc</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_version">innodb_version</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="storage-engines.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_timed_mutexes">timed_mutexes</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_unique_checks">unique_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<h4><a name="idp87043168"></a>
      <code class="literal">InnoDB</code> Command Options
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_ignore-builtin-innodb"></a>
          <a class="indexterm" name="idp87045328"></a>

          <a class="indexterm" name="idp87046832"></a>

          <code class="option">--ignore-builtin-innodb</code>
</p>
<div class="informaltable">
<table summary="Options for ignore-builtin-innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.2.22</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--ignore-builtin-innodb</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">ignore-builtin-innodb</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table>
</div>
<p>
          In MySQL 5.1, this option caused the server to behave as if
          the built-in <code class="literal">InnoDB</code> were not present, which
          enabled <code class="literal">InnoDB Plugin</code> to be used instead.
          In MySQL 5.6, <code class="literal">InnoDB</code> is the
          default storage engine and <code class="literal">InnoDB Plugin</code> is
          not used, so this option has no effect. As of MySQL 5.6.5, it
          is ignored.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb"></a>
          <a class="indexterm" name="idp87073920"></a>

          <a class="indexterm" name="idp87075408"></a>

          <code class="option">--innodb[=<em class="replaceable"><code>value</code></em>]</code>
        </p><p>
          Controls loading of the <code class="literal">InnoDB</code> storage
          engine, if the server was compiled with
          <code class="literal">InnoDB</code> support. This option has a tristate
          format, with possible values of <code class="literal">OFF</code>,
          <code class="literal">ON</code>, or <code class="literal">FORCE</code>. See
          <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1. Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To disable <code class="literal">InnoDB</code>, use
          <a class="link" href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a class="link" href="storage-engines.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>.
          In this case, because the default storage engine is
          <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>, the server will not start
          unless you also use
          <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="option">--default-storage-engine</code></a> and
          <a class="link" href="server-administration.html#sysvar_default_tmp_storage_engine"><code class="option">--default-tmp-storage-engine</code></a> to
          set the default to some other engine for both permanent and
          <code class="literal">TEMPORARY</code> tables.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb-status-file"></a>
          <a class="indexterm" name="idp87089776"></a>

          <a class="indexterm" name="idp87091280"></a>

          <code class="option">--innodb-status-file</code>
</p>
<div class="informaltable">
<table summary="Options for innodb-status-file" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-status-file</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb-status-file</code></td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Controls whether <code class="literal">InnoDB</code> creates a file
          named
          <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
          in the MySQL data directory. If enabled,
          <code class="literal">InnoDB</code> periodically writes the output of
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> to this file.
        </p><p>
          By default, the file is not created. To create it, start
          <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
          <code class="option">--innodb-status-file=1</code> option. The file is
          deleted during normal shutdown.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idp87115024"></a>

          <a class="indexterm" name="idp87116512"></a>

          <a class="link" href="storage-engines.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
        </p><p>
          Disable the <code class="literal">InnoDB</code> storage engine. See the
          description of <a class="link" href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb</code></a>.
</p></li></ul>
</div>
<h4><a name="idp87121920"></a>
      <code class="literal">InnoDB</code> System Variables
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_daemon_memcached_enable_binlog"></a>
          <a class="indexterm" name="idp87124080"></a>

          <code class="literal">daemon_memcached_enable_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_enable_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_enable_binlog=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">daemon_memcached_enable_binlog</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_enable_binlog">daemon_memcached_enable_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">false</code></td></tr></tbody></table>
</div>
<p></p><p>
          See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_engine_lib_name"></a>
          <a class="indexterm" name="idp87151072"></a>

          <code class="literal">daemon_memcached_engine_lib_name</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_engine_lib_name" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_engine_lib_name=library</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">daemon_memcached_engine_lib_name</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_engine_lib_name">daemon_memcached_engine_lib_name</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">innodb_engine.so</code></td></tr></tbody></table>
</div>
<p>
          Specifies the shared library that implements the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin.
        </p><p>
          See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_engine_lib_path"></a>
          <a class="indexterm" name="idp87179696"></a>

          <code class="literal">daemon_memcached_engine_lib_path</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_engine_lib_path" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_engine_lib_path=directory</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">daemon_memcached_engine_lib_path</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_engine_lib_path">daemon_memcached_engine_lib_path</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal"></code></td></tr></tbody></table>
</div>
<p>
          The path of the directory containing the shared library that
          implements the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin.
        </p><p>
          See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_option"></a>
          <a class="indexterm" name="idp87208192"></a>

          <code class="literal">daemon_memcached_option</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_option" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_option=options</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">daemon_memcached_option</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_option">daemon_memcached_option</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal"></code></td></tr></tbody></table>
</div>
<p>
          Used to pass space-separated memcached options to the
          underlying <span class="command"><strong>memcached</strong></span> memory object caching
          daemon on startup. For example, you might change the port that
          <span class="command"><strong>memcached</strong></span> listens on, reduce the maximum
          number of simultaneous connections, change the maximum memory
          size for a key/value pair, or enable debugging messages for
          the error log.
        </p><p>
          See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for
          this option. For information about memcached options, refer to
          the memcached man page.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_r_batch_size"></a>
          <a class="indexterm" name="idp87236992"></a>

          <code class="literal">daemon_memcached_r_batch_size</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_r_batch_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_r_batch_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">daemon_memcached_r_batch_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size">daemon_memcached_r_batch_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr></tbody></table>
</div>
<p>
          Specifies how many <span class="command"><strong>memcached</strong></span> read
          operations (<code class="literal">get</code>) to perform before doing a
          <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to start a new
          transaction. Counterpart of
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>.
        </p><p>
          This value is set to 1 by default, so that any changes made to
          the table through SQL statements are immediately visible to
          the <span class="command"><strong>memcached</strong></span> operations. You might
          increase it to reduce the overhead from frequent commits on a
          system where the underlying table is only being accessed
          through the <span class="command"><strong>memcached</strong></span> interface. If you set
          the value too large, the amount of undo or redo data could
          impose some storage overhead, as with any long-running
          transaction.
        </p><p>
          See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_w_batch_size"></a>
          <a class="indexterm" name="idp87269696"></a>

          <code class="literal">daemon_memcached_w_batch_size</code>
</p>
<div class="informaltable">
<table summary="Options for daemon_memcached_w_batch_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--daemon_memcached_w_batch_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">daemon_memcached_w_batch_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size">daemon_memcached_w_batch_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr></tbody></table>
</div>
<p>
          Specifies how many <span class="command"><strong>memcached</strong></span> write
          operations, such as <code class="literal">add</code>,
          <code class="literal">set</code>, or <code class="literal">incr</code>, to perform
          before doing a <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to start
          a new transaction. Counterpart of
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>.
        </p><p>
          This value is set to 1 by default, on the assumption that any
          data being stored is important to preserve in case of an
          outage and should immediately be committed. When storing
          non-critical data, you might increase this value to reduce the
          overhead from frequent commits; but then the last
          <em class="replaceable"><code>N</code></em>-1 uncommitted write operations
          could be lost in case of a crash.
        </p><p>
          See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_ignore_builtin_innodb"></a>
          <a class="indexterm" name="idp87302688"></a>

          <a class="indexterm" name="idp87303776"></a>

          <code class="literal">ignore_builtin_innodb</code>
</p>
<div class="informaltable">
<table summary="Options for ignore-builtin-innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.2.22</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--ignore-builtin-innodb</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">ignore-builtin-innodb</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table>
</div>
<p>
          See the description of
          <a class="link" href="storage-engines.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a> under
          <span class="quote">“<span class="quote"><code class="literal">InnoDB</code> Command Options</span>”</span>
          earlier in this section.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_flushing"></a>
          <a class="indexterm" name="idp87329920"></a>

          <a class="indexterm" name="idp87331024"></a>

          <code class="literal">innodb_adaptive_flushing</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_flushing" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_flushing=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_flushing</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idp87354336"></a><p>
          Specifies whether to dynamically adjust the rate of flushing
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> in the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> based on
          the workload. Adjusting the flush rate dynamically is intended
          to avoid bursts of I/O activity. This setting is enabled by
          default. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_flushing_lwm"></a>
          <a class="indexterm" name="idp87359728"></a>

          <code class="literal">innodb_adaptive_flushing_lwm</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_flushing_lwm" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_flushing_lwm=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_flushing_lwm</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing_lwm">innodb_adaptive_flushing_lwm</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 70</code></td></tr></tbody></table>
</div>
<p>
          Low water mark representing percentage of
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> capacity at
          which <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
          flushing</a> is enabled.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_hash_index"></a>
          <a class="indexterm" name="idp87389600"></a>

          <a class="indexterm" name="idp87390704"></a>

          <code class="literal">innodb_adaptive_hash_index</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_hash_index" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_hash_index=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_hash_index</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Whether the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          index</a> is enabled or disabled. The adaptive hash index
          feature is useful for some workloads, and not for others;
          conduct benchmarks with it both enabled and disabled, using
          realistic workloads. See
          <a class="xref" href="storage-engines.html#innodb-adaptive-hash" title="14.2.3.12.6. Adaptive Hash Indexes">Section 14.2.3.12.6, “Adaptive Hash Indexes”</a> for details. This
          variable is enabled by default. Use
          <code class="option">--skip-innodb_adaptive_hash_index</code> at server
          startup to disable it.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_max_sleep_delay"></a>
          <a class="indexterm" name="idp87418144"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_max_sleep_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_max_sleep_delay=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_max_sleep_delay</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_adaptive_max_sleep_delay">innodb_adaptive_max_sleep_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">150000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 1000000</code></td></tr></tbody></table>
</div>
<p>
          Allows <code class="literal">InnoDB</code> to automatically adjust the
          value of
          <a class="link" href="storage-engines.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> up
          or down according to the current workload. Any non-zero value
          enables automated, dynamic adjustment of the
          <code class="literal">innodb_thread_sleep_delay</code> value, up to the
          maximum value specified in the
          <code class="literal">innodb_adaptive_max_sleep_delay</code> option. The
          value represents the number of microseconds. This option can
          be useful in busy systems, with greater than 16
          <code class="literal">InnoDB</code> threads. (In practice, it is most
          valuable for MySQL systems with hundreds or thousands of
          simultaneous connections.)
        </p></li><li class="listitem"><p><a name="sysvar_innodb_additional_mem_pool_size"></a>
          <a class="indexterm" name="idp87450960"></a>

          <a class="indexterm" name="idp87452064"></a>

          <code class="literal">innodb_additional_mem_pool_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_additional_mem_pool_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_additional_mem_pool_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_additional_mem_pool_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_additional_mem_pool_size">innodb_additional_mem_pool_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">2097152 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of a memory pool <code class="literal">InnoDB</code>
          uses to store <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data
          dictionary</a> information and other internal data
          structures. The more tables you have in your application, the
          more memory you allocate here. If <code class="literal">InnoDB</code>
          runs out of memory in this pool, it starts to allocate memory
          from the operating system and writes warning messages to the
          MySQL error log. The default value is 8MB.
        </p><p>
          This variable relates to the <code class="literal">InnoDB</code>
          internal memory allocator, which is unused if
          <a class="link" href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
          enabled. As of MySQL 5.6.3,
          <code class="literal">innodb_additional_mem_pool_size</code> is
          deprecated and will be removed in a future MySQL release.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_bk_commit_interval"></a>
          <a class="indexterm" name="idp87487072"></a>

          <code class="literal">innodb_api_bk_commit_interval</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_bk_commit_interval" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_bk_commit_interval=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_api_bk_commit_interval</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_api_bk_commit_interval">innodb_api_bk_commit_interval</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1073741824 </code></td></tr></tbody></table>
</div>
<p>
          How often to auto-commit idle connections that use the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          interface, in seconds. See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a>
          for usage details for this option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_disable_rowlock"></a>
          <a class="indexterm" name="idp87517504"></a>

          <code class="literal">innodb_api_disable_rowlock</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_disable_rowlock" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_disable_rowlock=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_api_disable_rowlock</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_api_disable_rowlock">innodb_api_disable_rowlock</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for
          this option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_enable_binlog"></a>
          <a class="indexterm" name="idp87544896"></a>

          <code class="literal">innodb_api_enable_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_enable_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_enable_binlog=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_api_enable_binlog</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_api_enable_binlog">innodb_api_enable_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Lets you use the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin with the MySQL
          <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>. See
          <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for this
          option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_enable_mdl"></a>
          <a class="indexterm" name="idp87573744"></a>

          <code class="literal">innodb_api_enable_mdl</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_enable_mdl" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_enable_mdl=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_api_enable_mdl</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_api_enable_mdl">innodb_api_enable_mdl</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Locks the table used by the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin, so that it cannot be
          dropped or altered by <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a>
          through the SQL interface. See
          <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage details for this
          option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_trx_level"></a>
          <a class="indexterm" name="idp87602560"></a>

          <code class="literal">innodb_api_trx_level</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_api_trx_level" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_api_trx_level=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_api_trx_level</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_api_trx_level">innodb_api_trx_level</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
          Lets you control the transaction
          <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> on
          queries processed by the <span class="command"><strong>memcached</strong></span>
          interface. See <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a> for usage
          details for this option. The constants corresponding to the
          familiar names are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              0 = <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>
            </p></li><li class="listitem"><p>
              1 = <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>
            </p></li><li class="listitem"><p>
              2 = <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>
            </p></li><li class="listitem"><p>
              3 = <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_autoextend_increment"></a>
          <a class="indexterm" name="idp87637632"></a>

          <a class="indexterm" name="idp87638736"></a>

          <code class="literal">innodb_autoextend_increment</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_autoextend_increment" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoextend_increment=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_autoextend_increment</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1000</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1000</code></td></tr></tbody></table>
</div>
<p>
          The increment size (in MB) for extending the size of an
          auto-extend <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> file when it becomes full. The default value
          is 64 as of MySQL 5.6.6, 8 before that. This variable does not
          affect the per-table tablespace files that are created if you
          use <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table=1</code></a>.
          Those files are auto-extending regardless of the value of
          <a class="link" href="storage-engines.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>.
          The initial extensions are by small amounts, after which
          extensions occur in increments of 4MB.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_autoinc_lock_mode"></a>
          <a class="indexterm" name="idp87677888"></a>

          <a class="indexterm" name="idp87678992"></a>

          <code class="literal">innodb_autoinc_lock_mode</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_autoinc_lock_mode" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoinc_lock_mode=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_autoinc_lock_mode</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="6"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_lock_mode" title="lock mode">lock mode</a> to use for
          generating
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          values. The permissible values are 0, 1, or 2, for
          <span class="quote">“<span class="quote">traditional</span>”</span>, <span class="quote">“<span class="quote">consecutive</span>”</span>, or
          <span class="quote">“<span class="quote">interleaved</span>”</span> lock mode, respectively.
          <a class="xref" href="server-administration.html#innodb-auto-increment-handling" title="5.4.4. AUTO_INCREMENT Handling in InnoDB">Section 5.4.4, “<code class="literal">AUTO_INCREMENT</code> Handling in <code class="literal">InnoDB</code>”</a>, describes
          the characteristics of these modes.
        </p><p>
          This variable has a default of 1 (<span class="quote">“<span class="quote">consecutive</span>”</span>
          lock mode).
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_at_shutdown"></a>
          <a class="indexterm" name="idp87713536"></a>

          <code class="literal">innodb_buffer_pool_dump_at_shutdown</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_dump_at_shutdown" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_dump_at_shutdown=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_at_shutdown">innodb_buffer_pool_dump_at_shutdown</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether to record the pages cached in the InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> when the
          MySQL server is shut down, to shorten the
          <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmup</a> process at the next
          restart. Typically used in combination with
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_now"></a>
          <a class="indexterm" name="idp87742192"></a>

          <code class="literal">innodb_buffer_pool_dump_now</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_dump_now" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_dump_now=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_dump_now</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_now">innodb_buffer_pool_dump_now</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Immediately records the pages cached in the InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. Typically
          used in combination with
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_filename"></a>
          <a class="indexterm" name="idp87770000"></a>

          <code class="literal">innodb_buffer_pool_filename</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_filename" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_filename=file</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_filename</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_filename">innodb_buffer_pool_filename</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ib_buffer_pool</code></td></tr></tbody></table>
</div>
<p>
          Specifies the file that holds the list of page numbers
          produced by
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          or
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_now"><code class="literal">innodb_buffer_pool_dump_now</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_instances"></a>
          <a class="indexterm" name="idp87798000"></a>

          <a class="indexterm" name="idp87799104"></a>

          <code class="literal">innodb_buffer_pool_instances</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_instances" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_instances=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_instances</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 64</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">-1 (autosized)</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 64</code></td></tr></tbody></table>
</div>
<p>
          The number of regions that the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> is divided
          into. For systems with buffer pools in the multi-gigabyte
          range, dividing the buffer pool into separate instances can
          improve concurrency, by reducing contention as different
          threads read and write to cached pages. Each page that is
          stored in or read from the buffer pool is assigned to one of
          the buffer pool instances randomly, using a hashing function.
          Each buffer pool manages its own free lists,
          <a class="link" href="glossary.html#glos_flush_list" title="flush list">flush lists</a>,
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRUs</a>, and all other data
          structures connected to a buffer pool, and is protected by its
          own buffer pool <a class="link" href="glossary.html#glos_mutex" title="mutex">mutex</a>.
        </p><p>
          This option takes effect only when you set the
          <code class="literal">innodb_buffer_pool_size</code> to a size of 1
          gigabyte or more. The total size you specify is divided among
          all the buffer pools. For best efficiency, specify a
          combination of
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          and <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          so that each buffer pool instance is at least 1 gigabyte.
        </p><p>
          Before MySQL 5.6.6, the default is 1. As of MySQL 5.6.6, the
          default is 8, except on 32-bit Windows systems, where the
          default depends on the value of
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If
              <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              is greater than 1.3GB, the default for
              <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              is
              <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>/128MB,
              with individual memory allocation requests for each chunk.
              1.3GB was chosen as the boundary at which there is
              significant risk for 32-bit Windows to be unable to
              allocate the contiguous address space needed for a single
              buffer pool.
            </p></li><li class="listitem"><p>
              Otherwise, the default is 1.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_abort"></a>
          <a class="indexterm" name="idp87848528"></a>

          <code class="literal">innodb_buffer_pool_load_abort</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_load_abort" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_load_abort=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_load_abort</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_abort">innodb_buffer_pool_load_abort</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Interrupts the process of restoring InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> contents
          triggered by
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
          or
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_at_startup"></a>
          <a class="indexterm" name="idp87877248"></a>

          <code class="literal">innodb_buffer_pool_load_at_startup</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_load_at_startup" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_load_at_startup=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_load_at_startup</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_at_startup">innodb_buffer_pool_load_at_startup</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Specifies that, on MySQL server startup, the InnoDB
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> is
          automatically <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmed up</a> by
          loading the same pages it held at an earlier time. Typically
          used in combination with
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_now"></a>
          <a class="indexterm" name="idp87905904"></a>

          <code class="literal">innodb_buffer_pool_load_now</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_load_now" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_load_now=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_load_now</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_now">innodb_buffer_pool_load_now</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Immediately <a class="link" href="glossary.html#glos_warm_up" title="warm up">warms up</a> the
          InnoDB <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> by
          loading a set of data pages, without waiting for a server
          restart. Can be useful to bring cache memory back to a known
          state during benchmarking, or to ready the MySQL server to
          resume its normal workload after running queries for reports
          or maintenance.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_size"></a>
          <a class="indexterm" name="idp87933744"></a>

          <a class="indexterm" name="idp87934832"></a>

          <code class="literal">innodb_buffer_pool_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, the
          memory area where <code class="literal">InnoDB</code> caches table and
          index data. The default value is 128MB. The maximum value
          depends on the CPU architecture; the maximum is 4294967295
          (2<sup>32</sup>-1) on 32-bit systems and
          18446744073709551615 (2<sup>64</sup>-1) on
          64-bit systems. On 32-bit systems, the CPU architecture and
          operating system may impose a lower practical maximum size
          than the stated maximum. When the size of the buffer pool is
          greater than 1GB, setting
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          to a value greater than 1 can improve the scalability on a
          busy server.
        </p><p>
          The larger you set this value, the less disk I/O is needed to
          access the same data in tables more than once. On a dedicated
          database server, you might set this to up to 80% of the
          machine physical memory size. Be prepared to scale back this
          value if these other issues occur:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Competition for physical memory might cause paging in the
              operating system.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code> reserves additional memory for
              buffers and control structures, so that the total
              allocated space is approximately 10% greater than the
              specified size.
            </p></li><li class="listitem"><p>
              The address space must be contiguous, which can be an
              issue on Windows systems with DLLs that load at specific
              addresses.
            </p></li><li class="listitem"><p>
              The time to initialize the buffer pool is roughly
              proportional to its size. On large installations, this
              initialization time might be significant. For example, on
              a modern Linux x86_64 server, initialization of a 10GB
              buffer pool takes approximately 6 seconds. See
              <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_change_buffer_max_size"></a>
          <a class="indexterm" name="idp87971760"></a>

          <code class="literal">innodb_change_buffer_max_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_change_buffer_max_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_change_buffer_max_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_change_buffer_max_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_change_buffer_max_size">innodb_change_buffer_max_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">25</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 50</code></td></tr></tbody></table>
</div>
<p>
          Maximum size for the InnoDB
          <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a>, as a
          percentage of the total size of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. You might
          increase this value for a MySQL server with heavy insert,
          update, and delete activity, or decrease it for a MySQL server
          with unchanging data used for reporting. For general I/O
          tuning advice, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_change_buffering"></a>
          <a class="indexterm" name="idp88002448"></a>

          <a class="indexterm" name="idp88003536"></a>

          <code class="literal">innodb_change_buffering</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_change_buffering" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_change_buffering=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_change_buffering</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="9"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">all</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">inserts</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">deletes</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">purges</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">changes</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">all</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr></tbody></table>
</div>
<p>
          Whether <code class="literal">InnoDB</code> performs
          <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change buffering</a>,
          an optimization that delays write operations to secondary
          indexes so that the I/O operations can be performed
          sequentially. The permitted values are
          <code class="literal">inserts</code> (buffer insert operations),
          <code class="literal">deletes</code> (buffer delete operations; strictly
          speaking, the writes that mark index records for later
          deletion during a purge operation), <code class="literal">changes</code>
          (buffer insert and delete-marking operations),
          <code class="literal">purges</code> (buffer
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations, the writes
          when deleted index entries are finally garbage-collected),
          <code class="literal">all</code> (buffer insert, delete-marking, and
          purge operations) and <code class="literal">none</code> (do not buffer
          any operations). The default is <code class="literal">all</code>. For
          details, see
          <a class="xref" href="storage-engines.html#innodb-performance-change_buffering" title="14.2.4.2.13. Controlling InnoDB Change Buffering">Section 14.2.4.2.13, “Controlling InnoDB Change Buffering”</a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_checksum_algorithm"></a>
          <a class="indexterm" name="idp88046832"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_checksum_algorithm" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_checksum_algorithm=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_checksum_algorithm</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm">innodb_checksum_algorithm</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="9"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_none</code></td></tr><tr><td scope="row" rowspan="9"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6, &lt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_none</code></td></tr><tr><td scope="row" rowspan="9"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.7)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_innodb</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_crc32</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">strict_none</code></td></tr></tbody></table>
</div>
<p>
          Specifies how to generate and verify the
          <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> stored in each
          disk block of each <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>. Replaces
          the <a class="link" href="storage-engines.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a> option.
        </p><p>
          The value <code class="literal">innodb</code> is backward-compatible
          with all versions of MySQL. The value <code class="literal">crc32</code>
          uses an algorithm that is faster to compute the checksum for
          every modified block, and to check the checksums for each disk
          read. The value <code class="literal">none</code> writes a constant
          value in the checksum field rather than computing a value
          based on the block data. The blocks in a tablespace can use a
          mix of old, new, and no checksum values, being updated
          gradually as the data is modified; once any blocks in a
          tablespace are modified to use the <code class="literal">crc32</code>
          algorithm, the associated tables cannot be read by earlier
          versions of MySQL.
        </p><p>
          The default value was changed from <code class="literal">innodb</code>
          to <span class="command"><strong>crc32</strong></span> in MySQL 5.6.6, but switched back
          to <code class="literal">innodb</code> in 5.6.7 for improved
          compatibility of <code class="literal">InnoDB</code> data files during a
          downgrade to an earlier MySQL version, and for use of
          <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="24.2. MySQL Enterprise Backup">MySQL Enterprise
          Backup</a> for backups.
        </p><p>
          The <code class="literal">strict_*</code> forms work the same as
          <code class="literal">innodb</code>, <code class="literal">crc32</code>, and
          <code class="literal">none</code>, except that <code class="literal">InnoDB</code>
          halts if it encounters a mix of checksum values in the same
          tablespace. You can only use these options in a completely new
          instance, to set up all tablespaces for the first time. The
          <code class="literal">strict_*</code> settings are somewhat faster,
          because they do not need to compute both new and old checksum
          values to accept both during disk reads.
        </p><p>
          For usage information, including a matrix of valid
          combinations of checksum values during read and write
          operations, see <a class="xref" href="storage-engines.html#innodb-crc32-checksum" title="14.2.4.2.7. Fast CRC32 Checksum Algorithm">Section 14.2.4.2.7, “Fast CRC32 Checksum Algorithm”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_checksums"></a>
          <a class="indexterm" name="idp88132864"></a>

          <a class="indexterm" name="idp88133952"></a>

          <code class="literal">innodb_checksums</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_checksums" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_checksums</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_checksums</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_checksums">innodb_checksums</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> can use
          <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> validation on
          all tablespace pages read from the disk to ensure extra fault
          tolerance against hardware faults or corrupted data files.
          This validation is enabled by default. Under specialized
          circumstances (such as when running benchmarks) this extra
          safety feature can be disabled with
          <code class="option">--skip-innodb-checksums</code>. You can specify the
          method of calculating the checksum with
          <a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>.
        </p><p>
          In MySQL 5.6.3 and higher, this option is deprecated, replaced
          by <a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>.
          <code class="literal">innodb_checksum_algorithm=innodb</code> is the
          same as <code class="literal">innodb_checksums=ON</code> (the default).
          <code class="literal">innodb_checksum_algorithm=none</code> is the same
          as <code class="literal">innodb_checksums=OFF</code>. Remove any
          <code class="literal">innodb_checksums</code> options from your
          configuration files and startup scripts, to avoid conflicts
          with <code class="literal">innodb_checksum_algorithm</code>:
          <code class="literal">innodb_checksums=OFF</code> would automatically
          set <code class="literal">innodb_checksum_algorithm=none</code>;
          <code class="literal">innodb_checksums=ON</code> would be ignored and
          overridden by any other setting for
          <code class="literal">innodb_checksum_algorithm</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_cmp_per_index_enabled"></a>
          <a class="indexterm" name="idp88170512"></a>

          <code class="literal">innodb_cmp_per_index_enabled</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_cmp_per_index_enabled" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_cmp_per_index_enabled=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_cmp_per_index_enabled</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_cmp_per_index_enabled">innodb_cmp_per_index_enabled</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Enables per-index compression-related statistics in the
          <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="20.30.2. The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP_PER_INDEX</code></a>
          table. Because these statistics can be expensive to gather,
          only enable this option on development, test, or slave
          instances during performance tuning related to
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> tables.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_commit_concurrency"></a>
          <a class="indexterm" name="idp88203248"></a>

          <a class="indexterm" name="idp88204352"></a>

          <a class="indexterm" name="idp88205856"></a>

          <code class="literal">innodb_commit_concurrency</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_commit_concurrency" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_commit_concurrency=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_commit_concurrency</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 1000</code></td></tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that
          can <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> at the same
          time. A value of 0 (the default) permits any number of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to commit
          simultaneously.
        </p><p>
          The value of <code class="literal">innodb_commit_concurrency</code>
          cannot be changed at runtime from zero to nonzero or vice
          versa. The value can be changed from one nonzero value to
          another.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_failure_threshold_pct"></a>
          <a class="indexterm" name="idp88237136"></a>

          <code class="literal">innodb_compression_failure_threshold_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_compression_failure_threshold_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_compression_failure_threshold_pct=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_compression_failure_threshold_pct</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_compression_failure_threshold_pct">innodb_compression_failure_threshold_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 100</code></td></tr></tbody></table>
</div>
<p>
          Sets the cutoff point at which MySQL begins adding padding
          within <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a>
          pages to avoid expensive
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a>. A value of zero disables the mechanism that
          monitors compression efficiency and dynamically adjusts the
          padding amount.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_level"></a>
          <a class="indexterm" name="idp88267280"></a>

          <code class="literal">innodb_compression_level</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_compression_level" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_compression_level=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_compression_level</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_compression_level">innodb_compression_level</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 9</code></td></tr></tbody></table>
</div>
<p>
          Specifies the level of zlib compression to use for
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> tables and
          indexes.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_pad_pct_max"></a>
          <a class="indexterm" name="idp88297104"></a>

          <code class="literal">innodb_compression_pad_pct_max</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_compression_pad_pct_max" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_compression_pad_pct_max=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_compression_pad_pct_max</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_compression_pad_pct_max">innodb_compression_pad_pct_max</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 75</code></td></tr></tbody></table>
</div>
<p>
          Specifies the maximum percentage that can be reserved as free
          space within each compressed
          <a class="link" href="glossary.html#glos_page" title="page">page</a>, allowing room to
          reorganize the data and modification log within the page when
          a <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> table or
          index is updated and the data might be recompressed. Only
          applies when
          <a class="link" href="storage-engines.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>
          is set to a non-zero value, and the rate of
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a> passes the cutoff point.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_concurrency_tickets"></a>
          <a class="indexterm" name="idp88328912"></a>

          <a class="indexterm" name="idp88330016"></a>

          <a class="indexterm" name="idp88331520"></a>

          <code class="literal">innodb_concurrency_tickets</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_concurrency_tickets" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_concurrency_tickets=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_concurrency_tickets</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">500</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 4294967295</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          Determines the number of
          <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that can enter
          <code class="literal">InnoDB</code> concurrently. A thread is placed in
          a queue when it tries to enter <code class="literal">InnoDB</code> if
          the number of threads has already reached the concurrency
          limit. When a thread is permitted to enter
          <code class="literal">InnoDB</code>, it is given a number of <span class="quote">“<span class="quote">free
          tickets</span>”</span> equal to the value of
          <a class="link" href="storage-engines.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
          and the thread can enter and leave <code class="literal">InnoDB</code>
          freely until it has used up its tickets. After that point, the
          thread again becomes subject to the concurrency check (and
          possible queuing) the next time it tries to enter
          <code class="literal">InnoDB</code>. The default value is 5000 as of
          MySQL 5.6.6, 500 before that.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_data_file_path"></a>
          <a class="indexterm" name="idp88374016"></a>

          <a class="indexterm" name="idp88375104"></a>

          <code class="literal">innodb_data_file_path</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_data_file_path" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_file_path=name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_data_file_path</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ibdata1:10M:autoextend</code></td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.7)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ibdata1:12M:autoextend</code></td></tr></tbody></table>
</div>
<p>
          The paths to individual <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a> and their
          sizes. The full directory path to each data file is formed by
          concatenating
          <a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to each
          path specified here. The file sizes are specified in KB, MB,
          or GB (1024MB) by appending <code class="literal">K</code>,
          <code class="literal">M</code>, or <code class="literal">G</code> to the size
          value. The sum of the sizes of the files must be at least
          slightly larger than 10MB. If you do not specify
          <code class="literal">innodb_data_file_path</code>, the default behavior
          is to create a single auto-extending data file, slightly
          larger than 12MB, named <code class="filename">ibdata1</code>. The size
          limit of individual files is determined by your operating
          system. You can set the file size to more than 4GB on those
          operating systems that support big files. You can also
          <a class="link" href="storage-engines.html#innodb-raw-devices" title="14.2.2.3. Using Raw Disk Partitions for the Shared Tablespace">use raw disk partitions as
          data files</a>. For detailed information on configuring
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a> files, see
          <a class="xref" href="storage-engines.html#innodb-configuration" title="14.2.1.2. Configuring InnoDB">Section 14.2.1.2, “Configuring <code class="literal">InnoDB</code>”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_data_home_dir"></a>
          <a class="indexterm" name="idp88415344"></a>

          <a class="indexterm" name="idp88416432"></a>

          <code class="literal">innodb_data_home_dir</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_data_home_dir" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_home_dir=path</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_data_home_dir</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr></tbody></table>
</div>
<p>
          The common part of the directory path for all
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a> in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>. This setting does not affect the location
          of<a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespaces when
          <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled. The default value is the MySQL data directory. If you
          specify the value as an empty string, you can use absolute
          file paths in
          <a class="link" href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_disable_sort_file_cache"></a>
          <a class="indexterm" name="idp88444464"></a>

          <a class="indexterm" name="idp88445568"></a>

          <code class="literal">innodb_disable_sort_file_cache</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_disable_sort_file_cache" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_disable_sort_file_cache=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_disable_sort_file_cache</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_disable_sort_file_cache">innodb_disable_sort_file_cache</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          If enabled, this variable disables the operating system file
          system cache for merge-sort temporary files. The effect is to
          open such files with the equivalent of
          <code class="literal">O_DIRECT</code>. This variable was added in MySQL
          5.6.4.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_doublewrite"></a>
          <a class="indexterm" name="idp88473040"></a>

          <a class="indexterm" name="idp88474128"></a>

          <a class="indexterm" name="idp88475616"></a>

          <code class="literal">innodb_doublewrite</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_doublewrite" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-doublewrite</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_doublewrite</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table>
</div>
<p>
          If this variable is enabled (the default),
          <code class="literal">InnoDB</code> stores all data twice, first to the
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>, then to the actual
          <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a>. This
          variable can be turned off with
          <code class="option">--skip-innodb_doublewrite</code> for benchmarks or
          cases when top performance is needed rather than concern for
          data integrity or possible failures.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fast_shutdown"></a>
          <a class="indexterm" name="idp88500480"></a>

          <a class="indexterm" name="idp88501568"></a>

          <code class="literal">innodb_fast_shutdown</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_fast_shutdown" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_fast_shutdown[=#]</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_fast_shutdown</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="6"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          The <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_shutdown" title="shutdown">shutdown</a> mode. If the
          value is 0, <code class="literal">InnoDB</code> does a
          <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>, a
          full <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> and an insert
          buffer merge before shutting down. If the value is 1 (the
          default), <code class="literal">InnoDB</code> skips these operations at
          shutdown, a process known as a
          <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>. If
          the value is 2, <code class="literal">InnoDB</code> flushes its logs and
          shuts down cold, as if MySQL had crashed; no committed
          transactions are lost, but the
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          operation makes the next startup take longer.
        </p><p>
          The slow shutdown can take minutes, or even hours in extreme
          cases where substantial amounts of data are still buffered.
          Use the slow shutdown technique before upgrading or
          downgrading between MySQL major releases, so that all data
          files are fully prepared in case the upgrade process updates
          the file format.
        </p><p>
          Use <code class="literal">innodb_fast_shutdown=2</code> in emergency or
          troubleshooting situations, to get the absolute fastest
          shutdown if data is at risk of corruption.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_format"></a>
          <a class="indexterm" name="idp88540848"></a>

          <a class="indexterm" name="idp88541936"></a>

          <a class="indexterm" name="idp88543424"></a>

          <a class="indexterm" name="idp88544496"></a>

          <code class="literal">innodb_file_format</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_format</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_file_format">innodb_file_format</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_file_format" title="file format">file format</a> to use
          for new <code class="literal">InnoDB</code> tables. Currently,
          <code class="literal">Antelope</code> and <code class="literal">Barracuda</code>
          are supported. This applies only for tables that have their
          own <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>, so for
          it to have an effect,
          <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
          enabled. The <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>
          file format is required for certain InnoDB features such as
          table <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_format_check"></a>
          <a class="indexterm" name="idp88578944"></a>

          <a class="indexterm" name="idp88580048"></a>

          <code class="literal">innodb_file_format_check</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format_check" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_check=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_format_check</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          This variable can be set to 1 or 0 at server startup to enable
          or disable whether <code class="literal">InnoDB</code> checks the
          <a class="link" href="glossary.html#glos_file_format" title="file format">file format</a> tag in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> (for example, <code class="literal">Antelope</code> or
          <code class="literal">Barracuda</code>). If the tag is checked and is
          higher than that supported by the current version of
          <code class="literal">InnoDB</code>, an error occurs and
          <code class="literal">InnoDB</code> does not start. If the tag is not
          higher, <code class="literal">InnoDB</code> sets the value of
          <a class="link" href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to the
          file format tag.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            Despite the default value sometimes being displayed as
            <code class="literal">ON</code> or <code class="literal">OFF</code>, always use
            the numeric values 1 or 0 to turn this option on or off in
            your configuration file or command line.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_file_format_max"></a>
          <a class="indexterm" name="idp88613984"></a>

          <a class="indexterm" name="idp88615072"></a>

          <code class="literal">innodb_file_format_max</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format_max" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_max=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_format_max</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_file_format_max">innodb_file_format_max</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr></tbody></table>
</div>
<p>
          At server startup, <code class="literal">InnoDB</code> sets the value of
          this variable to the <a class="link" href="glossary.html#glos_file_format" title="file format">file
          format</a> tag in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> (for example, <code class="literal">Antelope</code> or
          <code class="literal">Barracuda</code>). If the server creates or opens
          a table with a <span class="quote">“<span class="quote">higher</span>”</span> file format, it sets the
          value of
          <a class="link" href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to
          that format.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_per_table"></a>
          <a class="indexterm" name="idp88648912"></a>

          <a class="indexterm" name="idp88650000"></a>

          <code class="literal">innodb_file_per_table</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_per_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_per_table</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_per_table</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          When <code class="literal">innodb_file_per_table</code> is enabled (the
          default in 5.6.6 and higher), <code class="literal">InnoDB</code> stores
          the data and indexes for each newly created table in a
          separate
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code>
          file</a>, rather than in the system tablespace. The storage
          for these <code class="literal">InnoDB</code> tables is reclaimed when
          such tables are dropped or truncated. This setting enables
          several other <code class="literal">InnoDB</code> features, such as
          table <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>. See
          <a class="xref" href="server-administration.html#innodb-multiple-tablespaces" title="5.4.1. Managing InnoDB Tablespaces">Section 5.4.1, “Managing InnoDB Tablespaces”</a> for details
          about such features as well as advantages and disadvantages of
          using per-table tablespaces.
        </p><p>
          When <code class="literal">innodb_file_per_table</code> is disabled,
          <code class="literal">InnoDB</code> stores the data for all tables and
          indexes in the <a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata
          files</a> that make up the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>. This setting reduces the performance
          overhead of filesystem operations for operations such as
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> or
          <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>. It is most
          appropriate for a server environment where entire storage
          devices are devoted to MySQL data. Because the system
          tablespace never shrinks, and is shared across all databases
          in an <a class="link" href="glossary.html#glos_instance" title="instance">instance</a>, avoid
          loading huge amounts of temporary data on a space-constrained
          system when <code class="literal">innodb_file_per_table=OFF</code>. Set
          up a separate instance in such cases, so that you can drop the
          entire instance to reclaim the space.
        </p><p>
          By default, <code class="literal">innodb_file_per_table</code> is
          enabled as of MySQL 5.6.6, disabled before that. Consider
          disabling it if backward compatibility with MySQL 5.5 or 5.1
          is a concern. This will prevent <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> from moving
          <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables from the system
          tablespace to individual <code class="filename">.ibd</code> files.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_log_at_timeout"></a>
          <a class="indexterm" name="idp88697680"></a>

          <a class="indexterm" name="idp88698784"></a>

          <code class="literal">innodb_flush_log_at_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_log_at_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_timeout">innodb_flush_log_at_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 2700</code></td></tr></tbody></table>
</div>
<p>
          Write and flush the logs every <em class="replaceable"><code>N</code></em>
          seconds.
          <a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
          was introduced in MySQL 5.6.6. It allows the timeout period
          between flushes to be increased in order to reduce flushing
          and avoid impacting performance of binary log group commit.
          Prior to MySQL 5.6.6, flushing frequency was once per second.
          The default setting for
          <a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
          is also once per second.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_log_at_trx_commit"></a>
          <a class="indexterm" name="idp88725568"></a>

          <a class="indexterm" name="idp88726672"></a>

          <code class="literal">innodb_flush_log_at_trx_commit</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_log_at_trx_commit" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_log_at_trx_commit[=#]</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_flush_log_at_trx_commit</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="6"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          Controls the balance between strict
          <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> compliance for
          <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> operations, and
          higher performance that is possible when commit-related I/O
          operations are rearranged and done in batches. You can achieve
          better performance by changing the default value, but then you
          can lose up to one second worth of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> in a
          crash.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The default value of 1 is required for full ACID
              compliance. With this value, the
              <a class="link" href="glossary.html#glos_log_buffer" title="log buffer">log buffer</a> is
              written out to the <a class="link" href="glossary.html#glos_log_file" title="log file">log
              file</a> at each transaction commit and the
              <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> to disk operation
              is performed on the log file.
            </p></li><li class="listitem"><p>
              With a value of 0, any <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process
              crash can erase the last second of transactions. The log
              buffer is written out to the log file once per second and
              the flush to disk operation is performed on the log file,
              but no writes are done at a transaction commit.
            </p></li><li class="listitem"><p>
              With a value of 2, only an operating system crash or a
              power outage can erase the last second of transactions.
              The log buffer is written out to the file at each commit,
              but the flush to disk operation is not performed on it.
              Before MySQL 5.6.6, the flushing on the log file takes
              place once per second. Note that the once-per-second
              flushing is not 100% guaranteed to happen every second,
              due to process scheduling issues. As of MySQL 5.6.6,
              flushing frequency is controlled by
              <a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
              instead.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code>'s
              <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
              works regardless of the value. Transactions are either
              applied entirely or erased entirely.
</p></li></ul>
</div>
<p>
          For the greatest possible durability and consistency in a
          replication setup using <code class="literal">InnoDB</code> with
          transactions, use
          <code class="literal">innodb_flush_log_at_trx_commit=1</code> and
          <code class="literal">sync_binlog=1</code> in your master server
          <code class="filename">my.cnf</code> file.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p xmlns="">
            Many operating systems and some disk hardware fool the
            flush-to-disk operation. They may tell
            <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> that the flush has taken place,
            even though it has not. Then the durability of transactions
            is not guaranteed even with the setting 1, and in the worst
            case a power outage can even corrupt
            <code class="literal">InnoDB</code> data. Using a battery-backed disk
            cache in the SCSI disk controller or in the disk itself
            speeds up file flushes, and makes the operation safer. You
            can also try using the Unix command
            <span class="command"><strong>hdparm</strong></span> to disable the caching of disk
            writes in hardware caches, or use some other command
            specific to the hardware vendor.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_flush_method"></a>
          <a class="indexterm" name="idp88777440"></a>

          <a class="indexterm" name="idp88778528"></a>

          <code class="literal">innodb_flush_method</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_method" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_method=name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_flush_method</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_flush_method">innodb_flush_method</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span> (linux)</td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span> (hpux)</td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span> (solaris)</td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr><tr><td scope="row" rowspan="7"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.7)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span> (linux)</td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT_NO_FSYNC</code></td></tr><tr><td scope="row" rowspan="7"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.7)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span> (solaris)</td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT_NO_FSYNC</code></td></tr><tr><td scope="row" rowspan="7"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.7)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span> (hpux)</td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT_NO_FSYNC</code></td></tr></tbody></table>
</div>
<p>
          Controls the system calls used to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data to the
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a> and <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a>, which can influence I/O throughput. This
          variable is relevant only for Unix and Linux systems. On
          Windows systems, the flush method is always
          <code class="literal">async_unbuffered</code> and cannot be changed.
        </p><p>
          By default, <code class="literal">InnoDB</code> uses the
          <code class="literal">fsync()</code> system call to flush both the data
          and log files. If
          <a class="link" href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> option is
          set to <code class="literal">O_DSYNC</code>, <code class="literal">InnoDB</code>
          uses <code class="literal">O_SYNC</code> to open and flush the log
          files, and <code class="literal">fsync()</code> to flush the data files.
          If <code class="literal">O_DIRECT</code> is specified (available on some
          GNU/Linux versions, FreeBSD, and Solaris),
          <code class="literal">InnoDB</code> uses <code class="literal">O_DIRECT</code> (or
          <code class="literal">directio()</code> on Solaris) to open the data
          files, and uses <code class="literal">fsync()</code> to flush both the
          data and log files. Note that <code class="literal">InnoDB</code> uses
          <code class="literal">fsync()</code> instead of
          <code class="literal">fdatasync()</code>, and it does not use
          <code class="literal">O_DSYNC</code> by default because there have been
          problems with it on many varieties of Unix.
        </p><p>
          An alternative setting is
          <code class="literal">O_DIRECT_NO_FSYNC</code>: it uses the
          <code class="literal">O_DIRECT</code> flag during flushing I/O, but
          skips the <code class="literal">fsync()</code> system call afterwards.
          This setting is suitable for some types of filesystems but not
          others. For example, it is not suitable for XFS. If you are
          not sure whether the filesystem you use requires an
          <code class="literal">fsync()</code>, for example to preserve all file
          metadata, use <code class="literal">O_DIRECT</code> instead.
        </p><p>
          Depending on hardware configuration, setting
          <code class="literal">innodb_flush_method</code> to
          <code class="literal">O_DIRECT</code> or
          <code class="literal">O_DIRECT_NO_FSYNC</code> can have either a
          positive or negative effect on performance. Benchmark your
          particular configuration to decide which setting to use, or
          whether to keep the default. Examine the
          <a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs"><code class="literal">Innodb_data_fsyncs</code></a> status
          variable to see the overall number of
          <code class="literal">fsync()</code> calls done with each setting. The
          mix of read and write operations in your workload can also
          affect which setting performs better for you. For example, on
          a system with a hardware RAID controller and battery-backed
          write cache, <code class="literal">O_DIRECT</code> can help to avoid
          double buffering between the <code class="literal">InnoDB</code> buffer
          pool and the operating system's filesystem cache. On some
          systems where <code class="literal">InnoDB</code> data and log files are
          located on a SAN, the default value or
          <code class="literal">O_DSYNC</code> might be faster for a read-heavy
          workload with mostly <code class="literal">SELECT</code> statements.
          Always test this parameter with the same type of hardware and
          workload that reflects your production environment. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p><p>
          Formerly, a value of <code class="literal">fdatasync</code> also
          specified the default behavior. This value was removed, due to
          confusion that a value of <code class="literal">fdatasync</code> caused
          <code class="literal">fsync()</code> system calls rather than
          <code class="literal">fdatasync()</code> for flushing. To obtain the
          default value now, do not set any value for
          <a class="link" href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> at
          startup.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_neighbors"></a>
          <a class="indexterm" name="idp88904832"></a>

          <code class="literal">innodb_flush_neighbors</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_neighbors" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_neighbors</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_flush_neighbors</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_flush_neighbors">innodb_flush_neighbors</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="6"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> a
          page from the InnoDB <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a> also flushes other
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> in the same
          <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The default value of 1 flushes contiguous dirty pages in
              the same extent from the buffer pool.
            </p></li><li class="listitem"><p>
              A setting of 0 turns
              <code class="literal">innodb_flush_neighbors</code> off and no other
              dirty pages are flushed from the buffer pool.
            </p></li><li class="listitem"><p>
              A setting of 2 flushes dirty pages in the same extent from
              the buffer pool.
</p></li></ul>
</div>
<p>
          When the table data is stored on a traditional
          <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> storage device, flushing
          such <a class="link" href="glossary.html#glos_neighbor_page" title="neighbor page">neighbor pages</a>
          in one operation reduces I/O overhead (primarily for disk seek
          operations) compared to flushing individual pages at different
          times. For table data stored on
          <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a>, seek time is not a
          significant factor and you can turn this setting off to spread
          out the write operations. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flushing_avg_loops"></a>
          <a class="indexterm" name="idp88946608"></a>

          <code class="literal">innodb_flushing_avg_loops</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flushing_avg_loops" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flushing_avg_loops=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_flushing_avg_loops</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_flushing_avg_loops">innodb_flushing_avg_loops</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">30</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1000</code></td></tr></tbody></table>
</div>
<p>
          Number of iterations for which InnoDB keeps the previously
          calculated snapshot of the flushing state, controlling how
          quickly <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
          flushing</a> responds to changing
          <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>. Increasing the
          value makes the the rate of
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> operations change
          smoothly and gradually as the workload changes. Decreasing the
          value makes adaptive flushing adjust quickly to workload
          changes, which can cause spikes in flushing activity if the
          workload increases and decreases suddenly.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_load_corrupted"></a>
          <a class="indexterm" name="idp88977600"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_force_load_corrupted"><code class="literal">innodb_force_load_corrupted</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_force_load_corrupted" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_force_load_corrupted</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_force_load_corrupted</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Lets InnoDB load tables at startup that are marked as
          corrupted. Use only during troubleshooting, to recover data
          that is otherwise inaccessible. When troubleshooting is
          complete, turn this setting back off and restart the server.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_recovery"></a>
          <a class="indexterm" name="idp89004112"></a>

          <a class="indexterm" name="idp89005200"></a>

          <code class="literal">innodb_force_recovery</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_force_recovery" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_force_recovery=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_force_recovery</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="10"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" rowspan="7" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">3</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">5</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">6</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          mode, typically only changed in serious troubleshooting
          situations. Possible values are from 0 to 6. The meanings of
          these values are described in
          <a class="xref" href="storage-engines.html#forcing-innodb-recovery" title="14.2.4.6. Starting InnoDB on a Corrupted Database">Section 14.2.4.6, “Starting <code class="literal">InnoDB</code> on a Corrupted Database”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p xmlns="">
            Only set this variable greater than 0 in an emergency
            situation, to dump your tables from a corrupt database. As a
            safety measure, <code class="literal">InnoDB</code> prevents any
            changes to its data when this variable is greater than 0.
            This restriction also prohibits some queries that use
            <code class="literal">WHERE</code> or <code class="literal">ORDER BY</code>
            clauses, because high values can prevent queries from using
            indexes, to guard against possible corrupt index data.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_ft_aux_table"></a>
          <a class="indexterm" name="idp89045680"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_aux_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_aux_table">innodb_ft_aux_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Specifies the qualified name of an <code class="literal">InnoDB</code>
          table containing a <code class="literal">FULLTEXT</code> index. This
          variable is intended for diagnostic purposes and can only be
          set at runtime. For example:
        </p><pre class="programlisting">mysql&gt; set global innodb_ft_aux_table = 'test/t1';</pre><p>
          Attempting to set this variable at startup will result in a
          <span class="quote">“<span class="quote"><span class="errortext">mysqld: option '--innodb-ft-aux-table'
          cannot take an argument</span></span>”</span> error and startup
          will abort. After you set this variable to a name in the
          format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>,
          the <code class="literal">INFORMATION_SCHEMA</code> tables
          <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="20.30.22. The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="20.30.23. The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-config-table" title="20.30.20. The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="20.30.24. The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>, and
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="20.30.25. The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a> will show
          information about the search index for the specified table.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_cache_size"></a>
          <a class="indexterm" name="idp89075104"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_cache_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_cache_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_cache_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_cache_size">innodb_ft_cache_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.4, &lt;= 5.6.9)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">32000000</code></td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.10)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8000000</code></td></tr></tbody></table>
</div>
<p>
          

          Size of the cache that holds a parsed document in memory while
          creating an InnoDB <code class="literal">FULLTEXT</code> index.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_enable_diag_print"></a>
          <a class="indexterm" name="idp89109360"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_diag_print"><code class="literal">innodb_ft_enable_diag_print</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_enable_diag_print" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_enable_diag_print=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_enable_diag_print</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_diag_print">innodb_ft_enable_diag_print</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.7)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Whether to enable additional full-text search diagnostic
          output.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_enable_stopword"></a>
          <a class="indexterm" name="idp89142080"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_stopword"><code class="literal">innodb_ft_enable_stopword</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_enable_stopword" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_enable_stopword=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_enable_stopword</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_stopword">innodb_ft_enable_stopword</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies that a set of
          <a class="link" href="glossary.html#glos_stopword" title="stopword">stopwords</a> is associated
          with an <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
          index at the time the index is created. If the
          <a class="link" href="storage-engines.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>
          option is set, the stopwords are taken from that table. Else,
          if the
          <a class="link" href="storage-engines.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>
          option is set, the stopwords are taken from that table.
          Otherwise, a built-in set of default stopwords is used.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_max_token_size"></a>
          <a class="indexterm" name="idp89172512"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_max_token_size"><code class="literal">innodb_ft_max_token_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_max_token_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_max_token_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_max_token_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_max_token_size">innodb_ft_max_token_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">84</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">10 .. 252</code></td></tr></tbody></table>
</div>
<p>
          Maximum length of words that are stored in an InnoDB
          <code class="literal">FULLTEXT</code> index. Setting a limit on this
          value reduces the size of the index, thus speeding up queries,
          by omitting long keywords or arbitrary collections of letters
          that are not real words and are not likely to be search terms.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_min_token_size"></a>
          <a class="indexterm" name="idp89202016"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_min_token_size"><code class="literal">innodb_ft_min_token_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_min_token_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_min_token_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_min_token_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_min_token_size">innodb_ft_min_token_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">3</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 16</code></td></tr></tbody></table>
</div>
<p>
          Minimum length of words that are stored in an InnoDB
          <code class="literal">FULLTEXT</code> index. Increasing this value
          reduces the size of the index, thus speeding up queries, by
          omitting common word that are unlikely to be significant in a
          search context, such as the English words <span class="quote">“<span class="quote">a</span>”</span> and
          <span class="quote">“<span class="quote">to</span>”</span>. For content using a CJK (Chinese, Japanese,
          Korean) character set, specify a value of 1.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_num_word_optimize"></a>
          <a class="indexterm" name="idp89232416"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_num_word_optimize"><code class="literal">innodb_ft_num_word_optimize</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_num_word_optimize" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_num_word_optimize=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_num_word_optimize</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_num_word_optimize">innodb_ft_num_word_optimize</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2000</code></td></tr></tbody></table>
</div>
<p>
          Number of words to process during each
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> operation on an
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index.
          Because a bulk insert or update operation to a table
          containing a full-text search index could require substantial
          index maintenance to incorporate all changes, you might do a
          series of <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
          statements, each picking up where the last left off.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_server_stopword_table"></a>
          <a class="indexterm" name="idp89262144"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_server_stopword_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_server_stopword_table=db_name/table_name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_server_stopword_table</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_server_stopword_table">innodb_ft_server_stopword_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          Name of the table containing a list of words to ignore when
          creating an InnoDB <code class="literal">FULLTEXT</code> index, in the
          format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            The stopword table must be an <code class="literal">InnoDB</code>
            table, containing a single <code class="literal">VARCHAR</code> column
            named <code class="literal">VALUE</code>. The stopword table must
            exist before you specify its name in the configuration
            option value.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_ft_sort_pll_degree"></a>
          <a class="indexterm" name="idp89293696"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_sort_pll_degree" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_sort_pll_degree=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_sort_pll_degree</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_sort_pll_degree">innodb_ft_sort_pll_degree</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 32</code></td></tr></tbody></table>
</div>
<p>
          Number of threads used in parallel to index and tokenize text
          in an <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
          index, when building a
          <a class="link" href="glossary.html#glos_search_index" title="search index">search index</a> for a
          large table. See
          <a class="link" href="storage-engines.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a> for
          additional usage information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_user_stopword_table"></a>
          <a class="indexterm" name="idp89325344"></a>

          <a class="link" href="storage-engines.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_ft_user_stopword_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_ft_user_stopword_table=db_name/table_name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_ft_user_stopword_table</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_ft_user_stopword_table">innodb_ft_user_stopword_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          Name of the table containing a list of words to ignore when
          creating an InnoDB <code class="literal">FULLTEXT</code> index, in the
          format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            The stopword table must be an <code class="literal">InnoDB</code>
            table, containing a single <code class="literal">VARCHAR</code> column
            named <code class="literal">VALUE</code>. The stopword table must
            exist before you specify its name in the configuration
            option value.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_io_capacity"></a>
          <a class="indexterm" name="idp89356896"></a>

          <a class="indexterm" name="idp89357984"></a>

          <code class="literal">innodb_io_capacity</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_io_capacity" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_io_capacity=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_io_capacity</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">100 .. 2**32-1</code></td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">100 .. 2**64-1</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          parameter sets an upper limit, per buffer pool instance, on
          the I/O activity performed by the <code class="literal">InnoDB</code>
          background tasks, such as
          <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> pages
          from the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
          and merging data from the
          <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert buffer</a>. The
          default value is 200. For busy systems capable of higher I/O
          rates, you can set a higher value at server startup, to help
          the server handle the background maintenance work associated
          with a high rate of row changes.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            Specifying a server startup value for
            <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
            will render
            <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
            inoperable.
</p>
</div>
<p>
          For systems with individual 5400 RPM or 7200 RPM drives, you
          might lower the value to the former default of
          <code class="literal">100</code>.
        </p><p>
          This parameter should be set to approximately the number of
          I/O operations that the system can perform per second.
          Ideally, keep this setting as low as practical, but not so low
          that these background activities fall behind. If the value is
          too high, data is removed from the buffer pool and insert
          buffer too quickly to provide significant benefit from the
          caching.
        </p><p>
          The value represents an estimated proportion of the I/O
          operations per second (IOPS) available to older-generation
          disk drives that could perform about 100 IOPS. The current
          default of 200 reflects that modern storage devices are
          capable of much higher I/O rates.
        </p><p>
          In general, you can increase the value as a function of the
          number of drives used for <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
          I/O, particularly fast drives capable of high numbers of IOPS.
          For example, systems that use multiple disks or solid-state
          disks for <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> are likely to
          benefit from the ability to control this parameter.
        </p><p>
          Although you can specify a very high number, in practice such
          large values have little if any benefit; for example, a value
          of one million would be considered very high.
        </p><p>
          You can set the <code class="literal">innodb_io_capacity</code> value to
          any number 100 or greater, and the default value is
          <code class="literal">200</code>. You can set the value of this
          parameter in the MySQL option file (<code class="literal">my.cnf</code>
          or <code class="literal">my.ini</code>) or change it dynamically with
          the <code class="literal">SET GLOBAL</code> command, which requires the
          <code class="literal">SUPER</code> privilege.
        </p><p>
          See <a class="xref" href="storage-engines.html#innodb-performance-thread_io_rate" title="14.2.4.2.20. Controlling the InnoDB Master Thread I/O Rate">Section 14.2.4.2.20, “Controlling the InnoDB Master Thread I/O Rate”</a> for
          more guidelines about this option. For general information
          about InnoDB I/O performance, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_io_capacity_max"></a>
          <a class="indexterm" name="idp89417008"></a>

          <code class="literal">innodb_io_capacity_max</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_io_capacity_max" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_io_capacity_max=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_io_capacity_max</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_io_capacity_max">innodb_io_capacity_max</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">see formula in description</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">2000 .. 4294967295</code></td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">see formula in description</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">2000 .. 18446744073709547520</code></td></tr></tbody></table>
</div>
<p>
          The limit up to which <code class="literal">InnoDB</code> is allowed to
          extend the <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          setting, per buffer pool instance, in case of emergency. Its
          default value is twice the default value of
          <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>, with a
          lower limit of 2000. It is inoperative if you have specified
          any value for
          <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> at server
          startup.
        </p><p>
          For a brief period during MySQL 5.6 development, this variable
          was known as <code class="literal">innodb_max_io_capacity</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_large_prefix"></a>
          <a class="indexterm" name="idp89463216"></a>

          <a class="indexterm" name="idp89464304"></a>

          <code class="literal">innodb_large_prefix</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_large_prefix" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_large_prefix</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_large_prefix</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_large_prefix">innodb_large_prefix</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enable this option to allow
          <a class="link" href="glossary.html#glos_index_prefix" title="index prefix">index key prefixes</a>
          longer than 767 bytes (up to 3072 bytes), for
          <code class="literal">InnoDB</code> tables that use the
          <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
          row formats. (Creating such tables also requires the option
          values
          <a class="link" href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format=barracuda</code></a>
          and
          <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table=true</code></a>.)
          See <a class="xref" href="storage-engines.html#innodb-restrictions" title="14.2.7. Limits on InnoDB Tables">Section 14.2.7, “Limits on <code class="literal">InnoDB</code> Tables”</a> for the relevant
          maximums associated with index key prefixes under various
          settings.
        </p><p>
          For tables using the
          <code class="literal"><a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a></code>
          row formats, this option does not affect the allowed key
          prefix length. It does introduce a new error possibility. When
          this setting is enabled, attempting to create an index prefix
          with a key length greater than 3072 for a
          <code class="literal">REDUNDANT</code> or <code class="literal">COMPACT</code>
          table causes an error
          <a class="link" href="error-handling.html#error_er_index_column_too_long"><code class="literal">ER_INDEX_COLUMN_TOO_LONG</code></a>
          (1727).
        </p></li><li class="listitem"><p><a name="sysvar_innodb_lock_wait_timeout"></a>
          <a class="indexterm" name="idp89503168"></a>

          <a class="indexterm" name="idp89504272"></a>

          <code class="literal">innodb_lock_wait_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_lock_wait_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_lock_wait_timeout=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_lock_wait_timeout</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1073741824</code></td></tr></tbody></table>
</div>
<p>
          The timeout in seconds an <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a> waits for
          a <a class="link" href="glossary.html#glos_row_lock" title="row lock">row lock</a> before giving
          up. The default value is 50 seconds. A transaction that tries
          to access a row that is locked by another
          <code class="literal">InnoDB</code> transaction waits at most this many
          seconds for write access to the row before issuing the
          following error:
        </p><pre class="programlisting">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</pre><p>
          When a lock wait timeout occurs, the current statement is
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled back</a> (not the
          entire transaction). To have the entire transaction roll back,
          start the server with the
          <a class="link" href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
          option. See also <a class="xref" href="storage-engines.html#innodb-error-handling" title="14.2.3.14. InnoDB Error Handling">Section 14.2.3.14, “<code class="literal">InnoDB</code> Error Handling”</a>.
        </p><p>
          You might decrease this value for highly interactive
          applications or <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a> systems,
          to display user feedback quickly or put the update into a
          queue for processing later. You might increase this value for
          long-running back-end operations, such as a transform step in
          a data warehouse that waits for other large insert or update
          operations to finish.
        </p><p>
          <code class="literal">innodb_lock_wait_timeout</code> applies to
          <code class="literal">InnoDB</code> row locks only. A MySQL
          <a class="link" href="glossary.html#glos_table_lock" title="table lock">table lock</a> does not
          happen inside <code class="literal">InnoDB</code> and this timeout does
          not apply to waits for table locks.
        </p><p>
          The lock wait timeout value does not apply to
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a>, because
          <code class="literal">InnoDB</code> detects them immediately and rolls
          back one of the deadlocked transactions.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_locks_unsafe_for_binlog"></a>
          <a class="indexterm" name="idp89544704"></a>

          <a class="indexterm" name="idp89545808"></a>

          <code class="literal">innodb_locks_unsafe_for_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_locks_unsafe_for_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_locks_unsafe_for_binlog</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_locks_unsafe_for_binlog</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog">innodb_locks_unsafe_for_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idp89570976"></a><a class="indexterm" name="idp89572464"></a><a class="indexterm" name="idp89573952"></a><a class="indexterm" name="idp89575440"></a><a class="indexterm" name="idp89576928"></a><a class="indexterm" name="idp89578416"></a><a class="indexterm" name="idp89579904"></a><a class="indexterm" name="idp89581392"></a><a class="indexterm" name="idp89582880"></a><a class="indexterm" name="idp89584368"></a><p>
          This variable affects how <code class="literal">InnoDB</code> uses
          <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap locking</a> for searches
          and index scans. As of MySQL 5.6.3,
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          deprecated and will be removed in a future MySQL release.
        </p><p>
          Normally, <code class="literal">InnoDB</code> uses an algorithm called
          next-key locking that combines index-row locking with
          <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap locking</a>.
          <code class="literal">InnoDB</code> performs row-level locking in such a
          way that when it searches or scans a table index, it sets
          shared or exclusive locks on the index records it encounters.
          Thus, the row-level locks are actually index-record locks. In
          addition, a next-key lock on an index record also affects the
          <span class="quote">“<span class="quote">gap</span>”</span> before that index record. That is, a
          next-key lock is an index-record lock plus a gap lock on the
          gap preceding the index record. If one session has a shared or
          exclusive lock on record <code class="literal">R</code> in an index,
          another session cannot insert a new index record in the gap
          immediately before <code class="literal">R</code> in the index order.
          See <a class="xref" href="storage-engines.html#innodb-record-level-locks" title="14.2.3.5. InnoDB Record, Gap, and Next-Key Locks">Section 14.2.3.5, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>.
        </p><p>
          By default, the value of
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is 0
          (disabled), which means that gap locking is enabled:
          <code class="literal">InnoDB</code> uses next-key locks for searches and
          index scans. To enable the variable, set it to 1. This causes
          gap locking to be disabled: <code class="literal">InnoDB</code> uses
          only index-record locks for searches and index scans.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code>
          does not disable the use of gap locking for foreign-key
          constraint checking or duplicate-key checking.
        </p><p>
          The effect of enabling
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is similar
          to but not identical to setting the transaction isolation
          level to <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Enabling
              <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              is a global setting and affects all sessions, whereas the
              isolation level can be set globally for all sessions, or
              individually per session.
            </p></li><li class="listitem"><p>
              <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              can be set only at server startup, whereas the isolation
              level can be set at startup or changed at runtime.
</p></li></ul>
</div>
<p>
          <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> therefore
          offers finer and more flexible control than
          <a class="link" href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>.
          For additional details about the effect of isolation level on
          gap locking, see <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6. SET TRANSACTION Syntax">Section 13.3.6, “<code class="literal">SET TRANSACTION</code> Syntax”</a>.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code> may
          cause phantom problems because other sessions can insert new
          rows into the gaps when gap locking is disabled. Suppose that
          there is an index on the <code class="literal">id</code> column of the
          <code class="literal">child</code> table and that you want to read and
          lock all rows from the table having an identifier value larger
          than 100, with the intention of updating some column in the
          selected rows later:
        </p><pre class="programlisting">SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;</pre><p>
          The query scans the index starting from the first record where
          <code class="literal">id</code> is greater than 100. If the locks set on
          the index records in that range do not lock out inserts made
          in the gaps, another session can insert a new row into the
          table. Consequently, if you were to execute the same
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> again within the same
          transaction, you would see a new row in the result set
          returned by the query. This also means that if new items are
          added to the database, <code class="literal">InnoDB</code> does not
          guarantee serializability. Therefore, if
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is enabled,
          <code class="literal">InnoDB</code> guarantees at most an isolation
          level of <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>.
          (Conflict serializability is still guaranteed.) For additional
          information about phantoms, see
          <a class="xref" href="storage-engines.html#innodb-next-key-locking" title="14.2.3.6. Avoiding the Phantom Problem Using Next-Key Locking">Section 14.2.3.6, “Avoiding the Phantom Problem Using Next-Key Locking”</a>.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code> has
          additional effects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              For <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
              <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statements,
              <code class="literal">InnoDB</code> holds locks only for rows that
              it updates or deletes. Record locks for nonmatching rows
              are released after MySQL has evaluated the
              <code class="literal">WHERE</code> condition. This greatly reduces
              the probability of deadlocks, but they can still happen.
            </p></li><li class="listitem"><p>
              For <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements, if a
              row is already locked, <code class="literal">InnoDB</code> performs
              a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, returning the
              latest committed version to MySQL so that MySQL can
              determine whether the row matches the
              <code class="literal">WHERE</code> condition of the
              <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>. If the row matches
              (must be updated), MySQL reads the row again and this time
              <code class="literal">InnoDB</code> either locks it or waits for a
              lock on it.
</p></li></ul>
</div>
<p>
          Consider the following example, beginning with this table:
        </p><pre class="programlisting">CREATE TABLE t (a INT NOT NULL, b INT) ENGINE = InnoDB;
INSERT INTO t VALUES (1,2),(2,3),(3,2),(4,3),(5,2);
COMMIT;</pre><p>
          In this case, table has no indexes, so searches and index
          scans use the hidden clustered index for record locking (see
          <a class="xref" href="storage-engines.html#innodb-index-types" title="14.2.3.12.2. Clustered and Secondary Indexes">Section 14.2.3.12.2, “Clustered and Secondary Indexes”</a>).
        </p><p>
          Suppose that one client performs an
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> using these statements:
        </p><pre class="programlisting">SET autocommit = 0;
UPDATE t SET b = 5 WHERE b = 3;</pre><p>
          Suppose also that a second client performs an
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> by executing these
          statements following those of the first client:
        </p><pre class="programlisting">SET autocommit = 0;
UPDATE t SET b = 4 WHERE b = 2;</pre><p>
          As <code class="literal">InnoDB</code> executes each
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, it first acquires an
          exclusive lock for each row, and then determines whether to
          modify it. If <code class="literal">InnoDB</code> does not modify the
          row and <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          enabled, it releases the lock. Otherwise,
          <code class="literal">InnoDB</code> retains the lock until the end of
          the transaction. This affects transaction processing as
          follows.
        </p><p>
          If <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          disabled, the first <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and does not release any of them:
        </p><pre class="programlisting">x-lock(1,2); retain x-lock
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); retain x-lock
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); retain x-lock</pre><p>
          The second <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> blocks as
          soon as it tries to acquire any locks (because first update
          has retained locks on all rows), and does not proceed until
          the first <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> commits or
          rolls back:
        </p><pre class="programlisting">x-lock(1,2); block and wait for first UPDATE to commit or roll back</pre><p>
          If <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          enabled, the first <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and releases those for rows that it does not
          modify:
        </p><pre class="programlisting">x-lock(1,2); unlock(1,2)
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); unlock(3,2)
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); unlock(5,2)</pre><p>
          For the second <code class="literal">UPDATE</code>,
          <code class="literal">InnoDB</code> does a
          <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, returning the latest
          committed version of each row to MySQL so that MySQL can
          determine whether the row matches the <code class="literal">WHERE</code>
          condition of the <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>:
        </p><pre class="programlisting">x-lock(1,2); update(1,2) to (1,4); retain x-lock
x-lock(2,3); unlock(2,3)
x-lock(3,2); update(3,2) to (3,4); retain x-lock
x-lock(4,3); unlock(4,3)
x-lock(5,2); update(5,2) to (5,4); retain x-lock</pre></li><li class="listitem"><p><a name="sysvar_innodb_log_buffer_size"></a>
          <a class="indexterm" name="idp89654912"></a>

          <a class="indexterm" name="idp89656000"></a>

          <code class="literal">innodb_log_buffer_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_buffer_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_buffer_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_buffer_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">262144 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of the buffer that <code class="literal">InnoDB</code>
          uses to write to the <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a> on disk. The default value is 8MB. A large
          <a class="link" href="glossary.html#glos_log_buffer" title="log buffer">log buffer</a> enables
          large <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to
          run without a need to write the log to disk before the
          transactions <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>. Thus,
          if you have transactions that update, insert, or delete many
          rows, making the log buffer larger saves disk I/O. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_compressed_pages"></a>
          <a class="indexterm" name="idp89687392"></a>

          <code class="literal">innodb_log_compressed_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_compressed_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.11</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_compressed_pages=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_compressed_pages</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_log_compressed_pages">innodb_log_compressed_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether images of
          <a class="link" href="glossary.html#glos_compression" title="compression">re-compressed</a>
          <a class="link" href="glossary.html#glos_page" title="page">pages</a> are stored in
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo
          logs</a>.
        </p><p>
          This variable was added in MySQL 5.6.11.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_file_size"></a>
          <a class="indexterm" name="idp89717616"></a>

          <a class="indexterm" name="idp89718704"></a>

          <code class="literal">innodb_log_file_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_file_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_file_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_file_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.3, &lt;= 5.6.7)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1048576 .. 512GB / innodb_log_files_in_group</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.8)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50331648</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1048576 .. 512GB / innodb_log_files_in_group</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of each <a class="link" href="glossary.html#glos_log_file" title="log file">log
          file</a> in a
          <a class="link" href="glossary.html#glos_log_group" title="log group">log group</a>.
          The combined size of log files
          (<code class="literal">innodb_log_file_size</code> *
          <a class="link" href="storage-engines.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>)
          cannot exceed a maximum value that is slightly less than
          512GB. A pair of 255 GB log files, for example, would allow
          you to approach the limit but not exceed it. The default value
          is 48MB. Sensible values range from 1MB to
          1/<em class="replaceable"><code>N</code></em>-th of the size of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a>, where <em class="replaceable"><code>N</code></em> is the number
          of log files in the group. The larger the value, the less
          checkpoint flush activity is needed in the buffer pool, saving
          disk I/O. Larger log files also make
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
          recovery</a> slower, although improvements to recovery
          performance in MySQL 5.5 and higher make the log file size
          less of a consideration. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_files_in_group"></a>
          <a class="indexterm" name="idp89760896"></a>

          <a class="indexterm" name="idp89762000"></a>

          <code class="literal">innodb_log_files_in_group</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_files_in_group" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_files_in_group=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_files_in_group</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">2 .. 100</code></td></tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>
          in the <a class="link" href="glossary.html#glos_log_group" title="log group">log group</a>.
          <code class="literal">InnoDB</code> writes to the files in a circular
          fashion. The default (and recommended) value is 2. The
          location of these files is specified by
          <a class="link" href="storage-engines.html#sysvar_innodb_log_group_home_dir"><code class="literal">innodb_log_group_home_dir</code></a>.
          The combined size of log files
          (<a class="link" href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> *
          <code class="literal">innodb_log_files_in_group</code>) can be up to
          512GB.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_group_home_dir"></a>
          <a class="indexterm" name="idp89793760"></a>

          <a class="indexterm" name="idp89794864"></a>

          <code class="literal">innodb_log_group_home_dir</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_group_home_dir" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_group_home_dir=path</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_group_home_dir</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr></tbody></table>
</div>
<p>
          The directory path to the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files, whose
          number is specified by
          <a class="link" href="storage-engines.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>. If
          you do not specify any <code class="literal">InnoDB</code> log
          variables, the default is to create two files named
          <code class="filename">ib_logfile0</code> and
          <code class="filename">ib_logfile1</code> in the MySQL data directory.
          Their size is given by the size of the
          <a class="link" href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> system
          variable.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_lru_scan_depth"></a>
          <a class="indexterm" name="idp89822864"></a>

          <code class="literal">innodb_lru_scan_depth</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_lru_scan_depth" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_lru_scan_depth=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_lru_scan_depth</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_lru_scan_depth">innodb_lru_scan_depth</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1024</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">100 .. 2**32-1</code></td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1024</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">100 .. 2**64-1</code></td></tr></tbody></table>
</div>
<p>
          A parameter that influences the algorithms and heuristics for
          the <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> operation for the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. Primarily
          of interest to performance experts tuning I/O-intensive
          workloads. It specifies, per buffer pool instance, how far
          down the buffer pool LRU list the
          <code class="literal">page_cleaner</code> thread scans looking for
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> to flush.
          This is a background operation performed once a second. If you
          have spare I/O capacity under a typical workload, increase the
          value. If a write-intensive workload saturates your I/O
          capacity, decrease the value, especially if you have a large
          buffer pool. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_dirty_pages_pct"></a>
          <a class="indexterm" name="idp89869008"></a>

          <a class="indexterm" name="idp89870112"></a>

          <code class="literal">innodb_max_dirty_pages_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_dirty_pages_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_dirty_pages_pct=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_max_dirty_pages_pct</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">75</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 99</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> so that
          the percentage of <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty
          pages</a> does not exceed this value. Specify an integer in
          the range from 0 to 99. The default value is 75. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_dirty_pages_pct_lwm"></a>
          <a class="indexterm" name="idp89901376"></a>

          <code class="literal">innodb_max_dirty_pages_pct_lwm</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_dirty_pages_pct_lwm" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_dirty_pages_pct_lwm=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct_lwm">innodb_max_dirty_pages_pct_lwm</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 99</code></td></tr></tbody></table>
</div>
<p>
          Low water mark representing percentage of
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> where
          preflushing is enabled to control the dirty page ratio. The
          default of 0 disables the preflushing behavior entirely.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_purge_lag"></a>
          <a class="indexterm" name="idp89930640"></a>

          <a class="indexterm" name="idp89931728"></a>

          <code class="literal">innodb_max_purge_lag</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_purge_lag" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_purge_lag=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_max_purge_lag</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          This variable controls how to delay
          <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations when
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations are lagging
          (see <a class="xref" href="storage-engines.html#innodb-multi-versioning" title="14.2.3.11. InnoDB Multi-Versioning">Section 14.2.3.11, “<code class="literal">InnoDB</code> Multi-Versioning”</a>). The default
          value is 0 (no delays).
        </p><p>
          The <code class="literal">InnoDB</code> transaction system maintains a
          list of transactions that have index records delete-marked by
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations. The length
          of this list represents the
          <em class="replaceable"><code>purge_lag</code></em> value. When
          <em class="replaceable"><code>purge_lag</code></em> exceeds
          <a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>, each
          <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operation is delayed.
        </p><p>
          To prevent excessive delays in extreme situations where
          <em class="replaceable"><code>purge_lag</code></em> becomes huge, you can put
          a cap on the amount of delay by setting the
          <a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag_delay"><code class="literal">innodb_max_purge_lag_delay</code></a>
          configuration option. The delay is computed at the beginning
          of a purge batch.
        </p><p>
          A typical setting for a problematic workload might be 1
          million, assuming that transactions are small, only 100 bytes
          in size, and it is permissible to have 100MB of unpurged
          <code class="literal">InnoDB</code> table rows.
        </p><p>
          The lag value is displayed as the history list length in the
          <code class="literal">TRANSACTIONS</code> section of InnoDB Monitor
          output. For example, if the output includes the following
          lines, the lag value is 20:
        </p><pre class="programlisting">------------
TRANSACTIONS
------------
Trx id counter 0 290328385
Purge done for trx's n:o &lt; 0 290315608 undo n:o &lt; 0 17
History list length 20</pre><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_purge_lag_delay"></a>
          <a class="indexterm" name="idp89976384"></a>

          <a class="indexterm" name="idp89977488"></a>

          <code class="literal">innodb_max_purge_lag_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_purge_lag_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_purge_lag_delay=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_max_purge_lag_delay</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag_delay">innodb_max_purge_lag_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
          Specifies the maximum delay in milliseconds for the delay
          imposed by the
          <a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>
          configuration option. Any non-zero value represents an upper
          limit on the delay period computed from the formula based on
          the value of <code class="literal">innodb_max_purge_lag</code>. The
          default of zero means that there is no upper limit imposed on
          the delay interval.
        </p><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_mirrored_log_groups"></a>
          <a class="indexterm" name="idp90009152"></a>

          <a class="indexterm" name="idp90010256"></a>

          <code class="literal">innodb_mirrored_log_groups</code>
        </p><p>
          Has no effect. This variable is deprecated as of MySQL 5.6.11
          and will be removed in a future MySQL release.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_disable"></a>
          <a class="indexterm" name="idp90014064"></a>

          <code class="literal">innodb_monitor_disable</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_disable" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_disable=[counter|module|pattern|all]</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_monitor_disable</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_disable">innodb_monitor_disable</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Turns off one or more
          <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table">Section 20.30.19, “The <code class="literal">INFORMATION_SCHEMA INNODB_METRICS</code> Table”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_enable"></a>
          <a class="indexterm" name="idp90040112"></a>

          <code class="literal">innodb_monitor_enable</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_enable" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_enable=name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_monitor_enable</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_enable">innodb_monitor_enable</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Turns on one or more
          <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table">Section 20.30.19, “The <code class="literal">INFORMATION_SCHEMA INNODB_METRICS</code> Table”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_reset"></a>
          <a class="indexterm" name="idp90066144"></a>

          <code class="literal">innodb_monitor_reset</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_reset" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_reset=[counter|module|pattern|all]</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_monitor_reset</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_reset">innodb_monitor_reset</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Resets to zero the count value for one or more
          <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table">Section 20.30.19, “The <code class="literal">INFORMATION_SCHEMA INNODB_METRICS</code> Table”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_reset_all"></a>
          <a class="indexterm" name="idp90092208"></a>

          <code class="literal">innodb_monitor_reset_all</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_monitor_reset_all" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_monitor_reset_all=[counter|module|pattern|all]</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_monitor_reset_all</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_monitor_reset_all">innodb_monitor_reset_all</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr></tbody></table>
</div>
<p>
          Resets all values (minimum, maximum, and so on) for one or
          more <a class="link" href="glossary.html#glos_counter" title="counter">counters</a> in the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="information-schema.html#innodb-metrics-table" title="20.30.19. The INFORMATION_SCHEMA INNODB_METRICS Table">Section 20.30.19, “The <code class="literal">INFORMATION_SCHEMA INNODB_METRICS</code> Table”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_pct"></a>
          <a class="indexterm" name="idp90118352"></a>

          <a class="indexterm" name="idp90119440"></a>

          <code class="literal">innodb_old_blocks_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_old_blocks_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_pct=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_old_blocks_pct</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">37</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">5 .. 95</code></td></tr></tbody></table>
</div>
<p>
          Specifies the approximate percentage of the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> used for
          the old block <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a>. The
          range of values is 5 to 95. The default value is 37 (that is,
          3/8 of the pool). Often used in combination with
          <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>. See
          <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a> for information about
          buffer pool management, such as the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_time"></a>
          <a class="indexterm" name="idp90151504"></a>

          <a class="indexterm" name="idp90152592"></a>

          <code class="literal">innodb_old_blocks_time</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_old_blocks_time" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_time=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_old_blocks_time</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 2**32-1</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 2**32-1</code></td></tr></tbody></table>
</div>
<p>
          Non-zero values protect against the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> being
          filled up by data that is referenced only for a brief period,
          such as during a <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full
          table scan</a>. Increasing this value offers more
          protection against full table scans interfering with data
          cached in the buffer pool.
        </p><p>
          Specifies how long in milliseconds (ms) a block inserted into
          the old <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a> must stay
          there after its first access before it can be moved to the new
          sublist. If the value is 0, a block inserted into the old
          sublist moves immediately to the new sublist the first time it
          is accessed, no matter how soon after insertion the access
          occurs. If the value is greater than 0, blocks remain in the
          old sublist until an access occurs at least that many ms after
          the first access. For example, a value of 1000 causes blocks
          to stay in the old sublist for 1 second after the first access
          before they become eligible to move to the new sublist.
        </p><p>
          The default value is 1000 as of MySQL 5.6.6, 0 before that.
        </p><p>
          This variable is often used in combination with
          <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>. See
          <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a> for information about
          buffer pool management, such as the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_online_alter_log_max_size"></a>
          <a class="indexterm" name="idp90196192"></a>

          <code class="literal">innodb_online_alter_log_max_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_online_alter_log_max_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_online_alter_log_max_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_online_alter_log_max_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_online_alter_log_max_size">innodb_online_alter_log_max_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">65536 .. 2**64-1</code></td></tr></tbody></table>
</div>
<p>
          Specifies an upper limit on the size of the temporary log
          files used during <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online
          DDL</a> operations for <code class="literal">InnoDB</code> tables.
          There is one such log file for each index being created or
          table being altered. This log file stores data inserted,
          updated, or deleted in the table during the DDL operation. The
          temporary log file is extended when needed by the value of
          <a class="link" href="storage-engines.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a>, up
          to the maximum specified by
          <code class="literal">innodb_online_alter_log_max_size</code>. If any
          temporary log file exceeds the upper size limit, the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation fails and
          all uncommitted concurrent DML operations are rolled back.
          Thus, a large value for this option allows more DML to happen
          during an online DDL operation, but also causes a longer
          period at the end of the DDL operation when the table is
          locked to apply the data from the log.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_open_files"></a>
          <a class="indexterm" name="idp90229264"></a>

          <a class="indexterm" name="idp90230352"></a>

          <code class="literal">innodb_open_files</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_open_files" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_open_files=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_open_files</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_open_files">innodb_open_files</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">300</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">10 .. 4294967295</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">-1 (autosized)</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">10 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          This variable is relevant only if you use multiple
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>. It
          specifies the maximum number of
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code>
          files</a> that MySQL can keep open at one time. The minimum
          value is 10. As of MySQL 5.6.6, the default value is 300 if
          <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is not
          enabled, and the higher of 300 and
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> otherwise.
          Before 5.6.6, the default value is 300.
        </p><p>
          The file descriptors used for <code class="filename">.ibd</code> files
          are for <code class="literal">InnoDB</code> tables only. They are
          independent of those specified by the
          <a class="link" href="server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a> server
          option, and do not affect the operation of the table cache.
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_optimize_fulltext_only"></a>
          <a class="indexterm" name="idp90274080"></a>

          <code class="literal">innodb_optimize_fulltext_only</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_optimize_fulltext_only" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_optimize_fulltext_only=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_optimize_fulltext_only</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_optimize_fulltext_only">innodb_optimize_fulltext_only</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Changes the way the <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> statement operates on
          <code class="literal">InnoDB</code> tables. Intended to be enabled
          temporarily, during maintenance operations for
          <code class="literal">InnoDB</code> tables with
          <code class="literal">FULLTEXT</code> indexes.
        </p><p>
          By default, <code class="literal">OPTIMIZE TABLE</code> reorganizes the
          data in the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered
          index</a> of the table. When this option is enabled,
          <code class="literal">OPTIMIZE TABLE</code> skips this reorganization of
          the table data, and instead processes the newly added,
          deleted, and updated token data for a
          <code class="literal">FULLTEXT</code> index, See
          <a class="xref" href="storage-engines.html#innodb-fulltext-index" title="14.2.3.12.3. FULLTEXT Indexes">Section 14.2.3.12.3, “<code class="literal">FULLTEXT</code> Indexes”</a> for more information
          about <code class="literal">FULLTEXT</code> indexes for
          <code class="literal">InnoDB</code> tables.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_page_size"></a>
          <a class="indexterm" name="idp90308832"></a>

          <code class="literal">innodb_page_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_page_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_page_size=#k</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_page_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_page_size">innodb_page_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="9"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">16384</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">4k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">8k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">16k</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">8192</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">16384</code></td></tr></tbody></table>
</div>
<p>
          Specifies the <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>
          for all <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a> in a MySQL
          <a class="link" href="glossary.html#glos_instance" title="instance">instance</a>. This value is
          set when the instance is created and remains constant
          afterwards. You can specify page size using the values
          <code class="literal">16k</code> (the default), <code class="literal">8k</code>,
          or <code class="literal">4k</code>.
        </p><p>
          The default, with the largest page size, is appropriate for a
          wide range of <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>,
          particularly for queries involving table scans and DML
          operations involving bulk updates. Smaller page sizes might be
          more efficient for <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a>
          workloads involving many small writes, where contention can be
          an issue when a single page contains many rows. Smaller pages
          might also be efficient with
          <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage devices, which
          typically use small block sizes. Keeping the
          <code class="literal">InnoDB</code> page size close to the storage
          device block size minimizes the amount of unchanged data that
          is rewritten to disk. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_print_all_deadlocks"></a>
          <a class="indexterm" name="idp90354176"></a>

          <a class="indexterm" name="idp90355280"></a>

          <code class="literal">innodb_print_all_deadlocks</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_print_all_deadlocks" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_print_all_deadlocks=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_print_all_deadlocks</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idp90380464"></a><p>
          When this option is enabled, information about all
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> in
          <code class="literal">InnoDB</code> user transactions is recorded in the
          <code class="literal">mysqld</code> <a class="link" href="server-administration.html#error-log" title="5.2.2. The Error Log">error
          log</a>. Otherwise, you see information about only the last
          deadlock, using the <code class="literal">SHOW ENGINE INNODB
          STATUS</code> command. An occasional
          <code class="literal">InnoDB</code> deadlock is not necessarily an
          issue, because <code class="literal">InnoDB</code> detects the condition
          immediately, and rolls back one of the transactions
          automatically. You might use this option to troubleshoot why
          deadlocks are happening if an application does not have
          appropriate error-handling logic to detect the rollback and
          retry its operation. A large number of deadlocks might
          indicate the need to restructure transactions that issue
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> or <code class="literal">SELECT ... FOR
          UPDATE</code> statements for multiple tables, so that each
          transaction accesses the tables in the same order, thus
          avoiding the deadlock condition.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_batch_size"></a>
          <a class="indexterm" name="idp90390112"></a>

          <a class="indexterm" name="idp90391200"></a>

          <code class="literal">innodb_purge_batch_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_purge_batch_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_batch_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_purge_batch_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.3)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">300</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 5000</code></td></tr></tbody></table>
</div>
<p>
          The granularity of changes, expressed in units of
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> records, that
          trigger a <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation,
          flushing the changed <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a> blocks to disk. This option is intended for tuning
          performance in combination with the setting
          <code class="literal">innodb_purge_threads=<em class="replaceable"><code>n</code></em></code>,
          and typical users do not need to modify it.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_threads"></a>
          <a class="indexterm" name="idp90421424"></a>

          <a class="indexterm" name="idp90422512"></a>

          <code class="literal">innodb_purge_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_purge_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_threads=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_purge_threads</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.2)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 32</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 32</code></td></tr></tbody></table>
</div>
<p>
          The number of background threads devoted to the InnoDB
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation. The new
          default and minimum value of 1 in MySQL 5.6.5 signifies that
          the purge operation is always performed by background threads,
          never as part of the <a class="link" href="glossary.html#glos_master_thread" title="master thread">master
          thread</a>. Non-zero values runs the purge operation in one
          or more background threads, which can reduce internal
          contention within InnoDB, improving scalability. Increasing
          the value to greater than 1 creates that many separate purge
          threads, which can improve efficiency on systems where
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations are performed
          on multiple tables. The maximum is 32.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_random_read_ahead"></a>
          <a class="indexterm" name="idp90460736"></a>

          <code class="literal">innodb_random_read_ahead</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_random_read_ahead" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_random_read_ahead=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_random_read_ahead</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enables the random
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> technique
          for optimizing <code class="literal">InnoDB</code> I/O. This is a
          setting that was originally on by default, then was removed in
          MySQL 5.5, and now is available but turned off by default. See
          <a class="xref" href="storage-engines.html#innodb-performance-read_ahead" title="14.2.4.2.16. Changes in the Read-Ahead Algorithm">Section 14.2.4.2.16, “Changes in the Read-Ahead Algorithm”</a> for details
          about the performance considerations for the different types
          of read-ahead requests. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_ahead_threshold"></a>
          <a class="indexterm" name="idp90489776"></a>

          <a class="indexterm" name="idp90490880"></a>

          <code class="literal">innodb_read_ahead_threshold</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_ahead_threshold" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_ahead_threshold=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_read_ahead_threshold</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">56</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 64</code></td></tr></tbody></table>
</div>
<p>
          Controls the sensitivity of linear
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> that
          <code class="literal">InnoDB</code> uses to prefetch pages into the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. If
          <code class="literal">InnoDB</code> reads at least
          <code class="literal">innodb_read_ahead_threshold</code> pages
          sequentially from an <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>
          (64 pages), it initiates an asynchronous read for the entire
          following extent. The permissible range of values is 0 to 64.
          The default is 56: <code class="literal">InnoDB</code> must read at
          least 56 pages sequentially from an extent to initiate an
          asynchronous read for the following extent. For general I/O
          tuning advice, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_io_threads"></a>
          <a class="indexterm" name="idp90523888"></a>

          <a class="indexterm" name="idp90524976"></a>

          <code class="literal">innodb_read_io_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_io_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_io_threads=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_read_io_threads</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 64</code></td></tr></tbody></table>
</div>
<p>
          The number of I/O threads for read operations in
          <code class="literal">InnoDB</code>. The default value is 4. Its
          counterpart for write threads is
          <a class="link" href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <code class="literal">innodb_read_io_threads</code>,
            <a class="link" href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>,
            and the Linux <code class="literal">aio-max-nr</code> setting can
            exceed system limits. Ideally, increase the
            <code class="literal">aio-max-nr</code> setting; as a workaround, you
            might reduce the settings for one or both of the MySQL
            configuration options.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_read_only"></a>
          <a class="indexterm" name="idp90558272"></a>

          <code class="literal">innodb_read_only</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_only" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.7</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_only=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_read_only</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_read_only">innodb_read_only</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Starts the server in read-only mode. For distributing database
          applications or data sets on read-only media. Can also be used
          in data warehouses to share the same data directory between
          multiple instances. See
          <a class="xref" href="storage-engines.html#innodb-read-only-instance" title="14.2.5.1. Support for Read-Only Media">Section 14.2.5.1, “Support for Read-Only Media”</a> for usage
          instructions.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_replication_delay"></a>
          <a class="indexterm" name="idp90585120"></a>

          <a class="indexterm" name="idp90586224"></a>

          <code class="literal">innodb_replication_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_replication_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_replication_delay=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_replication_delay</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          The replication thread delay (in ms) on a slave server if
          <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
          reached.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_on_timeout"></a>
          <a class="indexterm" name="idp90614080"></a>

          <a class="indexterm" name="idp90615184"></a>

          <code class="literal">innodb_rollback_on_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_rollback_on_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_on_timeout</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_rollback_on_timeout</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          In MySQL 5.6, <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rolls back</a> only the last
          statement on a transaction timeout by default. If
          <a class="link" href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a> is
          specified, a transaction timeout causes
          <code class="literal">InnoDB</code> to abort and roll back the entire
          transaction (the same behavior as in MySQL 4.1).
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_segments"></a>
          <a class="indexterm" name="idp90643056"></a>

          <code class="literal">innodb_rollback_segments</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_rollback_segments" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_segments=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_rollback_segments</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 128</code></td></tr></tbody></table>
</div>
<p>
          Defines how many of the
          <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>
          in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> that InnoDB uses within a
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>. This
          setting, while still valid, is replaced by
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sort_buffer_size"></a>
          <a class="indexterm" name="idp90674512"></a>

          <code class="literal">innodb_sort_buffer_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sort_buffer_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sort_buffer_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_sort_buffer_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_sort_buffer_size">innodb_sort_buffer_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.4)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">524288 .. 67108864</code></td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">65536 .. 67108864</code></td></tr></tbody></table>
</div>
<p>
          Specifies the size of sort buffers used for sorting data
          during creation of an <code class="literal">InnoDB</code> index. The
          size specified defines the amount of data filled in memory for
          an internal sort and written out to disk, which can be
          referred to as a <span class="quote">“<span class="quote">run</span>”</span>. During the merge phase,
          pairs of buffers of the specified size are <span class="quote">“<span class="quote">read
          in</span>”</span> and merged. The larger the setting, the fewer
          <span class="quote">“<span class="quote">runs</span>”</span> and merges there are, which is important
          to understand from a tuning perspective.
        </p><p>
          This sort area is only used for merge sorts during index
          creation, not during later index maintenance operations.
          Buffers are deallocated when index creation completes.
        </p><p>
          The value of this option also controls the amount by which the
          temporary log file is extended, to record concurrent DML
          during <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a>
          operations.
        </p><p>
          Before this setting was made configurable, the size was
          hardcoded to 1048576 bytes (1MB), and that value remains the
          default.
        </p><p>
          During an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
          <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement that
          creates an index, 3 buffers are allocated, each with a size
          defined by this option. Additionally, auxiliary pointers are
          allocated to rows in the sort buffer so that the sort can run
          on pointers (as opposed to moving rows during the sort
          operation).
        </p><p>
          For a typical sort operation, a formula such as this can be
          used to estimate memory consumption:
        </p><pre class="programlisting">(6 /*FTS_NUM_AUX_INDEX*/ *
(3*@@global.innodb_sort_buffer_size) + 2 * (
@@global.innodb_sort_buffer_size/dict_index_get_min_size(index)*/) 
* 8 /*64-bit sizeof *buf-&gt;tuples*/")</pre><p>
          <span class="quote">“<span class="quote"><code class="literal">@@global.innodb_sort_buffer_size/dict_index_get_min_size(index)</code></span>”</span>
          indicates the maximum tuples held. <span class="quote">“<span class="quote"><code class="literal">2 *
          (@@global.innodb_sort_buffer_size/*dict_index_get_min_size(index)*/)
          * 8 /*64-bit size of *buf-&gt;tuples*/</code> indicates
          auxiliary pointers allocated.</span>”</span>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            For 32-bit, multiply by 4 instead of 8.
</p>
</div>
<p>
          For parallel sorts on an index, multiply by the
          <a class="link" href="storage-engines.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
          setting:
        </p><pre class="programlisting">(6 /*FTS_NUM_AUX_INDEX*/ @@global.innodb_ft_sort_pll_degree)</pre></li><li class="listitem"><p><a name="sysvar_innodb_spin_wait_delay"></a>
          <a class="indexterm" name="idp90725936"></a>

          <a class="indexterm" name="idp90727024"></a>

          <code class="literal">innodb_spin_wait_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_spin_wait_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_spin_wait_delay=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_spin_wait_delay</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          The maximum delay between polls for a
          <a class="link" href="glossary.html#glos_spin" title="spin">spin</a> lock. The low-level
          implementation of this mechanism varies depending on the
          combination of hardware and operating system, so the delay
          does not correspond to a fixed time interval. The default
          value is 6.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_auto_recalc"></a>
          <a class="indexterm" name="idp90754864"></a>

          <code class="literal">innodb_stats_auto_recalc</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_auto_recalc" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_auto_recalc=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_auto_recalc</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_stats_auto_recalc">innodb_stats_auto_recalc</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Causes <code class="literal">InnoDB</code> to automatically recalculate
          <a class="link" href="glossary.html#glos_persistent_statistics" title="persistent statistics">persistent
          statistics</a> after the data in a table is changed
          substantially. The threshold value is currently 10% of the
          rows in the table. This setting applies to tables created when
          the <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          option is enabled, or where the clause
          <code class="literal">STATS_PERSISTENT=1</code> is enabled by a
          <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. The
          amount of data sampled to produce the statistics is controlled
          by the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          configuration option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_method"></a>
          <a class="indexterm" name="idp90787008"></a>

          <a class="indexterm" name="idp90788096"></a>

          <code class="literal">innodb_stats_method</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_method" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_method=name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_method</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_stats_method">innodb_stats_method</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="6"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">nulls_equal</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">nulls_equal</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">nulls_unequal</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">nulls_ignored</code></td></tr></tbody></table>
</div>
<p>
          How the server treats <code class="literal">NULL</code> values when
          collecting <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>
          about the distribution of index values for
          <code class="literal">InnoDB</code> tables. This variable has three
          possible values, <code class="literal">nulls_equal</code>,
          <code class="literal">nulls_unequal</code>, and
          <code class="literal">nulls_ignored</code>. For
          <code class="literal">nulls_equal</code>, all <code class="literal">NULL</code>
          index values are considered equal and form a single value
          group that has a size equal to the number of
          <code class="literal">NULL</code> values. For
          <code class="literal">nulls_unequal</code>, <code class="literal">NULL</code>
          values are considered unequal, and each
          <code class="literal">NULL</code> forms a distinct value group of size
          1. For <code class="literal">nulls_ignored</code>,
          <code class="literal">NULL</code> values are ignored.
        </p><p>
          The method that is used for generating table statistics
          influences how the optimizer chooses indexes for query
          execution, as described in
          <a class="xref" href="optimization.html#myisam-index-statistics" title="8.3.7. InnoDB and MyISAM Index Statistics Collection">Section 8.3.7, “<code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> Index Statistics
        Collection”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_on_metadata"></a>
          <a class="indexterm" name="idp90831648"></a>

          <a class="indexterm" name="idp90832752"></a>

          <code class="literal">innodb_stats_on_metadata</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_on_metadata" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_on_metadata</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_on_metadata</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.6.5)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.6.6)</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          When this variable is enabled, <code class="literal">InnoDB</code>
          updates <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>
          during metadata statements such as <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW
          TABLE STATUS</code></a> or <a class="link" href="sql-syntax.html#show-index" title="13.7.5.23. SHOW INDEX Syntax"><code class="literal">SHOW
          INDEX</code></a>, or when accessing the
          <code class="literal">INFORMATION_SCHEMA</code> tables
          <a class="link" href="information-schema.html#tables-table" title="20.23. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a> or
          <a class="link" href="information-schema.html#statistics-table" title="20.22. The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">STATISTICS</code></a>. (These updates are
          similar to what happens for <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>.) When disabled, <code class="literal">InnoDB</code>
          does not update statistics during these operations. Leaving
          this setting disabled can improve access speed for schemas
          that have a large number of tables or indexes. It can also
          improve the stability of
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">execution
          plans</a> for queries that involve
          <code class="literal">InnoDB</code> tables.
        </p><p>
          This variable is disabled by default as of MySQL 5.6.6,
          enabled before that.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_persistent"></a>
          <a class="indexterm" name="idp90873312"></a>

          <a class="indexterm" name="idp90874400"></a>

          <code class="literal">innodb_stats_persistent</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_persistent" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_persistent=setting</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_persistent</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent">innodb_stats_persistent</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="8"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="5" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">default</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether the <code class="literal">InnoDB</code> index
          statistics produced by the <code class="literal">ANALYZE TABLE</code>
          command are stored on disk, remaining consistent until a
          subsequent <code class="literal">ANALYZE TABLE</code>. Otherwise, the
          statistics are recalculated more frequently, such as at each
          server restart, which can lead to variations in
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query execution
          plans</a>. This setting is stored with each table when the
          table is created. You can specify or change it through SQL
          with the <code class="literal">STATS_PERSISTENT</code> clause of the
          <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> commands.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_persistent_sample_pages"></a>
          <a class="indexterm" name="idp90914896"></a>

          <code class="literal">innodb_stats_persistent_sample_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_persistent_sample_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_persistent_sample_pages=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_persistent_sample_pages</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent_sample_pages">innodb_stats_persistent_sample_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">20</code></td></tr></tbody></table>
</div>
<p>
          The number of index <a class="link" href="glossary.html#glos_page" title="page">pages</a> to
          sample when estimating
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> and other
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> for an
          indexed column, such as those calculated by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. Increasing the
          value improves the accuracy of index statistics, which can
          improve the <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query
          execution plan</a>, at the expense of increased I/O during
          the execution of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          for an <code class="literal">InnoDB</code> table.
        </p><p>
          This option only applies when the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          setting is turned on for a table; when that option is turned
          off for a table, the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
          setting applies instead.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_sample_pages"></a>
          <a class="indexterm" name="idp90948960"></a>

          <a class="indexterm" name="idp90950064"></a>

          <code class="literal">innodb_stats_sample_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_sample_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_sample_pages=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_sample_pages</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_stats_sample_pages">innodb_stats_sample_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 2**64-1</code></td></tr></tbody></table>
</div>
<p>
          Deprecated, use
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
          instead.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_transient_sample_pages"></a>
          <a class="indexterm" name="idp90979744"></a>

          <code class="literal">innodb_stats_transient_sample_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_transient_sample_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.2</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_transient_sample_pages=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_transient_sample_pages</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages">innodb_stats_transient_sample_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr></tbody></table>
</div>
<p>
          The number of index <a class="link" href="glossary.html#glos_page" title="page">pages</a> to
          sample when estimating
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> and other
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> for an
          indexed column, such as those calculated by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. The default
          value is 8. Increasing the value improves the accuracy of
          index statistics, which can improve the
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query execution
          plan</a>, at the expense of increased I/O when opening an
          <code class="literal">InnoDB</code> table or recalculating statistics.
        </p><p>
          This option only applies when the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          setting is turned off for a table; when this option is turned
          on for a table, the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          setting applies instead. Takes the place of the
          <code class="literal">innodb_stats_sample_pages</code> option. For more
          information, see <a class="xref" href="storage-engines.html#innodb-other-changes" title="14.2.5. InnoDB Features for Flexibility, Ease of Use and Reliability">Section 14.2.5, “<code class="literal">InnoDB</code> Features for Flexibility, Ease of Use and
    Reliability”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_strict_mode"></a>
          <a class="indexterm" name="idp91014352"></a>

          <a class="indexterm" name="idp91015440"></a>

          <code class="literal">innodb_strict_mode</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_strict_mode" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_strict_mode=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_strict_mode</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Whether <code class="literal">InnoDB</code> returns errors rather than
          warnings for certain conditions. This is analogous to strict
          SQL mode. The default value is <code class="literal">OFF</code>. See
          <a class="xref" href="storage-engines.html#innodb-other-changes-strict-mode" title="14.2.5.7. InnoDB Strict Mode">Section 14.2.5.7, “<code class="literal">InnoDB</code> Strict Mode”</a> for a list
          of the conditions that are affected.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_support_xa"></a>
          <a class="indexterm" name="idp91042176"></a>

          <a class="indexterm" name="idp91043264"></a>

          <a class="indexterm" name="idp91044752"></a>

          <code class="literal">innodb_support_xa</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_support_xa" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_support_xa</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_support_xa</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_support_xa">innodb_support_xa</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table>
</div>
<p>
          Enables <code class="literal">InnoDB</code> support for two-phase commit
          in <a class="link" href="glossary.html#glos_xa" title="XA">XA</a> transactions, causing an
          extra disk flush for transaction preparation. This setting is
          the default. The XA mechanism is used internally and is
          essential for any server that has its binary log turned on and
          is accepting changes to its data from more than one thread. If
          you turn it off, transactions can be written to the binary log
          in a different order from the one in which the live database
          is committing them. This can produce different data when the
          binary log is replayed in disaster recovery or on a
          replication slave. Do not turn it off on a replication master
          server unless you have an unusual setup where only one thread
          is able to change data.
        </p><p>
          For a server that is accepting data changes from only one
          thread, it is safe and recommended to turn off this option to
          improve performance for <code class="literal">InnoDB</code> tables. For
          example, you can turn it off on replication slaves where only
          the replication SQL thread is changing data.
        </p><p>
          You can also turn off this option if you do not need it for
          safe binary logging or replication, and you also do not use an
          external XA transaction manager.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_array_size"></a>
          <a class="indexterm" name="idp91073152"></a>

          <code class="literal">innodb_sync_array_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sync_array_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sync_array_size=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_sync_array_size</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_sync_array_size">innodb_sync_array_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1024</code></td></tr></tbody></table>
</div>
<p>
          Splits an internal data structure used to coordinate threads,
          for higher concurrency in workloads with large numbers of
          waiting threads. This setting must be configured when the
          MySQL instance is starting up, and cannot be changed
          afterward. Increasing this option value is recommended for
          workloads that frequently produce a large number of waiting
          threads, typically greater than 768.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_spin_loops"></a>
          <a class="indexterm" name="idp91101872"></a>

          <a class="indexterm" name="idp91102960"></a>

          <code class="literal">innodb_sync_spin_loops</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sync_spin_loops" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sync_spin_loops=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_sync_spin_loops</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">30</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table>
</div>
<p>
          The number of times a thread waits for an
          <code class="literal">InnoDB</code> mutex to be freed before the thread
          is suspended. The default value is 30.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_table_locks"></a>
          <a class="indexterm" name="idp91130640"></a>

          <a class="indexterm" name="idp91131728"></a>

          <code class="literal">innodb_table_locks</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_table_locks" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_table_locks</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_table_locks</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_table_locks">innodb_table_locks</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table>
</div>
<p>
          If <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>,
          <code class="literal">InnoDB</code> honors <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a>; MySQL does not return from <code class="literal">LOCK
          TABLES ... WRITE</code> until all other threads have
          released all their locks to the table. The default value of
          <a class="link" href="storage-engines.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks</code></a> is 1,
          which means that <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          causes InnoDB to lock a table internally if
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>.
        </p><p>
          In MySQL 5.6,
          <a class="link" href="storage-engines.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks = 0</code></a> has no
          effect for tables locked explicitly with
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It does have an effect for tables locked for
          read or write by
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_concurrency"></a>
          <a class="indexterm" name="idp91166272"></a>

          <a class="indexterm" name="idp91167376"></a>

          <a class="indexterm" name="idp91168880"></a>

          <code class="literal">innodb_thread_concurrency</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_thread_concurrency" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_concurrency=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_thread_concurrency</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 1000</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to keep the number of
          operating system threads concurrently inside
          <code class="literal">InnoDB</code> less than or equal to the limit
          given by this variable. Once the number of threads reaches
          this limit, additional threads are placed into a wait state
          within a FIFO queue for execution. Threads waiting for locks
          are not counted in the number of concurrently executing
          threads.
        </p><p>
          The correct value for this variable is dependent on
          environment and workload. Try a range of different values to
          determine what value works for your applications. A
          recommended value is 2 times the number of CPUs plus the
          number of disks.
        </p><p>
          The range of this variable is 0 to 1000. A value of 0 (the
          default) is interpreted as infinite concurrency (no
          concurrency checking). Disabling thread concurrency checking
          enables InnoDB to create as many threads as it needs. A value
          of 0 also disables the <code class="literal">queries inside
          InnoDB</code> and <code class="literal">queries in queue
          counters</code> in the <code class="literal">ROW OPERATIONS</code>
          section of <code class="literal">SHOW ENGINE INNODB STATUS</code>
          output.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_sleep_delay"></a>
          <a class="indexterm" name="idp91201920"></a>

          <a class="indexterm" name="idp91203024"></a>

          <code class="literal">innodb_thread_sleep_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_thread_sleep_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_sleep_delay=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_thread_sleep_delay</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr></tbody></table>
</div>
<p>
          How long <code class="literal">InnoDB</code> threads sleep before
          joining the <code class="literal">InnoDB</code> queue, in microseconds.
          The default value is 10,000. A value of 0 disables sleep. In
          MySQL 5.6.3 and higher, you can set the configuration option
          <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
          to the highest value you would allow for
          <code class="literal">innodb_thread_sleep_delay</code>, and InnoDB
          automatically adjusts
          <code class="literal">innodb_thread_sleep_delay</code> up or down
          depending on the current thread-scheduling activity. This
          dynamic adjustment helps the thread scheduling mechanism to
          work smoothly during times when the system is lightly loaded
          and when it is operating near full capacity.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_directory"></a>
          <a class="indexterm" name="idp91232048"></a>

          <code class="literal">innodb_undo_directory</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_undo_directory" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_undo_directory=name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_undo_directory</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_undo_directory">innodb_undo_directory</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">.</code></td></tr></tbody></table>
</div>
<p>
          The relative or absolute directory path where
          <code class="literal">InnoDB</code> creates separate tablespaces for the
          undo logs. Typically used to place those logs on a different
          storage device. Used in conjunction with
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> and
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>,
          which determine the disk layout of the undo logs outside the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>. Its default value of <code class="filename">.</code>
          represents the same directory where <code class="literal">InnoDB</code>
          creates its other log files by default.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_logs"></a>
          <a class="indexterm" name="idp91262992"></a>

          <code class="literal">innodb_undo_logs</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_undo_logs" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_undo_logs=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_undo_logs</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_undo_logs">innodb_undo_logs</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 128</code></td></tr></tbody></table>
</div>
<p>
          Defines how many of the
          <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>
          in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> that <code class="literal">InnoDB</code> uses within a
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>. This
          setting is appropriate for tuning performance if you observe
          mutex contention related to the undo logs. Replaces the
          <code class="literal">innodb_rollback_segments</code> setting. For the
          total number of available undo logs, rather than the number of
          active ones, see the
          <a class="link" href="server-administration.html#statvar_Innodb_available_undo_logs"><code class="literal">Innodb_available_undo_logs</code></a>
          status variable.
        </p><p>
          Although you can increase or decrease how many rollback
          segments are used within a transaction, the number of rollback
          segments physically present in the system never decreases.
          Thus you might start with a low value for this parameter and
          gradually increase it, to avoid allocating rollback segments
          that are not needed later. If
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> is not set,
          it defaults to the maximum value of 128. For information about
          managing rollback segments, see
          <a class="xref" href="storage-engines.html#innodb-multi-versioning" title="14.2.3.11. InnoDB Multi-Versioning">Section 14.2.3.11, “<code class="literal">InnoDB</code> Multi-Versioning”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_tablespaces"></a>
          <a class="indexterm" name="idp91298400"></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_undo_tablespaces" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_undo_tablespaces=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_undo_tablespaces</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces">innodb_undo_tablespaces</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 126</code></td></tr></tbody></table>
</div>
<p>
          The number of
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a> files that
          the <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> are divided
          between, when you use a non-zero
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> setting. By
          default, all the undo logs are part of the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> and the system tablespace will always
          contain one undo tablespace in addition to those configured by
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>.
          Because the undo logs can become large during long-running
          transactions, splitting the undo logs between multiple
          tablespaces reduces the maximum size of any one tablespace.
          The tablespace files are created in the location defined by
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>, with
          names of the form
          <code class="filename">undo<em class="replaceable"><code>N</code></em></code>, where
          <em class="replaceable"><code>N</code></em> is a sequential series of
          integers, including leading zeros. The default size of undo
          tablespaces files is 10M. The number of
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> must
          be set prior to initializing <code class="literal">InnoDB</code>.
          Attempting to restart <code class="literal">InnoDB</code> after changing
          the number of
          <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> will
          result in a failed start with an error stating that InnoDB did
          not find the expected number of undo tablespaces.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_use_native_aio"></a>
          <a class="indexterm" name="idp91336208"></a>

          <a class="indexterm" name="idp91337296"></a>

          <code class="literal">innodb_use_native_aio</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_use_native_aio" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_native_aio=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_use_native_aio</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether to use the Linux asynchronous I/O subsystem.
          This variable applies to Linux systems only, and cannot be
          changed while the server is running.
        </p><p>
          Normally, you do not need to touch this option, because it is
          enabled by default. If a problem with the asynchronous I/O
          subsystem in the OS prevents <code class="literal">InnoDB</code> from
          starting, start the server with this variable disabled (use
          <a class="link" href="storage-engines.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a> in
          the option file). This option could also be turned off
          automatically during startup, if <code class="literal">InnoDB</code>
          detects a potential problem such as a combination of
          <code class="literal">tmpdir</code> location, <code class="literal">tmpfs</code>
          filesystem, and Linux kernel that that does not support AIO on
          <code class="literal">tmpfs</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_use_sys_malloc"></a>
          <a class="indexterm" name="idp91367392"></a>

          <a class="indexterm" name="idp91368480"></a>

          <code class="literal">innodb_use_sys_malloc</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_use_sys_malloc" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_sys_malloc=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_use_sys_malloc</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_use_sys_malloc">innodb_use_sys_malloc</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Whether <code class="literal">InnoDB</code> uses the operating system
          memory allocator (<code class="literal">ON</code>) or its own
          (<code class="literal">OFF</code>). The default value is
          <code class="literal">ON</code>.
        </p><p>
          As of MySQL 5.6.3,
          <a class="link" href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
          deprecated and will be removed in a future MySQL release.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_version"></a>
          <a class="indexterm" name="idp91399120"></a>

          <a class="indexterm" name="idp91400208"></a>

          <code class="literal">innodb_version</code>
        </p><p>
          The <code class="literal">InnoDB</code> version number. Starting in
          5.6.11, the separate numbering for <code class="literal">InnoDB</code>
          is discontinued and this value is the same as for the
          <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> variable.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_write_io_threads"></a>
          <a class="indexterm" name="idp91406272"></a>

          <a class="indexterm" name="idp91407360"></a>

          <code class="literal">innodb_write_io_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_write_io_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_write_io_threads=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_write_io_threads</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="storage-engines.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td scope="row" rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 64</code></td></tr></tbody></table>
</div>
<p>
          The number of I/O threads for write operations in
          <code class="literal">InnoDB</code>. The default value is 4. Its
          counterpart for read threads is
          <a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>,
            <code class="literal">innodb_write_io_threads</code>, and the Linux
            <code class="literal">aio-max-nr</code> setting can exceed system
            limits. Ideally, increase the <code class="literal">aio-max-nr</code>
            setting; as a workaround, you might reduce the settings for
            one or both of the MySQL configuration options.
</p>
</div>
</li><li class="listitem"><p>
          <code class="literal">sync_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for sync_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--sync-binlog=#</code></td></tr><tr><td scope="row"><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">sync_binlog</code></td></tr><tr><td scope="row"><span class="bold"><strong>System Variable Name</strong></span></td><td colspan="3"><code class="literal"><a class="link" href="replication.html#sysvar_sync_binlog">sync_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr><tr><td scope="row" rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values</strong></span></td></tr><tr><td scope="row"><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 18446744073709547520</code></td></tr></tbody></table>
</div>
<p>
          If the value of this variable is greater than 0, the MySQL
          server synchronizes its binary log to disk (using
          <code class="literal">fdatasync()</code>) after every
          <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a> writes to the
          binary log. There is one write to the binary log per statement
          if autocommit is enabled, and one write per transaction
          otherwise. The default value of
          <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a> is 0, which does
          no synchronizing to disk. A value of 1 is the safest choice,
          because in the event of a crash you lose at most one statement
          or transaction from the binary log. However, it is also the
          slowest choice (unless the disk has a battery-backed cache,
          which makes synchronization very fast). For general I/O tuning
          advice, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-parameter-changes"></a>14.2.6.1. List of Parameters Recently Changed in <code class="literal">InnoDB</code></h4>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-parameters-new"></a>14.2.6.1.1. New Parameters</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp91484992"></a><p>
      Throughout the course of development, InnoDB 1.1 and its
      predecessor the InnoDB Plugin introduced new configuration
      parameters.
    </p><p>
      The following <code class="literal">InnoDB</code>-related configuration
      parameters were added between MySQL 5.5 and 5.6:
    </p><p>
      <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_dump_now"><code class="literal">innodb_buffer_pool_dump_now</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_filename"><code class="literal">innodb_buffer_pool_filename</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_abort"><code class="literal">innodb_buffer_pool_load_abort</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_disable_sort_file_cache"><code class="literal">innodb_disable_sort_file_cache</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_force_load_corrupted"><code class="literal">innodb_force_load_corrupted</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_diag_print"><code class="literal">innodb_ft_enable_diag_print</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_enable_stopword"><code class="literal">innodb_ft_enable_stopword</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_max_token_size"><code class="literal">innodb_ft_max_token_size</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_min_token_size"><code class="literal">innodb_ft_min_token_size</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_num_word_optimize"><code class="literal">innodb_ft_num_word_optimize</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_lru_scan_depth"><code class="literal">innodb_lru_scan_depth</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_monitor_disable"><code class="literal">innodb_monitor_disable</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_monitor_reset"><code class="literal">innodb_monitor_reset</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_monitor_reset_all"><code class="literal">innodb_monitor_reset_all</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_sync_array_size"><code class="literal">innodb_sync_array_size</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a>,
      <a class="link" href="storage-engines.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-parameters-new-defaults"></a>14.2.6.1.2. Parameters with New Defaults</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp91525744"></a><a class="indexterm" name="idp91526832"></a><a class="indexterm" name="idp91528352"></a><a class="indexterm" name="idp91529856"></a><a class="indexterm" name="idp91531360"></a><a class="indexterm" name="idp91532880"></a><a class="indexterm" name="idp91534384"></a><a class="indexterm" name="idp91535904"></a><a class="indexterm" name="idp91537408"></a><p>
      For better out-of-the-box performance, the following InnoDB
      configuration parameters have new default values since MySQL 5.1:
</p>
<div class="table">
<a name="innodb-parameters-new-defaults-table"></a><p class="title"><b>Table 14.6. InnoDB Parameters with New Defaults</b></p>
<div class="table-contents">
<table summary="InnoDB Parameters with New Defaults" border="1"><colgroup><col align="left"><col align="right"><col align="right"></colgroup><thead><tr><th scope="col" align="left">Name</th><th scope="col" align="right">Old Default</th><th scope="col" align="right">New Default</th></tr></thead><tbody><tr><td scope="row" align="left"><code class="literal">innodb_additional_mem_pool_size</code></td><td align="right"><code class="literal">1MB</code></td><td align="right"><code class="literal">8MB</code></td></tr><tr><td scope="row" align="left"><code class="literal">innodb_buffer_pool_size</code></td><td align="right"><code class="literal">8MB</code></td><td align="right"><code class="literal">128MB</code></td></tr><tr><td scope="row" align="left"><code class="literal">innodb_change_buffering</code></td><td align="right"><code class="literal">inserts</code></td><td align="right"><code class="literal">all</code></td></tr><tr><td scope="row" align="left"><code class="literal">innodb_file_format_check</code></td><td align="right"><code class="literal">ON</code></td><td align="right"><code class="literal">1</code></td></tr><tr><td scope="row" align="left"><code class="literal">innodb_log_buffer_size</code></td><td align="right"><code class="literal">1MB</code></td><td align="right"><code class="literal">8MB</code></td></tr><tr><td scope="row" align="left"><code class="literal">innodb_max_dirty_pages_pct</code></td><td align="right"><code class="literal">90</code></td><td align="right"><code class="literal">75</code></td></tr><tr><td scope="row" align="left"><code class="literal">innodb_sync_spin_loops</code></td><td align="right"><code class="literal">20</code></td><td align="right"><code class="literal">30</code></td></tr><tr><td scope="row" align="left"><code class="literal">innodb_thread_concurrency</code></td><td align="right"><code class="literal">8</code></td><td align="right"><code class="literal">0</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-restrictions"></a>14.2.7. Limits on <code class="literal">InnoDB</code> Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp91573232"></a><a class="indexterm" name="idp91574720"></a><a class="indexterm" name="idp91576208"></a>
<div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p xmlns="">
        Do <span class="emphasis"><em>not</em></span> convert MySQL system tables in the
        <code class="literal">mysql</code> database from <code class="literal">MyISAM</code>
        to <code class="literal">InnoDB</code> tables! This is an unsupported
        operation. If you do this, MySQL does not restart until you
        restore the old system tables from a backup or re-generate them
        with the <a class="link" href="programs.html#mysql-install-db" title="4.4.3. mysql_install_db — Initialize MySQL Data Directory"><span class="command"><strong>mysql_install_db</strong></span></a> script.
</p>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p xmlns="">
        <a class="indexterm" name="idp91583568"></a>

        <a class="indexterm" name="idp91585024"></a>

        It is not a good idea to configure <code class="literal">InnoDB</code> to
        use data files or log files on NFS volumes. Otherwise, the files
        might be locked by other processes and become unavailable for
        use by MySQL.
</p>
</div>
<h4><a name="idp91587680"></a>
      Maximums and Minimums
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A table can contain a maximum of 1017 columns (raised in MySQL
          5.6.9 from the earlier limit of 1000).
        </p></li><li class="listitem"><p>
          A table can contain a maximum of 64
          <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
        </p></li><li class="listitem"><p>
          By default, an index key for a single-column index can be up
          to 767 bytes. The same length limit applies to any index key
          prefix. See <a class="xref" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax">Section 13.1.13, “<code class="literal">CREATE INDEX</code> Syntax”</a>. For example, you
          might hit this limit with a
          <a class="link" href="glossary.html#glos_column_prefix" title="column prefix">column prefix</a> index
          of more than 255 characters on a <code class="literal">TEXT</code> or
          <code class="literal">VARCHAR</code> column, assuming a UTF-8 character
          set and the maximum of 3 bytes for each character. When the
          <a class="link" href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>
          configuration option is enabled, this length limit is raised
          to 3072 bytes, for <code class="literal">InnoDB</code> tables that use
          the
          <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
          row formats.
        </p><p>
          When you attempt to specify an index prefix length longer than
          allowed, the length is silently reduced to the maximum length
          for a nonunique index. For a unique index, exceeding the index
          prefix limit produces an error. To avoid such errors for
          replication configurations, avoid setting the
          <a class="link" href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> option on
          the master if it cannot also be set on the slaves, and the
          slaves have unique indexes that could be affected by this
          limit.
        </p><p>
          This configuration option changes the error handling for some
          combinations of row format and prefix length longer than the
          maximum allowed. See
          <a class="link" href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> for
          details.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> internal maximum key length is
          3500 bytes, but MySQL itself restricts this to 3072 bytes.
          This limit applies to the length of the combined index key in
          a multi-column index.
        </p></li><li class="listitem"><p>
          If you reduce the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> to 8KB or 4KB
          by specifying the
          <a class="link" href="storage-engines.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option when
          creating the MySQL instance, the maximum length of the index
          key is lowered proportionally, based on the limit of 3072
          bytes for a 16KB page size. That is, the maximum index key
          length is 1536 bytes when the page size is 8KB, and 768 bytes
          when the page size is 4KB.
        </p></li><li class="listitem"><p>
          The maximum row length, except for variable-length columns
          (<a class="link" href="data-types.html#binary-varbinary" title="11.4.2. The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than
          half of a database page. That is, the maximum row length is
          about 8000 bytes for the default page size of 16KB; if you
          reduce the page size by specifying the
          <a class="link" href="storage-engines.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option when
          creating the MySQL instance, the maximum row length is 4000
          bytes for 8KB pages and 2000 bytes for 4KB pages.
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">LONGBLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">LONGTEXT</code></a>
          columns must be less than 4GB, and the total row length,
          including <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
          4GB.
        </p><p>
          If a row is less than half a page long, all of it is stored
          locally within the page. If it exceeds half a page,
          variable-length columns are chosen for external off-page
          storage until the row fits within half a page, as described in
          <a class="xref" href="server-administration.html#innodb-file-space" title="5.3.2. File Space Management">Section 5.3.2, “File Space Management”</a>.
        </p></li><li class="listitem"><p>
          Although <code class="literal">InnoDB</code> supports row sizes larger
          than 65,535 bytes internally, MySQL itself imposes a row-size
          limit of 65,535 for the combined size of all columns:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (a VARCHAR(8000), b VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>c VARCHAR(10000), d VARCHAR(10000), e VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>f VARCHAR(10000), g VARCHAR(10000)) ENGINE=InnoDB;</code></strong>
ERROR 1118 (42000): Row size too large. The maximum row size for the
used table type, not counting BLOBs, is 65535. You have to change some
columns to TEXT or BLOBs
</pre><p>
          See <a class="xref" href="restrictions.html#column-count-limit" title="E.10.4. Limits on Table Column Count and Row Size">Section E.10.4, “Limits on Table Column Count and Row Size”</a>.
        </p></li><li class="listitem"><p>
          On some older operating systems, files must be less than 2GB.
          This is not a limitation of <code class="literal">InnoDB</code> itself,
          but if you require a large tablespace, you will need to
          configure it using several smaller data files rather than one
          or a file large data files.
        </p></li><li class="listitem"><p>
          The combined size of the <code class="literal">InnoDB</code> log files
          can be up to 512GB.
        </p></li><li class="listitem"><p>
          The minimum tablespace size is slightly larger than 10MB. The
          maximum tablespace size is four billion database pages (64TB).
          This is also the maximum size for a table.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idp91629520"></a>

          <a class="indexterm" name="idp91631008"></a>

          The default database page size in <code class="literal">InnoDB</code> is
          16KB, or you can lower the page size to 8KB or 4KB by
          specifying the
          <a class="link" href="storage-engines.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option when
          creating the MySQL instance.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            Increasing the page size is not a supported operation: there
            is no guarantee that <code class="literal">InnoDB</code> will function
            normally with a page size greater than 16KB. Problems
            compiling or running InnoDB may occur. In particular,
            <code class="literal">ROW_FORMAT=COMPRESSED</code> in the Barracuda
            file format assumes that the page size is at most 16KB and
            uses 14-bit pointers.
          </p><p xmlns="">
            A MySQL instance using a particular
            <code class="literal">InnoDB</code> page size cannot use data files or
            log files from an instance that uses a different page size.
            This limitation could affect restore or downgrade operations
            using data from MySQL 5.6, which does support page sizes
            other than 16KB.
</p>
</div>
</li></ul>
</div>
<h4><a name="idp91638688"></a>
      Index Types
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code> tables support
          <code class="literal">FULLTEXT</code> indexes, starting in MySQL 5.6.4.
          See <a class="xref" href="storage-engines.html#innodb-fulltext-index" title="14.2.3.12.3. FULLTEXT Indexes">Section 14.2.3.12.3, “<code class="literal">FULLTEXT</code> Indexes”</a> for details.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> tables support spatial data types,
          but not indexes on them.
</p></li></ul>
</div>
<h4><a name="idp91644688"></a>
      Restrictions on InnoDB Tables
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> determines index
          cardinality (as displayed in the
          <code class="literal">Cardinality</code> column of
          <a class="link" href="sql-syntax.html#show-index" title="13.7.5.23. SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> output) by doing
          <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a> to each
          of the index trees and updating index cardinality estimates
          accordingly. Because these are only estimates, repeated runs
          of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> could produce
          different numbers. This makes <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> fast on <code class="literal">InnoDB</code> tables but
          not 100% accurate because it does not take all rows into
          account.
        </p><p>
          You can make the
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> collected by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> more precise and
          more stable by turning on the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          configuration option, as explained in
          <a class="xref" href="storage-engines.html#innodb-persistent-stats" title="14.2.4.2.10. Persistent Optimizer Statistics for InnoDB Tables">Section 14.2.4.2.10, “Persistent Optimizer Statistics for InnoDB Tables”</a>. When that setting
          is enabled, it is important to run
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> after major
          changes to indexed column data, because the statistics are not
          recalculated periodically (such as after a server restart) as
          they traditionally have been.
        </p><p>
          You can change the number of random dives by modifying the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          system variable (if the persistent statistics setting is
          turned on), or the
          <a class="link" href="storage-engines.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
          system variable (if the persistent statistics setting is
          turned off). For more information, see
          <a class="xref" href="storage-engines.html#innodb-other-changes" title="14.2.5. InnoDB Features for Flexibility, Ease of Use and Reliability">Section 14.2.5, “<code class="literal">InnoDB</code> Features for Flexibility, Ease of Use and
    Reliability”</a>.
        </p><p>
          MySQL uses index cardinality estimates only in join
          optimization. If some join is not optimized in the right way,
          you can try using <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>. In the few cases that
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> does not produce
          values good enough for your particular tables, you can use
          <code class="literal">FORCE INDEX</code> with your queries to force the
          use of a particular index, or set the
          <a class="link" href="server-administration.html#sysvar_max_seeks_for_key"><code class="literal">max_seeks_for_key</code></a> system
          variable to ensure that MySQL prefers index lookups over table
          scans. See <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>, and
          <a class="xref" href="error-handling.html#optimizer-issues" title="C.5.6. Optimizer-Related Issues">Section C.5.6, “Optimizer-Related Issues”</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> does not give
          accurate statistics on <code class="literal">InnoDB</code> tables,
          except for the physical size reserved by the table. The row
          count is only a rough estimate used in SQL optimization.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> does not keep an internal count of
          rows in a table because concurrent transactions might
          <span class="quote">“<span class="quote">see</span>”</span> different numbers of rows at the same time.
          To process a <code class="literal">SELECT COUNT(*) FROM t</code>
          statement, <code class="literal">InnoDB</code> scans an index of the
          table, which takes some time if the index is not entirely in
          the buffer pool. If your table does not change often, using
          the MySQL query cache is a good solution. To get a fast count,
          you have to use a counter table you create yourself and let
          your application update it according to the inserts and
          deletes it does. If an approximate row count is sufficient,
          <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> can be used.
          See <a class="xref" href="storage-engines.html#innodb-tuning" title="14.2.4.1. InnoDB Performance Tuning Tips">Section 14.2.4.1, “<code class="literal">InnoDB</code> Performance Tuning Tips”</a>.
        </p></li><li class="listitem"><p>
          On Windows, <code class="literal">InnoDB</code> always stores database
          and table names internally in lowercase. To move databases in
          a binary format from Unix to Windows or from Windows to Unix,
          create all databases and tables using lowercase names.
        </p></li><li class="listitem"><p>
          An <code class="literal">AUTO_INCREMENT</code> column
          <em class="replaceable"><code>ai_col</code></em> must be defined as part of
          an index such that it is possible to perform the equivalent of
          an indexed <code class="literal">SELECT
          MAX(<em class="replaceable"><code>ai_col</code></em>)</code> lookup on the
          table to obtain the maximum column value. Typically, this is
          achieved by making the column the first column of some table
          index.
        </p></li><li class="listitem"><p>
          While initializing a previously specified
          <code class="literal">AUTO_INCREMENT</code> column on a table,
          <code class="literal">InnoDB</code> sets an exclusive lock on the end of
          the index associated with the
          <code class="literal">AUTO_INCREMENT</code> column. While accessing the
          auto-increment counter, <code class="literal">InnoDB</code> uses a
          specific <code class="literal">AUTO-INC</code> table lock mode where the
          lock lasts only to the end of the current SQL statement, not
          to the end of the entire transaction. Other clients cannot
          insert into the table while the <code class="literal">AUTO-INC</code>
          table lock is held. See
          <a class="xref" href="server-administration.html#innodb-auto-increment-handling" title="5.4.4. AUTO_INCREMENT Handling in InnoDB">Section 5.4.4, “<code class="literal">AUTO_INCREMENT</code> Handling in <code class="literal">InnoDB</code>”</a>.
        </p></li><li class="listitem"><p>
          When you restart the MySQL server, <code class="literal">InnoDB</code>
          may reuse an old value that was generated for an
          <code class="literal">AUTO_INCREMENT</code> column but never stored
          (that is, a value that was generated during an old transaction
          that was rolled back).
        </p></li><li class="listitem"><p>
          When an <code class="literal">AUTO_INCREMENT</code> integer column runs
          out of values, a subsequent <code class="literal">INSERT</code>
          operation returns a duplicate-key error. This is general MySQL
          behavior, similar to how <code class="literal">MyISAM</code> works.
        </p></li><li class="listitem"><p>
          <code class="literal">DELETE FROM
          <em class="replaceable"><code>tbl_name</code></em></code> does not
          regenerate the table but instead deletes all rows, one by one.
        </p></li><li class="listitem"><p>
          Currently, cascaded foreign key actions do not activate
          triggers.
        </p></li><li class="listitem"><p>
          You cannot create a table with a column name that matches the
          name of an internal InnoDB column (including
          <code class="literal">DB_ROW_ID</code>, <code class="literal">DB_TRX_ID</code>,
          <code class="literal">DB_ROLL_PTR</code>, and
          <code class="literal">DB_MIX_ID</code>). The server reports error 1005
          and refers to error –1 in the error message. This
          restriction applies only to use of the names in uppercase.
</p></li></ul>
</div>
<h4><a name="idp91701296"></a>
      Locking and Transactions
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> acquires two locks
          on each table if <code class="literal">innodb_table_locks=1</code> (the
          default). In addition to a table lock on the MySQL layer, it
          also acquires an <code class="literal">InnoDB</code> table lock.
          Versions of MySQL before 4.1.2 did not acquire
          <code class="literal">InnoDB</code> table locks; the old behavior can be
          selected by setting <code class="literal">innodb_table_locks=0</code>.
          If no <code class="literal">InnoDB</code> table lock is acquired,
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> completes even if
          some records of the tables are being locked by other
          transactions.
        </p><p>
          In MySQL 5.6,
          <a class="link" href="storage-engines.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks=0</code></a> has no
          effect for tables locked explicitly with
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It does have an effect for tables locked for
          read or write by
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li class="listitem"><p>
          All <code class="literal">InnoDB</code> locks held by a transaction are
          released when the transaction is committed or aborted. Thus,
          it does not make much sense to invoke
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> on
          <code class="literal">InnoDB</code> tables in
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> mode because the
          acquired <code class="literal">InnoDB</code> table locks would be
          released immediately.
        </p></li><li class="listitem"><p>
          You cannot lock additional tables in the middle of a
          transaction because <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          performs an implicit <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
          TABLES</code></a>.
        </p></li><li class="listitem"><p>
          The limit of 1023 concurrent data-modifying transactions has
          been raised in MySQL 5.5 and above. The limit is now 128 *
          1023 concurrent transactions that generate undo records. You
          can remove any workarounds that require changing the proper
          structure of your transactions, such as committing more
          frequently.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-acid"></a>14.2.8. MySQL and the ACID Model</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp91724640"></a><p>
      The <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model is a set of
      database design principles that emphasize aspects of reliability
      that are important for business data and mission-critical
      applications. MySQL includes components such as the
      <code class="literal">InnoDB</code> storage engine that adhere closely to
      the ACID model, so that data is not corrupted and results are not
      distorted by exceptional conditions such as software crashes and
      hardware malfunctions. When you rely on ACID-compliant features,
      you do not need to reinvent the wheel of consistency checking and
      crash recovery mechanisms. In cases where you have additional
      software safeguards, ultra-reliable hardware, or an application
      that can tolerate a small amount of data loss or inconsistency,
      you can adjust MySQL settings to trade some of the ACID
      reliability for greater performance or throughput.
    </p><p>
      The following sections discuss how MySQL features, in particular
      the <code class="literal">InnoDB</code> storage engine, interact with the
      categories of the ACID model:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>A</strong></span>: atomicity.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>C</strong></span>: consistency.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>I:</strong></span>: isolation.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>D</strong></span>: durability.
</p></li></ul>
</div>
<h4><a name="idp91735888"></a>
      Atomicity
</h4>
<p>
      The <span class="bold"><strong>atomicity</strong></span> aspect of the ACID
      model mainly involves <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>. Related
      MySQL features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Autocommit setting.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> statement.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
          statement.
        </p></li><li class="listitem"><p>
          Operational data from the
          <code class="literal">INFORMATION_SCHEMA</code> tables.
</p></li></ul>
</div>
<h4><a name="idp91744912"></a>
      Consistency
</h4>
<p>
      The <span class="bold"><strong>consistency</strong></span> aspect of the
      ACID model mainly involves internal <code class="literal">InnoDB</code>
      processing to protect data from crashes. Related MySQL features
      include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
</p></li></ul>
</div>
<h4><a name="idp91752064"></a>
      Isolation
</h4>
<p>
      The <span class="bold"><strong>isolation</strong></span> aspect of the ACID
      model mainly involves <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, in
      particular the <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation
      level</a> that applies to each transaction. Related MySQL
      features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_autocommit" title="autocommit">Autocommit</a> setting.
        </p></li><li class="listitem"><p>
          <code class="literal">SET ISOLATION LEVEL</code> statement.
        </p></li><li class="listitem"><p>
          The low-level details of <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_locking" title="locking">locking</a>. During
          performance tuning, you see these details through
          <code class="literal">INFORMATION_SCHEMA</code> tables.
</p></li></ul>
</div>
<h4><a name="idp91762224"></a>
      Durability
</h4>
<p>
      The <span class="bold"><strong>durability</strong></span> aspect of the ACID
      model involves MySQL software features interacting with your
      particular hardware configuration. Because of the many
      possibilities depending on the capabilities of your CPU, network,
      and storage devices, this aspect is the most complicated to
      provide concrete guidelines for. (And those guidelines might take
      the form of buy <span class="quote">“<span class="quote">new hardware</span>”</span>.) Related MySQL
      features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>, turned on and off by the
          <a class="link" href="storage-engines.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a>
          configuration option.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>.
        </p></li><li class="listitem"><p>
          Write buffer in a storage device, such as a disk drive, SSD,
          or RAID array.
        </p></li><li class="listitem"><p>
          Battery-backed cache in a storage device.
        </p></li><li class="listitem"><p>
          The operating system used to run MySQL, in particular its
          support for the <code class="literal">fsync()</code> system call.
        </p></li><li class="listitem"><p>
          Uninterruptible power supply (UPS) protecting the electrical
          power to all computer servers and storage devices that run
          MySQL servers and store MySQL data.
        </p></li><li class="listitem"><p>
          Your backup strategy, such as frequency and types of backups,
          and backup retention periods.
        </p></li><li class="listitem"><p>
          For distributed or hosted data applications, the particular
          characteristics of the data centers where the hardware for the
          MySQL servers is located, and network connections between the
          data centers.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached"></a>14.2.9. InnoDB Integration with memcached</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#innodb-memcached-benefits">14.2.9.1. Benefits of the InnoDB / memcached Combination</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached-intro">14.2.9.2. Architecture of InnoDB and memcached Integration</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached-setup">14.2.9.3. Getting Started with InnoDB Memcached Plugin</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached-security">14.2.9.4. Security Considerations for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached-developing">14.2.9.5. Writing Applications for the InnoDB memcached Interface</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached-replication">14.2.9.6. Using the InnoDB memcached Plugin with Replication</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached-internals">14.2.9.7. Internals of the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-memcached-troubleshoot">14.2.9.8. Troubleshooting the InnoDB memcached Plugin</a></span></dt></dl>
</div>
<a class="indexterm" name="idp91780560"></a><p>
    The ever-increasing performance demands of web-based services have
    generated significant interest in simple data access methods that
    maximize performance. These techniques are broadly classified under
    the name <span class="quote">“<span class="quote">NoSQL</span>”</span>: to increase performance and
    throughput, they take away the overhead of parsing an SQL statement,
    constructing an execution plan, and dealing with strongly typed data
    values split into multiple fields.
  </p><p>
    MySQL 5.6 includes a NoSQL interface, using an
    integrated <span class="command"><strong>memcached</strong></span> daemon that can
    automatically store data and retrieve it from
    <code class="literal">InnoDB</code> tables, turning the MySQL server into a
    fast <span class="quote">“<span class="quote">key-value store</span>”</span> for single-row insert, update,
    or delete operations. You can still also access the same tables
    through SQL for convenience, complex queries, bulk operations,
    application compatibility, and other strengths of traditional
    database software.
  </p><p>
    With this NoSQL interface, you use the familiar
    <span class="command"><strong>memcached</strong></span> API to speed up database operations,
    letting <code class="literal">InnoDB</code> handle memory caching using its
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> mechanism. Data
    modified through <span class="command"><strong>memcached</strong></span> operations such as
    <code class="literal">ADD</code>, <code class="literal">SET</code>,
    <code class="literal">INCR</code> are stored to disk, using the familiar
    <code class="literal">InnoDB</code> mechanisms such as
    <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change buffering</a>, the
    <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite buffer</a>,
    and <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>. The
    combination of <span class="command"><strong>memcached</strong></span> simplicity and
    <code class="literal">InnoDB</code> durability provides users with the best of
    both worlds, as explained in
    <a class="xref" href="storage-engines.html#innodb-memcached-benefits" title="14.2.9.1. Benefits of the InnoDB / memcached Combination">Section 14.2.9.1, “Benefits of the InnoDB / memcached Combination”</a>. For architectural
    details about how the components fit together, see
    <a class="xref" href="storage-engines.html#innodb-memcached-intro" title="14.2.9.2. Architecture of InnoDB and memcached Integration">Section 14.2.9.2, “Architecture of InnoDB and memcached Integration”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-benefits"></a>14.2.9.1. Benefits of the InnoDB / memcached Combination</h4>
</div>
</div>
</div>
<p>
      This section outlines advantages and usage scenarios for the
      <span class="command"><strong>memcached</strong></span> interface to
      <code class="literal">InnoDB</code> tables introduced in
      <a class="xref" href="storage-engines.html#innodb-memcached" title="14.2.9. InnoDB Integration with memcached">Section 14.2.9, “InnoDB Integration with memcached”</a>. The combination of
      <code class="literal">InnoDB</code> tables and <span class="command"><strong>memcached</strong></span>
      offers advantages over using either by themselves:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Raw performance for simple lookups. Direct access to the
          <code class="literal">InnoDB</code> storage engine avoids the parsing
          and planning overhead of SQL. Running
          <span class="command"><strong>memcached</strong></span> in the same process space as the
          MySQL server avoids the network overhead of passing requests
          back and forth.
        </p></li><li class="listitem"><p>
          Data is stored in a MySQL database to protect against crashes,
          outages, and corruption.
        </p></li><li class="listitem"><p>
          The transfer between memory and disk is handled automatically,
          simplifying application logic.
        </p></li><li class="listitem"><p>
          Data can be unstructured or structured, depending on the type
          of application. You can make an all-new table for the data, or
          map the NoSQL-style processing to one or more existing tables.
        </p></li><li class="listitem"><p>
          You can still access the underlying table through SQL, for
          reporting, analysis, ad hoc queries, bulk loading, set
          operations such as union and intersection, and other
          operations well suited to the expressiveness and flexibility
          of SQL.
        </p></li><li class="listitem"><p>
          You can ensure high availability of the NoSQL data by using
          this feature on a <a class="link" href="glossary.html#glos_master_server" title="master server">master
          server</a> in combination with MySQL replication.
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The integration of <span class="command"><strong>memcached</strong></span> with MySQL
          provides a painless way to make the in-memory data persistent,
          so you can use it for more significant kinds of data. You can
          put more <code class="literal">add</code>, <code class="literal">incr</code>, and
          similar write operations into your application, without
          worrying that the data could disappear at any moment. You can
          stop and start the <span class="command"><strong>memcached</strong></span> server without
          losing updates made to the cached data. To guard against
          unexpected outages, you can take advantage of
          <code class="literal">InnoDB</code> crash recovery, replication, and
          backup procedures.
        </p></li><li class="listitem"><p>
          The way <code class="literal">InnoDB</code> does fast
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> lookups is
          a natural fit for <span class="command"><strong>memcached</strong></span> single-item
          queries. The direct, low-level database access path used by
          the <span class="command"><strong>memcached</strong></span> plugin is much more efficient
          for key-value lookups than equivalent SQL queries.
        </p></li><li class="listitem"><p>
          The serialization features of <span class="command"><strong>memcached</strong></span>,
          which can turn complex data structures, binary files, or even
          code blocks into storeable strings, offer a simple way to get
          such objects into a database.
        </p></li><li class="listitem"><p>
          Because you can access the underlying data through SQL, you
          can produce reports, search or update across multiple keys,
          and call functions such as <code class="literal">AVG()</code> and
          <code class="literal">MAX()</code> on the <span class="command"><strong>memcached</strong></span>
          data. All of these operations are expensive or complicated
          with the standalone <span class="command"><strong>memcached</strong></span>.
        </p></li><li class="listitem"><p>
          You do not need to manually load data into
          <span class="command"><strong>memcached</strong></span> at startup. As particular keys
          are requested by an application, the values are retrieved from
          the database automatically, and cached in memory using the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>.
        </p></li><li class="listitem"><p>
          Because <span class="command"><strong>memcached</strong></span> consumes relatively
          little CPU, and its memory footprint is easy to control, it
          can run comfortably alongside a MySQL instance on the same
          system.
        </p></li><li class="listitem"><p>
          Because data consistency is enforced through the usual
          mechanism as with regular <code class="literal">InnoDB</code> tables,
          you do not have to worry about stale
          <span class="command"><strong>memcached</strong></span> data or fallback logic to query
          the database in the case of a missing key.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-intro"></a>14.2.9.2. Architecture of InnoDB and memcached Integration</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp91833280"></a><p>
      This section describes how the <span class="command"><strong>memcached</strong></span> daemon
      is integrated into the MySQL Server, to help understand how this
      approach compares with other techniques that combine NoSQL
      components or interfaces with a MySQL back-end.
    </p><p>
      When integrated with MySQL Server, <span class="command"><strong>memcached</strong></span> is
      implemented as a MySQL plugin daemon, accessing the
      <code class="literal">InnoDB</code> storage engine directly and bypassing
      the SQL layer:
</p>
<div class="mediaobject">
<img src="images/innodb_memcached2.jpg" width="554" height="414" alt="Architecture Diagram for MySQL Server with Integrated memcached Server">
</div>
<p>
      Features provided in the current release:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="command"><strong>memcached</strong></span> as a daemon plugin of
          <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>: both <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> and
          <span class="command"><strong>memcached</strong></span> run in the same process space,
          with very low latency access to data.
        </p></li><li class="listitem"><p>
          Direct access to <code class="literal">InnoDB</code> tables, bypassing
          the SQL parser, the optimizer, and even the Handler API layer.
        </p></li><li class="listitem"><p>
          Standard <span class="command"><strong>memcached</strong></span> protocols, both the
          text-based protocol and the binary protocol. The
          <code class="literal">InnoDB</code> + <span class="command"><strong>memcached</strong></span>
          combination passes all 55 compatibility tests from the
          <span class="command"><strong>memcapable</strong></span> command.
        </p></li><li class="listitem"><p>
          Multi-column support: you can map multiple columns into the
          <span class="quote">“<span class="quote">value</span>”</span> part of the key/value store, with column
          values delimited by a user-specified separator character.
        </p></li><li class="listitem"><p>
          By default, you use the <span class="command"><strong>memcached</strong></span> protocol
          to read and write data directly to <code class="literal">InnoDB</code>,
          and let MySQL manage the in-memory caching through the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The
          default settings represent the combination of high reliability
          with the fewest surprises for database applications. For
          example, the default settings avoid uncommitted data on the
          database side, or stale data returned for
          <span class="command"><strong>memcached</strong></span> <code class="literal">get</code> requests.

          
        </p></li><li class="listitem"><p>
          Advanced users can configure the system as a traditional
          <span class="command"><strong>memcached</strong></span> server, with all data cached only
          in the <span class="command"><strong>memcached</strong></span> default engine (memory),
          or use a combination of the
          <span class="quote">“<span class="quote"><span class="command"><strong>memcached</strong></span> default engine</span>”</span>
          (memory caching) and the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> engine (<code class="literal">InnoDB</code>
          as backend persistent storage).
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You can control how often data is passed back and forth
          between <code class="literal">InnoDB</code> and memcached operations
          through the
          <a class="link" href="storage-engines.html#sysvar_innodb_api_bk_commit_interval"><code class="literal">innodb_api_bk_commit_interval</code></a>,
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>,
          and
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
          configuration options. Both the batch size options default to
          a value of 1 for maximum reliability.
        </p></li><li class="listitem"><p>
          You can specify any <span class="command"><strong>memcached</strong></span> configuration
          options through the MySQL configuration variable
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>. For
          example, you might change the port that
          <span class="command"><strong>memcached</strong></span> listens on, reduce the maximum
          number of simultaneous connections, change the maximum memory
          size for a key/value pair, or enable debugging messages for
          the error log.
        </p></li><li class="listitem"><p>
          A configuration option
          <a class="link" href="storage-engines.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a> lets you
          control the transaction
          <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> on
          queries processed by the <span class="command"><strong>memcached</strong></span>
          interface. Although <span class="command"><strong>memcached</strong></span> has concept
          of <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, you
          might use this property to control how soon
          <span class="command"><strong>memcached</strong></span> sees changes caused by SQL
          statements, if you issue <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
          statements on the same table that <span class="command"><strong>memcached</strong></span>
          interfaces with. By default, it is set to
          <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>.
        </p></li><li class="listitem"><p>
          Another configuration option is
          <a class="link" href="storage-engines.html#sysvar_innodb_api_enable_mdl"><code class="literal">innodb_api_enable_mdl</code></a>.
          <span class="quote">“<span class="quote">MDL</span>”</span> stands for <span class="quote">“<span class="quote">metadata locking</span>”</span>.
          This basically locks the table from the MySQL level, so that
          the mapped table cannot be dropped or altered by
          <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> through the SQL interface.
          Without the lock, the table can be dropped from MySQL layer,
          but will be kept in the InnoDB storage until
          <span class="command"><strong>memcached</strong></span> or any other user stops using it.
</p></li></ul>
</div>
<h5><a name="innodb-memcached-compare-contrast"></a>
      Differences Between Using <span class="command"><strong>memcached</strong></span> Standalone or with <code class="literal">InnoDB</code>
</h5>
<p>
      MySQL users might already be familiar with using
      <span class="command"><strong>memcached</strong></span> along with MySQL, as described in
      <a class="xref" href="ha-overview.html#ha-memcached" title="15.6. Using MySQL with memcached">Section 15.6, “Using MySQL with <span class="command"><strong>memcached</strong></span>”</a>. This section describes the
      similarities and differences between the information in that
      section, and when using the <code class="literal">InnoDB</code> integration
      features of the <span class="command"><strong>memcached</strong></span> that is built into
      MySQL. The link at the start of each item goes to the associated
      information about the traditional <span class="command"><strong>memcached</strong></span>
      server.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-install" title="15.6.1. Installing memcached">Installation</a>:
          Because the <span class="command"><strong>memcached</strong></span> library comes with
          the MySQL server, installation and setup are straightforward.
          You run a SQL script to set up a table for
          <span class="command"><strong>memcached</strong></span> to use, issue a one-time
          <code class="literal">install plugin</code> statement to enable
          <span class="command"><strong>memcached</strong></span>, and add to the MySQL
          configuration file or startup script any desired
          <span class="command"><strong>memcached</strong></span> options, for example to use a
          different port. You might still install the regular
          <span class="command"><strong>memcached</strong></span> distribution to get the
          additional utilities such as <span class="command"><strong>memcp</strong></span>,
          <span class="command"><strong>memcat</strong></span>, and <span class="command"><strong>memcapable</strong></span>.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-using-deployment" title="15.6.2.1. memcached Deployment">Deployment</a>:
          It is typical to run large numbers of low-capacity
          <span class="command"><strong>memcached</strong></span> servers. Because the
          <code class="literal">InnoDB</code> + <span class="command"><strong>memcached</strong></span>
          combination has a 1:1 ratio between database and
          <span class="command"><strong>memcached</strong></span> servers, the typical deployment
          involves a smaller number of moderate or high-powered servers,
          machines that were already running MySQL. The benefit of this
          server configuration is more for improving the efficiency of
          each individual database server than in tapping into unused
          memory or distributing lookups across large numbers of
          servers. In the default configuration, very little memory is
          used for <span class="command"><strong>memcached</strong></span>, and the in-memory
          lookups are served from the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, which
          automatically caches the most recently used and most
          frequently used data. As in a traditional MySQL server
          instance, keep the value of the
          <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          configuration option as high as practical (without causing
          paging at the OS level), so that as much of the workload as
          possible is done in memory.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-using-expiry" title="15.6.2.3. Data Expiry">Expiry</a>: By
          default (that is, with the caching policy
          <code class="literal">innodb_only</code>), the latest data from the
          <code class="literal">InnoDB</code> table is always returned, so the
          expiry options have no practical effect. If you change the
          caching policy to <code class="literal">caching</code> or
          <code class="literal">cache-only</code>, the expiry options work as
          usual, but requested data might be stale if it was updated in
          the underlying table before it expires from the memory cache.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-using-namespaces" title="15.6.2.2. Using Namespaces">Namespaces</a>:
          <span class="command"><strong>memcached</strong></span> is like a single giant directory,
          where to keep files from conflicting with each other you might
          give them elaborate names with prefixes and suffixes. The
          integrated <code class="literal">InnoDB</code> /
          <span class="command"><strong>memcached</strong></span> server lets you use these same
          naming conventions for keys, with one addition. Key names of
          the format
          <code class="literal">@@<em class="replaceable"><code>table_id</code></em>.<em class="replaceable"><code>key</code></em></code>.<em class="replaceable"><code>table_id</code></em>
          are decoded to reference a specific a table, using mapping
          data from the <code class="literal">innodb_memcache.containers</code>
          table. The <em class="replaceable"><code>key</code></em> is looked up in or
          written to the specified table.
        </p><p>
          The <code class="literal">@@</code> notation only works for individual
          calls to the <code class="literal">get</code>, <code class="literal">add</code>,
          and <code class="literal">set</code> functions, not the others such as
          <code class="literal">incr</code> or <code class="literal">delete</code>. To
          designate the default table for all subsequent
          <span class="command"><strong>memcached</strong></span> operations within a session,
          perform a <code class="literal">get</code> request using the
          <code class="literal">@@</code> notation and a table ID, but without the
          key portion. For example:
        </p><pre class="programlisting">
get @@table_x
</pre><p>
          Subsequent <code class="literal">get</code>, <code class="literal">set</code>,
          <code class="literal">incr</code>, <code class="literal">delete</code> and other
          operations use the table designated by
          <code class="literal">table_x</code> in the
          <code class="literal">innodb_memcache.containers.name</code> column.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-using-hashtypes" title="15.6.2.4. memcached Hashing/Distribution Types">Hashing and
          distribution</a>: The default configuration, with the
          caching policy <code class="literal">innodb_only</code>, is suitable for
          the traditional deployment configuration where all data is
          available on all servers, such as a set of replication slave
          servers.
        </p><p>
          If you physically divide the data, as in a sharded
          configuration, you can split the data across several machines
          running the <code class="literal">InnoDB</code> and
          <span class="command"><strong>memcached</strong></span> combined server, and use the
          traditional <span class="command"><strong>memcached</strong></span> hashing mechanism to
          route requests to a particular machine. On the MySQL side,
          typically you would let all the data be inserted by
          <code class="literal">add</code> requests to
          <span class="command"><strong>memcached</strong></span> so the appropriate values were
          stored in the database on the appropriate server.
        </p><p>
          These types of deployment best practices are still being
          codified.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-using-memory" title="15.6.2.6. Memory Allocation within memcached">Memory usage</a>:
          By default (with the caching policy
          <code class="literal">innodb_only</code>), the
          <span class="command"><strong>memcached</strong></span> protocol passes information back
          and forth with <code class="literal">InnoDB</code> tables, and the
          fixed-size <code class="literal">InnoDB</code> buffer pool handles the
          in-memory lookups rather than <span class="command"><strong>memcached</strong></span>
          memory usage growing and shrinking. Relatively little memory
          is used on the <span class="command"><strong>memcached</strong></span> side.
        </p><p>
          If you switch the caching policy to <code class="literal">caching</code>
          or <code class="literal">cache-only</code>, the normal rules of
          <span class="command"><strong>memcached</strong></span> memory usage apply. Memory for
          the <span class="command"><strong>memcached</strong></span> data values is allocated in
          terms of <span class="quote">“<span class="quote">slabs</span>”</span>. You can control the slab size
          and maximum memory used for <span class="command"><strong>memcached</strong></span>.
        </p><p>
          Either way, you can monitor and troubleshoot the integrated
          <span class="command"><strong>memcached</strong></span> daemon using the familiar
          <a class="link" href="ha-overview.html#ha-memcached-stats" title="15.6.4. Getting memcached Statistics">statistics</a> system,
          accessed through the standard protocol, for example over a
          <span class="command"><strong>telnet</strong></span> session. Because extra utilities are
          not included with the integrated daemon, to use the
          <a class="link" href="ha-overview.html#ha-memcached-stats-memcached-tool" title="15.6.4.6. Using memcached-tool"><code class="literal">memcached-tool</code>
          script</a>, install a full <span class="command"><strong>memcached</strong></span>
          distribution.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-using-threads" title="15.6.2.7. memcached Thread Support">Thread
          usage</a>: MySQL threads and <span class="command"><strong>memcached</strong></span>
          threads must co-exist on the same server, so any limits
          imposed on threads by the operating system apply to this total
          number.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-using-logs" title="15.6.2.8. memcached Logs">Log usage</a>:
          Because the <span class="command"><strong>memcached</strong></span> daemon is run
          alongside the MySQL server and writes to
          <code class="literal">stderr</code>, the <code class="literal">-v</code>,
          <code class="literal">-vv</code>, and <code class="literal">-vvv</code> options
          for logging write their output to the MySQL
          <a class="link" href="glossary.html#glos_error_log" title="error log">error log</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-operations" title="15.6.3.1. Basic memcached Operations"><span class="command"><strong>memcached</strong></span>
          operations</a>: All the familiar operations such as
          <code class="literal">get</code>, <code class="literal">set</code>,
          <code class="literal">add</code>, and <code class="literal">delete</code> are
          available. Serialization (that is, the exact string format to
          represent complex data structures) depends on the language
          interface.

          

        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-mysql-frontend" title="15.6.3.2. Using memcached as a MySQL Caching Layer">Using
          <span class="command"><strong>memcached</strong></span> as a MySQL front end</a>: That
          is what the <code class="literal">InnoDB</code> integration with
          <span class="command"><strong>memcached</strong></span> is all about. Putting these
          components together improves the performance of your
          application. Making <code class="literal">InnoDB</code> handle data
          transfers between memory and disk simplifies the logic of your
          application.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-libmemcached-utilities" title="15.6.3.3.6. libmemcached Command-Line Utilities">Utilities</a>:
          The MySQL server includes the <code class="literal">libmemcached</code>
          library but not the additional command-line utilities. To get
          the commands such as <span class="command"><strong>memcp</strong></span>,
          <span class="command"><strong>memcat</strong></span>, and <span class="command"><strong>memcapable</strong></span>
          commands, install a full <span class="command"><strong>memcached</strong></span>
          distribution. When <span class="command"><strong>memrm</strong></span> and
          <span class="command"><strong>memflush</strong></span> remove items from the cache, they
          are also removed from the underlying <code class="literal">InnoDB</code>
          table.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-interfaces" title="15.6.3. Developing a memcached Application">Programming
          interfaces</a>: You can access the MySQL server through the
          <code class="literal">InnoDB</code> and <span class="command"><strong>memcached</strong></span>
          combination using the same language as always:
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-libmemcached" title="15.6.3.3. Using libmemcached with C and C++">C and
          C++</a>,
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-java" title="15.6.3.8. Using MySQL and memcached with Java">Java</a>,
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-perl" title="15.6.3.4. Using MySQL and memcached with Perl">Perl</a>,
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-python" title="15.6.3.5. Using MySQL and memcached with Python">Python</a>,
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-php" title="15.6.3.6. Using MySQL and memcached with PHP">PHP</a>, and
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-ruby" title="15.6.3.7. Using MySQL and memcached with Ruby">Ruby</a>.
          Specify the server hostname and port as with any other
          <span class="command"><strong>memcached</strong></span> server. By default, the
          integrated <span class="command"><strong>memcached</strong></span> server listens on the
          same port as usual, <code class="literal">11211</code>. You can use both
          the <a class="link" href="ha-overview.html#ha-memcached-interfaces-protocol" title="15.6.3.9. Using the memcached TCP Text Protocol">text and
          binary protocols</a>. You can customize the
          <a class="link" href="ha-overview.html#ha-memcached-interfaces-libmemcached-behaviors" title="15.6.3.3.5. Controlling libmemcached Behaviors">behavior</a>
          of the <span class="command"><strong>memcached</strong></span> functions at runtime.
          Serialization (that is, the exact string format to represent
          complex data structures) depends on the language interface.
        </p></li><li class="listitem"><p>
          <a class="link" href="ha-overview.html#ha-memcached-faq" title="15.6.5. memcached FAQ">Frequently asked
          questions</a>: MySQL has had an extensive
          <span class="command"><strong>memcached</strong></span> FAQ for several releases. In
          MySQL 5.6, the answers are largely the same,
          except that using <code class="literal">InnoDB</code> tables as a
          storage medium for <span class="command"><strong>memcached</strong></span> data means
          that you can use this combination for more write-intensive
          applications than before, rather than as a read-only cache.
</p></li></ul>
</div>
<p>
      For a more detailed look at the workings of this feature, see
      <a class="xref" href="storage-engines.html#innodb-memcached-internals" title="14.2.9.7. Internals of the InnoDB memcached Plugin">Section 14.2.9.7, “Internals of the InnoDB memcached Plugin”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-setup"></a>14.2.9.3. Getting Started with InnoDB Memcached Plugin</h4>

</div>

</div>

</div>
<p>
      This section describes the steps to activate the
      <code class="literal">InnoDB</code> / <span class="command"><strong>memcached</strong></span>
      integration on a MySQL Server. Because the
      <span class="command"><strong>memcached</strong></span> daemon is tightly integrated with the
      MySQL Server to avoid network traffic and minimize latency, you
      perform this process on each MySQL instance that uses this
      feature.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
        Before setting up the <span class="command"><strong>memcached</strong></span> interface for
        any data, consult <a class="xref" href="storage-engines.html#innodb-memcached-security" title="14.2.9.4. Security Considerations for the InnoDB memcached Plugin">Section 14.2.9.4, “Security Considerations for the InnoDB memcached Plugin”</a> to
        understand the security procedures needed to prevent
        unauthorized access.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-prereqs"></a>14.2.9.3.1. Prerequisites for the InnoDB memcached Plugin</h5>

</div>

</div>

</div>
<p>
        Before you set up the plugin and the internal tables, verify
        that your server has the required prerequisite software.
      </p><h6><a name="idp92016816"></a>
        Platform Support
      </h6><p>
        Currently, the <span class="command"><strong>memcached</strong></span> Daemon Plugin is
        only supported on Linux, Solaris, and OS X platforms.
      </p><h6><a name="idp92018464"></a>
        Software Prerequisites
      </h6><p>
        You must have <code class="literal">libevent</code> installed, since it is
        required by <span class="command"><strong>memcached</strong></span>. The way to get this
        library is different if you use the MySQL installer or build
        from source, as described in the following sections.
      </p><h6><a name="idp92020928"></a>
        Using a MySQL Installation Package
      </h6><p>
        When you use a MySQL installer, the <code class="literal">libevent</code>
        library is not included. Use the particular method for your
        operating system to download and install
        <code class="literal">libevent</code> 1.4.3 or later: for example,
        depending on the operating system, you might use the command
        <code class="literal">apt-get</code>, <code class="literal">yum</code>, or
        <code class="literal">port install</code>. For example, on Ubuntu Linux:
      </p><pre class="programlisting">sudo apt-get install libevent-dev</pre><p>
        The libraries for <span class="command"><strong>memcached</strong></span> and the
        <code class="literal">InnoDB</code> plugin for
        <span class="command"><strong>memcached</strong></span> are put into the right place by the
        MySQL installer. For typical operation, the files
        <code class="filename">lib/plugin/libmemcached.so</code> and
        <code class="filename">lib/plugin/innodb_engine.so</code> are used.
      </p><h6><a name="idp92030432"></a>
        Building from Source
      </h6><p>
        For a brief introduction on the setup steps, see the file
        <code class="filename">README-innodb_memcached</code> in the source
        distribution in <code class="filename">plugin/innodb_memcached</code>.
        This is a more detailed explanation of that procedure.
      </p><p>
        If you have the source code release, <code class="literal">libevent</code>
        1.4.3 is bundled with the package and is located at the top
        level of the MySQL source code directory. The bundled version of
        <code class="literal">libevent</code> is used unless you direct the build
        to use a local system version of <code class="literal">libevent</code> by
        setting <a class="link" href="installing.html#option_cmake_with_libevent"><code class="option">-DWITH_LIBEVENT</code></a> to
        <code class="literal">system</code> or <code class="literal">yes</code>.
      </p><p>
        When you build MySQL server, build with
        <a class="link" href="installing.html#option_cmake_with_innodb_memcached"><code class="option">-DWITH_INNODB_MEMCACHED=ON</code></a>. This
        will generate two shared libraries in the MySQL plugin directory
        that are required to run <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">libmemcached.so</code>: the
            <span class="command"><strong>memcached</strong></span> daemon plugin to MySQL.
          </p></li><li class="listitem"><p>
            <code class="filename">innodb_engine.so</code>: an
            <code class="literal">InnoDB</code> API plugin to
            <span class="command"><strong>memcached</strong></span>.
</p></li></ul>
</div>
<h6><a name="idp92046320"></a>
        Setting Operating System Limits
      </h6><p>
        The <span class="command"><strong>memcached</strong></span> daemon can sometimes cause the
        MySQL server to exceed the OS limit on the number of open files.
        You might need to run the <span class="command"><strong>ulimit</strong></span> command to
        increase the limit, and then start the MySQL server from that
        same shell. See <a class="xref" href="storage-engines.html#innodb-memcached-troubleshoot" title="14.2.9.8. Troubleshooting the InnoDB memcached Plugin">Section 14.2.9.8, “Troubleshooting the InnoDB memcached Plugin”</a>
        for the steps to resolve this issue.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-installing"></a>14.2.9.3.2. Installing and Configuring the InnoDB memcached Plugin</h5>

</div>

</div>

</div>
<p></p><h6><a name="idp92050832"></a>
        Setting Up Required Tables
      </h6><a class="indexterm" name="idp92051280"></a><a class="indexterm" name="idp92052368"></a><a class="indexterm" name="idp92053440"></a><p>
        To configure the <span class="command"><strong>memcached</strong></span> plugin so it can
        interact with <code class="literal">InnoDB</code> tables, run the
        configuration script
        <code class="filename">scripts/innodb_memcached_config.sql</code> to
        install the necessary tables used behind the scenes:
      </p><pre class="programlisting">mysql: source <em class="replaceable"><code>MYSQL_HOME</code></em>/share/innodb_memcached_config.sql
</pre><p>
        This is a one-time operation. The tables remain in place if you
        later disable and re-enable the <span class="command"><strong>memcached</strong></span>
        support. For information about the layout and purpose of these
        tables, see <a class="xref" href="storage-engines.html#innodb-memcached-internals" title="14.2.9.7. Internals of the InnoDB memcached Plugin">Section 14.2.9.7, “Internals of the InnoDB memcached Plugin”</a>.
      </p><h6><a name="idp92060288"></a>
        Installing the Daemon Plugin
      </h6><p>
        To activate the daemon plugin, use the <code class="literal">install
        plugin</code> statement, just as when installing any other
        MySQL plugin:
      </p><pre class="programlisting">
mysql&gt; install plugin daemon_memcached soname "libmemcached.so";
</pre><p>
        Once the plugin is installed this way, it is automatically
        activated each time the MySQL server is booted or restarted.
      </p><h6><a name="idp92063328"></a>
        Disabling the Daemon Plugin
      </h6><p>
        When making major changes to the plugin configuration, you might
        need to turn off the plugin. To do so, issue the following
        statement:
      </p><pre class="programlisting">
mysql&gt; uninstall plugin daemon_memcached;
</pre><p>
        To re-enable it, issue the preceding <code class="literal">install
        plugin</code> statement again. All the previous configuration
        settings, internal tables, and data are preserved when the
        plugin is restarted this way.
      </p><p>
        For additional information about enabling and disabling plugins,
        see <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1. Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>.
      </p><h6><a name="idp92067456"></a>
        Specifying <span class="command"><strong>memcached</strong></span> Configuration Options
      </h6><p>
        If you have any <span class="command"><strong>memcached</strong></span> specific
        configuration parameters, specify them on the
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command line or enter them in the
        MySQL configuration file, encoded in the argument to the
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a> MySQL
        configuration option. The <span class="command"><strong>memcached</strong></span>
        configuration options take effect when the plugin is installed,
        which you do each time the MySQL server is started.
      </p><p>
        For example, to make <span class="command"><strong>memcached</strong></span> listen on port
        11222 instead of the default port 11211, add
        <code class="literal">-p11222</code> to the MySQL configuration option
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>:
      </p><pre class="programlisting">mysqld .... --daemon_memcached_option="-p11222"</pre><p>
        You can add other memcached command line options to the
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a> string.
        The other configuration options are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_engine_lib_name"><code class="literal">daemon_memcached_engine_lib_name</code></a>
            (default <code class="filename">innodb_engine.so</code>)
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_engine_lib_path"><code class="literal">daemon_memcached_engine_lib_path</code></a>
            (default NULL, representing the plugin directory).
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>,
            batch commit size for read operations
            (<code class="literal">get</code>). It specifies after how many
            <span class="command"><strong>memcached</strong></span> read operations the system
            automatically does a
            <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>. By default, this
            is set to 1 so that every <code class="literal">get</code> request can
            access the very latest committed data in the
            <code class="literal">InnoDB</code> table, whether the data was
            updated through <span class="command"><strong>memcached</strong></span> or by SQL. When
            its value is greater than 1, the counter for read operations
            is incremented once for every <code class="literal">get</code> call.
            The <code class="literal">flush_all</code> call resets both the read
            and write counters.
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>,
            batch commit for any write operations
            (<code class="literal">set</code>, <code class="literal">replace</code>,
            <code class="literal">append</code>, <code class="literal">prepend</code>,
            <code class="literal">incr</code>, <code class="literal">decr</code>, and so on)
            By default, this is set as 1, so that no uncommitted data is
            lost in case of an outage, and any SQL queries on the
            underlying table can access the very latest data. When its
            value is greater than 1, the counter for write operations is
            incremented once for every <code class="literal">add</code>,
            <code class="literal">set</code>, <code class="literal">incr</code>,
            <code class="literal">decr</code>, and <code class="literal">delete</code> call.
            The <code class="literal">flush_all</code> call resets both the read
            and write counters.
</p></li></ul>
</div>
<p>
        By default, you do not need to change anything with the first
        two configuration options. Those options allow you to load any
        other storage engine for <span class="command"><strong>memcached</strong></span> (such as
        the NDB <span class="command"><strong>memcached</strong></span> engine).
      </p><p>
        Again, please note that you will have these configuration
        parameters in your MySQL configuration file or MySQL boot
        command line. They take effect when you load the
        <span class="command"><strong>memcached</strong></span> plugin.
      </p><h6><a name="idp92104400"></a>
        Summary
      </h6><p>
        Now you have everything set up. You can directly interact with
        InnoDB tables through the <span class="command"><strong>memcached</strong></span>
        interface. To verify that the feature is working properly, see
        <a class="xref" href="storage-engines.html#innodb-memcached-snifftest" title="14.2.9.3.3. Verifying the InnoDB and memcached Setup">Section 14.2.9.3.3, “Verifying the InnoDB and memcached Setup”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-snifftest"></a>14.2.9.3.3. Verifying the InnoDB and memcached Setup</h5>

</div>

</div>

</div>
<p>
        Now that everything is set up, you can experiment with the
        InnoDB and <span class="command"><strong>memcached</strong></span> combination:
      </p><p>
        Here is an example using the Unix, Linux, or OS X command shell:
      </p><pre class="programlisting"># Point memcached-related commands at the memcached attached to the mysqld process.
export MEMCACHED_SERVERS=127.0.0.1:11211
# Store the contents of a modestly sized text file in memcached, with the data passed
# to MySQL and stored in a table. The key is the basename of the file, 'mime.types'.
memcp /etc/apache2/mime.types
# Retrieve the data we just stored, from the memory cache.
memcat mime.types</pre><p>
        Here is an example using <span class="command"><strong>telnet</strong></span> to send
        <span class="command"><strong>memcached</strong></span> commands and receive results
        through the ASCII protocol:
      </p><pre class="programlisting"><strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
<strong class="userinput"><code>set a11 10 0 9</code></strong>
<strong class="userinput"><code>123456789</code></strong>
STORED
<strong class="userinput"><code>get a11</code></strong>
VALUE a11 0 9
123456789
END
<strong class="userinput"><code>quit</code></strong>
</pre><p>
        To prove that all the same data has been stored in MySQL,
        connect to the MySQL server and issue:
      </p><pre class="programlisting">
mysql&gt; select * from test.demo_test;
</pre><p>
        Now, shut down the MySQL server, which also shuts off the
        integrated <span class="command"><strong>memcached</strong></span> server. Further attempts
        to access the <span class="command"><strong>memcached</strong></span> data now fail with a
        connection error. Normally, the <span class="command"><strong>memcached</strong></span>
        data would disappear at this point, and you would write
        application logic to load the data back into memory when
        <span class="command"><strong>memcached</strong></span> was restarted. But the MySQL /
        <span class="command"><strong>memcached</strong></span> integration automates this process:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Restart the MySQL server.
          </p></li><li class="listitem"><p>
            Run the <code class="literal">install plugin</code> statement to start
            the <code class="literal">daemon_memcached</code> plugin again.
          </p></li><li class="listitem"><p>
            Now any <span class="command"><strong>memcat</strong></span> commands or
            <code class="literal">get</code> operations once again return the
            key/value pairs you stored in the earlier
            <span class="command"><strong>memcached</strong></span> session. When a key is
            requested and the associated value is not already in the
            memory cache, it is automatically queried from the MySQL
            table, by default <code class="literal">test.demo_test</code>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-security"></a>14.2.9.4. Security Considerations for the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<p xmlns="">
        Consult this section before deploying the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin on
        any production servers, or even test servers if the MySQL
        instance contains any sensitive information.
</p>
</div>
<p>
      Because <span class="command"><strong>memcached</strong></span> does not use an
      authentication mechanism by default, and the optional SASL
      authentication is not as strong as traditional DBMS security
      measures, make sure to keep only non-sensitive data in the MySQL
      instance using the <code class="literal">InnoDB</code>
      <span class="command"><strong>memcached</strong></span> plugin, and wall off any servers
      using this configuration from potential intruders. Do not allow
      <span class="command"><strong>memcached</strong></span> access to such servers from the
      Internet, only from within a firewalled intranet, ideally from a
      subnet whose membership you can restrict.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-sasl"></a>14.2.9.4.1. Password-Protecting the <span class="command"><strong>memcached</strong></span> Interface through
SASL</h5>
</div>
</div>
</div>
<a class="indexterm" name="idp92140288"></a><a class="indexterm" name="idp92141360"></a><a class="indexterm" name="idp92142464"></a><a class="indexterm" name="idp92143968"></a><a class="indexterm" name="idp92145472"></a><p>
        SASL support gives you the capability to protect your MySQL
        database from unauthenticated access through
        <span class="command"><strong>memcached</strong></span> clients. This section explains the
        steps to enable this option. The steps to enable such support
        are almost identical to those you would do to enable SASL for a
        traditional <span class="command"><strong>memcached</strong></span> server.
      </p><h6><a name="idp92149120"></a>
        Background Info:
      </h6><p>
        SASL stands for <span class="quote">“<span class="quote">Simple Authentication and Security
        Layer</span>”</span>, a standard for adding authentication support to
        connection-based protocols. <span class="command"><strong>memcached</strong></span> added
        SASL support starting in its 1.4.3 release.
      </p><p>
        SASL authentication is only supported with the binary protocol.
      </p><p>
        For the InnoDB + <span class="command"><strong>memcached</strong></span> combination, the
        table that stores the <span class="command"><strong>memcached</strong></span> data must be
        registered in the <code class="literal">container</code> system table. And
        <span class="command"><strong>memcached</strong></span> clients can only access such a
        registered table.  Even though the DBA can add access
        restrictions on a table that is registered with the
        <span class="command"><strong>memcached</strong></span> plugin, they have no control over
        who can access it through <span class="command"><strong>memcached</strong></span>
        applications. This is why we provide a means (through SASL) to
        control who can access <code class="literal">InnoDB</code> tables
        associated with the <span class="command"><strong>memcached</strong></span> plugin.
      </p><p>
        The following section shows how to build, enable, and test an
        SASL-enabled <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span> plugin.
      </p><h6><a name="idp92160400"></a>
        Steps to Build and Enable SASL in InnoDB Memcached Plugin:
      </h6><p>
        By default, SASL-enabled <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span> is not included in the release
        package, since it relies on building
        <span class="command"><strong>memcached</strong></span> with SASL libraries. To enable this
        feature, download the MySQL source and rebuild the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
        after downloading the SASL libraries:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            First, get the SASL development and utility libraries. For
            example, on Ubuntu, you can get these libraries through:
          </p><pre class="programlisting">sudo apt-get -f install libsasl2-2 sasl2-bin libsasl2-2 libsasl2-dev libsasl2-modules</pre></li><li class="listitem"><p>
            Then build the <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> plugin (shared libraries) with
            SASL capability, by adding
            <code class="literal">ENABLE_MEMCACHED_SASL=1</code> to the
            <span class="command"><strong>cmake</strong></span> options. In addition,
            <span class="command"><strong>memcached</strong></span> provides a simple plaintext
            password support, which is easier to use for testing. To
            enable this, set the option
            <code class="literal">ENABLE_MEMCACHED_SASL_PWDB=1</code>.
          </p><p>
            Overall, you will add following three options to the
            <span class="command"><strong>cmake</strong></span>:
          </p><pre class="programlisting">cmake ... -DWITH_INNODB_MEMCACHED=1
  -DENABLE_MEMCACHED_SASL=1 -DENABLE_MEMCACHED_SASL_PWDB=1</pre></li><li class="listitem"><p>
            The third step is to install the <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> plugin as before, as explained
            in <a class="xref" href="storage-engines.html#innodb-memcached-setup" title="14.2.9.3. Getting Started with InnoDB Memcached Plugin">Section 14.2.9.3, “Getting Started with InnoDB Memcached Plugin”</a>.
          </p></li><li class="listitem"><p>
            As previously mentioned, <span class="command"><strong>memcached</strong></span>
            provides a simple plaintext password support through SASL,
            which will be used for this demo.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="a"><li class="listitem"><p>
                Create a user named <code class="literal">testname</code> and its
                password as <code class="literal">testpasswd</code> in a file:
              </p><pre class="programlisting">
echo "testname:testpasswd:::::::" &gt;/home/jy/memcached-sasl-db
</pre></li><li class="listitem"><p>
                Let <span class="command"><strong>memcached</strong></span> know about it by
                setting the environment variable
                <code class="literal">MEMCACHED_SASL_PWDB</code>:
              </p><pre class="programlisting">export MEMCACHED_SASL_PWDB=/home/jy/memcached-sasl-db</pre></li><li class="listitem"><p>
                Also tell <span class="command"><strong>memcached</strong></span> that it is a
                plaintext password:
              </p><pre class="programlisting">
echo "mech_list: plain" &gt; /home/jy/work2/msasl/clients/memcached.conf
export SASL_CONF_PATH=/home/jy/work2/msasl/clients/memcached.conf
</pre></li></ol>
</div>
</li><li class="listitem"><p>
            Then reboot the server, and add a
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
            option <code class="literal">-S</code> to enable SASL:
          </p><pre class="programlisting">mysqld ... --daemon_memcached_option="-S"</pre></li><li class="listitem"><p>
            Now the setup is complete. To test it, you might need an
            SASL-enabled client, such as this
            <a class="ulink" href="https://code.launchpad.net/~trond-norbye/libmemcached/sasl" target="_top">SASL-enabled
            libmemcached</a>.
          </p><pre class="programlisting">memcp --servers=localhost:11211 --binary  --username=testname
  --password=testpasswd myfile.txt

memcat --servers=localhost:11211 --binary --username=testname
  --password=testpasswd myfile.txt</pre><p>
            Without appropriate user name or password, the above
            operation is rejected with the error message
            <code class="literal">memcache error AUTHENTICATION FAILURE</code>.
            Otherwise, the operation succeed. You can also examine the
            plaintext password set in the
            <code class="filename">memcached-sasl-db</code> file to verify it.
</p></li></ol>
</div>
<p>
        There are other methods to test SASL authentication with
        <span class="command"><strong>memcached</strong></span>. But the one described above is the
        most straightforward.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-developing"></a>14.2.9.5. Writing Applications for the InnoDB memcached Interface</h4>

</div>

</div>

</div>
<p>
      Typically, writing an application for the
      <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> interface
      involves some degree of rewriting or adapting existing code that
      uses MySQL or the <span class="command"><strong>memcached</strong></span> API:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Instead of many <span class="command"><strong>memcached</strong></span> servers running
          on low-powered machines, you have the same number of
          <span class="command"><strong>memcached</strong></span> servers as MySQL servers, running
          on relatively high-powered machines with substantial disk
          storage and memory. You might reuse some existing code that
          works with the <span class="command"><strong>memcached</strong></span> API, but some
          adaptation is likely needed due to the different server
          configuration.
        </p></li><li class="listitem"><p>
          The data stored through this interface all goes into
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>, or
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns, and must be
          converted to do numeric operations. You can do the conversion
          on the application side, or by using the
          <code class="literal">CAST()</code> function in queries.
        </p></li><li class="listitem"><p>
          Coming from a database background, you might be used to
          general-purpose SQL tables with many columns. The tables
          accessed by the <span class="command"><strong>memcached</strong></span> code likely have
          only a few or even just a single column holding data values.
        </p></li><li class="listitem"><p>
          You might adapt parts of your application that do single-row
          queries, inserts, updates, or deletes, to squeeze more
          performance out of critical sections of code. Both
          <a class="link" href="glossary.html#glos_query" title="query">queries</a> (read) and
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> (write) operations can be
          substantially faster when performed through the
          <span class="command"><strong>memcached</strong></span> interface. The speedup for writes
          is typically greater than the speedup for reads, so you might
          focus on adapting the code that performs logging or records
          interactive choices on a web site.
</p></li></ul>
</div>
<p>
      The following sections explore these aspects in more detail.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-porting-mysql"></a>14.2.9.5.1. Adapting an Existing MySQL Schema for a <span class="command"><strong>memcached</strong></span>
Application</h5>
</div>
</div>
</div>
<p>
        Consider these aspects of <span class="command"><strong>memcached</strong></span>
        applications when adapting an existing MySQL schema or
        application to use the <span class="command"><strong>memcached</strong></span> interface:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="command"><strong>memcached</strong></span> keys cannot contain spaces or
            newlines, because those characters are used as separators in
            the ASCII protocol. If you are using lookup values that
            contain spaces, transform or hash them into values without
            spaces before using them as keys in calls to
            <code class="literal">add()</code>, <code class="literal">set()</code>,
            <code class="literal">get()</code> and so on. Although theoretically
            those characters are allowed in keys in programs that use
            the binary protocol, you should always restrict the
            characters used in keys to ensure compatibility with a broad
            range of clients.
          </p></li><li class="listitem"><p>
            If you have a short numeric
            <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> column
            in an <code class="literal">InnoDB</code> table, you can use that as
            the unique lookup key for <span class="command"><strong>memcached</strong></span> by
            converting the integer to a string value. If the
            <span class="command"><strong>memcached</strong></span> server is being used for more
            than one application, or with more than one
            <code class="literal">InnoDB</code> table, consider modifying the name
            to make sure it is unique. For example, you might prepend
            the table name, or the database name and the table name,
            before the numeric value.
          </p></li><li class="listitem"><p>
            You cannot use a partitioned table for data queried or
            stored through the <span class="command"><strong>memcached</strong></span> interface.
          </p></li><li class="listitem"><p>
            The <span class="command"><strong>memcached</strong></span> protocol passes numeric
            values around as strings. To store numeric values in the
            underlying <code class="literal">InnoDB</code> table, for example to
            implement counters that can be used in SQL functions such as
            <code class="literal">SUM()</code> or <code class="literal">AVG()</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Use <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns with
                enough characters to hold all the digits of the largest
                expected number (and additional characters if
                appropriate for the negative sign, decimal point, or
                both).
              </p></li><li class="listitem"><p>
                In any query that performs arithmetic using the column
                values, use the <code class="literal">CAST()</code> function to
                convert from string to integer or other numeric type.
                For example:
              </p><pre class="programlisting">-- Alphabetic entries are returned as zero.
select cast(c2 as unsigned integer) from demo_test;
-- Since there could be numeric values of 0, can't disqualify them.
-- Test the string values to find the ones that are integers, and average only those.
select avg(cast(c2 as unsigned integer)) from demo_test
  where c2 between '0' and '9999999999';
-- Views let you hide the complexity of queries. The results are already converted;
-- no need to repeat conversion functions and WHERE clauses each time.
create view numbers as select c1 key, cast(c2 as unsigned integer) val
  from demo_test where c2 between '0' and '9999999999';
select sum(val) from numbers;</pre><p>
                Note that any alphabetic values in the result set are
                turned into 0 by the call to <code class="literal">CAST()</code>.
                When using functions such as <code class="literal">AVG()</code>
                that depend on the number of rows in the result set,
                include <code class="literal">WHERE</code> clauses to filter out
                any non-numeric values.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            If the <code class="literal">InnoDB</code> column you use as a key can
            be longer than 250 bytes, hash it to a value that is less
            than 250 bytes.
          </p></li><li class="listitem"><p>
            To use an existing table with the
            <span class="command"><strong>memcached</strong></span> interface, define an entry for
            it in the <code class="literal">innodb_memcache.containers</code>
            table. To make that the table the default for all requests
            relayed through <span class="command"><strong>memcached</strong></span>, specify the
            value <code class="literal">default</code> in the
            <code class="literal">name</code> column, then restart the MySQL
            server to make that change take effect. If you are using
            multiple tables for different classes of
            <span class="command"><strong>memcached</strong></span> data, set up multiple entries
            in the <code class="literal">innodb_memcache.containers</code> table
            with <code class="literal">name</code> values of your choosing, then
            issue a <span class="command"><strong>memcached</strong></span> request of the form
            <code class="literal">get @@<em class="replaceable"><code>name</code></em></code> or
            <code class="literal">set @@<em class="replaceable"><code>name</code></em></code>
            within the application to switch the table used for
            subsequent requests through the <span class="command"><strong>memcached</strong></span>
            API.
          </p><p>
            For an example of using a table other than the predefined
            <code class="literal">test.demo_test</code> table, see
            <a class="xref" href="storage-engines.html#innodb-memcached-tutorial-python" title="Example 14.5. Specifying the Table and Column Mapping for an InnoDB + memcached Application">Example 14.5, “Specifying the Table and Column Mapping for an InnoDB + memcached
          Application”</a>. For the
            required layout and meaning of the columns in such a table,
            see <a class="xref" href="storage-engines.html#innodb-memcached-internals" title="14.2.9.7. Internals of the InnoDB memcached Plugin">Section 14.2.9.7, “Internals of the InnoDB memcached Plugin”</a>.
          </p></li><li class="listitem"><p>
            To use multiple MySQL column values with
            <span class="command"><strong>memcached</strong></span> key/value pairs, in the
            <code class="literal">innodb_memcache.containers</code> entry
            associated with the MySQL table, specify in the
            <code class="literal">value_columns</code> field several column names
            separated by comma, semicolon, space, or pipe characters;
            for example, <code class="literal">col1,col2,col3</code> or
            <code class="literal">col1|col2|col3</code>.
          </p><p>
            Concatenate the column values into a single string using the
            pipe character as a separator, before passing that string to
            <span class="command"><strong>memcached</strong></span> <code class="literal">add</code> or
            <code class="literal">set</code> calls. The string is unpacked
            automatically into the various columns. Each
            <code class="literal">get</code> call returns a single string with the
            column values, also delimited by the pipe separator
            character. you unpack those values using the appropriate
            syntax depending on your application language.
</p></li></ul>
</div>
<div class="example">
<a name="innodb-memcached-tutorial-python"></a><p class="title"><b>Example 14.5. Specifying the Table and Column Mapping for an InnoDB + memcached
Application</b></p>
<div class="example-contents">
<p>
          Here is an example showing how to use your own table for a
          MySQL application going through the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin for data manipulation.
        </p><p>
          First, we set up a table to hold some country data: the
          population, area in metric units, and <code class="literal">'R'</code>
          or <code class="literal">'L'</code> indicating if people drive on the
          right or on the left.
        </p><pre class="programlisting">use test;

CREATE TABLE `multicol` (
  `country` varchar(128) NOT NULL DEFAULT '',
  `population` varchar(10) DEFAULT NULL,
  `area_sq_km` varchar(9) DEFAULT NULL,
  `drive_side` varchar(1) DEFAULT NULL,
  `c3` int(11) DEFAULT NULL,
  `c4` bigint(20) unsigned DEFAULT NULL,
  `c5` int(11) DEFAULT NULL,
  PRIMARY KEY (`country`),
) ENGINE=InnoDB DEFAULT CHARSET=latin1;</pre><p>
          Now we make a descriptor for this table so that the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
          knows how to access it:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The sample entry in the <code class="literal">CONTAINERS</code>
              table has a <code class="literal">name</code> column
              <code class="literal">'aaa'</code>; we set up another identifier
              <code class="literal">'bbb'</code>. If we made a single master table
              for all <span class="command"><strong>memcached</strong></span> applications to use,
              we would make the ID <code class="literal">'default'</code> and skip
              the <code class="literal">@@</code> requests to switch tables.
            </p></li><li class="listitem"><p>
              We specify the <code class="literal">test.multicol</code> table. The
              schema name is stored in one column and the table name is
              stored in another column.
            </p></li><li class="listitem"><p>
              The key column will be our unique
              <code class="literal">country</code> value. That column was
              specified as the primary key when we created the table
              above, so we also specify the index name
              <code class="literal">'PRIMARY'</code> here.
            </p></li><li class="listitem"><p>
              Rather than a single column to hold a composite data
              value, we will divide the data among three table columns,
              so we specify a comma-separated list of those columns that
              will be used when storing or retrieving values.
            </p></li><li class="listitem"><p>
              And for the flags, expire, and CAS values, we specify
              corresponding columns based on the settings from the
              sample table <code class="literal">demo.test</code>. These values
              are typically not significant in applications using the
              <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
              plugin, because MySQL keeps the data synchronized and
              there is no need to worry about data expiring or being
              stale.
</p></li></ul>
</div>
<pre class="programlisting">insert into innodb_memcache.containers
  (name,db_schema,db_table,key_columns,value_columns,flags,cas_column,
  expire_time_column,unique_idx_name_on_key)
values
  ('bbb','test','multicol','country','population,area_sq_km,drive_side',
  'c3','c4','c5','PRIMARY');

commit;</pre><p>
          Here is a sample Python program showing how we would access
          this table from a program:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              No database authorization is needed, since all data
              manipulation is done through the
              <span class="command"><strong>memcached</strong></span> interface. All we need to
              know is the port number the <span class="command"><strong>memcached</strong></span>
              daemon is listening to on the local system.
            </p></li><li class="listitem"><p>
              We load sample values for a few arbitrary countries. (Area
              and population figures from Wikipedia.)
            </p></li><li class="listitem"><p>
              To make the program use the <code class="literal">multicol</code>
              table, we call the <code class="literal">switch_table()</code>
              function that does a dummy <code class="literal">GET</code> or
              <code class="literal">SET</code> request using <code class="literal">@@</code>
              notation. The name in the request is
              <code class="literal">bbb</code>, which is the value we stored in
              <code class="literal">innodb_memcache.containers.name</code>. (In a
              real application, we would use a more descriptive name.
              This example just illustrates that you specify a table
              identifier, not the table name, with the <code class="literal">GET
              @@...</code> request.
            </p></li><li class="listitem"><p>
              The utility functions to insert and query the data
              demonstrate how we might turn a Python data structure into
              pipe-separated values for sending to MySQL with
              <code class="literal">ADD</code> or <code class="literal">SET</code> requests,
              and unpack the pipe-separated values returned by
              <code class="literal">GET</code> requests. This extra processing is
              only required when mapping the single
              <span class="command"><strong>memcached</strong></span> value to multiple MySQL table
              columns.
</p></li></ul>
</div>
<pre class="programlisting">import sys, os
import memcache

def connect_to_memcached():
  memc = memcache.Client(['127.0.0.1:11211'], debug=0);
  print "Connected to memcached."
  return memc

def banner(message):
  print
  print "=" * len(message)
  print message
  print "=" * len(message)

country_data = [
("Canada","34820000","9984670","R"),
("USA","314242000","9826675","R"),
("Ireland","6399152","84421","L"),
("UK","62262000","243610","L"),
("Mexico","113910608","1972550","R"),
("Denmark","5543453","43094","R"),
("Norway","5002942","385252","R"),
("UAE","8264070","83600","R"),
("India","1210193422","3287263","L"),
("China","1347350000","9640821","R"),
]

def switch_table(memc,table):
  key = "@@" + table
  print "Switching default table to '" + table + "' by issuing GET for '" + key + "'."
  result = memc.get(key)

def insert_country_data(memc):
  banner("Inserting initial data via memcached interface")
  for item in country_data:
    country = item[0]
    population = item[1]
    area = item[2]
    drive_side = item[3]

    key = country
    value = "|".join([population,area,drive_side])
    print "Key = " + key
    print "Value = " + value

    if memc.add(key,value):
      print "Added new key, value pair."
    else:
      print "Updating value for existing key."
      memc.set(key,value)

def query_country_data(memc):
  banner("Retrieving data for all keys (country names)")
  for item in country_data:
    key = item[0]
    result = memc.get(key)
    print "Here is the result retrieved from the database for key " + key + ":"
    print result
    (m_population, m_area, m_drive_side) = result.split("|")
    print "Unpacked population value: " + m_population
    print "Unpacked area value      : " + m_area
    print "Unpacked drive side value: " + m_drive_side

if __name__ == '__main__':

  memc = connect_to_memcached()
  switch_table(memc,"bbb")
  insert_country_data(memc)
  query_country_data(memc)

  sys.exit(0)</pre><p>
          Here are some SQL queries to illustrate the state of the MySQL
          data after the script is run, and show how you could access
          the same data directly through SQL, or from an application
          written in any language using the appropriate
          <a class="link" href="connectors-apis.html" title="Chapter 22. Connectors and APIs">MySQL Connector or API</a>.
        </p><p>
          The table descriptor <code class="literal">'bbb'</code> is in place,
          allowing us to switch to the <code class="literal">multicol</code> table
          by issuing a <span class="command"><strong>memcached</strong></span> request <code class="literal">GET
          @bbb</code>:
        </p><pre class="programlisting">mysql: use innodb_memcache;
Database changed

mysql: select * from containers;
+------+-----------+-----------+-------------+----------------------------------+-------+------------+--------------------+------------------------+
| name | db_schema | db_table  | key_columns | value_columns                    | flags | cas_column | expire_time_column | unique_idx_name_on_key |
+------+-----------+-----------+-------------+----------------------------------+-------+------------+--------------------+------------------------+
| aaa  | test      | demo_test | c1          | c2                               | c3    | c4         | c5                 | PRIMARY                |
| bbb  | test      | multicol  | country     | population,area_sq_km,drive_side | c3    | c4         | c5                 | PRIMARY                |
+------+-----------+-----------+-------------+----------------------------------+-------+------------+--------------------+------------------------+
2 rows in set (0.01 sec)</pre><p>
          After running the script, the data is in the
          <code class="literal">multicol</code> table, available for traditional
          MySQL <a class="link" href="glossary.html#glos_query" title="query">queries</a> or
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements:
        </p><pre class="programlisting">mysql: use test;
Database changed

mysql: select * from multicol;
+---------+------------+------------+------------+------+------+------+
| country | population | area_sq_km | drive_side | c3   | c4   | c5   |
+---------+------------+------------+------------+------+------+------+
| Canada  | 34820000   | 9984670    | R          |    0 |   11 |    0 |
| China   | 1347350000 | 9640821    | R          |    0 |   20 |    0 |
| Denmark | 5543453    | 43094      | R          |    0 |   16 |    0 |
| India   | 1210193422 | 3287263    | L          |    0 |   19 |    0 |
| Ireland | 6399152    | 84421      | L          |    0 |   13 |    0 |
| Mexico  | 113910608  | 1972550    | R          |    0 |   15 |    0 |
| Norway  | 5002942    | 385252     | R          |    0 |   17 |    0 |
| UAE     | 8264070    | 83600      | R          |    0 |   18 |    0 |
| UK      | 62262000   | 243610     | L          |    0 |   14 |    0 |
| USA     | 314242000  | 9826675    | R          |    0 |   12 |    0 |
+---------+------------+------------+------------+------+------+------+
10 rows in set (0.00 sec)

mysql: desc multicol;
+------------+---------------------+------+-----+---------+-------+
| Field      | Type                | Null | Key | Default | Extra |
+------------+---------------------+------+-----+---------+-------+
| country    | varchar(128)        | NO   | PRI |         |       |
| population | varchar(10)         | YES  |     | NULL    |       |
| area_sq_km | varchar(9)          | YES  |     | NULL    |       |
| drive_side | varchar(1)          | YES  |     | NULL    |       |
| c3         | int(11)             | YES  |     | NULL    |       |
| c4         | bigint(20) unsigned | YES  |     | NULL    |       |
| c5         | int(11)             | YES  |     | NULL    |       |
+------------+---------------------+------+-----+---------+-------+
7 rows in set (0.01 sec)</pre><p>
          Allow sufficient size to hold all necessary digits, decimal
          points, sign characters, leading zeros, and so on when
          defining the length for columns that will be treated as
          numbers. Too-long values in a string column such as a
          <code class="literal">VARCHAR</code> are truncated by removing some
          characters, which might produce a nonsensical numeric value.
        </p><p>
          We can produce reports through SQL queries, doing calculations
          and tests across any columns, not just the
          <code class="literal">country</code> key column. (Because these examples
          use data from only a few countries, the numbers are for
          illustration purposes only.) Here, we find the average
          population of countries where people drive on the right, and
          the average size of countries whose names start with
          <span class="quote">“<span class="quote">U</span>”</span>:
        </p><pre class="programlisting">mysql: select avg(population) from multicol where drive_side = 'R';
+-------------------+
| avg(population)   |
+-------------------+
| 261304724.7142857 |
+-------------------+
1 row in set (0.00 sec)

mysql: select sum(area_sq_km) from multicol where country like 'U%';
+-----------------+
| sum(area_sq_km) |
+-----------------+
|        10153885 |
+-----------------+
1 row in set (0.00 sec)</pre><p>
          Because the <code class="literal">population</code> and
          <code class="literal">area_sq_km</code> columns store character data
          rather than strongly typed numeric data, functions such as
          <code class="literal">avg()</code> and <code class="literal">sum()</code> work by
          converting each value to a number first. This approach
          <span class="emphasis"><em>does not work</em></span> for operators such as
          <code class="literal">&lt;</code> or <code class="literal">&gt;</code>: for
          example, when comparing character-based values, <code class="literal">9
          &gt; 1000</code>, which is not you expect from a clause
          such as <code class="literal">ORDER BY population DESC</code>. For the
          most accurate type treatment, perform queries against views
          that cast numeric columns to the appropriate types. This
          technique lets you issue very simple <code class="literal">SELECT
          *</code> queries from your database applications, while
          ensuring that all casting, filtering, and ordering is correct.
          Here, we make a view that can be queried to find the top 3
          countries in descending order of population, with the results
          always reflecting the latest data from the
          <code class="literal">multicol</code> table, and with the population and
          area figures always treated as numbers:
        </p><pre class="programlisting">mysql: create view populous_countries as
  select
    country,
    cast(population as unsigned integer) population,
    cast(area_sq_km as unsigned integer) area_sq_km,
    drive_side from multicol
  order by cast(population as unsigned integer) desc
  limit 3;
Query OK, 0 rows affected (0.01 sec)

mysql: select * from populous_countries;
+---------+------------+------------+------------+
| country | population | area_sq_km | drive_side |
+---------+------------+------------+------------+
| China   | 1347350000 |    9640821 | R          |
| India   | 1210193422 |    3287263 | L          |
| USA     |  314242000 |    9826675 | R          |
+---------+------------+------------+------------+
3 rows in set (0.00 sec)

mysql: desc populous_countries;
+------------+---------------------+------+-----+---------+-------+
| Field      | Type                | Null | Key | Default | Extra |
+------------+---------------------+------+-----+---------+-------+
| country    | varchar(128)        | NO   |     |         |       |
| population | bigint(10) unsigned | YES  |     | NULL    |       |
| area_sq_km | int(9) unsigned     | YES  |     | NULL    |       |
| drive_side | varchar(1)          | YES  |     | NULL    |       |
+------------+---------------------+------+-----+---------+-------+
4 rows in set (0.02 sec)</pre>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-porting-memcached"></a>14.2.9.5.2. Adapting an Existing <span class="command"><strong>memcached</strong></span> Application for the
Integrated <span class="command"><strong>memcached</strong></span> Daemon</h5>
</div>
</div>
</div>
<p>
        Consider these aspects of MySQL and <code class="literal">InnoDB</code>
        tables when adapting an existing <span class="command"><strong>memcached</strong></span>
        application to use the MySQL integration:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you have key values longer than a few bytes, you might
            find it more efficient to use a numeric auto-increment
            column for the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
            key</a> in the <code class="literal">InnoDB</code> table, and
            create a unique
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary index</a>
            on the column holding the <span class="command"><strong>memcached</strong></span> key
            values. This is because <code class="literal">InnoDB</code> performs
            best for large-scale insertions if the primary key values
            are added in sorted order (as they are with auto-increment
            values), and the primary key values are duplicated in each
            secondary index, which can take up unnecessary space when
            the primary key is a long string value.
          </p></li><li class="listitem"><p>
            If you store several different classes of information in
            <span class="command"><strong>memcached</strong></span>, you might set up a separate
            <code class="literal">InnoDB</code> table for each kind of data.
            Define additional table identifiers in the
            <code class="literal">innodb_memcache.containers</code> table, and use
            the notation
            <code class="literal">@@<em class="replaceable"><code>table_id</code></em>.<em class="replaceable"><code>key</code></em></code>
            to store or retrieve items from different tables. Physically
            dividing the items lets you tune the characteristics of each
            table for best space utilization, performance, and
            reliability. For example, you might enable
            <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> for a
            table that holds blog posts, but not for one that holds
            thumbnail images. You might back up one table more
            frequently than another because it holds critical data. You
            might create additional
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
            indexes</a> on tables that are frequently used to
            generate reports through SQL.
          </p></li><li class="listitem"><p>
            Preferably, set up a stable set of table definitions for use
            with the <span class="command"><strong>memcached</strong></span> interface and leave
            them in place permanently. Changes to the
            <code class="literal">containers</code> table take effect the next
            time that table is queried. The entries in that table are
            processed at startup, and are consulted whenever an
            unrecognized table ID is requested by the
            <code class="literal">@@</code> notation. Thus, new entries are
            visible as soon as you try to use the associated table ID,
            but changes to existing entries require a server restart
            before they take effect.
          </p></li><li class="listitem"><p>
            When you use the default caching policy
            <code class="literal">innodb_only</code>, your calls to
            <code class="literal">add()</code>, <code class="literal">set()</code>,
            <code class="literal">incr()</code>, and so on can succeed but still
            trigger debugging messages such as <code class="literal">while expecting
            'STORED', got unexpected response 'NOT_STORED</code>.
            This is because in the <code class="literal">innodb_only</code>
            configuration, new and updated values are sent directly to
            the <code class="literal">InnoDB</code> table without being saved in
            the memory cache.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-tuning"></a>14.2.9.5.3. Tuning Performance of the InnoDB memcached Plugin</h5>

</div>

</div>

</div>
<p>
        Because using <code class="literal">InnoDB</code> in combination with
        <span class="command"><strong>memcached</strong></span> involves writing all data to disk,
        whether immediately or sometime later, understand that raw
        performance is expected to be somewhat lower than using
        <span class="command"><strong>memcached</strong></span> by itself. Focus your tuning goals
        for the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
        plugin on achieving higher performance than equivalent SQL
        operations.
      </p><p>
        Benchmarks suggest that both queries and
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations (inserts,
        updates, and deletes) are faster going through the
        <span class="command"><strong>memcached</strong></span> interface than with traditional
        SQL. DML operations typically see a larger speedup. Thus, the
        types of applications you might adapt to use the
        <span class="command"><strong>memcached</strong></span> interface first are those that are
        write-intensive. You might also use MySQL as a data store for
        types of write-intensive applications that formerly used some
        fast, lightweight mechanism where reliability was not a
        priority.
      </p><h6><a name="idp92376784"></a>
        Adapting SQL Queries
      </h6><p>
        The types of queries that are most suited to the simple
        <code class="literal">GET</code> request style are those with a single
        clause, or a set of <code class="literal">AND</code> conditions, in the
        <code class="literal">WHERE</code> clause:
      </p><pre class="programlisting">SQL:
select col from tbl where key = 'key_value';

memcached:
GET key_value

SQL:
select col from tbl where col1 = val1 and col2 = val2 and col3 = val3;

memcached:
# Since you must always know these 3 values to look up the key,
# combine them into a unique string and use that as the key
# for all ADD, SET, and GET operations.
key_value = val1 + ":" + val2 + ":" + val3
GET key_value

SQL:
select 'key exists!' from tbl
  where exists (select col1 from tbl where key = 'key_value') limit 1;

memcached:
# Test for existence of key by asking for its value and checking if the call succeeds,
# ignoring the value itself. For existence checking, you typically only store a very
# short value such as "1".
GET key_value
</pre><h6><a name="idp92381248"></a>
        Taking Advantage of System Memory
      </h6><p>
        For best performance, deploy the <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span> plugin on machines that are
        configured like typical database servers: in particular, with
        the majority of system RAM devoted to the
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> through the
        <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        configuration option. For systems with multi-gigabyte buffer
        pools, consider raising the value of the
        <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        configuration option for maximum throughput when most operations
        involve data already cached in memory.
      </p><h6><a name="idp92387072"></a>
        Reducing Redundant I/O
      </h6><p>
        <code class="literal">InnoDB</code> has a number of settings that let you
        choose the balance between high reliability in case of a crash,
        and the amount of I/O overhead during high write workloads. For
        example, consider setting the configuration options
        <a class="link" href="storage-engines.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite=0</code></a> and
        <a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit=2</code></a>.
        Measure the performance with different settings for the
        <a class="link" href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> option. If
        the <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a> is not
        turned on for the server, use the setting
        <a class="link" href="storage-engines.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa=0</code></a>.
      </p><p>
        For other ways to reduce or tune I/O for table operations, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7. Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
      </p><h6><a name="idp92394224"></a>
        Reducing Transactional Overhead
      </h6><p>
        The default value of 1 for the configuration options
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
        and
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        is intended for maximum reliability of results and safety of
        stored or updated data.
      </p><p>
        Depending on the type of application, you might increase one or
        both of these settings to reduce the overhead of frequent
        <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> operations. On a busy
        system, you might increase
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>,
        knowing that changes to the data made through SQL might not
        become visible to <span class="command"><strong>memcached</strong></span> immediately (that
        is, until <em class="replaceable"><code>N</code></em> more
        <code class="literal">get</code> operations were processed). When
        processing data where every write operation must be reliably
        stored, you would leave
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        set to 1. You might increase it when processing large numbers of
        updates intended to only be used for statistical analysis, where
        it is not critical if the last <em class="replaceable"><code>N</code></em>
        updates are lost in case of a crash.
      </p><p>
        For example, imagine a system that monitors traffic crossing a
        busy bridge, recording approximately 100,000 vehicles each day.
        If the application simply counts different types of vehicles to
        analyze traffic patterns, it might change
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        from <code class="literal">1</code> to <code class="literal">100</code>, reducing
        the I/O overhead for commit operations by 99%. In case of an
        unexpected outage, only a maximum of 100 records could be lost,
        which might be an acceptable margin of error. If instead the
        application was doing automated toll collection for each car, it
        would keep
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        set to <code class="literal">1</code> to ensure that every toll record was
        immediately saved to disk.
      </p><p>
        Because of the way <code class="literal">InnoDB</code> organizes the
        <span class="command"><strong>memcached</strong></span> key values on disk, if you have a
        large number of keys to create, it can be faster to sort all the
        data items by the key value in your application and
        <code class="literal">add</code> them in sorted order, rather than
        creating them in arbitrary order.
      </p><p>
        The <span class="command"><strong>memslap</strong></span> command, which is part of the
        regular <span class="command"><strong>memcached</strong></span> distribution but not
        included with the MySQL server, can be useful for benchmarking
        different configurations. It can also be used to generate sample
        key/value pairs that you can use in your own benchmarking. See
        <a class="xref" href="ha-overview.html#ha-memcached-interfaces-libmemcached-utilities" title="15.6.3.3.6. libmemcached Command-Line Utilities">Section 15.6.3.3.6, “<span class="command"><strong>libmemcached</strong></span> Command-Line Utilities”</a>
        for details.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-txn"></a>14.2.9.5.4. Controlling Transactional Behavior of the InnoDB memcached Plugin</h5>

</div>

</div>

</div>
<p>
        Unlike with the traditional <span class="command"><strong>memcached</strong></span>, with
        the <code class="literal">InnoDB</code> + <span class="command"><strong>memcached</strong></span>
        combination you can control how <span class="quote">“<span class="quote">durable</span>”</span> are the
        data values produced through calls to <code class="literal">add</code>,
        <code class="literal">set</code>, <code class="literal">incr</code>, and so on.
        Because MySQL places a high priority on durability and
        consistency of data, by default all data written through the
        <span class="command"><strong>memcached</strong></span> interface is always stored to disk,
        and calls to <code class="literal">get</code> always return the most
        recent value from disk. Although this default setting does not
        give the highest possible raw performance, it is still very fast
        compared to the traditional SQL interface for
        <code class="literal">InnoDB</code> tables.
      </p><p>
        As you gain experience with this feature, you can make the
        decision to relax the durability settings for non-critical
        classes of data, at the risk of possibly losing some updated
        values in case of an outage, or returning data that is slightly
        out-of-date.
      </p><h6><a name="idp92425856"></a>
        Frequency of Commits
      </h6><p>
        One tradeoff between durability and raw performance is how
        frequently new and changed data is
        <a class="link" href="glossary.html#glos_commit" title="commit">committed</a>. If the data is
        critical, you want it to be committed immediately so that it is
        safe in case of any crash or outage. If the data is less
        critical, such as counters that would be reset after a crash, or
        debugging or logging data where you could afford to lose a few
        seconds worth, you might prefer the higher raw throughput that
        comes with less frequent commits.
      </p><p>
        When a <span class="command"><strong>memcached</strong></span> operation causes an insert,
        update, or delete in the underlying <code class="literal">InnoDB</code>
        table, that change might be committed to the underlying table
        instantly (if
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size=1</code></a>)
        or some time later (if that configuration option value is
        greater than 1). In either case, the change cannot be rolled
        back. If you increase the value of
        <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size=1</code></a>
        to avoid high I/O overhead during busy times, commits could
        become very infrequent when the workload decreases. As a safety
        measure, a background thread automatically commits changes made
        through the <span class="command"><strong>memcached</strong></span> API at regular
        intervals. The interval is controlled by the
        <a class="link" href="storage-engines.html#sysvar_innodb_api_bk_commit_interval"><code class="literal">innodb_api_bk_commit_interval</code></a>
        configuration option, and by default is 5 seconds.
      </p><p>
        When a <span class="command"><strong>memcached</strong></span> operation causes an insert
        or update in the underlying <code class="literal">InnoDB</code> table, the
        changed data is immediately visible to other
        <span class="command"><strong>memcached</strong></span> requests because the new value
        remains in the memory cache, even if it is not committed yet on
        the MySQL side.
      </p><h6><a name="idp92436592"></a>
        Transaction Isolation
      </h6><p>
        When a <span class="command"><strong>memcached</strong></span> operation such as
        <code class="literal">get</code> or <code class="literal">incr</code> causes a query
        or DML operation in the underlying <code class="literal">InnoDB</code>
        table, you can control whether it sees the very latest data
        written to the table, only data that has been committed, or
        other variations of transaction
        <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a>. You
        control this feature through the
        <a class="link" href="storage-engines.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a>
        configuration option. The numeric values specified with this
        option correspond to the familiar isolation level names such as
        <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>. See the
        description of the
        <a class="link" href="storage-engines.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a> option for
        the full list.
      </p><p>
        The stricter the isolation level, the more certain you can be
        that the data you retrieve will not be rolled back or changed
        suddenly so that a subsequent query sees a different value. But
        that strictness comes with greater
        <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> overhead that can
        cause waits. For a NoSQL-style application that does not use
        long-running transactions, you can typically stay with the
        default isolation level or switch to a less strict one.
      </p><h6><a name="idp92445664"></a>
        Allowing or Disallowing DDL
      </h6><p>
        By default, you can perform <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a>
        operations such as <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> on
        the tables being used by the <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span> plugin. To avoid potential
        slowdowns when these tables are being used for high-throughput
        applications, you can disable DDL operations on these tables by
        turning on the
        <a class="link" href="storage-engines.html#sysvar_innodb_api_enable_mdl"><code class="literal">innodb_api_enable_mdl</code></a>
        configuration option at startup. This option is less appropriate
        when you are accessing the same underlying tables through both
        the <span class="command"><strong>memcached</strong></span> interface and SQL, because it
        blocks <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements on
        the tables, which could be important for configuring the system
        to run reporting queries.
      </p><h6><a name="idp92453264"></a>
        Data Stored on Disk, in Memory, or Both
      </h6><p>
        Table <code class="literal">innodb_memcache.cache_policies</code>
        specifies whether to store data written through the
        <span class="command"><strong>memcached</strong></span> on disk
        (<code class="literal">innodb_only</code>, the default); to store the data
        in memory only, as in the traditional
        <span class="command"><strong>memcached</strong></span> (<code class="literal">cache-only</code>); or
        both (<code class="literal">caching</code>).
      </p><p>
        With the <code class="literal">caching</code> setting, if
        <span class="command"><strong>memcached</strong></span> cannot find a key in memory, it
        searches for the value in an <code class="literal">InnoDB</code> table.
        Values returned from <code class="literal">get</code> calls under the
        <code class="literal">caching</code> setting could be out-of-date, if they
        were updated on disk in the <code class="literal">InnoDB</code> table but
        not yet expired from the memory cache.
      </p><p>
        The caching policy can be set independently for
        <code class="literal">get</code>, <code class="literal">set</code> (including
        <code class="literal">incr</code> and <code class="literal">decr</code>),
        <code class="literal">delete</code>, and <code class="literal">flush</code>
        operations. For example:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            You might allow <code class="literal">get</code> and
            <code class="literal">set</code> operations to query or update a table
            and the <span class="command"><strong>memcached</strong></span> memory cache at the
            same time (through the <code class="literal">caching</code> setting),
            while making <code class="literal">delete</code>,
            <code class="literal">flush</code>, or both operate only on the
            in-memory copy (through the <code class="literal">cache_only</code>
            setting). That way, deleting or flushing an item just
            expires it from the cache, and the latest value is returned
            from the <code class="literal">InnoDB</code> table the next time the
            item is requested.
</p></li></ul>
</div>
<pre class="programlisting">
mysql&gt; desc innodb_memcache.cache_policies;
+---------------+-------------------------------------------------------+------+-----+---------+-------+
| Field         | Type                                                  | Null | Key | Default | Extra |
+---------------+-------------------------------------------------------+------+-----+---------+-------+
| policy_name   | varchar(40)                                           | NO   | PRI | NULL    |       |
| get_policy    | enum('innodb_only','cache_only','caching','disabled') | NO   |     | NULL    |       |
| set_policy    | enum('innodb_only','cache_only','caching','disabled') | NO   |     | NULL    |       |
| delete_policy | enum('innodb_only','cache_only','caching','disabled') | NO   |     | NULL    |       |
| flush_policy  | enum('innodb_only','cache_only','caching','disabled') | NO   |     | NULL    |       |
+---------------+-------------------------------------------------------+------+-----+---------+-------+

mysql&gt; select * from innodb_memcache.cache_policies;
+--------------+-------------+-------------+---------------+--------------+
| policy_name  | get_policy  | set_policy  | delete_policy | flush_policy |
+--------------+-------------+-------------+---------------+--------------+
| cache_policy | innodb_only | innodb_only | innodb_only   | innodb_only  |
+--------------+-------------+-------------+---------------+--------------+

mysql&gt; update innodb_memcache.cache_policies set set_policy = 'caching'
    -&gt; where policy_name = 'cache_policy';
</pre><p>
        The <code class="literal">cache_policies</code> values are only read at
        startup, and are tightly integrated with the operation of the
        <span class="command"><strong>memcached</strong></span> plugin. After changing any of the
        values in this table, uninstall the plugin and reinstall it:
      </p><pre class="programlisting">
mysql&gt; uninstall plugin daemon_memcached;
Query OK, 0 rows affected (2.00 sec)
mysql&gt; install plugin daemon_memcached soname "libmemcached.so";
Query OK, 0 rows affected (0.00 sec)
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-dml"></a>14.2.9.5.5. Adapting DML Statements to <span class="command"><strong>memcached</strong></span> Operations</h5>

</div>

</div>

</div>
<p>
        Benchmarks suggest that the <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span> plugin speeds up
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations (inserts,
        updates, and deletes) more than it speeds up queries. You might
        focus your initial development efforts on write-intensive
        applications that are I/O-bound, and look for opportunities to
        use MySQL for new kinds of write-intensive applications.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><pre class="programlisting">INSERT INTO t1 (key,val) VALUES (<em class="replaceable"><code>some_key</code></em>,<em class="replaceable"><code>some_value</code></em>);
SELECT val FROM t1 WHERE key = <em class="replaceable"><code>some_key</code></em>;
UPDATE t1 SET val = <em class="replaceable"><code>new_value</code></em> WHERE key = <em class="replaceable"><code>some_key</code></em>;
UPDATE t1 SET val = val + x WHERE key = <em class="replaceable"><code>some_key</code></em>;
DELETE FROM t1 WHERE key = <em class="replaceable"><code>some_key</code></em>;
</pre><p>
            Single-row DML statements are the most straightforward kinds
            of statements to turn into <code class="literal">memcached</code>
            operations: <code class="literal">INSERT</code> becomes
            <code class="literal">add</code>, <code class="literal">UPDATE</code> becomes
            <code class="literal">set</code>, <code class="literal">incr</code> or
            <code class="literal">decr</code>, and <code class="literal">DELETE</code>
            becomes <code class="literal">delete</code>. When issued through the
            <span class="command"><strong>memcached</strong></span> interface, these operations are
            guaranteed to affect only 1 row because
            <em class="replaceable"><code>key</code></em> is unique within the table.
          </p><p>
            In the preceding SQL examples, <code class="literal">t1</code> refers
            to the table currently being used by the
            <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
            plugin based on the configuration settings in the
            <code class="literal">innodb_memcache.containers</code> table,
            <code class="literal">key</code> refers to the column listed under
            <code class="literal">key_columns</code>, and <code class="literal">val</code>
            refers to the column listed under
            <code class="literal">value_columns</code>.
          </p></li><li class="listitem"><pre class="programlisting">TRUNCATE TABLE t1;
DELETE FROM t1;</pre><p>
            Corresponds to the <code class="literal">flush_all</code> operation,
            when <code class="literal">t1</code> is configured as the table for
            <span class="command"><strong>memcached</strong></span> operations as in the previous
            step. Removes all the rows in the table.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-memcached-ddl"></a>14.2.9.5.6. Performing DML and DDL Statements on the Underlying
<code class="literal">InnoDB</code> Table</h5>
</div>
</div>
</div>
<p>
        You can access the InnoDB table (by default,
        <code class="literal">test.demo_test</code>) through the standard SQL
        interfaces. However, there are some restrictions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When query a table through SQL that is also being accessed
            through the <span class="command"><strong>memcached</strong></span> interface, remember
            that <span class="command"><strong>memcached</strong></span> operations can be
            configured to be committed periodically rather than after
            every write operation. This behavior is controlled by the
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            option. If this option is set to a value greater than 1, use
            <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a> queries
            to find the just-inserted rows:
          </p><pre class="programlisting">
mysql&gt; set session TRANSACTION ISOLATION LEVEL read uncommitted;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; select * from demo_test;
+------+------+------+------+-----------+------+------+------+------+------+------+
| cx   | cy   | c1   | cz   | c2        | ca   | CB   | c3   | cu   | c4   | C5   |
+------+------+------+------+-----------+------+------+------+------+------+------+
| NULL | NULL | a11  | NULL | 123456789 | NULL | NULL |   10 | NULL |    3 | NULL |
+------+------+------+------+-----------+------+------+------+------+------+------+
1 row in set (0.00 sec)
</pre></li><li class="listitem"><p>
            To modify a table through SQL that is also being accessed
            through the <span class="command"><strong>memcached</strong></span> interface, remember
            that <span class="command"><strong>memcached</strong></span> operations can be
            configured to be start a new transaction periodically rather
            than for every read operation. This behavior is controlled
            by the
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            option. If this option is set to a value greater than 1, ...
          </p></li><li class="listitem"><p>
            The <code class="literal">InnoDB</code> table is locked IS (shared
            intention) or IX (exclusive intentional) for all operations
            in a transaction. If you increase
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            and
            <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            substantially from their default value of 1, the table is
            most likely intentionally locked between each operation,
            preventing you from running
            <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> statements on the table.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-replication"></a>14.2.9.6. Using the InnoDB memcached Plugin with Replication</h4>

</div>

</div>

</div>
<p>
      Because the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
      daemon plugin supports the MySQL
      <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>, any updates
      made on a <a class="link" href="glossary.html#glos_master_server" title="master server">master server</a>
      through the <span class="command"><strong>memcached</strong></span> interface can be
      replicated for backup, balancing intensive read workloads, and
      high availability. All <code class="literal">memcached</code> commands are
      supported for binlogging.
    </p><p>
      You do not need to set up the <code class="literal">InnoDB</code>
      <span class="command"><strong>memcached</strong></span> plugin on the
      <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave servers</a>. In this
      configuration, the primary advantage is increased write throughput
      on the master. The speed of the replication mechanism is not
      affected.
    </p><p>
      The following sections show how to use the binlog capability, to
      use the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
      plugin along with MySQL replication. It assumes you have already
      done the basic setup described in
      <a class="xref" href="storage-engines.html#innodb-memcached-setup" title="14.2.9.3. Getting Started with InnoDB Memcached Plugin">Section 14.2.9.3, “Getting Started with InnoDB Memcached Plugin”</a>.
</p>
<h5><a name="idp92543232"></a>
      Enable InnoDB Memcached Binary Log with <code class="literal">innodb_api_enable_binlog</code>:
</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          To use the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin with the MySQL
          <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>, enable the
          <a class="link" href="storage-engines.html#sysvar_innodb_api_enable_binlog"><code class="literal">innodb_api_enable_binlog</code></a>
          configuration option on the
          <a class="link" href="glossary.html#glos_master_server" title="master server">master server</a>. This
          option can only be set at server boot time. You must also
          enable the MySQL binary log on the master server with the
          <a class="link" href="replication.html#sysvar_log_bin"><code class="literal">--log-bin</code></a> option. You can add
          these options to your server configuration file such as
          <code class="filename">my.cnf</code>, or on the
          <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command line.
        </p><pre class="programlisting">mysqld ... --log-bin -–innodb_api_enable_binlog=1</pre></li><li class="listitem"><p>
          Then configure your master and slave server, as described in
          <a class="xref" href="replication.html#replication-howto" title="16.1.1. How to Set Up Replication">Section 16.1.1, “How to Set Up Replication”</a>.
        </p></li><li class="listitem"><p>
          Use <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to create a master data
          snapshot, and sync it to the slave server.
        </p><pre class="programlisting">
master shell: mysqldump --all-databases --lock-all-tables &gt; dbdump.db
slave shell: mysql &lt; dbdump.db
</pre></li><li class="listitem"><p>
          On the master server, issue <code class="literal">show master
          status</code> to obtain the Master Binary Log Coordinates:
        </p><pre class="programlisting">mysql&gt; show master status;</pre></li><li class="listitem"><p>
          On the slave server, use a <code class="literal">change master to</code>
          statement to set up a slave server with the above coordinates:
        </p><pre class="programlisting">
mysql&gt; CHANGE MASTER TO
       MASTER_HOST='localhost',
       MASTER_USER='root',
       MASTER_PASSWORD='',
       MASTER_PORT = 13000,
       MASTER_LOG_FILE='0.000001,
       MASTER_LOG_POS=114;
</pre></li><li class="listitem"><p>
          Then start the slave:
        </p><pre class="programlisting">
mysql&gt; start slave;
</pre><p>
          If the error log prints output similar to the following, the
          slave is ready for replication:
        </p><pre class="programlisting">111002 18:47:15 [Note] Slave I/O thread: connected to master 'root@localhost:13000',
replication started in log '0.000001' at position 114</pre></li></ul>
</div>
<h5><a name="idp92565536"></a>
      Test with the <span class="command"><strong>memcached</strong></span> telnet interface:
</h5>
<p>
      To test the server with the above replication setup, we use the
      <span class="command"><strong>memcached</strong></span> telnet interface, and also query the
      master and slave servers using SQL to verify the results.
    </p><p>
      In our configuration setup SQL, one example table
      <code class="literal">demo_test</code> is created in the
      <code class="literal">test</code> database for use by
      <span class="command"><strong>memcached</strong></span>. We will use this default table for
      the demonstrations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Use <code class="literal">set</code> to insert a record, key
          <code class="literal">test1</code>, value <code class="literal">t1</code>, and
          flag <code class="literal">10</code>:
        </p><pre class="programlisting">telnet 127.0.0.1 11211
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
set test1 10 0 2
t1
STORED</pre></li></ul>
</div>
<p>
      In the master server, you can see that the row is inserted.
      <code class="literal">c1</code> maps to the key, <code class="literal">c2</code> maps
      to the value, <code class="literal">c3</code> is the flag,
      <code class="literal">c4</code> is the <code class="literal">cas</code> value, and
      <code class="literal">c5</code> is the expiration.
    </p><pre class="programlisting">
mysql&gt; select * from test.demo_test;
</pre>
<div class="informaltable">
<table summary=' Results of the query "select * from test.demo_test" on
        the master server, to show data that is inserted through a
memcached API call. ' border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">c1</th><th scope="col">c2</th><th scope="col">c3</th><th scope="col">c4</th><th scope="col">c5</th></tr></thead><tbody><tr><td scope="row">test1</td><td>t1</td><td>10</td><td>2</td><td>0</td></tr></tbody></table>
</div>
<pre class="programlisting">1 row in set (0.00 sec)</pre><p>
      In the slave server, you will see the same record is inserted by
      replication:
    </p><pre class="programlisting">
mysql&gt; select * from test.demo_test;
</pre>
<div class="informaltable">
<table summary=' Results of the query "select * from test.demo_test" to
        demonstrate that data inserted through a memcached API call is
propagated from a master server to a slave server. ' border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">c1</th><th scope="col">c2</th><th scope="col">c3</th><th scope="col">c4</th><th scope="col">c5</th></tr></thead><tbody><tr><td scope="row">test1</td><td>t1</td><td>10</td><td>2</td><td>0</td></tr></tbody></table>
</div>
<pre class="programlisting">1 row in set (0.00 sec)</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Use <code class="literal">set</code> command to update the key
          <code class="literal">test1</code> to a new value
          <code class="literal">new</code>:
</p></li></ul>
</div>
<pre class="programlisting">Connected to 127.0.0.1.
Escape character is '^]'.
set test1 10 0 3
new
STORED</pre><p>
      From the slave server, the update is replicated (notice the
      <code class="literal">cas</code> value also updated):
    </p><pre class="programlisting">
mysql&gt; select * from test.demo_test;
</pre>
<div class="informaltable">
<table summary=' Results of the query "select * from test.demo_test" to
        demonstrate that data updated through a memcached API call is
propagated from a master server to a slave server. ' border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">c1</th><th scope="col">c2</th><th scope="col">c3</th><th scope="col">c4</th><th scope="col">c5</th></tr></thead><tbody><tr><td scope="row">test1</td><td>new</td><td>10</td><td>3</td><td>0</td></tr></tbody></table>
</div>
<pre class="programlisting">1 row in set (0.00 sec)</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Delete the record with a <code class="literal">delete</code> command:
</p></li></ul>
</div>
<pre class="programlisting">Connected to 127.0.0.1.
Escape character is '^]'.
delete test1
DELETED</pre><p>
      When the delete is replicated to the slave, the record on the
      slave is also deleted:
    </p><pre class="programlisting">
mysql&gt; select * from test.demo_test;
Empty set (0.00 sec)
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Truncate the table with the <code class="literal">flush_all</code>
          command.
</p></li></ul>
</div>
<p>
      First, insert two records by telnetting to the master server:
    </p><pre class="programlisting">Connected to 127.0.0.1.
Escape character is '^]'
set test2 10 0 5
again
STORED
set test3 10 0 6
again1
STORED</pre><p>
      In the slave server, confirm these two records are replicated:
    </p><pre class="programlisting">
mysql&gt; select * from test.demo_test;
</pre>
<div class="informaltable">
<table summary=' Results of the query "select * from test.demo_test" to
        demonstrate data on the slave server prior to a FLUSH_ALL
memcached call on the master server. ' border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">c1</th><th scope="col">c2</th><th scope="col">c3</th><th scope="col">c4</th><th scope="col">c5</th></tr></thead><tbody><tr><td scope="row">test2</td><td>again</td><td>10</td><td>5</td><td>0</td></tr><tr><td scope="row">test3</td><td>again1</td><td>10</td><td>6</td><td>0</td></tr></tbody></table>
</div>
<pre class="programlisting">2 rows in set (0.00 sec)</pre><p>
      Call <code class="literal">flush_all</code> in the telnet interface to
      truncate the table:
    </p><pre class="programlisting">Connected to 127.0.0.1.
Escape character is '^]'.
flush_all
OK</pre><p>
      Then check that the truncation operation is replicated on the
      slave server:
    </p><pre class="programlisting">
mysql&gt; select * from test.demo_test;
Empty set (0.00 sec)
</pre><p>
      All <code class="literal">memcached</code> commands are supported in terms
      of replication.
</p>
<h5><a name="idp92645504"></a>
      Notes for the InnoDB Memcached Binlog:
</h5>
<p>
      Binlog Format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Most <span class="command"><strong>memcached</strong></span> operations are mapped to
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements (analogous to
          insert, delete, update). Since there is no actual SQL
          statement being processed by the MySQL server, all
          <span class="command"><strong>memcached</strong></span> commands (except for
          <code class="literal">flush_all</code>) use Row-Based Replication (RBR)
          logging. This is independent of any server
          <a class="link" href="replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a> setting.
        </p></li><li class="listitem"><p>
          The <span class="command"><strong>memcached</strong></span> <code class="literal">flush_all</code>
          command is mapped to the <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE
          TABLE</code></a> command. Since
          <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> commands can only use
          statement-based logging, this <code class="literal">flush_all</code>
          command is replicated by sending a
          <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> statement.
</p></li></ul>
</div>
<p>
      Transactions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The concept of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> has not
          typically been part of <span class="command"><strong>memcached</strong></span>
          applications. We use
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
          and
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
          to control the read and write transaction batch size for
          performance considerations. These settings do not affect
          replication: each SQL operation on the underlying table is
          replicated right after successful completion.
        </p></li><li class="listitem"><p>
          The default value of
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
          is 1, so each <span class="command"><strong>memcached</strong></span> write operation is
          committed immediately. This default setting incurs a certain
          amount of performance overhead, to avoid any inconsistency in
          the data visible on the master and slave servers. The
          replicated records will always be available immediately on the
          slave server. If you set
          <code class="literal">daemon_memcached_w_batch_size</code> greater than
          1, records inserted or updated through the
          <span class="command"><strong>memcached</strong></span> interface are not immediately
          visible on the master server; to view these records on the
          master server before they are committed, issue <code class="literal">set
          transaction isolation level read uncommitted</code>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-internals"></a>14.2.9.7. Internals of the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<h5><a name="idp92668480"></a>
      InnoDB API for the InnoDB memcached Plugin
</h5>
<p>
      The <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> engine
      accesses <code class="literal">InnoDB</code> through
      <code class="literal">InnoDB</code> APIs. Most of the APIs are directly
      adopted from embedded <code class="literal">InnoDB</code>.
      <code class="literal">InnoDB</code> API functions are passed to
      <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> as
      <span class="quote">“<span class="quote">callback functions</span>”</span>. <code class="literal">InnoDB</code> API
      functions access the <code class="literal">InnoDB</code> table directly, and
      are mostly DML operations except for the
      <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> operation.
    </p><p>
      All <span class="command"><strong>memcached</strong></span> commands, listed below, are
      implemented through the <code class="literal">InnoDB</code>
      <span class="command"><strong>memcached</strong></span> API. The following table outlines how
      each <span class="command"><strong>memcached</strong></span> command is mapped to a DML
      operation.

</p>
<div class="table">
<a name="idp92681136"></a><p class="title"><b>Table 14.7. memcached Commands and Associated DML Operation</b></p>
<div class="table-contents">
<table summary="memcached Commands and Associated DML Operation" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th scope="col">memcached Command</th><th scope="col">DML Operation</th></tr></thead><tbody><tr><td scope="row">get</td><td>a read/fetch command</td></tr><tr><td scope="row">set</td><td>a search followed by an insertion or update (depending on whether or not
                a key exists)</td></tr><tr><td scope="row">add</td><td>a search followed by an insertion or update</td></tr><tr><td scope="row">replace</td><td>a search followed by an update</td></tr><tr><td scope="row">append</td><td>a search followed by an update (appends data to the result before
                update)</td></tr><tr><td scope="row">prepend</td><td>a search followed by an update (prepends data to the result before
update)</td></tr><tr><td scope="row">incr</td><td>a search followed by an update</td></tr><tr><td scope="row">decr</td><td>a search followed by an update</td></tr><tr><td scope="row">delete</td><td>a search followed by a deletion</td></tr><tr><td scope="row">flush_all</td><td>truncate table</td></tr></tbody></table>
</div>

</div>
<h5><a name="idp92699328"></a>
      Underlying Tables Used by the InnoDB memcached Plugin
</h5>
<a class="indexterm" name="idp92699792"></a><a class="indexterm" name="idp92700880"></a><a class="indexterm" name="idp92701952"></a><a class="indexterm" name="idp92703024"></a><p>
      This section explains the details of the underlying tables used by
      the <code class="literal">InnoDB</code> / <span class="command"><strong>memcached</strong></span>
      plugin.
    </p><p>
      The configuration script,
      <code class="filename">scripts/innodb_memcached_config.sql</code>, installs
      3 tables needed by the InnoDB <span class="command"><strong>memcached</strong></span>. These
      tables are created in a dedicated database
      <code class="literal">innodb_memcache</code>:
    </p><pre class="programlisting">
mysql&gt; use innodb_memcache;
Database changed
mysql&gt; show tables;
+---------------------------+
| Tables_in_innodb_memcache |
+---------------------------+
| cache_policies            |
| config_options            |
| containers                |
+---------------------------+
3 rows in set (0.01 sec)
</pre>
<h5><a name="idp92710080"></a>
      containers Table
</h5>
<p>
      <code class="literal">containers</code> - This table is the most important
      table for the <span class="command"><strong>memcached</strong></span> daemon. It describes
      the table or tables used to store the <span class="command"><strong>memcached</strong></span>
      values. You must make changes to this table to start using the
      <span class="command"><strong>memcached</strong></span> interface with one or more of your
      own tables, rather than just experimenting with the
      <code class="literal">test.demo_test</code> table.
    </p><p>
      The mapping is done through specifying corresponding column values
      in the table:
    </p><pre class="programlisting">
mysql&gt; desc containers;
+------------------------+--------------+------+-----+---------+-------+
| Field                  | Type         | Null | Key | Default | Extra |
+------------------------+--------------+------+-----+---------+-------+
| name                   | varchar(50)  | NO   | PRI | NULL    |       |
| db_schema              | varchar(250) | NO   |     | NULL    |       |
| db_table               | varchar(250) | NO   |     | NULL    |       |
| key_columns            | varchar(250) | NO   |     | NULL    |       |
| value_columns          | varchar(250) | YES  |     | NULL    |       |
| flags                  | varchar(250) | NO   |     | 0       |       |
| cas_column             | varchar(250) | YES  |     | NULL    |       |
| expire_time_column     | varchar(250) | YES  |     | NULL    |       |
| unique_idx_name_on_key | varchar(250) | NO   |     | NULL    |       |
+------------------------+--------------+------+-----+---------+-------+
9 rows in set (0.02 sec)
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">db_schema</code> and <code class="literal">db_table</code>
          columns specify the database and table name for storing the
          <span class="command"><strong>memcached</strong></span> value.
        </p></li><li class="listitem"><p>
          <code class="literal">key_columns</code> specifies the single column
          name used as the lookup key for <span class="command"><strong>memcached</strong></span>
          operations.
        </p></li><li class="listitem"><p>
          <code class="literal">value_columns</code> describes the columns (one or
          more) used as values for <span class="command"><strong>memcached</strong></span>
          operations. To specify multiple columns, separate them with
          pipe characters (such as <code class="literal">col1|col2|col3</code> and
          so on).
        </p></li><li class="listitem"><p>
          <code class="literal">unique_idx_name_on_key</code> is the name of the
          index on the key column. It must be a unique index. It can be
          the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> or a
          <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary index</a>.
          Preferably, make the key column the primary key of the
          <code class="literal">InnoDB</code> table. Doing so saves a lookup step
          over using a secondary index for this column. You cannot make
          a <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering index</a>
          for <span class="command"><strong>memcached</strong></span> lookups;
          <code class="literal">InnoDB</code> returns an error if you try to
          define a composite secondary index over both the key and value
          columns.
</p></li></ul>
</div>
<p>
      The above 5 column values (table name, key column, value column
      and index) must be supplied. Otherwise, the setup will fail.
    </p><p>
      Although the following values are optional, they are needed for
      full compliance with the <span class="command"><strong>memcached</strong></span> protocol:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">flags</code> specifies the columns used as flags
          (a user-defined numeric value that is stored and retrieved
          along with the main value) for <span class="command"><strong>memcached</strong></span>.
          It is also used as the column specifier for some operations
          (such as <code class="literal">incr</code>, <code class="literal">prepend</code>)
          if <span class="command"><strong>memcached</strong></span> value is mapped to multiple
          columns. So the operation would be done on the specified
          column. For example, if you have mapped a value to 3 columns,
          and only want the increment operation performed on one of
          these columns, you can use <code class="literal">flags</code> to specify
          which column will be used for these operations.
        </p></li><li class="listitem"><p>
          <code class="literal">cas_column</code> and
          <code class="literal">exp_column</code> are used specifically to store
          the <code class="literal">cas</code> (compare-and-swap) and
          <code class="literal">exp</code> (expiry) value of
          <span class="command"><strong>memcached</strong></span>. Those values are related to the
          way <span class="command"><strong>memcached</strong></span> hashes requests to different
          servers and caches data in memory. Because the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
          is so tightly integrated with a single
          <span class="command"><strong>memcached</strong></span> daemon, and the in-memory caching
          mechanism is handled by MySQL and the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, these
          columns are rarely needed in this type of deployment.
</p></li></ul>
</div>
<h5><a name="idp92754448"></a>
      containers Table Column Constraints
</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">key_columns</code>: The maximum limit for a
          <span class="command"><strong>memcached</strong></span> key is 250 characters, which is
          enforced by <span class="command"><strong>memcached</strong></span>. If a mapped key
          longer than the maximum limit is used, the operation will
          fail. The mapped key must be a non-Null
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> or
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> type.
        </p></li><li class="listitem"><p>
          <code class="literal">value_columns</code>: Must be mapped to a
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a>,
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> column. There is no length
          restriction and the value can be NULL.
        </p></li><li class="listitem"><p>
          <code class="literal">cas_column</code>: The <code class="literal">cas</code>
          value is a 64 bit integer. It must be mapped to a
          <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">BIGINT</code></a> of at least 8 bytes and
          can be NULL.
        </p></li><li class="listitem"><p>
          <code class="literal">expiration_time_column</code>: Must mapped to an
          <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INTEGER</code></a> of at
          least 4 bytes and can be NULL. Expiration time is defined as a
          32-bit integer for Unix time (the number of seconds since
          January 1, 1970, as a 32-bit value), or the number of seconds
          starting from the current time. For the latter, the number of
          seconds may not exceed 60*60*24*30 (the number of seconds in
          30 days). If the number sent by a client is larger, the server
          will consider it to be a real Unix time value rather than an
          offset from the current time.
        </p></li><li class="listitem"><p>
          <code class="literal">flags</code>: Must be mapped to an
          <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INTEGER</code></a> of at least 32-bits and
          can be NULL.
</p></li></ul>
</div>
<p>
      A pre-check is performed at plugin load time to enforce column
      constraints. If any mismatches are found, the plugin will not
      load.
</p>
<h5><a name="idp92773168"></a>
      cache_policies Table
</h5>
<p>
      Table <code class="literal">cache_policies</code> specifies whether to use
      <code class="literal">InnoDB</code> as the data store of
      <span class="command"><strong>memcached</strong></span> (<code class="literal">innodb_only</code>), or
      to use the traditional <span class="command"><strong>memcached</strong></span> engine as the
      backstore (<code class="literal">cache-only</code>), or both
      (<code class="literal">caching</code>). In the last case, if
      <span class="command"><strong>memcached</strong></span> cannot find a key in memory, it
      searches for the value in an <code class="literal">InnoDB</code> table.
</p>
<h5><a name="idp92781360"></a>
      config_options Table
</h5>
<p>
      Table <code class="literal">config_options</code> stores
      <span class="command"><strong>memcached</strong></span>-related settings that are appropriate
      to change at runtime, through SQL. Currently, MySQL supports the
      following configuration options through this table:
    </p><p>
      <code class="literal">separator</code>: The separator used to separate
      values of a long string into smaller values for multiple columns
      values. By default, this is the <code class="literal">|</code> character.
      For example, if you defined <code class="literal">col1, col2</code> as value
      columns, And you define <code class="literal">|</code> as separator, you
      could issue the following command in <span class="command"><strong>memcached</strong></span>
      to insert values into <code class="literal">col1</code> and
      <code class="literal">col2</code> respectively:
    </p><pre class="programlisting">set keyx 10 0 19
valuecolx|valuecoly</pre><p>
      So <code class="literal">valuecol1x</code> is stored in
      <code class="literal">col1</code> and <code class="literal">valuecoly</code> is stored
      in <code class="literal">col2</code>.
    </p><p>
      <code class="literal">table_map_delimiter</code>: The character separating
      the schema name and the table name when you use the
      <code class="literal">@@</code> notation in a key name to access a key in a
      specific table. For example, <code class="literal">@@t1.some_key</code> and
      <code class="literal">@@t2.some_key</code> have the same key value, but are
      stored in different tables and so do not conflict.
</p>
<h5><a name="idp92797712"></a>
      Multiple-column Mapping
</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          During plugin initialization, when <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> is configured with information
          defined in the <code class="literal">containers</code> table, each
          mapped column that is parsed from
          <code class="literal">value_columns</code> is verified against the
          mapped table. If multiple columns are mapped, there is a check
          to ensure that each column exists and is the right type.
        </p></li><li class="listitem"><p>
          At run-time, for <code class="literal">memcached</code> insert
          operations, if there are more delimiters in the value than the
          number of mapped columns, only the number of mapped values are
          taken. For example, if there are 6 mapped columns and 7
          delimited values are provided, only the first 6 delimited
          values are taken. The 7th delimited value is ignored.
        </p></li><li class="listitem"><p>
          If there are fewer delimited values than mapped columns,
          unfilled columns are set to NULL. If an unfilled column cannot
          be NULL, the insert will fail.
        </p></li><li class="listitem"><p>
          If a table has more columns than mapped values, the extra
          columns do not affect output results.
</p></li></ul>
</div>
<h5><a name="idp92806240"></a>
      Example Tables
</h5>
<p>
      The configuration script,
      <code class="filename">scripts/innodb_memcached_config.sql</code>, creates
      a table <code class="literal">demo_test</code> in the
      <code class="literal">test</code> database as an example. It also allows the
      Daemon Memcached to work immediately, without creating any
      additional tables.
    </p><p>
      The entries in the <code class="literal">container</code> table define which
      column is used for what purpose as described above:
    </p><pre class="programlisting">
mysql&gt; select * from innodb_memcache.containers;
+------+-----------+-----------+-------------+---------------+-------+------------+--------------------+------------------------+
| name | db_schema | db_table  | key_columns | value_columns | flags | cas_column | expire_time_column | unique_idx_name_on_key |
+------+-----------+-----------+-------------+---------------+-------+------------+--------------------+------------------------+
| aaa  | test      | demo_test | c1          | c2            | c3    | c4         | c5                 | PRIMARY                |
+------+-----------+-----------+-------------+---------------+-------+------------+--------------------+------------------------+
1 row in set (0.00 sec)

mysql&gt; desc test.demo_test;
+-------+---------------------+------+-----+---------+-------+
| Field | Type                | Null | Key | Default | Extra |
+-------+---------------------+------+-----+---------+-------+
| c1    | varchar(32)         | NO   | PRI |         |       |
| c2    | varchar(1024)       | YES  |     | NULL    |       |
| c3    | int(11)             | YES  |     | NULL    |       |
| c4    | bigint(20) unsigned | YES  |     | NULL    |       |
| c5    | int(11)             | YES  |     | NULL    |       |
+-------+---------------------+------+-----+---------+-------+
5 rows in set (0.01 sec)
</pre><p>
      When no table ID is requested through the <code class="literal">@@</code>
      notation in the key name:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If a row has a <code class="literal">name</code> value of
          <code class="literal">default</code>, the corresponding table is used by
          the <span class="command"><strong>memcached</strong></span> plugin. Thus, when you make
          your first entry in
          <code class="literal">innodb_memcache.containers</code> to move beyond
          the <code class="literal">demo_test</code> table, use a
          <code class="literal">name</code> value of <code class="literal">default</code>.
        </p></li><li class="listitem"><p>
          If there is no
          <code class="literal">innodb_memcache.containers.name</code> value of
          <code class="literal">default</code>, the row with the first
          <code class="literal">name</code> value in alphabetical order is used.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-troubleshoot"></a>14.2.9.8. Troubleshooting the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
      The following list shows some potential issues you might encounter
      using the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
      daemon, and solutions or workarounds where available:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you see this error in your MySQL error log, the server
          might fail to start:
        </p><pre class="programlisting">failed to set rlimit for open files. Try running as root or requesting
smaller maxconns value.</pre><p>
          The error message is actually from the
          <span class="command"><strong>memcached</strong></span> daemon. One solution is to raise
          the OS limit for the number of open files. The command varies
          depending on the operating system. For example, here are the
          commands to check and increase the limit on several operating
          systems:
        </p><pre class="programlisting">
# Linux
$ ulimit -n
1024
ulimit -n 4096
$ ulimit -n
4096

# OS X Lion (10.6)
$ ulimit -n
256
ulimit -n 4096
$ ulimit -n
4096
</pre><p>
          The other solution is to reduce the number of concurrent
          connections available for the <span class="command"><strong>memcached</strong></span>
          daemon, using the <code class="literal">-c</code> option which defaults
          to 1024. Encode that <span class="command"><strong>memcached</strong></span> option using
          the MySQL option
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          inside the MySQL configuration file:
        </p><pre class="programlisting">
[mysqld]
...
loose-daemon_memcached_option='-c 64'
</pre></li><li class="listitem"><p>
          To troubleshoot problems where the
          <span class="command"><strong>memcached</strong></span> daemon is unable to store data in
          or retrieve data from the <code class="literal">InnoDB</code> table,
          specify the <span class="command"><strong>memcached</strong></span> option
          <code class="literal">-vvv</code> through the MySQL configuration option
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>.
          Examine the MySQL error log for debug output related to
          <span class="command"><strong>memcached</strong></span> operations.
        </p></li><li class="listitem"><p>
          If the column specified to hold the
          <span class="command"><strong>memcached</strong></span> item values is the wrong data
          type, such as a numeric type instead of a string type,
          attempts to store key/value pairs will fail with no specific
          error code or message.
        </p></li><li class="listitem"><p>
          If the <code class="literal">daemon_memcached</code> plugin causes any
          issues with starting the MySQL server, disable it during
          troubleshooting by adding this line under the
          <code class="literal">[mysqld]</code> group in your MySQL configuration
          file:
        </p><pre class="programlisting">daemon_memcached=OFF</pre><p>
          For example, if you run the <code class="literal">install plugin</code>
          command before running the
          <code class="filename">scripts/innodb_memcached_config.sql</code>
          script to set up the necessary database and tables, the server
          might crash and be unable to start. Or, if you set up an
          incorrect entry in the
          <code class="literal">innodb_memcache.containers</code> table, the
          server might be unable to start.
        </p><p>
          To permanently turn off the <span class="command"><strong>memcached</strong></span>
          plugin for a MySQL instance, issue the following command:
        </p><pre class="programlisting">
mysql&gt; uninstall plugin daemon_memcached;
</pre></li><li class="listitem"><p>
          If you run more than one instance of MySQL on the same
          machine, with the <span class="command"><strong>memcached</strong></span> daemon plugin
          enabled in each, make sure to specify a unique
          <span class="command"><strong>memcached</strong></span> port for each one using the
          <a class="link" href="storage-engines.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration option.
        </p></li><li class="listitem"><p>
          You might find that a SQL statement cannot find an expected
          table, or there is no data in the table, but
          <span class="command"><strong>memcached</strong></span> API calls still work and retrieve
          the expected data. This can happen if you do not set up the
          entry in the <code class="literal">innodb_memcache.containers</code>
          table, or do not switch to that table by issuing a
          <code class="literal">GET</code> or <code class="literal">SET</code> request with
          the key
          <code class="literal">@@<em class="replaceable"><code>table_id</code></em></code>, or
          make a change to an existing entry in
          <code class="literal">innodb_memcache.containers</code> without
          restarting the MySQL server afterward. The free-form storage
          mechanism is flexible enough that your requests to store or
          retrieve a multi-column value like
          <code class="literal">col1|col2|col3</code> will usually still work,
          even if the daemon is using the
          <code class="literal">test.demo_test</code> table which stores all the
          data within a single column.
        </p></li><li class="listitem"><p>
          When defining your own <code class="literal">InnoDB</code> table for use
          with <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>,
          and columns in your table are defined as NOT NULL, ensure that
          values are supplied for the NOT NULL columns when inserting a
          descriptor for the <code class="literal">InnoDB</code> table into the
          <span class="command"><strong>memcached</strong></span> containers table
          (<code class="literal">innodb_memcached.containers</code>). If your
          descriptor <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement
          contains fewer delimited values than there are mapped columns,
          unfilled columns are set to NULL. Attempting to insert a NULL
          value into a NOT NULL column causes the
          <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> to fail, which may only
          become evident after you reinitialize the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
          to apply changes to the containers table.
        </p></li><li class="listitem"><p>
          As the length of the <span class="command"><strong>memcached</strong></span> key and
          values increase, you encounter size and length limits at
          different points:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              When the key exceeds 250 bytes in size,
              <span class="command"><strong>memcached</strong></span> operations return an error.
              This is currently a fixed limit within
              <span class="command"><strong>memcached</strong></span>.
            </p></li><li class="listitem"><p>
              You might encounter <code class="literal">InnoDB</code>-related
              limits when the value exceeds 768 bytes in size, or 3072
              bytes in size, or 1/2 of the size specified by
              <a class="link" href="storage-engines.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>. These
              limits primarily apply if you intend to create an index on
              the value column to run report-generating queries on that
              column from SQL. See <a class="xref" href="storage-engines.html#innodb-restrictions" title="14.2.7. Limits on InnoDB Tables">Section 14.2.7, “Limits on <code class="literal">InnoDB</code> Tables”</a>
              for details.
            </p></li><li class="listitem"><p>
              The maximum size for the combination of the key and the
              value is 1 MB.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          If you share configuration files across MySQL servers with
          different versions, using the latest configuration options for
          the <span class="command"><strong>memcached</strong></span> plugin could cause startup
          errors for older MySQL versions. To avoid compatibility
          problems, use the <code class="literal">loose</code> forms of these
          option names, for example
          <code class="literal">loose-daemon_memcached_option='-c 64'</code>
          instead of <code class="literal">daemon_memcached_option='-c 64'</code>.
        </p></li><li class="listitem"><p>
          There is no restriction or check in place to validate
          character set settings. <span class="command"><strong>memcached</strong></span> stores
          and retrieves keys and values in bytes and is therefore not
          character set sensitive. However, you must ensure that the
          <span class="command"><strong>memcached</strong></span> client and the MySQL table use
          the same character set.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="myisam-storage-engine"></a>14.3. The <code class="literal">MyISAM</code> Storage Engine</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#myisam-start">14.3.1. <code class="literal">MyISAM</code> Startup Options</a></span></dt><dt><span class="section"><a href="storage-engines.html#key-space">14.3.2. Space Needed for Keys</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-formats">14.3.3. <code class="literal">MyISAM</code> Table Storage Formats</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-problems">14.3.4. <code class="literal">MyISAM</code> Table Problems</a></span></dt></dl>
</div>
<a class="indexterm" name="idp92897072"></a><a class="indexterm" name="idp92898144"></a><p>
    <code class="literal">MyISAM</code> is based on the older (and no longer
    available) <code class="literal">ISAM</code> storage engine but has many
    useful extensions.
</p>
<div class="table">
<a name="idp92901520"></a><p class="title"><b>Table 14.8. <code class="literal">MyISAM</code> Storage Engine
Features</b></p>
<div class="table-contents">
<table summary="MyISAM Storage Engine
Features" border="1"><colgroup><col class="featurev0"><col class="featurevalue0"><col class="featurev1"><col class="featurevalue1"><col class="featurev2"><col class="featurevalue2"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Storage limits</strong></span></td><td>256TB</td><td><span class="bold"><strong>Transactions</strong></span></td><td>No</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Table</td></tr><tr><td scope="row"><span class="bold"><strong>MVCC</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>T-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>Full-text search indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Data caches</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>Index caches</strong></span></td><td>Yes</td><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes<a href="#ftn.idp92924400" class="footnote"><sup class="footnote"><a name="idp92924400"></a>[a]</sup></a></td><td><span class="bold"><strong>Encrypted data<a href="#ftn.idp92925760" class="footnote"><sup class="footnote"><a name="idp92925760"></a>[b]</sup></a></strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td><td><span class="bold"><strong>Replication support<a href="#ftn.idp92928800" class="footnote"><sup class="footnote"><a name="idp92928800"></a>[c]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>Backup / point-in-time recovery<a href="#ftn.idp92931808" class="footnote"><sup class="footnote"><a name="idp92931808"></a>[d]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6">
<div id="ftn.idp92924400" class="footnote">
<p><a href="storage-engines.html#idp92924400" class="para"><sup class="para">[a] </sup></a>Compressed MyISAM tables are supported only when using the compressed row format. Tables using the compressed row format with MyISAM are read only.</p>
</div>

<div id="ftn.idp92925760" class="footnote">
<p><a href="storage-engines.html#idp92925760" class="para"><sup class="para">[b] </sup></a>Implemented in the server (via encryption functions), rather than in the storage engine.</p>
</div>

<div id="ftn.idp92928800" class="footnote">
<p><a href="storage-engines.html#idp92928800" class="para"><sup class="para">[c] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>

<div id="ftn.idp92931808" class="footnote">
<p><a href="storage-engines.html#idp92931808" class="para"><sup class="para">[d] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>
</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
    Each <code class="literal">MyISAM</code> table is stored on disk in three
    files. The files have names that begin with the table name and have
    an extension to indicate the file type. An <code class="filename">.frm</code>
    file stores the table format. The data file has an
    <code class="filename">.MYD</code> (<code class="literal">MYData</code>) extension. The
    index file has an <code class="filename">.MYI</code>
    (<code class="literal">MYIndex</code>) extension.
  </p><p>
    To specify explicitly that you want a <code class="literal">MyISAM</code>
    table, indicate that with an <code class="literal">ENGINE</code> table option:
  </p><pre class="programlisting">CREATE TABLE t (i INT) ENGINE = MYISAM;</pre><p>
    In MySQL 5.6, it is normally necessary to use
    <code class="literal">ENGINE</code> to specify the <code class="literal">MyISAM</code>
    storage engine because <code class="literal">InnoDB</code> is the default
    engine.
  </p><p>
    You can check or repair <code class="literal">MyISAM</code> tables with the
    <a class="link" href="programs.html#mysqlcheck" title="4.5.3. mysqlcheck — A Table Maintenance Program"><span class="command"><strong>mysqlcheck</strong></span></a> client or <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
    utility. You can also compress <code class="literal">MyISAM</code> tables with
    <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> to take up much less space. See
    <a class="xref" href="programs.html#mysqlcheck" title="4.5.3. mysqlcheck — A Table Maintenance Program">Section 4.5.3, “<span class="command"><strong>mysqlcheck</strong></span> — A Table Maintenance Program”</a>, <a class="xref" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility">Section 4.6.3, “<span class="command"><strong>myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>, and
    <a class="xref" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables">Section 4.6.5, “<span class="command"><strong>myisampack</strong></span> — Generate Compressed, Read-Only MyISAM Tables”</a>.
  </p><p>
    <code class="literal">MyISAM</code> tables have the following characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        All data values are stored with the low byte first. This makes
        the data machine and operating system independent. The only
        requirements for binary portability are that the machine uses
        two's-complement signed integers and IEEE floating-point format.
        These requirements are widely used among mainstream machines.
        Binary compatibility might not be applicable to embedded
        systems, which sometimes have peculiar processors.
      </p><p>
        There is no significant speed penalty for storing data low byte
        first; the bytes in a table row normally are unaligned and it
        takes little more processing to read an unaligned byte in order
        than in reverse order. Also, the code in the server that fetches
        column values is not time critical compared to other code.
      </p></li><li class="listitem"><p>
        All numeric key values are stored with the high byte first to
        permit better index compression.
      </p></li><li class="listitem"><p>
        Large files (up to 63-bit file length) are supported on file
        systems and operating systems that support large files.
      </p></li><li class="listitem"><p>
        There is a limit of
        (2<sup>32</sup>)<sup>2</sup>
        (1.844E+19) rows in a <code class="literal">MyISAM</code> table.
      </p></li><li class="listitem"><p>
        The maximum number of indexes per <code class="literal">MyISAM</code>
        table is 64.
      </p><p>
        The maximum number of columns per index is 16.
      </p></li><li class="listitem"><p>
        The maximum key length is 1000 bytes. This can also be changed
        by changing the source and recompiling. For the case of a key
        longer than 250 bytes, a larger key block size than the default
        of 1024 bytes is used.
      </p></li><li class="listitem"><p>
        When rows are inserted in sorted order (as when you are using an
        <code class="literal">AUTO_INCREMENT</code> column), the index tree is
        split so that the high node only contains one key. This improves
        space utilization in the index tree.
      </p></li><li class="listitem"><p>
        Internal handling of one <code class="literal">AUTO_INCREMENT</code>
        column per table is supported. <code class="literal">MyISAM</code>
        automatically updates this column for
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
        <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> operations. This makes
        <code class="literal">AUTO_INCREMENT</code> columns faster (at least 10%).
        Values at the top of the sequence are not reused after being
        deleted. (When an <code class="literal">AUTO_INCREMENT</code> column is
        defined as the last column of a multiple-column index, reuse of
        values deleted from the top of a sequence does occur.) The
        <code class="literal">AUTO_INCREMENT</code> value can be reset with
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>.
      </p></li><li class="listitem"><p>
        Dynamic-sized rows are much less fragmented when mixing deletes
        with updates and inserts. This is done by automatically
        combining adjacent deleted blocks and by extending blocks if the
        next block is deleted.
      </p></li><li class="listitem"><p>
        <code class="literal">MyISAM</code> supports concurrent inserts: If a
        table has no free blocks in the middle of the data file, you can
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> new rows into it at the
        same time that other threads are reading from the table. A free
        block can occur as a result of deleting rows or an update of a
        dynamic length row with more data than its current contents.
        When all free blocks are used up (filled in), future inserts
        become concurrent again. See
        <a class="xref" href="optimization.html#concurrent-inserts" title="8.10.3. Concurrent Inserts">Section 8.10.3, “Concurrent Inserts”</a>.
      </p></li><li class="listitem"><p>
        You can put the data file and index file in different
        directories on different physical devices to get more speed with
        the <code class="literal">DATA DIRECTORY</code> and <code class="literal">INDEX
        DIRECTORY</code> table options to <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a>. See <a class="xref" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax">Section 13.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>.
      </p></li><li class="listitem"><p>
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns can be indexed.
      </p></li><li class="listitem"><p>
        <code class="literal">NULL</code> values are permitted in indexed columns.
        This takes 0 to 1 bytes per key.
      </p></li><li class="listitem"><p>
        Each character column can have a different character set. See
        <a class="xref" href="globalization.html#charset" title="10.1. Character Set Support">Section 10.1, “Character Set Support”</a>.
      </p></li><li class="listitem"><p>
        There is a flag in the <code class="literal">MyISAM</code> index file that
        indicates whether the table was closed correctly. If
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is started with the
        <a class="link" href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a> option,
        <code class="literal">MyISAM</code> tables are automatically checked when
        opened, and are repaired if the table wasn't closed properly.
      </p></li><li class="listitem"><p>
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> marks tables as checked if you run
        it with the <a class="link" href="programs.html#option_myisamchk_update-state"><code class="option">--update-state</code></a>
        option. <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk --fast</strong></span></a> checks only those
        tables that don't have this mark.
      </p></li><li class="listitem"><p>
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk --analyze</strong></span></a> stores statistics for
        portions of keys, as well as for entire keys.
      </p></li><li class="listitem"><p>
        <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> can pack
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
</p></li></ul>
</div>
<p>
    <code class="literal">MyISAM</code> also supports the following features:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Support for a true <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> type;
        a <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column starts with a
        length stored in one or two bytes.
      </p></li><li class="listitem"><p>
        Tables with <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns may
        have fixed or dynamic row length.
      </p></li><li class="listitem"><p>
        The sum of the lengths of the
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> and
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> columns in a table may be up
        to 64KB.
      </p></li><li class="listitem"><p>
        Arbitrary length <code class="literal">UNIQUE</code> constraints.
</p></li></ul>
</div>
<h3><a name="idp93008320"></a>
    Additional Resources
</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        A forum dedicated to the <code class="literal">MyISAM</code> storage
        engine is available at <a class="ulink" href="http://forums.mysql.com/list.php?21" target="_top">http://forums.mysql.com/list.php?21</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-start"></a>14.3.1. <code class="literal">MyISAM</code> Startup Options</h3>

</div>

</div>

</div>
<p>
      The following options to <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can be used to
      change the behavior of <code class="literal">MyISAM</code> tables. For
      additional information, see <a class="xref" href="server-administration.html#server-options" title="5.1.3. Server Command Options">Section 5.1.3, “Server Command Options”</a>.
</p>
<div class="table">
<a name="idp93015408"></a><p class="title"><b>Table 14.9. <code class="literal">MyISAM</code> Option/Variable
Reference</b></p>
<div class="table-contents">
<table summary="MyISAM Option/Variable
Reference" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Cmd-Line</th><th scope="col">Option file</th><th scope="col">System Var</th><th scope="col">Status Var</th><th scope="col">Var Scope</th><th scope="col">Dynamic</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_bulk_insert_buffer_size">bulk_insert_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_concurrent_insert">concurrent_insert</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_delay-key-write">delay-key-write</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_delay_key_write">delay_key_write</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_have_rtree_keys">have_rtree_keys</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_key_buffer_size">key_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_log-isam">log-isam</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_myisam-block-size">myisam-block-size</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_data_pointer_size">myisam_data_pointer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_max_sort_file_size">myisam_max_sort_file_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_mmap_size">myisam_mmap_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_myisam-recover-options">myisam-recover-options</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_myisam_recover_options">myisam_recover_options</a></td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_recover_options">myisam_recover_options</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_repair_threads">myisam_repair_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_sort_buffer_size">myisam_sort_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_stats_method">myisam_stats_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_myisam_use_mmap">myisam_use_mmap</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-concurrent-insert">skip-concurrent-insert</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_concurrent_insert">concurrent_insert</a></td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_tmp_table_size">tmp_table_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="indexterm" name="idp93093152"></a>

          <a class="indexterm" name="idp93094656"></a>

          <a class="link" href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options=<em class="replaceable"><code>mode</code></em></code></a>
        </p><p>
          Set the mode for automatic recovery of crashed
          <code class="literal">MyISAM</code> tables.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idp93099248"></a>

          <a class="indexterm" name="idp93100736"></a>

          <a class="link" href="server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=ALL</code></a>
        </p><p>
          Don't flush key buffers between writes for any
          <code class="literal">MyISAM</code> table.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            If you do this, you should not access
            <code class="literal">MyISAM</code> tables from another program (such
            as from another MySQL server or with
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>) when the tables are in use.
            Doing so risks index corruption. Using
            <a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> does not
            eliminate this risk.
</p>
</div>
</li></ul>
</div>
<p>
      The following system variables affect the behavior of
      <code class="literal">MyISAM</code> tables. For additional information, see
      <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_bulk_insert_buffer_size"><code class="literal">bulk_insert_buffer_size</code></a>
        </p><p>
          The size of the tree cache used in bulk insert optimization.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            This is a limit <span class="emphasis"><em>per thread</em></span>!
</p>
</div>
</li><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a>
        </p><p>
          The maximum size of the temporary file that MySQL is permitted
          to use while re-creating a <code class="literal">MyISAM</code> index
          (during <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>,
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, or
          <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          INFILE</code></a>). If the file size would be larger than this
          value, the index is created using the key cache instead, which
          is slower. The value is given in bytes.
        </p></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a>
        </p><p>
          Set the size of the buffer used when recovering tables.
</p></li></ul>
</div>
<p>
      Automatic recovery is activated if you start
      <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
      <a class="link" href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a> option. In
      this case, when the server opens a <code class="literal">MyISAM</code>
      table, it checks whether the table is marked as crashed or whether
      the open count variable for the table is not 0 and you are running
      the server with external locking disabled. If either of these
      conditions is true, the following happens:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The server checks the table for errors.
        </p></li><li class="listitem"><p>
          If the server finds an error, it tries to do a fast table
          repair (with sorting and without re-creating the data file).
        </p></li><li class="listitem"><p>
          If the repair fails because of an error in the data file (for
          example, a duplicate-key error), the server tries again, this
          time re-creating the data file.
        </p></li><li class="listitem"><p>
          If the repair still fails, the server tries once more with the
          old repair option method (write row by row without sorting).
          This method should be able to repair any type of error and has
          low disk space requirements.
</p></li></ul>
</div>
<p>
      If the recovery wouldn't be able to recover all rows from
      previously completed statements and you didn't specify
      <code class="literal">FORCE</code> in the value of the
      <a class="link" href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a> option,
      automatic repair aborts with an error message in the error log:
    </p><pre class="programlisting">Error: Couldn't repair table: test.g00pages</pre><p>
      If you specify <code class="literal">FORCE</code>, a warning like this is
      written instead:
    </p><pre class="programlisting">Warning: Found 344 of 354 rows when repairing ./test/g00pages</pre><p>
      Note that if the automatic recovery value includes
      <code class="literal">BACKUP</code>, the recovery process creates files with
      names of the form
      <code class="filename"><em class="replaceable"><code>tbl_name-datetime</code></em>.BAK</code>.
      You should have a <span class="command"><strong>cron</strong></span> script that
      automatically moves these files from the database directories to
      backup media.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="key-space"></a>14.3.2. Space Needed for Keys</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp93137648"></a><p>
      <code class="literal">MyISAM</code> tables use B-tree indexes. You can
      roughly calculate the size for the index file as
      <code class="literal">(key_length+4)/0.67</code>, summed over all keys. This
      is for the worst case when all keys are inserted in sorted order
      and the table doesn't have any compressed keys.
    </p><p>
      String indexes are space compressed. If the first index part is a
      string, it is also prefix compressed. Space compression makes the
      index file smaller than the worst-case figure if a string column
      has a lot of trailing space or is a
      <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column that is not always
      used to the full length. Prefix compression is used on keys that
      start with a string. Prefix compression helps if there are many
      strings with an identical prefix.
    </p><p>
      In <code class="literal">MyISAM</code> tables, you can also prefix compress
      numbers by specifying the <code class="literal">PACK_KEYS=1</code> table
      option when you create the table. Numbers are stored with the high
      byte first, so this helps when you have many integer keys that
      have an identical prefix.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-table-formats"></a>14.3.3. <code class="literal">MyISAM</code> Table Storage Formats</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#static-format">14.3.3.1. Static (Fixed-Length) Table Characteristics</a></span></dt><dt><span class="section"><a href="storage-engines.html#dynamic-format">14.3.3.2. Dynamic Table Characteristics</a></span></dt><dt><span class="section"><a href="storage-engines.html#compressed-format">14.3.3.3. Compressed Table Characteristics</a></span></dt></dl>
</div>
<p>
      <code class="literal">MyISAM</code> supports three different storage
      formats. Two of them, fixed and dynamic format, are chosen
      automatically depending on the type of columns you are using. The
      third, compressed format, can be created only with the
      <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> utility (see
      <a class="xref" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables">Section 4.6.5, “<span class="command"><strong>myisampack</strong></span> — Generate Compressed, Read-Only MyISAM Tables”</a>).
    </p><p>
      When you use <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> for a table that has no
      <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> or
      <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, you can force the
      table format to <code class="literal">FIXED</code> or
      <code class="literal">DYNAMIC</code> with the <code class="literal">ROW_FORMAT</code>
      table option.
    </p><p>
      See <a class="xref" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax">Section 13.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>, for information about
      <code class="literal">ROW_FORMAT</code>.
    </p><p>
      You can decompress (unpack) compressed <code class="literal">MyISAM</code>
      tables using <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility">myisamchk
      <code class="option">--unpack</code></a>; see
      <a class="xref" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility">Section 4.6.3, “<span class="command"><strong>myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>, for more information.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="static-format"></a>14.3.3.1. Static (Fixed-Length) Table Characteristics</h4>
</div>
</div>
</div>
<p>
        Static format is the default for <code class="literal">MyISAM</code>
        tables. It is used when the table contains no variable-length
        columns (<a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
        <a class="link" href="data-types.html#binary-varbinary" title="11.4.2. The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a>, or
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>). Each row is stored using a
        fixed number of bytes.
      </p><p>
        Of the three <code class="literal">MyISAM</code> storage formats, static
        format is the simplest and most secure (least subject to
        corruption). It is also the fastest of the on-disk formats due
        to the ease with which rows in the data file can be found on
        disk: To look up a row based on a row number in the index,
        multiply the row number by the row length to calculate the row
        position. Also, when scanning a table, it is very easy to read a
        constant number of rows with each disk read operation.
      </p><p>
        The security is evidenced if your computer crashes while the
        MySQL server is writing to a fixed-format
        <code class="literal">MyISAM</code> file. In this case,
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> can easily determine where each row
        starts and ends, so it can usually reclaim all rows except the
        partially written one. Note that <code class="literal">MyISAM</code> table
        indexes can always be reconstructed based on the data rows.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          Fixed-length row format is only available for tables without
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> or
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns. Creating a table
          with these columns with an explicit
          <code class="literal">ROW_FORMAT</code> clause will not raise an error
          or warning; the format specification will be ignored.
</p>
</div>
<p>
        Static-format tables have these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> and
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns are
            space-padded to the specified column width, although the
            column type is not altered.
            <a class="link" href="data-types.html#binary-varbinary" title="11.4.2. The BINARY and VARBINARY Types"><code class="literal">BINARY</code></a> and
            <a class="link" href="data-types.html#binary-varbinary" title="11.4.2. The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a> columns are padded
            with <code class="literal">0x00</code> bytes to the column width.
          </p></li><li class="listitem"><p>
            Very quick.
          </p></li><li class="listitem"><p>
            Easy to cache.
          </p></li><li class="listitem"><p>
            Easy to reconstruct after a crash, because rows are located
            in fixed positions.
          </p></li><li class="listitem"><p>
            Reorganization is unnecessary unless you delete a huge
            number of rows and want to return free disk space to the
            operating system. To do this, use
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r</strong></span></a>.
          </p></li><li class="listitem"><p>
            Usually require more disk space than dynamic-format tables.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="dynamic-format"></a>14.3.3.2. Dynamic Table Characteristics</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp93187152"></a><a class="indexterm" name="idp93188240"></a><p>
        Dynamic storage format is used if a <code class="literal">MyISAM</code>
        table contains any variable-length columns
        (<a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
        <a class="link" href="data-types.html#binary-varbinary" title="11.4.2. The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a>, or
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>), or if the table was
        created with the <code class="literal">ROW_FORMAT=DYNAMIC</code> table
        option.
      </p><p>
        Dynamic format is a little more complex than static format
        because each row has a header that indicates how long it is. A
        row can become fragmented (stored in noncontiguous pieces) when
        it is made longer as a result of an update.
      </p><a class="indexterm" name="idp93195776"></a><p>
        You can use <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r</strong></span></a> to defragment a table. If you
        have fixed-length columns that you access or change frequently
        in a table that also contains some variable-length columns, it
        might be a good idea to move the variable-length columns to
        other tables just to avoid fragmentation.
      </p><p>
        Dynamic-format tables have these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            All string columns are dynamic except those with a length
            less than four.
          </p></li><li class="listitem"><p>
            Each row is preceded by a bitmap that indicates which
            columns contain the empty string (for string columns) or
            zero (for numeric columns). Note that this does not include
            columns that contain <code class="literal">NULL</code> values. If a
            string column has a length of zero after trailing space
            removal, or a numeric column has a value of zero, it is
            marked in the bitmap and not saved to disk. Nonempty strings
            are saved as a length byte plus the string contents.
          </p></li><li class="listitem"><p>
            Much less disk space usually is required than for
            fixed-length tables.
          </p></li><li class="listitem"><p>
            Each row uses only as much space as is required. However, if
            a row becomes larger, it is split into as many pieces as are
            required, resulting in row fragmentation. For example, if
            you update a row with information that extends the row
            length, the row becomes fragmented. In this case, you may
            have to run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r</strong></span></a> from time to time to improve
            performance. Use <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -ei</strong></span></a> to obtain
            table statistics.
          </p></li><li class="listitem"><p>
            More difficult than static-format tables to reconstruct
            after a crash, because rows may be fragmented into many
            pieces and links (fragments) may be missing.
          </p></li><li class="listitem"><p>
            The expected row length for dynamic-sized rows is calculated
            using the following expression:
          </p><pre class="programlisting">3
+ (<em class="replaceable"><code>number of columns</code></em> + 7) / 8
+ (<em class="replaceable"><code>number of char columns</code></em>)
+ (<em class="replaceable"><code>packed size of numeric columns</code></em>)
+ (<em class="replaceable"><code>length of strings</code></em>)
+ (<em class="replaceable"><code>number of NULL columns</code></em> + 7) / 8
</pre><p>
            There is a penalty of 6 bytes for each link. A dynamic row
            is linked whenever an update causes an enlargement of the
            row. Each new link is at least 20 bytes, so the next
            enlargement probably goes in the same link. If not, another
            link is created. You can find the number of links using
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -ed</strong></span></a>. All links may be removed
            with <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r</strong></span></a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="compressed-format"></a>14.3.3.3. Compressed Table Characteristics</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp93217392"></a><a class="indexterm" name="idp93218880"></a><a class="indexterm" name="idp93219952"></a><a class="indexterm" name="idp93221440"></a><p>
        Compressed storage format is a read-only format that is
        generated with the <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> tool.
        Compressed tables can be uncompressed with
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>.
      </p><p>
        Compressed tables have the following characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Compressed tables take very little disk space. This
            minimizes disk usage, which is helpful when using slow disks
            (such as CD-ROMs).
          </p></li><li class="listitem"><p>
            Each row is compressed separately, so there is very little
            access overhead. The header for a row takes up one to three
            bytes depending on the biggest row in the table. Each column
            is compressed differently. There is usually a different
            Huffman tree for each column. Some of the compression types
            are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Suffix space compression.
              </p></li><li class="listitem"><p>
                Prefix space compression.
              </p></li><li class="listitem"><p>
                Numbers with a value of zero are stored using one bit.
              </p></li><li class="listitem"><p>
                If values in an integer column have a small range, the
                column is stored using the smallest possible type. For
                example, a <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">BIGINT</code></a> column
                (eight bytes) can be stored as a
                <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">TINYINT</code></a> column (one byte)
                if all its values are in the range from
                <code class="literal">-128</code> to <code class="literal">127</code>.
              </p></li><li class="listitem"><p>
                If a column has only a small set of possible values, the
                data type is converted to
                <a class="link" href="data-types.html#enum" title="11.4.4. The ENUM Type"><code class="literal">ENUM</code></a>.
              </p></li><li class="listitem"><p>
                A column may use any combination of the preceding
                compression types.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            Can be used for fixed-length or dynamic-length rows.
</p></li></ul>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
          While a compressed table is read only, and you cannot
          therefore update or add rows in the table, DDL (Data
          Definition Language) operations are still valid. For example,
          you may still use <code class="literal">DROP</code> to drop the table,
          and <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> to empty the
          table.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-table-problems"></a>14.3.4. <code class="literal">MyISAM</code> Table Problems</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#corrupted-myisam-tables">14.3.4.1. Corrupted <code class="literal">MyISAM</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-close">14.3.4.2. Problems from Tables Not Being Closed Properly</a></span></dt></dl>
</div>
<p>
      The file format that MySQL uses to store data has been extensively
      tested, but there are always circumstances that may cause database
      tables to become corrupted. The following discussion describes how
      this can happen and how to handle it.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="corrupted-myisam-tables"></a>14.3.4.1. Corrupted <code class="literal">MyISAM</code> Tables</h4>
</div>
</div>
</div>
<p>
        Even though the <code class="literal">MyISAM</code> table format is very
        reliable (all changes to a table made by an SQL statement are
        written before the statement returns), you can still get
        corrupted tables if any of the following events occur:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process is killed in the
            middle of a write.
          </p></li><li class="listitem"><p>
            An unexpected computer shutdown occurs (for example, the
            computer is turned off).
          </p></li><li class="listitem"><p>
            Hardware failures.
          </p></li><li class="listitem"><p>
            You are using an external program (such as
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>) to modify a table that is
            being modified by the server at the same time.
          </p></li><li class="listitem"><p>
            A software bug in the MySQL or <code class="literal">MyISAM</code>
            code.
</p></li></ul>
</div>
<p>
        Typical symptoms of a corrupt table are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            You get the following error while selecting data from the
            table:
          </p><pre class="programlisting">Incorrect key file for table: '...'. Try to repair it</pre></li><li class="listitem"><p>
            Queries don't find rows in the table or return incomplete
            results.
</p></li></ul>
</div>
<p>
        You can check the health of a <code class="literal">MyISAM</code> table
        using the <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> statement,
        and repair a corrupted <code class="literal">MyISAM</code> table with
        <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>. When
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is not running, you can also check or
        repair a table with the <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> command.
        See <a class="xref" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax">Section 13.7.2.2, “<code class="literal">CHECK TABLE</code> Syntax”</a>,
        <a class="xref" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax">Section 13.7.2.5, “<code class="literal">REPAIR TABLE</code> Syntax”</a>, and <a class="xref" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility">Section 4.6.3, “<span class="command"><strong>myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>.
      </p><p>
        If your tables become corrupted frequently, you should try to
        determine why this is happening. The most important thing to
        know is whether the table became corrupted as a result of a
        server crash. You can verify this easily by looking for a recent
        <code class="literal">restarted mysqld</code> message in the error log. If
        there is such a message, it is likely that table corruption is a
        result of the server dying. Otherwise, corruption may have
        occurred during normal operation. This is a bug. You should try
        to create a reproducible test case that demonstrates the
        problem. See <a class="xref" href="error-handling.html#crashing" title="C.5.4.2. What to Do If MySQL Keeps Crashing">Section C.5.4.2, “What to Do If MySQL Keeps Crashing”</a>, and
        <a class="xref" href="extending-mysql.html#porting" title="23.4. Debugging and Porting MySQL">Section 23.4, “Debugging and Porting MySQL”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="myisam-table-close"></a>14.3.4.2. Problems from Tables Not Being Closed Properly</h4>

</div>

</div>

</div>
<p>
        Each <code class="literal">MyISAM</code> index file
        (<code class="filename">.MYI</code> file) has a counter in the header
        that can be used to check whether a table has been closed
        properly. If you get the following warning from
        <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> or
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>, it means that this counter has
        gone out of sync:
      </p><pre class="programlisting">clients are using or haven't closed the table properly</pre><p>
        This warning doesn't necessarily mean that the table is
        corrupted, but you should at least check the table.
      </p><p>
        The counter works as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The first time a table is updated in MySQL, a counter in the
            header of the index files is incremented.
          </p></li><li class="listitem"><p>
            The counter is not changed during further updates.
          </p></li><li class="listitem"><p>
            When the last instance of a table is closed (because a
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
            TABLES</code></a> operation was performed or because there is
            no room in the table cache), the counter is decremented if
            the table has been updated at any point.
          </p></li><li class="listitem"><p>
            When you repair the table or check the table and it is found
            to be okay, the counter is reset to zero.
          </p></li><li class="listitem"><p>
            To avoid problems with interaction with other processes that
            might check the table, the counter is not decremented on
            close if it was zero.
</p></li></ul>
</div>
<p>
        In other words, the counter can become incorrect only under
        these conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A <code class="literal">MyISAM</code> table is copied without first
            issuing <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> and
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
            TABLES</code></a>.
          </p></li><li class="listitem"><p>
            MySQL has crashed between an update and the final close.
            (Note that the table may still be okay, because MySQL always
            issues writes for everything between each statement.)
          </p></li><li class="listitem"><p>
            A table was modified by <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
            --recover</strong></span></a> or <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
            --update-state</strong></span></a> at the same time that it was in use
            by <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>.
          </p></li><li class="listitem"><p>
            Multiple <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> servers are using the
            table and one server performed a <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR
            TABLE</code></a> or <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
            TABLE</code></a> on the table while it was in use by another
            server. In this setup, it is safe to use
            <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a>, although you
            might get the warning from other servers. However,
            <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> should be
            avoided because when one server replaces the data file with
            a new one, this is not known to the other servers.
          </p><p>
            In general, it is a bad idea to share a data directory among
            multiple servers. See <a class="xref" href="server-administration.html#multiple-servers" title="5.6. Running Multiple MySQL Instances on One Machine">Section 5.6, “Running Multiple MySQL Instances on One Machine”</a>,
            for additional discussion.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="memory-storage-engine"></a>14.4. The <code class="literal">MEMORY</code> Storage Engine</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp93299328"></a><a class="indexterm" name="idp93300400"></a><a class="indexterm" name="idp93301472"></a><a class="indexterm" name="idp93302960"></a><p>
    The <code class="literal">MEMORY</code> storage engine (formerly known as
    <code class="literal">HEAP</code>) creates special-purpose tables with
    contents that are stored in memory. Because the data is vulnerable
    to crashes, hardware issues, or power outages, only use these tables
    as temporary work areas or read-only caches for data pulled from
    other tables.
</p>
<div class="table">
<a name="idp93306576"></a><p class="title"><b>Table 14.10. <code class="literal">MEMORY</code> Storage Engine
Features</b></p>
<div class="table-contents">
<table summary="MEMORY Storage Engine
Features" border="1"><colgroup><col class="featurev0"><col class="featurevalue0"><col class="featurev1"><col class="featurevalue1"><col class="featurev2"><col class="featurevalue2"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Storage limits</strong></span></td><td>RAM</td><td><span class="bold"><strong>Transactions</strong></span></td><td>No</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Table</td></tr><tr><td scope="row"><span class="bold"><strong>MVCC</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>T-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Full-text search indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Data caches</strong></span></td><td>N/A</td></tr><tr><td scope="row"><span class="bold"><strong>Index caches</strong></span></td><td>N/A</td><td><span class="bold"><strong>Compressed data</strong></span></td><td>No</td><td><span class="bold"><strong>Encrypted data<a href="#ftn.idp93330240" class="footnote"><sup class="footnote"><a name="idp93330240"></a>[a]</sup></a></strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td><td><span class="bold"><strong>Replication support<a href="#ftn.idp93333280" class="footnote"><sup class="footnote"><a name="idp93333280"></a>[b]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>Backup / point-in-time recovery<a href="#ftn.idp93336288" class="footnote"><sup class="footnote"><a name="idp93336288"></a>[c]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6">
<div id="ftn.idp93330240" class="footnote">
<p><a href="storage-engines.html#idp93330240" class="para"><sup class="para">[a] </sup></a>Implemented in the server (via encryption functions), rather than in the storage engine.</p>
</div>

<div id="ftn.idp93333280" class="footnote">
<p><a href="storage-engines.html#idp93333280" class="para"><sup class="para">[b] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>

<div id="ftn.idp93336288" class="footnote">
<p><a href="storage-engines.html#idp93336288" class="para"><sup class="para">[c] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>
</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p><a name="memory-compared-cluster"></a><b>When to Use <code class="literal">MEMORY</code> or MySQL Cluster. </b>
      Developers looking to deploy applications that use the
      <code class="literal">MEMORY</code> storage engine for important, highly
      available, or frequently updated data should consider whether
      MySQL Cluster is a better choice. A typical use case for the
      <code class="literal">MEMORY</code> engine involves these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Operations involving transient, non-critical data such as
        session management or caching. When the MySQL server halts or
        restarts, the data in <code class="literal">MEMORY</code> tables is lost.
      </p></li><li class="listitem"><p>
        In-memory storage for fast access and low latency. Data volume
        can fit entirely in memory without causing the operating system
        to swap out virtual memory pages.
      </p></li><li class="listitem"><p>
        A read-only or read-mostly data access pattern (limited
        updates).
</p></li></ul>
</div>
<p>
    MySQL Cluster offers the same features as the
    <code class="literal">MEMORY</code> engine with higher performance levels, and
    provides additional features not available with
    <code class="literal">MEMORY</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Row-level locking and multiple-thread operation for low
        contention between clients.
      </p></li><li class="listitem"><p>
        Scalability even with statement mixes that include writes.
      </p></li><li class="listitem"><p>
        Optional disk-backed operation for data durability.
      </p></li><li class="listitem"><p>
        Shared-nothing architecture and multiple-host operation with no
        single point of failure, enabling 99.999% availability.
      </p></li><li class="listitem"><p>
        Automatic data distribution across nodes; application developers
        need not craft custom sharding or partitioning solutions.
      </p></li><li class="listitem"><p>
        Support for variable-length data types (including
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>) not supported by
        <code class="literal">MEMORY</code>.
</p></li></ul>
</div>
<p>
    For a white paper with more detailed comparison of the
    <code class="literal">MEMORY</code> storage engine and MySQL Cluster, see
    <a class="ulink" href="http://www.mysql.com/why-mysql/white-papers/mysql-wp_cluster-7.0_Cluster_MEMORY.php" target="_top">Scaling
    Web Services with MySQL Cluster: An Alternative to the MySQL Memory
    Storage Engine</a>. This white paper includes a performance
    study of the two technologies and a step-by-step guide describing
    how existing <code class="literal">MEMORY</code> users can migrate to MySQL
    Cluster.
</p>
<h3><a name="idp93360640"></a>
    Performance Characteristics
</h3>
<p>
    <code class="literal">MEMORY</code> performance is constrained by contention
    resulting from single-thread execution and table lock overhead when
    processing updates. This limits scalability when load increases,
    particularly for statement mixes that include writes.
  </p><p>
    Despite the in-memory processing for <code class="literal">MEMORY</code>
    tables, they are not necessarily faster than
    <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables on a busy server, for
    general-purpose queries, or under a read/write workload. In
    particular, the table locking involved with performing updates can
    slow down concurrent usage of <code class="literal">MEMORY</code> tables from
    multiple sessions.
  </p><p>
    Depending on the kinds of queries performed on a
    <code class="literal">MEMORY</code> table, you might create indexes as either
    the default hash data structure (for looking up single values based
    on a unique key), or a general-purpose B-tree data structure (for
    all kinds of queries involving equality, inequality, or range
    operators such as less than or greater than). The following sections
    illustrate the syntax for creating both kinds of indexes. A common
    performance issue is using the default hash indexes in workloads
    where B-tree indexes are more efficient.
</p>
<h3><a name="idp93367040"></a>
    Physical Characteristics of <code class="literal">MEMORY</code> Tables
</h3>
<p>
    The <code class="literal">MEMORY</code> storage engine associates each table
    with one disk file, which stores the table definition (not the
    data). The file name begins with the table name and has an extension
    of <code class="filename">.frm</code>.
  </p><p>
    <code class="literal">MEMORY</code> tables have the following characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Space for <code class="literal">MEMORY</code> tables is allocated in small
        blocks. Tables use 100% dynamic hashing for inserts. No overflow
        area or extra key space is needed. No extra space is needed for
        free lists. Deleted rows are put in a linked list and are reused
        when you insert new data into the table.
        <code class="literal">MEMORY</code> tables also have none of the problems
        commonly associated with deletes plus inserts in hashed tables.
      </p></li><li class="listitem"><p>
        <code class="literal">MEMORY</code> tables use a fixed-length row-storage
        format. Variable-length types such as
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> are stored using a fixed
        length.
      </p></li><li class="listitem"><p>
        <code class="literal">MEMORY</code> tables cannot contain
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> or
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns.
      </p></li><li class="listitem"><p>
        <code class="literal">MEMORY</code> includes support for
        <code class="literal">AUTO_INCREMENT</code> columns.
      </p></li><li class="listitem"><p>
        Non-<code class="literal">TEMPORARY</code> <code class="literal">MEMORY</code>
        tables are shared among all clients, just like any other
        non-<code class="literal">TEMPORARY</code> table.
</p></li></ul>
</div>
<h3><a name="idp93385232"></a>
    DDL Operations for <code class="literal">MEMORY</code> Tables
</h3>
<p>
    To create a <code class="literal">MEMORY</code> table, specify the clause
    <code class="literal">ENGINE=MEMORY</code> on the <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
    TABLE</code></a> statement.
  </p><pre class="programlisting">CREATE TABLE t (i INT) ENGINE = MEMORY;</pre><p>
    As indicated by the engine name, <code class="literal">MEMORY</code> tables
    are stored in memory. They use hash indexes by default, which makes
    them very fast for single-value lookups, and very useful for
    creating temporary tables. However, when the server shuts down, all
    rows stored in <code class="literal">MEMORY</code> tables are lost. The tables
    themselves continue to exist because their definitions are stored in
    <code class="filename">.frm</code> files on disk, but they are empty when the
    server restarts.
  </p><p>
    This example shows how you might create, use, and remove a
    <code class="literal">MEMORY</code> table:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test ENGINE=MEMORY</code></strong>
    -&gt;     <strong class="userinput"><code>SELECT ip,SUM(downloads) AS down</code></strong>
    -&gt;     <strong class="userinput"><code>FROM log_table GROUP BY ip;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT COUNT(ip),AVG(down) FROM test;</code></strong>
mysql&gt; <strong class="userinput"><code>DROP TABLE test;</code></strong>
</pre><p>
    The maximum size of <code class="literal">MEMORY</code> tables is limited by
    the <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> system
    variable, which has a default value of 16MB. To enforce different
    size limits for <code class="literal">MEMORY</code> tables, change the value
    of this variable. The value in effect for
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>, or a subsequent
    <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
    <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>, is the value used for
    the life of the table. A server restart also sets the maximum size
    of existing <code class="literal">MEMORY</code> tables to the global
    <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> value. You can
    set the size for individual tables as described later in this
    section.
</p>
<h3><a name="idp93405488"></a>
    Indexes
</h3>
<p>
    The <code class="literal">MEMORY</code> storage engine supports both
    <code class="literal">HASH</code> and <code class="literal">BTREE</code> indexes. You
    can specify one or the other for a given index by adding a
    <code class="literal">USING</code> clause as shown here:
  </p><pre class="programlisting">CREATE TABLE lookup
    (id INT, INDEX USING HASH (id))
    ENGINE = MEMORY;
CREATE TABLE lookup
    (id INT, INDEX USING BTREE (id))
    ENGINE = MEMORY;</pre><p>
    For general characteristics of B-tree and hash indexes, see
    <a class="xref" href="optimization.html#mysql-indexes" title="8.3.1. How MySQL Uses Indexes">Section 8.3.1, “How MySQL Uses Indexes”</a>.
  </p><p>
    <code class="literal">MEMORY</code> tables can have up to 64 indexes per
    table, 16 columns per index and a maximum key length of 3072 bytes.
  </p><p>
    If a <code class="literal">MEMORY</code> table hash index has a high degree of
    key duplication (many index entries containing the same value),
    updates to the table that affect key values and all deletes are
    significantly slower. The degree of this slowdown is proportional to
    the degree of duplication (or, inversely proportional to the index
    cardinality). You can use a <code class="literal">BTREE</code> index to avoid
    this problem.
  </p><p>
    <code class="literal">MEMORY</code> tables can have nonunique keys. (This is
    an uncommon feature for implementations of hash indexes.)
  </p><p>
    Columns that are indexed can contain <code class="literal">NULL</code> values.
</p>
<h3><a name="idp93416928"></a>
    User-Created and Temporary Tables
</h3>
<p>
    <code class="literal">MEMORY</code> table contents are stored in memory, which
    is a property that <code class="literal">MEMORY</code> tables share with
    internal temporary tables that the server creates on the fly while
    processing queries. However, the two types of tables differ in that
    <code class="literal">MEMORY</code> tables are not subject to storage
    conversion, whereas internal temporary tables are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If an internal temporary table becomes too large, the server
        automatically converts it to on-disk storage, as described in
        <a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.3.3. How MySQL Uses Internal Temporary Tables">Section 8.4.3.3, “How MySQL Uses Internal Temporary Tables”</a>.
      </p></li><li class="listitem"><p>
        User-created <code class="literal">MEMORY</code> tables are never
        converted to disk tables.
</p></li></ul>
</div>
<h3><a name="idp93423648"></a>
    Loading Data
</h3>
<p>
    To populate a <code class="literal">MEMORY</code> table when the MySQL server
    starts, you can use the <a class="link" href="server-administration.html#option_mysqld_init-file"><code class="option">--init-file</code></a>
    option. For example, you can put statements such as
    <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1. INSERT ... SELECT Syntax"><code class="literal">INSERT INTO ...
    SELECT</code></a> or <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD
    DATA INFILE</code></a> into this file to load the table from a
    persistent data source. See <a class="xref" href="server-administration.html#server-options" title="5.1.3. Server Command Options">Section 5.1.3, “Server Command Options”</a>, and
    <a class="xref" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax">Section 13.2.6, “<code class="literal">LOAD DATA INFILE</code>
      Syntax”</a>.
  </p><p>
    For loading data into <code class="literal">MEMORY</code> tables accessed by
    other sessions concurrently, <code class="literal">MEMORY</code> supports
    <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a>. See
    <a class="xref" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax">Section 13.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
</p>
<h3><a name="idp93432352"></a>
    <code class="literal">MEMORY</code> Tables and Replication
</h3>
<p>
    A server's <code class="literal">MEMORY</code> tables become empty when it is
    shut down and restarted. If the server is a replication master, its
    slaves are not aware that these tables have become empty, so you see
    out-of-date content if you select data from the tables on the
    slaves. To synchronize master and slave <code class="literal">MEMORY</code>
    tables, when a <code class="literal">MEMORY</code> table is used on a master
    for the first time since it was started, a
    <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statement is written to the
    master's binary log, to empty the table on the slaves also. The
    slave still has outdated data in the table during the interval
    between the master's restart and its first use of the table. To
    avoid this interval when a direct query to the slave could return
    stale data, use the <a class="link" href="server-administration.html#option_mysqld_init-file"><code class="option">--init-file</code></a>
    option to populate the <code class="literal">MEMORY</code> table on the master
    at startup.
</p>
<h3><a name="idp93439136"></a>
    Managing Memory Use
</h3>
<p>
    The server needs sufficient memory to maintain all
    <code class="literal">MEMORY</code> tables that are in use at the same time.
  </p><p>
    Memory is not reclaimed if you delete individual rows from a
    <code class="literal">MEMORY</code> table. Memory is reclaimed only when the
    entire table is deleted. Memory that was previously used for deleted
    rows is re-used for new rows within the same table. To free all the
    memory used by a <code class="literal">MEMORY</code> table when you no longer
    require its contents, execute <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>
    or <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> to remove all rows,
    or remove the table altogether using <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP
    TABLE</code></a>. To free up the memory used by deleted rows, use
    <code class="literal">ALTER TABLE ENGINE=MEMORY</code> to force a table
    rebuild.
  </p><p>
    The memory needed for one row in a <code class="literal">MEMORY</code> table
    is calculated using the following expression:
  </p><pre class="programlisting">SUM_OVER_ALL_BTREE_KEYS(<em class="replaceable"><code>max_length_of_key</code></em> + sizeof(char*) * 4)
+ SUM_OVER_ALL_HASH_KEYS(sizeof(char*) * 2)
+ ALIGN(<em class="replaceable"><code>length_of_row</code></em>+1, sizeof(char*))
</pre><p>
    <code class="literal">ALIGN()</code> represents a round-up factor to cause the
    row length to be an exact multiple of the <code class="literal">char</code>
    pointer size. <code class="literal">sizeof(char*)</code> is 4 on 32-bit
    machines and 8 on 64-bit machines.
  </p><p>
    As mentioned earlier, the
    <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> system variable
    sets the limit on the maximum size of <code class="literal">MEMORY</code>
    tables. To control the maximum size for individual tables, set the
    session value of this variable before creating each table. (Do not
    change the global
    <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> value unless
    you intend the value to be used for <code class="literal">MEMORY</code> tables
    created by all clients.) The following example creates two
    <code class="literal">MEMORY</code> tables, with a maximum size of 1MB and
    2MB, respectively:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET max_heap_table_size = 1024*1024;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (id INT, UNIQUE(id)) ENGINE = MEMORY;</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>SET max_heap_table_size = 1024*1024*2;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>CREATE TABLE t2 (id INT, UNIQUE(id)) ENGINE = MEMORY;</code></strong>
Query OK, 0 rows affected (0.00 sec)
</pre><p>
    Both tables revert to the server's global
    <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> value if the
    server restarts.
  </p><p>
    You can also specify a <code class="literal">MAX_ROWS</code> table option in
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements for
    <code class="literal">MEMORY</code> tables to provide a hint about the number
    of rows you plan to store in them. This does not enable the table to
    grow beyond the <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a>
    value, which still acts as a constraint on maximum table size. For
    maximum flexibility in being able to use
    <code class="literal">MAX_ROWS</code>, set
    <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> at least as
    high as the value to which you want each <code class="literal">MEMORY</code>
    table to be able to grow.
</p>
<h3><a name="idp93467968"></a>
    Additional Resources
</h3>
<p>
    A forum dedicated to the <code class="literal">MEMORY</code> storage engine is
    available at <a class="ulink" href="http://forums.mysql.com/list.php?92" target="_top">http://forums.mysql.com/list.php?92</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="csv-storage-engine"></a>14.5. The <code class="literal">CSV</code> Storage Engine</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#se-csv-repair">14.5.1. Repairing and Checking CSV Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#se-csv-limitations">14.5.2. CSV Limitations</a></span></dt></dl>
</div>
<a class="indexterm" name="idp93471904"></a><a class="indexterm" name="idp93472976"></a><p>
    The <code class="literal">CSV</code> storage engine stores data in text files
    using comma-separated values format.
  </p><p>
    The <code class="literal">CSV</code> storage engine is always compiled into
    the MySQL server.
  </p><p>
    To examine the source for the <code class="literal">CSV</code> engine, look in
    the <code class="filename">storage/csv</code> directory of a MySQL source
    distribution.
  </p><p>
    When you create a <code class="literal">CSV</code> table, the server creates a
    table format file in the database directory. The file begins with
    the table name and has an <code class="filename">.frm</code> extension. The
    storage engine also creates a data file. Its name begins with the
    table name and has a <code class="filename">.CSV</code> extension. The data
    file is a plain text file. When you store data into the table, the
    storage engine saves it into the data file in comma-separated values
    format.
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test (i INT NOT NULL, c CHAR(10) NOT NULL)</code></strong>
    -&gt; <strong class="userinput"><code>ENGINE = CSV;</code></strong>
Query OK, 0 rows affected (0.12 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO test VALUES(1,'record one'),(2,'record two');</code></strong>
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql&gt; <strong class="userinput"><code>SELECT * FROM test;</code></strong>
+------+------------+
| i    | c          |
+------+------------+
|    1 | record one |
|    2 | record two |
+------+------------+
2 rows in set (0.00 sec)
</pre><p>
    Creating a CSV table also creates a corresponding Metafile that
    stores the state of the table and the number of rows that exist in
    the table. The name of this file is the same as the name of the
    table with the extension <code class="filename">CSM</code>.
  </p><p>
    If you examine the <code class="filename">test.CSV</code> file in the
    database directory created by executing the preceding statements,
    its contents should look like this:
  </p><pre class="programlisting">"1","record one"
"2","record two"</pre><p>
    This format can be read, and even written, by spreadsheet
    applications such as Microsoft Excel or StarOffice Calc.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="se-csv-repair"></a>14.5.1. Repairing and Checking CSV Tables</h3>
</div>
</div>
</div>
<p>
      The CSV storage engines supports the <code class="literal">CHECK</code> and
      <code class="literal">REPAIR</code> statements to verify and if possible
      repair a damaged CSV table.
    </p><p>
      When running the <code class="literal">CHECK</code> statement, the CSV file
      will be checked for validity by looking for the correct field
      separators, escaped fields (matching or missing quotation marks),
      the correct number of fields compared to the table definition and
      the existence of a corresponding CSV metafile. The first invalid
      row discovered will report an error. Checking a valid table
      produces output like that shown below:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>check table csvtest;</code></strong>
+--------------+-------+----------+----------+
| Table        | Op    | Msg_type | Msg_text |
+--------------+-------+----------+----------+
| test.csvtest | check | status   | OK       |
+--------------+-------+----------+----------+
1 row in set (0.00 sec)</pre><p>
      A check on a corrupted table returns a fault:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>check table csvtest;</code></strong>
+--------------+-------+----------+----------+
| Table        | Op    | Msg_type | Msg_text |
+--------------+-------+----------+----------+
| test.csvtest | check | error    | Corrupt  |
+--------------+-------+----------+----------+
1 row in set (0.01 sec)</pre><p>
      If the check fails, the table is marked as crashed (corrupt). Once
      a table has been marked as corrupt, it is automatically repaired
      when you next run <code class="literal">CHECK</code> or execute a
      <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement. The corresponding
      corrupt status and new status will be displayed when running
      <code class="literal">CHECK</code>:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>check table csvtest;</code></strong>
+--------------+-------+----------+----------------------------+
| Table        | Op    | Msg_type | Msg_text                   |
+--------------+-------+----------+----------------------------+
| test.csvtest | check | warning  | Table is marked as crashed |
| test.csvtest | check | status   | OK                         |
+--------------+-------+----------+----------------------------+
2 rows in set (0.08 sec)</pre><p>
      To repair a table you can use <code class="literal">REPAIR</code>, this
      copies as many valid rows from the existing CSV data as possible,
      and then replaces the existing CSV file with the recovered rows.
      Any rows beyond the corrupted data are lost.
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>repair table csvtest;</code></strong>
+--------------+--------+----------+----------+
| Table        | Op     | Msg_type | Msg_text |
+--------------+--------+----------+----------+
| test.csvtest | repair | status   | OK       |
+--------------+--------+----------+----------+
1 row in set (0.02 sec)</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p xmlns="">
        Note that during repair, only the rows from the CSV file up to
        the first damaged row are copied to the new table. All other
        rows from the first damaged row to the end of the table are
        removed, even valid rows.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="se-csv-limitations"></a>14.5.2. CSV Limitations</h3>

</div>

</div>

</div>
<p>
      The <code class="literal">CSV</code> storage engine does not support
      indexing.
    </p><p>
      Partitioning is not supported for tables using the
      <code class="literal">CSV</code> storage engine.
    </p><p>
      All tables that you create using the <code class="literal">CSV</code>
      storage engine must have the <code class="literal">NOT NULL</code> attribute
      on all columns. However, for backward compatibility, you can
      continue to use tables with nullable columns that were created in
      previous MySQL releases. (Bug #32050)
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="archive-storage-engine"></a>14.6. The <code class="literal">ARCHIVE</code> Storage Engine</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp93516208"></a><a class="indexterm" name="idp93517280"></a><p>
    The <code class="literal">ARCHIVE</code> storage engine produces
    special-purpose tables that store large amounts of unindexed data in
    a very small footprint.
</p>
<div class="table">
<a name="idp93520016"></a><p class="title"><b>Table 14.11. <code class="literal">ARCHIVE</code> Storage Engine
Features</b></p>
<div class="table-contents">
<table summary="ARCHIVE Storage Engine
Features" border="1"><colgroup><col class="featurev0"><col class="featurevalue0"><col class="featurev1"><col class="featurevalue1"><col class="featurev2"><col class="featurevalue2"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Storage limits</strong></span></td><td>None</td><td><span class="bold"><strong>Transactions</strong></span></td><td>No</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Table</td></tr><tr><td scope="row"><span class="bold"><strong>MVCC</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>B-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>T-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>Full-text search indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Data caches</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>Index caches</strong></span></td><td>No</td><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes</td><td><span class="bold"><strong>Encrypted data<a href="#ftn.idp93543712" class="footnote"><sup class="footnote"><a name="idp93543712"></a>[a]</sup></a></strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td><td><span class="bold"><strong>Replication support<a href="#ftn.idp93546752" class="footnote"><sup class="footnote"><a name="idp93546752"></a>[b]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>No</td></tr><tr><td scope="row"><span class="bold"><strong>Backup / point-in-time recovery<a href="#ftn.idp93549760" class="footnote"><sup class="footnote"><a name="idp93549760"></a>[c]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6">
<div id="ftn.idp93543712" class="footnote">
<p><a href="storage-engines.html#idp93543712" class="para"><sup class="para">[a] </sup></a>Implemented in the server (via encryption functions), rather than in the storage engine.</p>
</div>

<div id="ftn.idp93546752" class="footnote">
<p><a href="storage-engines.html#idp93546752" class="para"><sup class="para">[b] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>

<div id="ftn.idp93549760" class="footnote">
<p><a href="storage-engines.html#idp93549760" class="para"><sup class="para">[c] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>
</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
    The <code class="literal">ARCHIVE</code> storage engine is included in MySQL
    binary distributions. To enable this storage engine if you build
    MySQL from source, invoke <span class="command"><strong>CMake</strong></span> with the
    <a class="link" href="installing.html#option_cmake_storage_engine_options" title="2.9.4.  Storage Engine Options"><code class="option">-DWITH_ARCHIVE_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    To examine the source for the <code class="literal">ARCHIVE</code> engine,
    look in the <code class="filename">storage/archive</code> directory of a
    MySQL source distribution.
  </p><p>
    You can check whether the <code class="literal">ARCHIVE</code> storage engine
    is available with the <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a>
    statement.
  </p><p>
    When you create an <code class="literal">ARCHIVE</code> table, the server
    creates a table format file in the database directory. The file
    begins with the table name and has an <code class="filename">.frm</code>
    extension. The storage engine creates other files, all having names
    beginning with the table name. The data file has an extension of
    <code class="filename">.ARZ</code>. An <code class="filename">.ARN</code> file may
    appear during optimization operations.
  </p><p>
    The <code class="literal">ARCHIVE</code> engine supports
    <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
    <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, but not
    <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
    <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a>, or
    <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>. It does support
    <code class="literal">ORDER BY</code> operations,
    <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns, and basically all but
    spatial data types (see <a class="xref" href="functions.html#mysql-spatial-datatypes" title="12.18.4.1. MySQL Spatial Data Types">Section 12.18.4.1, “MySQL Spatial Data Types”</a>).
    The <code class="literal">ARCHIVE</code> engine uses row-level locking.
  </p><p>
    The <code class="literal">ARCHIVE</code> engine supports the
    <code class="literal">AUTO_INCREMENT</code> column attribute. The
    <code class="literal">AUTO_INCREMENT</code> column can have either a unique or
    nonunique index. Attempting to create an index on any other column
    results in an error. The <code class="literal">ARCHIVE</code> engine also
    supports the <code class="literal">AUTO_INCREMENT</code> table option in
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
    <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to specify the
    initial sequence value for a new table or reset the sequence value
    for an existing table, respectively.
  </p><p>
    The <code class="literal">ARCHIVE</code> engine ignores
    <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns if they are not
    requested and scans past them while reading.
  </p><p>
    <span class="bold"><strong>Storage:</strong></span> Rows are compressed as
    they are inserted. The <code class="literal">ARCHIVE</code> engine uses
    <code class="literal">zlib</code> lossless data compression (see
    <a class="ulink" href="http://www.zlib.net/" target="_top">http://www.zlib.net/</a>). You can use
    <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to analyze the table
    and pack it into a smaller format (for a reason to use
    <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>, see later in this
    section). The engine also supports <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
    TABLE</code></a>. There are several types of insertions that are
    used:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        An <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement just pushes
        rows into a compression buffer, and that buffer flushes as
        necessary. The insertion into the buffer is protected by a lock.
        A <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> forces a flush to occur,
        unless the only insertions that have come in were
        <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> (those flush as
        necessary). See <a class="xref" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax">Section 13.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
      </p></li><li class="listitem"><p>
        A bulk insert is visible only after it completes, unless other
        inserts occur at the same time, in which case it can be seen
        partially. A <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> never causes
        a flush of a bulk insert unless a normal insert occurs while it
        is loading.
</p></li></ul>
</div>
<p>
    <span class="bold"><strong>Retrieval</strong></span>: On retrieval, rows are
    uncompressed on demand; there is no row cache. A
    <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> operation performs a complete
    table scan: When a <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> occurs, it
    finds out how many rows are currently available and reads that
    number of rows. <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is performed
    as a consistent read. Note that lots of
    <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements during insertion
    can deteriorate the compression, unless only bulk or delayed inserts
    are used. To achieve better compression, you can use
    <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
    <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>. The number of rows in
    <code class="literal">ARCHIVE</code> tables reported by
    <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> is always accurate.
    See <a class="xref" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax">Section 13.7.2.4, “<code class="literal">OPTIMIZE TABLE</code> Syntax”</a>,
    <a class="xref" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax">Section 13.7.2.5, “<code class="literal">REPAIR TABLE</code> Syntax”</a>, and
    <a class="xref" href="sql-syntax.html#show-table-status" title="13.7.5.37. SHOW TABLE STATUS Syntax">Section 13.7.5.37, “<code class="literal">SHOW TABLE STATUS</code> Syntax”</a>.
</p>
<h3><a name="idp93602192"></a>
    Additional Resources
</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        A forum dedicated to the <code class="literal">ARCHIVE</code> storage
        engine is available at <a class="ulink" href="http://forums.mysql.com/list.php?112" target="_top">http://forums.mysql.com/list.php?112</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="blackhole-storage-engine"></a>14.7. The <code class="literal">BLACKHOLE</code> Storage Engine</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp93606960"></a><a class="indexterm" name="idp93608048"></a><p>
    The <code class="literal">BLACKHOLE</code> storage engine acts as a
    <span class="quote">“<span class="quote">black hole</span>”</span> that accepts data but throws it away and
    does not store it. Retrievals always return an empty result:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test(i INT, c CHAR(10)) ENGINE = BLACKHOLE;</code></strong>
Query OK, 0 rows affected (0.03 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO test VALUES(1,'record one'),(2,'record two');</code></strong>
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql&gt; <strong class="userinput"><code>SELECT * FROM test;</code></strong>
Empty set (0.00 sec)
</pre><p>
    To enable the <code class="literal">BLACKHOLE</code> storage engine if you
    build MySQL from source, invoke <span class="command"><strong>CMake</strong></span> with the
    <a class="link" href="installing.html#option_cmake_storage_engine_options" title="2.9.4.  Storage Engine Options"><code class="option">-DWITH_BLACKHOLE_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    To examine the source for the <code class="literal">BLACKHOLE</code> engine,
    look in the <code class="filename">sql</code> directory of a MySQL source
    distribution.
  </p><p>
    When you create a <code class="literal">BLACKHOLE</code> table, the server
    creates a table format file in the database directory. The file
    begins with the table name and has an <code class="filename">.frm</code>
    extension. There are no other files associated with the table.
  </p><p>
    The <code class="literal">BLACKHOLE</code> storage engine supports all kinds
    of indexes. That is, you can include index declarations in the table
    definition.
  </p><p>
    You can check whether the <code class="literal">BLACKHOLE</code> storage
    engine is available with the <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW
    ENGINES</code></a> statement.
  </p><p>
    Inserts into a <code class="literal">BLACKHOLE</code> table do not store any
    data, but if statement based binary logging is enabled, the SQL
    statements are logged and replicated to slave servers. This can be
    useful as a repeater or filter mechanism.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
      When using the row based format for the binary log, updates and
      deletes are skipped, and neither logged nor applied. For this
      reason, you should use STATEMENT for the binary logging format,
      and not ROW or MIXED.
</p>
</div>
<p>
    Suppose that your application requires slave-side filtering rules,
    but transferring all binary log data to the slave first results in
    too much traffic. In such a case, it is possible to set up on the
    master host a <span class="quote">“<span class="quote">dummy</span>”</span> slave process whose default
    storage engine is <code class="literal">BLACKHOLE</code>, depicted as follows:
</p>
<div class="mediaobject">
<img src="images/blackhole-1.png" width="520" height="245" alt="Replication using BLACKHOLE for filtering">
</div>
<p>
    The master writes to its binary log. The <span class="quote">“<span class="quote">dummy</span>”</span>
    <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process acts as a slave, applying the
    desired combination of <code class="literal">replicate-do-*</code> and
    <code class="literal">replicate-ignore-*</code> rules, and writes a new,
    filtered binary log of its own. (See
    <a class="xref" href="replication.html#replication-options" title="16.1.4. Replication and Binary Logging Options and Variables">Section 16.1.4, “Replication and Binary Logging Options and Variables”</a>.) This filtered log is
    provided to the slave.
  </p><p>
    The dummy process does not actually store any data, so there is
    little processing overhead incurred by running the additional
    <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process on the replication master host.
    This type of setup can be repeated with additional replication
    slaves.
  </p><p>
    <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> triggers for
    <code class="literal">BLACKHOLE</code> tables work as expected. However,
    because the <code class="literal">BLACKHOLE</code> table does not actually
    store any data, <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> and
    <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> triggers are not activated:
    The <code class="literal">FOR EACH ROW</code> clause in the trigger definition
    does not apply because there are no rows.
  </p><p>
    Other possible uses for the <code class="literal">BLACKHOLE</code> storage
    engine include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Verification of dump file syntax.
      </p></li><li class="listitem"><p>
        Measurement of the overhead from binary logging, by comparing
        performance using <code class="literal">BLACKHOLE</code> with and without
        binary logging enabled.
      </p></li><li class="listitem"><p>
        <code class="literal">BLACKHOLE</code> is essentially a
        <span class="quote">“<span class="quote">no-op</span>”</span> storage engine, so it could be used for
        finding performance bottlenecks not related to the storage
        engine itself.
</p></li></ul>
</div>
<p>
    The <code class="literal">BLACKHOLE</code> engine is transaction-aware, in the
    sense that committed transactions are written to the binary log and
    rolled-back transactions are not.
  </p><p>
    <span class="bold"><strong>Blackhole Engine and Auto Increment
    Columns</strong></span>
  </p><p>
    The Blackhole engine is a no-op engine. Any operations performed on
    a table using Blackhole will have no effect. This should be born in
    mind when considering the behavior of primary key columns that auto
    increment. The engine will not automatically increment field values,
    and does not retain auto increment field state. This has important
    implications in replication.
  </p><p>
    Consider the following replication scenario where all three of the
    following conditions apply:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        On a master server there is a blackhole table with an auto
        increment field that is a primary key.
      </p></li><li class="listitem"><p>
        On a slave the same table exists but using the MyISAM engine.
      </p></li><li class="listitem"><p>
        Inserts are performed into the master's table without explicitly
        setting the auto increment value in the
        <code class="literal">INSERT</code> statement itself or through using a
        <code class="literal">SET INSERT_ID</code> statement.
</p></li></ol>
</div>
<p>
    In this scenario replication will fail with a duplicate entry error
    on the primary key column.
  </p><p>
    In statement based replication, the value of
    <code class="literal">INSERT_ID</code> in the context event will always be the
    same. Replication will therefore fail due to trying insert a row
    with a duplicate value for a primary key column.
  </p><p>
    In row based replication, the value that the engine returns for the
    row always be the same for each insert. This will result in the
    slave attempting to replay two insert log entries using the same
    value for the primary key column, and so replication will fail.
  </p><p>
    <span class="bold"><strong>Column Filtering</strong></span>
  </p><p>
    When using row-based replication,
    (<a class="link" href="replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a>), a slave where
    the last columns are missing from a table is supported, as described
    in the section
    <a class="xref" href="replication.html#replication-features-differing-tables" title="16.4.1.9. Replication with Differing Table Definitions on Master and Slave">Section 16.4.1.9, “Replication with Differing Table Definitions on Master and Slave”</a>.
  </p><p>
    This filtering works on the slave side, that is, the columns are
    copied to the slave before they are filtered out. There are at least
    two cases where it is not desirable to copy the columns to the
    slave:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        If the data is confidential, so the slave server should not have
        access to it.
      </p></li><li class="listitem"><p>
        If the master has many slaves, filtering before sending to the
        slaves may reduce network traffic.
</p></li></ol>
</div>
<p>
    Master column filtering can be achieved using the
    <code class="literal">BLACKHOLE</code> engine. This is carried out in a way
    similar to how master table filtering is achieved - by using the
    <code class="literal">BLACKHOLE</code> engine and the
    <a class="link" href="replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a> or
    <a class="link" href="replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a> option.
  </p><p>
    The setup for the master is:
  </p><pre class="programlisting">CREATE TABLE t1 (public_col_1, ..., public_col_N,
                 secret_col_1, ..., secret_col_M) ENGINE=MyISAM;</pre><p>
    The setup for the trusted slave is:
  </p><pre class="programlisting">CREATE TABLE t1 (public_col_1, ..., public_col_N) ENGINE=BLACKHOLE;</pre><p>
    The setup for the untrusted slave is:
</p><pre class="programlisting">CREATE TABLE t1 (public_col_1, ..., public_col_N) ENGINE=MyISAM;</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="merge-storage-engine"></a>14.8. The <code class="literal">MERGE</code> Storage Engine</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#merge-table-advantages">14.8.1. <code class="literal">MERGE</code> Table Advantages and Disadvantages</a></span></dt><dt><span class="section"><a href="storage-engines.html#merge-table-problems">14.8.2. <code class="literal">MERGE</code> Table Problems</a></span></dt></dl>
</div>
<a class="indexterm" name="idp93677920"></a><a class="indexterm" name="idp93678992"></a><a class="indexterm" name="idp93680480"></a><a class="indexterm" name="idp93681968"></a><a class="indexterm" name="idp93683456"></a><p>
    The <code class="literal">MERGE</code> storage engine, also known as the
    <code class="literal">MRG_MyISAM</code> engine, is a collection of identical
    <code class="literal">MyISAM</code> tables that can be used as one.
    <span class="quote">“<span class="quote">Identical</span>”</span> means that all tables have identical column
    and index information. You cannot merge <code class="literal">MyISAM</code>
    tables in which the columns are listed in a different order, do not
    have exactly the same columns, or have the indexes in different
    order. However, any or all of the <code class="literal">MyISAM</code> tables
    can be compressed with <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a>. See
    <a class="xref" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables">Section 4.6.5, “<span class="command"><strong>myisampack</strong></span> — Generate Compressed, Read-Only MyISAM Tables”</a>. Differences in table options such as
    <code class="literal">AVG_ROW_LENGTH</code>, <code class="literal">MAX_ROWS</code>, or
    <code class="literal">PACK_KEYS</code> do not matter.
  </p><p>
    An alternative to a <code class="literal">MERGE</code> table is a partitioned
    table, which stores partitions of a single table in separate files.
    Partitioning enables some operations to be performed more
    efficiently and is not limited to the <code class="literal">MyISAM</code>
    storage engine. For more information, see
    <a class="xref" href="partitioning.html" title="Chapter 18. Partitioning">Chapter 18, <i>Partitioning</i></a>.
  </p><p>
    When you create a <code class="literal">MERGE</code> table, MySQL creates two
    files on disk. The files have names that begin with the table name
    and have an extension to indicate the file type. An
    <code class="filename">.frm</code> file stores the table format, and an
    <code class="filename">.MRG</code> file contains the names of the underlying
    <code class="literal">MyISAM</code> tables that should be used as one. The
    tables do not have to be in the same database as the
    <code class="literal">MERGE</code> table.
  </p><p>
    You can use <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
    <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
    <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
    <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> on <code class="literal">MERGE</code>
    tables. You must have <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a>,
    <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a>, and
    <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a> privileges on the
    <code class="literal">MyISAM</code> tables that you map to a
    <code class="literal">MERGE</code> table.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
      The use of <code class="literal">MERGE</code> tables entails the following
      security issue: If a user has access to <code class="literal">MyISAM</code>
      table <em class="replaceable"><code>t</code></em>, that user can create a
      <code class="literal">MERGE</code> table <em class="replaceable"><code>m</code></em> that
      accesses <em class="replaceable"><code>t</code></em>. However, if the user's
      privileges on <em class="replaceable"><code>t</code></em> are subsequently
      revoked, the user can continue to access
      <em class="replaceable"><code>t</code></em> by doing so through
      <em class="replaceable"><code>m</code></em>.
</p>
</div>
<p>
    Use of <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> with a
    <code class="literal">MERGE</code> table drops only the
    <code class="literal">MERGE</code> specification. The underlying tables are
    not affected.
  </p><p>
    To create a <code class="literal">MERGE</code> table, you must specify a
    <code class="literal">UNION=(<em class="replaceable"><code>list-of-tables</code></em>)</code>
    option that indicates which <code class="literal">MyISAM</code> tables to use.
    You can optionally specify an <code class="literal">INSERT_METHOD</code>
    option to control how inserts into the <code class="literal">MERGE</code>
    table take place. Use a value of <code class="literal">FIRST</code> or
    <code class="literal">LAST</code> to cause inserts to be made in the first or
    last underlying table, respectively. If you specify no
    <code class="literal">INSERT_METHOD</code> option or if you specify it with a
    value of <code class="literal">NO</code>, inserts into the
    <code class="literal">MERGE</code> table are not permitted and attempts to do
    so result in an error.
  </p><p>
    The following example shows how to create a <code class="literal">MERGE</code>
    table:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (</code></strong>
    -&gt;    <strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong>
    -&gt;    <strong class="userinput"><code>message CHAR(20)) ENGINE=MyISAM;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t2 (</code></strong>
    -&gt;    <strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong>
    -&gt;    <strong class="userinput"><code>message CHAR(20)) ENGINE=MyISAM;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO t1 (message) VALUES ('Testing'),('table'),('t1');</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO t2 (message) VALUES ('Testing'),('table'),('t2');</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE total (</code></strong>
    -&gt;    <strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT,</code></strong>
    -&gt;    <strong class="userinput"><code>message CHAR(20), INDEX(a))</code></strong>
    -&gt;    <strong class="userinput"><code>ENGINE=MERGE UNION=(t1,t2) INSERT_METHOD=LAST;</code></strong>
</pre><p>
    Note that column <code class="literal">a</code> is indexed as a
    <code class="literal">PRIMARY KEY</code> in the underlying
    <code class="literal">MyISAM</code> tables, but not in the
    <code class="literal">MERGE</code> table. There it is indexed but not as a
    <code class="literal">PRIMARY KEY</code> because a <code class="literal">MERGE</code>
    table cannot enforce uniqueness over the set of underlying tables.
    (Similarly, a column with a <code class="literal">UNIQUE</code> index in the
    underlying tables should be indexed in the <code class="literal">MERGE</code>
    table but not as a <code class="literal">UNIQUE</code> index.)
  </p><p>
    After creating the <code class="literal">MERGE</code> table, you can use it to
    issue queries that operate on the group of tables as a whole:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM total;</code></strong>
+---+---------+
| a | message |
+---+---------+
| 1 | Testing |
| 2 | table   |
| 3 | t1      |
| 1 | Testing |
| 2 | table   |
| 3 | t2      |
+---+---------+
</pre><p>
    To remap a <code class="literal">MERGE</code> table to a different collection
    of <code class="literal">MyISAM</code> tables, you can use one of the
    following methods:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">DROP</code> the <code class="literal">MERGE</code> table and
        re-create it.
      </p></li><li class="listitem"><p>
        Use <code class="literal">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em>
        UNION=(...)</code> to change the list of underlying tables.
      </p><p>
        It is also possible to use <code class="literal">ALTER TABLE ...
        UNION=()</code> (that is, with an empty
        <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> clause) to remove all of
        the underlying tables.
</p></li></ul>
</div>
<p>
    The underlying table definitions and indexes must conform closely to
    the definition of the <code class="literal">MERGE</code> table. Conformance is
    checked when a table that is part of a <code class="literal">MERGE</code>
    table is opened, not when the <code class="literal">MERGE</code> table is
    created. If any table fails the conformance checks, the operation
    that triggered the opening of the table fails. This means that
    changes to the definitions of tables within a
    <code class="literal">MERGE</code> may cause a failure when the
    <code class="literal">MERGE</code> table is accessed. The conformance checks
    applied to each table are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The underlying table and the <code class="literal">MERGE</code> table must
        have the same number of columns.
      </p></li><li class="listitem"><p>
        The column order in the underlying table and the
        <code class="literal">MERGE</code> table must match.
      </p></li><li class="listitem"><p>
        Additionally, the specification for each corresponding column in
        the parent <code class="literal">MERGE</code> table and the underlying
        tables are compared and must satisfy these checks:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            The column type in the underlying table and the
            <code class="literal">MERGE</code> table must be equal.
          </p></li><li class="listitem"><p>
            The column length in the underlying table and the
            <code class="literal">MERGE</code> table must be equal.
          </p></li><li class="listitem"><p>
            The column of the underlying table and the
            <code class="literal">MERGE</code> table can be
            <code class="literal">NULL</code>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
        The underlying table must have at least as many indexes as the
        <code class="literal">MERGE</code> table. The underlying table may have
        more indexes than the <code class="literal">MERGE</code> table, but cannot
        have fewer.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          A known issue exists where indexes on the same columns must be
          in identical order, in both the <code class="literal">MERGE</code> table
          and the underlying <code class="literal">MyISAM</code> table. See Bug
          #33653.
</p>
</div>
<p>
        Each index must satisfy these checks:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            The index type of the underlying table and the
            <code class="literal">MERGE</code> table must be the same.
          </p></li><li class="listitem"><p>
            The number of index parts (that is, multiple columns within
            a compound index) in the index definition for the underlying
            table and the <code class="literal">MERGE</code> table must be the
            same.
          </p></li><li class="listitem"><p>
            For each index part:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                Index part lengths must be equal.
              </p></li><li class="listitem"><p>
                Index part types must be equal.
              </p></li><li class="listitem"><p>
                Index part languages must be equal.
              </p></li><li class="listitem"><p>
                Check whether index parts can be
                <code class="literal">NULL</code>.
</p></li></ul>
</div>
</li></ul>
</div>
</li></ul>
</div>
<p>
    If a <code class="literal">MERGE</code> table cannot be opened or used because
    of a problem with an underlying table, <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
    TABLE</code></a> displays information about which table caused the
    problem.
</p>
<h3><a name="idp93789776"></a>
    Additional Resources
</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        A forum dedicated to the <code class="literal">MERGE</code> storage engine
        is available at <a class="ulink" href="http://forums.mysql.com/list.php?93" target="_top">http://forums.mysql.com/list.php?93</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="merge-table-advantages"></a>14.8.1. <code class="literal">MERGE</code> Table Advantages and Disadvantages</h3>

</div>

</div>

</div>
<p>
      <code class="literal">MERGE</code> tables can help you solve the following
      problems:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Easily manage a set of log tables. For example, you can put
          data from different months into separate tables, compress some
          of them with <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a>, and then create a
          <code class="literal">MERGE</code> table to use them as one.
        </p></li><li class="listitem"><p>
          Obtain more speed. You can split a large read-only table based
          on some criteria, and then put individual tables on different
          disks. A <code class="literal">MERGE</code> table structured this way
          could be much faster than using a single large table.
        </p></li><li class="listitem"><p>
          Perform more efficient searches. If you know exactly what you
          are looking for, you can search in just one of the underlying
          tables for some queries and use a <code class="literal">MERGE</code>
          table for others. You can even have many different
          <code class="literal">MERGE</code> tables that use overlapping sets of
          tables.
        </p></li><li class="listitem"><p>
          Perform more efficient repairs. It is easier to repair
          individual smaller tables that are mapped to a
          <code class="literal">MERGE</code> table than to repair a single large
          table.
        </p></li><li class="listitem"><p>
          Instantly map many tables as one. A <code class="literal">MERGE</code>
          table need not maintain an index of its own because it uses
          the indexes of the individual tables. As a result,
          <code class="literal">MERGE</code> table collections are
          <span class="emphasis"><em>very</em></span> fast to create or remap. (You must
          still specify the index definitions when you create a
          <code class="literal">MERGE</code> table, even though no indexes are
          created.)
        </p></li><li class="listitem"><p>
          If you have a set of tables from which you create a large
          table on demand, you can instead create a
          <code class="literal">MERGE</code> table from them on demand. This is
          much faster and saves a lot of disk space.
        </p></li><li class="listitem"><p>
          Exceed the file size limit for the operating system. Each
          <code class="literal">MyISAM</code> table is bound by this limit, but a
          collection of <code class="literal">MyISAM</code> tables is not.
        </p></li><li class="listitem"><p>
          You can create an alias or synonym for a
          <code class="literal">MyISAM</code> table by defining a
          <code class="literal">MERGE</code> table that maps to that single table.
          There should be no really notable performance impact from
          doing this (only a couple of indirect calls and
          <code class="literal">memcpy()</code> calls for each read).
</p></li></ul>
</div>
<p>
      The disadvantages of <code class="literal">MERGE</code> tables are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You can use only identical <code class="literal">MyISAM</code> tables
          for a <code class="literal">MERGE</code> table.
        </p></li><li class="listitem"><p>
          Some <code class="literal">MyISAM</code> features are unavailable in
          <code class="literal">MERGE</code> tables. For example, you cannot
          create <code class="literal">FULLTEXT</code> indexes on
          <code class="literal">MERGE</code> tables. (You can create
          <code class="literal">FULLTEXT</code> indexes on the underlying
          <code class="literal">MyISAM</code> tables, but you cannot search the
          <code class="literal">MERGE</code> table with a full-text search.)
        </p></li><li class="listitem"><p>
          If the <code class="literal">MERGE</code> table is nontemporary, all
          underlying <code class="literal">MyISAM</code> tables must be
          nontemporary. If the <code class="literal">MERGE</code> table is
          temporary, the <code class="literal">MyISAM</code> tables can be any mix
          of temporary and nontemporary.
        </p></li><li class="listitem"><p>
          <code class="literal">MERGE</code> tables use more file descriptors than
          <code class="literal">MyISAM</code> tables. If 10 clients are using a
          <code class="literal">MERGE</code> table that maps to 10 tables, the
          server uses (10 × 10) + 10 file descriptors. (10 data
          file descriptors for each of the 10 clients, and 10 index file
          descriptors shared among the clients.)
        </p></li><li class="listitem"><p>
          Index reads are slower. When you read an index, the
          <code class="literal">MERGE</code> storage engine needs to issue a read
          on all underlying tables to check which one most closely
          matches a given index value. To read the next index value, the
          <code class="literal">MERGE</code> storage engine needs to search the
          read buffers to find the next value. Only when one index
          buffer is used up does the storage engine need to read the
          next index block. This makes <code class="literal">MERGE</code> indexes
          much slower on <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
          searches, but not much slower on
          <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> searches. For more
          information about <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
          and <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>, see
          <a class="xref" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax">Section 13.8.2, “<code class="literal">EXPLAIN</code> Syntax”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="merge-table-problems"></a>14.8.2. <code class="literal">MERGE</code> Table Problems</h3>

</div>

</div>

</div>
<p>
      The following are known problems with <code class="literal">MERGE</code>
      tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          In versions of MySQL Server prior to 5.1.23, it was possible
          to create temporary merge tables with nontemporary child
          MyISAM tables.
        </p><p>
          From versions 5.1.23, MERGE children were locked through the
          parent table. If the parent was temporary, it was not locked
          and so the children were not locked either. Parallel use of
          the MyISAM tables corrupted them.
        </p></li><li class="listitem"><p>
          If you use <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to
          change a <code class="literal">MERGE</code> table to another storage
          engine, the mapping to the underlying tables is lost. Instead,
          the rows from the underlying <code class="literal">MyISAM</code> tables
          are copied into the altered table, which then uses the
          specified storage engine.
        </p></li><li class="listitem"><p>
          The <code class="literal">INSERT_METHOD</code> table option for a
          <code class="literal">MERGE</code> table indicates which underlying
          <code class="literal">MyISAM</code> table to use for inserts into the
          <code class="literal">MERGE</code> table. However, use of the
          <code class="literal">AUTO_INCREMENT</code> table option for that
          <code class="literal">MyISAM</code> table has no effect for inserts into
          the <code class="literal">MERGE</code> table until at least one row has
          been inserted directly into the <code class="literal">MyISAM</code>
          table.
        </p></li><li class="listitem"><p>
          A <code class="literal">MERGE</code> table cannot maintain uniqueness
          constraints over the entire table. When you perform an
          <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>, the data goes into the
          first or last <code class="literal">MyISAM</code> table (as determined
          by the <code class="literal">INSERT_METHOD</code> option). MySQL ensures
          that unique key values remain unique within that
          <code class="literal">MyISAM</code> table, but not over all the
          underlying tables in the collection.
        </p></li><li class="listitem"><p>
          Because the <code class="literal">MERGE</code> engine cannot enforce
          uniqueness over the set of underlying tables,
          <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> does not work as
          expected. The two key facts are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> can detect unique
              key violations only in the underlying table to which it is
              going to write (which is determined by the
              <code class="literal">INSERT_METHOD</code> option). This differs
              from violations in the <code class="literal">MERGE</code> table
              itself.
            </p></li><li class="listitem"><p>
              If <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> detects a unique
              key violation, it will change only the corresponding row
              in the underlying table it is writing to; that is, the
              first or last table, as determined by the
              <code class="literal">INSERT_METHOD</code> option.
</p></li></ul>
</div>
<p>
          Similar considerations apply for
          <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3. INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a>.
        </p></li><li class="listitem"><p>
          <code class="literal">MERGE</code> tables do not support partitioning.
          That is, you cannot partition a <code class="literal">MERGE</code>
          table, nor can any of a <code class="literal">MERGE</code> table's
          underlying <code class="literal">MyISAM</code> tables be partitioned.
        </p></li><li class="listitem"><p>
          You should not use <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>, <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>,
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>,
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>,
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> without a
          <code class="literal">WHERE</code> clause, or
          <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> on any of the
          tables that are mapped into an open <code class="literal">MERGE</code>
          table. If you do so, the <code class="literal">MERGE</code> table may
          still refer to the original table and yield unexpected
          results. To work around this problem, ensure that no
          <code class="literal">MERGE</code> tables remain open by issuing a
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
          statement prior to performing any of the named operations.
        </p><p>
          The unexpected results include the possibility that the
          operation on the <code class="literal">MERGE</code> table will report
          table corruption. If this occurs after one of the named
          operations on the underlying <code class="literal">MyISAM</code> tables,
          the corruption message is spurious. To deal with this, issue a
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
          statement after modifying the <code class="literal">MyISAM</code>
          tables.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> on a table that is
          in use by a <code class="literal">MERGE</code> table does not work on
          Windows because the <code class="literal">MERGE</code> storage engine's
          table mapping is hidden from the upper layer of MySQL. Windows
          does not permit open files to be deleted, so you first must
          flush all <code class="literal">MERGE</code> tables (with
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>)
          or drop the <code class="literal">MERGE</code> table before dropping the
          table.
        </p></li><li class="listitem"><p>
          The definition of the <code class="literal">MyISAM</code> tables and the
          <code class="literal">MERGE</code> table are checked when the tables are
          accessed (for example, as part of a
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> or
          <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement). The checks
          ensure that the definitions of the tables and the parent
          <code class="literal">MERGE</code> table definition match by comparing
          column order, types, sizes and associated indexes. If there is
          a difference between the tables, an error is returned and the
          statement fails. Because these checks take place when the
          tables are opened, any changes to the definition of a single
          table, including column changes, column ordering, and engine
          alterations will cause the statement to fail.
        </p></li><li class="listitem"><p>
          The order of indexes in the <code class="literal">MERGE</code> table and
          its underlying tables should be the same. If you use
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a
          <code class="literal">UNIQUE</code> index to a table used in a
          <code class="literal">MERGE</code> table, and then use
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a nonunique
          index on the <code class="literal">MERGE</code> table, the index
          ordering is different for the tables if there was already a
          nonunique index in the underlying table. (This happens because
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> puts
          <code class="literal">UNIQUE</code> indexes before nonunique indexes to
          facilitate rapid detection of duplicate keys.) Consequently,
          queries on tables with such indexes may return unexpected
          results.
        </p></li><li class="listitem"><p>
          If you encounter an error message similar to <span class="errortext">ERROR
          1017 (HY000): Can't find file:
          '<em class="replaceable"><code>tbl_name</code></em>.MRG' (errno:
          2)</span>, it generally indicates that some of the
          underlying tables do not use the <code class="literal">MyISAM</code>
          storage engine. Confirm that all of these tables are
          <code class="literal">MyISAM</code>.
        </p></li><li class="listitem"><p>
          The maximum number of rows in a <code class="literal">MERGE</code> table
          is 2<sup>64</sup> (~1.844E+19; the same as for
          a <code class="literal">MyISAM</code> table). It is not possible to
          merge multiple <code class="literal">MyISAM</code> tables into a single
          <code class="literal">MERGE</code> table that would have more than this
          number of rows.
        </p></li><li class="listitem"><p>
          The <code class="literal">MERGE</code> storage engine does not support
          <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statements.
        </p></li><li class="listitem"><p>
          Use of underlying <code class="literal">MyISAM</code> tables of
          differing row formats with a parent <code class="literal">MERGE</code>
          table is currently known to fail. See Bug #32364.
        </p></li><li class="listitem"><p>
          You cannot change the union list of a nontemporary
          <code class="literal">MERGE</code> table when <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a> is in effect. The following does
          <span class="emphasis"><em>not</em></span> work:
        </p><pre class="programlisting">CREATE TABLE m1 ... ENGINE=MRG_MYISAM ...;
LOCK TABLES t1 WRITE, t2 WRITE, m1 WRITE;
ALTER TABLE m1 ... UNION=(t1,t2) ...;</pre><p>
          However, you can do this with a temporary
          <code class="literal">MERGE</code> table.
        </p></li><li class="listitem"><p>
          You cannot create a <code class="literal">MERGE</code> table with
          <code class="literal">CREATE ... SELECT</code>, neither as a temporary
          <code class="literal">MERGE</code> table, nor as a nontemporary
          <code class="literal">MERGE</code> table. For example:
        </p><pre class="programlisting">CREATE TABLE m1 ... ENGINE=MRG_MYISAM ... SELECT ...;</pre><p>
          Attempts to do this result in an error:
          <em class="replaceable"><code>tbl_name</code></em> is not <code class="literal">BASE
          TABLE</code>.
        </p></li><li class="listitem"><p>
          In some cases, differing <code class="literal">PACK_KEYS</code> table
          option values among the <code class="literal">MERGE</code> and
          underlying tables cause unexpected results if the underlying
          tables contain <code class="literal">CHAR</code> or
          <code class="literal">BINARY</code> columns. As a workaround, use
          <code class="literal">ALTER TABLE</code> to ensure that all involved
          tables have the same <code class="literal">PACK_KEYS</code> value. (Bug
          #50646)
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="federated-storage-engine"></a>14.9. The <code class="literal">FEDERATED</code> Storage Engine</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#federated-description">14.9.1. <code class="literal">FEDERATED</code> Storage Engine Overview</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-create">14.9.2. How to Create <code class="literal">FEDERATED</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-usagenotes">14.9.3. <code class="literal">FEDERATED</code> Storage Engine Notes and Tips</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-storage-engine-resources">14.9.4. <code class="literal">FEDERATED</code> Storage Engine Resources</a></span></dt></dl>
</div>
<a class="indexterm" name="idp93936784"></a><a class="indexterm" name="idp93937872"></a><p>
    The <code class="literal">FEDERATED</code> storage engine lets you access data
    from a remote MySQL database without using replication or cluster
    technology. Querying a local <code class="literal">FEDERATED</code> table
    automatically pulls the data from the remote (federated) tables. No
    data is stored on the local tables.
  </p><p>
    To include the <code class="literal">FEDERATED</code> storage engine if you
    build MySQL from source, invoke <span class="command"><strong>CMake</strong></span> with the
    <a class="link" href="installing.html#option_cmake_storage_engine_options" title="2.9.4.  Storage Engine Options"><code class="option">-DWITH_FEDERATED_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    The <code class="literal">FEDERATED</code> storage engine is not enabled by
    default in the running server; to enable
    <code class="literal">FEDERATED</code>, you must start the MySQL server binary
    using the <code class="option">--federated</code> option.
  </p><p>
    To examine the source for the <code class="literal">FEDERATED</code> engine,
    look in the <code class="filename">storage/federated</code> directory of a
    MySQL source distribution.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-description"></a>14.9.1. <code class="literal">FEDERATED</code> Storage Engine Overview</h3>
</div>
</div>
</div>
<p>
      When you create a table using one of the standard storage engines
      (such as <code class="literal">MyISAM</code>, <code class="literal">CSV</code> or
      <code class="literal">InnoDB</code>), the table consists of the table
      definition and the associated data. When you create a
      <code class="literal">FEDERATED</code> table, the table definition is the
      same, but the physical storage of the data is handled on a remote
      server.
    </p><p>
      A <code class="literal">FEDERATED</code> table consists of two elements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A <span class="emphasis"><em>remote server</em></span> with a database table,
          which in turn consists of the table definition (stored in the
          <code class="filename">.frm</code> file) and the associated table. The
          table type of the remote table may be any type supported by
          the remote <code class="literal">mysqld</code> server, including
          <code class="literal">MyISAM</code> or <code class="literal">InnoDB</code>.
        </p></li><li class="listitem"><p>
          A <span class="emphasis"><em>local server</em></span> with a database table,
          where the table definition matches that of the corresponding
          table on the remote server. The table definition is stored
          within the <code class="filename">.frm</code> file. However, there is
          no data file on the local server. Instead, the table
          definition includes a connection string that points to the
          remote table.
</p></li></ul>
</div>
<p>
      When executing queries and statements on a
      <code class="literal">FEDERATED</code> table on the local server, the
      operations that would normally insert, update or delete
      information from a local data file are instead sent to the remote
      server for execution, where they update the data file on the
      remote server or return matching rows from the remote server.
    </p><p>
      The basic structure of a <code class="literal">FEDERATED</code> table setup
      is shown in <a class="xref" href="storage-engines.html#figure-se-federated-structure" title="Figure 14.1. FEDERATED Table Structure">Figure 14.1, “<code class="literal">FEDERATED</code> Table Structure”</a>.
</p>
<div class="figure">
<a name="figure-se-federated-structure"></a><p class="title"><b>Figure 14.1. <code class="literal">FEDERATED</code> Table Structure</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/se-federated-structure.png" width="475" height="269" alt="FEDERATED table structure">
</div>

</div>

</div>
<br class="figure-break"><p>
      When a client issues an SQL statement that refers to a
      <code class="literal">FEDERATED</code> table, the flow of information
      between the local server (where the SQL statement is executed) and
      the remote server (where the data is physically stored) is as
      follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          The storage engine looks through each column that the
          <code class="literal">FEDERATED</code> table has and constructs an
          appropriate SQL statement that refers to the remote table.
        </p></li><li class="listitem"><p>
          The statement is sent to the remote server using the MySQL
          client API.
        </p></li><li class="listitem"><p>
          The remote server processes the statement and the local server
          retrieves any result that the statement produces (an
          affected-rows count or a result set).
        </p></li><li class="listitem"><p>
          If the statement produces a result set, each column is
          converted to internal storage engine format that the
          <code class="literal">FEDERATED</code> engine expects and can use to
          display the result to the client that issued the original
          statement.
</p></li></ol>
</div>
<p>
      The local server communicates with the remote server using MySQL
      client C API functions. It invokes
      <a class="link" href="connectors-apis.html#mysql-real-query" title="22.8.7.55. mysql_real_query()"><code class="literal">mysql_real_query()</code></a> to send the
      statement. To read a result set, it uses
      <a class="link" href="connectors-apis.html#mysql-store-result" title="22.8.7.70. mysql_store_result()"><code class="literal">mysql_store_result()</code></a> and fetches
      rows one at a time using
      <a class="link" href="connectors-apis.html#mysql-fetch-row" title="22.8.7.21. mysql_fetch_row()"><code class="literal">mysql_fetch_row()</code></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-create"></a>14.9.2. How to Create <code class="literal">FEDERATED</code> Tables</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#federated-create-connection">14.9.2.1. Creating a <code class="literal">FEDERATED</code> Table Using
        <code class="literal">CONNECTION</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-create-server">14.9.2.2. Creating a <code class="literal">FEDERATED</code> Table Using
<code class="literal">CREATE SERVER</code></a></span></dt></dl>
</div>
<p>
      To create a <code class="literal">FEDERATED</code> table you should follow
      these steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Create the table on the remote server. Alternatively, make a
          note of the table definition of an existing table, perhaps
          using the <a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a>
          statement.
        </p></li><li class="listitem"><p>
          Create the table on the local server with an identical table
          definition, but adding the connection information that links
          the local table to the remote table.
</p></li></ol>
</div>
<p>
      For example, you could create the following table on the remote
      server:
    </p><pre class="programlisting">CREATE TABLE test_table (
    id     INT(20) NOT NULL AUTO_INCREMENT,
    name   VARCHAR(32) NOT NULL DEFAULT '',
    other  INT(20) NOT NULL DEFAULT '0',
    PRIMARY KEY  (id),
    INDEX name (name),
    INDEX other_key (other)
)
ENGINE=MyISAM
DEFAULT CHARSET=latin1;</pre><p>
      To create the local table that will be federated to the remote
      table, there are two options available. You can either create the
      local table and specify the connection string (containing the
      server name, login, password) to be used to connect to the remote
      table using the <code class="literal">CONNECTION</code>, or you can use an
      existing connection that you have previously created using the
      <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p xmlns="">
        When you create the local table it <span class="emphasis"><em>must</em></span>
        have an identical field definition to the remote table.
</p>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
        You can improve the performance of a
        <code class="literal">FEDERATED</code> table by adding indexes to the
        table on the host. The optimization will occur because the query
        sent to the remote server will include the contents of the
        <code class="literal">WHERE</code> clause and will be sent to the remote
        server and subsequently executed locally. This reduces the
        network traffic that would otherwise request the entire table
        from the server for local processing.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="federated-create-connection"></a>14.9.2.1. Creating a <code class="literal">FEDERATED</code> Table Using
<code class="literal">CONNECTION</code></h4>
</div>
</div>
</div>
<p>
        To use the first method, you must specify the
        <code class="literal">CONNECTION</code> string after the engine type in a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. For
        example:
      </p><pre class="programlisting">CREATE TABLE federated_table (
    id     INT(20) NOT NULL AUTO_INCREMENT,
    name   VARCHAR(32) NOT NULL DEFAULT '',
    other  INT(20) NOT NULL DEFAULT '0',
    PRIMARY KEY  (id),
    INDEX name (name),
    INDEX other_key (other)
)
ENGINE=FEDERATED
DEFAULT CHARSET=latin1
CONNECTION='mysql://fed_user@remote_host:9306/federated/test_table';</pre>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          <code class="literal">CONNECTION</code> replaces the
          <code class="literal">COMMENT</code> used in some previous versions of
          MySQL.
</p>
</div>
<p>
        The <code class="literal">CONNECTION</code> string contains the
        information required to connect to the remote server containing
        the table that will be used to physically store the data. The
        connection string specifies the server name, login credentials,
        port number and database/table information. In the example, the
        remote table is on the server <code class="literal">remote_host</code>,
        using port 9306. The name and port number should match the host
        name (or IP address) and port number of the remote MySQL server
        instance you want to use as your remote table.
      </p><p>
        The format of the connection string is as follows:
      </p><pre class="programlisting"><em class="replaceable"><code>scheme</code></em>://<em class="replaceable"><code>user_name</code></em>[:<em class="replaceable"><code>password</code></em>]@<em class="replaceable"><code>host_name</code></em>[:<em class="replaceable"><code>port_num</code></em>]/<em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em>
</pre><p>
        Where:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <em class="replaceable"><code>scheme</code></em>: A recognized connection
            protocol. Only <code class="literal">mysql</code> is supported as the
            <em class="replaceable"><code>scheme</code></em> value at this point.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>user_name</code></em>: The user name for the
            connection. This user must have been created on the remote
            server, and must have suitable privileges to perform the
            required actions (<a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and so forth) on the
            remote table.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>password</code></em>: (Optional) The
            corresponding password for
            <em class="replaceable"><code>user_name</code></em>.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>host_name</code></em>: The host name or IP
            address of the remote server.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>port_num</code></em>: (Optional) The port
            number for the remote server. The default is 3306.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>db_name</code></em>: The name of the database
            holding the remote table.
          </p></li><li class="listitem"><p>
            <em class="replaceable"><code>tbl_name</code></em>: The name of the remote
            table. The name of the local and the remote table do not
            have to match.
</p></li></ul>
</div>
<p>
        Sample connection strings:
      </p><pre class="programlisting">CONNECTION='mysql://username:password@hostname:port/database/tablename'
CONNECTION='mysql://username@hostname/database/tablename'
CONNECTION='mysql://username:password@hostname/database/tablename'</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="federated-create-server"></a>14.9.2.2. Creating a <code class="literal">FEDERATED</code> Table Using
<code class="literal">CREATE SERVER</code></h4>
</div>
</div>
</div>
<p>
        If you are creating a number of <code class="literal">FEDERATED</code>
        tables on the same server, or if you want to simplify the
        process of creating <code class="literal">FEDERATED</code> tables, you can
        use the <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement
        to define the server connection parameters, just as you would
        with the <code class="literal">CONNECTION</code> string.
      </p><p>
        The format of the <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a>
        statement is:
      </p><pre class="programlisting">CREATE SERVER<em class="replaceable"><code>server_name</code></em>
FOREIGN DATA WRAPPER <em class="replaceable"><code>wrapper_name</code></em>
OPTIONS (<em class="replaceable"><code>option</code></em> [, <em class="replaceable"><code>option</code></em>] ...)</pre><p>
        The <em class="replaceable"><code>server_name</code></em> is used in the
        connection string when creating a new
        <code class="literal">FEDERATED</code> table.
      </p><p>
        For example, to create a server connection identical to the
        <code class="literal">CONNECTION</code> string:
      </p><pre class="programlisting">CONNECTION='mysql://fed_user@remote_host:9306/federated/test_table';</pre><p>
        You would use the following statement:
      </p><pre class="programlisting">CREATE SERVER fedlink
FOREIGN DATA WRAPPER mysql
OPTIONS (USER 'fed_user', HOST 'remote_host', PORT 9306, DATABASE 'federated');</pre><p>
        To create a <code class="literal">FEDERATED</code> table that uses this
        connection, you still use the <code class="literal">CONNECTION</code>
        keyword, but specify the name you used in the
        <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement.
      </p><pre class="programlisting">CREATE TABLE test_table (
    id     INT(20) NOT NULL AUTO_INCREMENT,
    name   VARCHAR(32) NOT NULL DEFAULT '',
    other  INT(20) NOT NULL DEFAULT '0',
    PRIMARY KEY  (id),
    INDEX name (name),
    INDEX other_key (other)
)
ENGINE=FEDERATED
DEFAULT CHARSET=latin1
CONNECTION='fedlink/test_table';</pre><p>
        The connection name in this example contains the name of the
        connection (<code class="literal">fedlink</code>) and the name of the
        table (<code class="literal">test_table</code>) to link to, separated by a
        slash. If you specify only the connection name without a table
        name, the table name of the local table is used instead.
      </p><p>
        For more information on <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE
        SERVER</code></a>, see <a class="xref" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax">Section 13.1.16, “<code class="literal">CREATE SERVER</code> Syntax”</a>.
      </p><p>
        The <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement
        accepts the same arguments as the <code class="literal">CONNECTION</code>
        string. The <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a>
        statement updates the rows in the
        <code class="literal">mysql.servers</code> table. See the following table
        for information on the correspondence between parameters in a
        connection string, options in the <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE
        SERVER</code></a> statement, and the columns in the
        <code class="literal">mysql.servers</code> table. For reference, the
        format of the <code class="literal">CONNECTION</code> string is as
        follows:
      </p><pre class="programlisting"><em class="replaceable"><code>scheme</code></em>://<em class="replaceable"><code>user_name</code></em>[:<em class="replaceable"><code>password</code></em>]@<em class="replaceable"><code>host_name</code></em>[:<em class="replaceable"><code>port_num</code></em>]/<em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em>
</pre>
<div class="informaltable">
<table summary="This table describes the correspondence between
          parameters in a connection string, options in the
          CREATE SERVER statement, and
          the columns in the mysql.servers
table." border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">Description</th><th scope="col"><code class="literal">CONNECTION</code> string</th><th scope="col"><a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> option</th><th scope="col"><code class="literal">mysql.servers</code> column</th></tr></thead><tbody><tr><td scope="row">Connection scheme</td><td><em class="replaceable"><code>scheme</code></em></td><td><code class="literal">wrapper_name</code></td><td><code class="literal">Wrapper</code></td></tr><tr><td scope="row">Remote user</td><td><em class="replaceable"><code>user_name</code></em></td><td><code class="literal">USER</code></td><td><code class="literal">Username</code></td></tr><tr><td scope="row">Remote password</td><td><em class="replaceable"><code>password</code></em></td><td><code class="literal">PASSWORD</code></td><td><code class="literal">Password</code></td></tr><tr><td scope="row">Remote host</td><td><em class="replaceable"><code>host_name</code></em></td><td><code class="literal">HOST</code></td><td><code class="literal">Host</code></td></tr><tr><td scope="row">Remote port</td><td><em class="replaceable"><code>port_num</code></em></td><td><code class="literal">PORT</code></td><td><code class="literal">Port</code></td></tr><tr><td scope="row">Remote database</td><td><em class="replaceable"><code>db_name</code></em></td><td><code class="literal">DATABASE</code></td><td><code class="literal">Db</code></td></tr></tbody></table>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-usagenotes"></a>14.9.3. <code class="literal">FEDERATED</code> Storage Engine Notes and Tips</h3>

</div>

</div>

</div>
<p>
      You should be aware of the following points when using the
      <code class="literal">FEDERATED</code> storage engine:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">FEDERATED</code> tables may be replicated to other
          slaves, but you must ensure that the slave servers are able to
          use the user/password combination that is defined in the
          <code class="literal">CONNECTION</code> string (or the row in the
          <code class="literal">mysql.servers</code> table) to connect to the
          remote server.
</p></li></ul>
</div>
<p>
      The following items indicate features that the
      <code class="literal">FEDERATED</code> storage engine does and does not
      support:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The remote server must be a MySQL server.
        </p></li><li class="listitem"><p>
          The remote table that a <code class="literal">FEDERATED</code> table
          points to <span class="emphasis"><em>must</em></span> exist before you try to
          access the table through the <code class="literal">FEDERATED</code>
          table.
        </p></li><li class="listitem"><p>
          It is possible for one <code class="literal">FEDERATED</code> table to
          point to another, but you must be careful not to create a
          loop.
        </p></li><li class="listitem"><p>
          A <code class="literal">FEDERATED</code> table does not support indexes
          per se. Because access to the table is handled remotely, it is
          the remote table that supports the indexes. Care should be
          taken when creating a <code class="literal">FEDERATED</code> table since
          the index definition from an equivalent
          <code class="literal">MyISAM</code> or other table may not be supported.
          For example, creating a <code class="literal">FEDERATED</code> table
          with an index prefix on
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> or
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns will fail. The
          following definition in <code class="literal">MyISAM</code> is valid:
        </p><pre class="programlisting">CREATE TABLE `T1`(`A` VARCHAR(100),UNIQUE KEY(`A`(30))) ENGINE=MYISAM;</pre><p>
          The key prefix in this example is incompatible with the
          <code class="literal">FEDERATED</code> engine, and the equivalent
          statement will fail:
        </p><pre class="programlisting">CREATE TABLE `T1`(`A` VARCHAR(100),UNIQUE KEY(`A`(30))) ENGINE=FEDERATED
  CONNECTION='MYSQL://127.0.0.1:3306/TEST/T1';</pre><p>
          If possible, you should try to separate the column and index
          definition when creating tables on both the remote server and
          the local server to avoid these index issues.
        </p></li><li class="listitem"><p>
          Internally, the implementation uses
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
          <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>, but not
          <a class="link" href="sql-syntax.html#handler" title="13.2.4. HANDLER Syntax"><code class="literal">HANDLER</code></a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">FEDERATED</code> storage engine supports
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
          <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>,
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
          <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>, and indexes. It
          does not support <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          or any Data Definition Language statements that directly
          affect the structure of the table, other than
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>. The current
          implementation does not use prepared statements.

          
        </p></li><li class="listitem"><p>
          <code class="literal">FEDERATED</code> accepts
          <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3. INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a> statements, but if a
          duplicate-key violation occurs, the statement fails with an
          error.
        </p></li><li class="listitem"><p>
          Performance on a <code class="literal">FEDERATED</code> table when
          performing bulk inserts (for example, on a
          <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1. INSERT ... SELECT Syntax"><code class="literal">INSERT INTO ...
          SELECT ...</code></a> statement) is slower than with other
          table types because each selected row is treated as an
          individual <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement on
          the <code class="literal">FEDERATED</code> table.
        </p></li><li class="listitem"><p>
          Transactions are not supported.
        </p></li><li class="listitem"><p>
          <code class="literal">FEDERATED</code> performs bulk-insert handling
          such that multiple rows are sent to the remote table in a
          batch. This provides a performance improvement and enables the
          remote table to perform improvement. Also, if the remote table
          is transactional, it enables the remote storage engine to
          perform statement rollback properly should an error occur.
          This capability has the following limitations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The size of the insert cannot exceed the maximum packet
              size between servers. If the insert exceeds this size, it
              is broken into multiple packets and the rollback problem
              can occur.
            </p></li><li class="listitem"><p>
              Bulk-insert handling does not occur for
              <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3. INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
              ... ON DUPLICATE KEY UPDATE</code></a>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          There is no way for the <code class="literal">FEDERATED</code> engine to
          know if the remote table has changed. The reason for this is
          that this table must work like a data file that would never be
          written to by anything other than the database system. The
          integrity of the data in the local table could be breached if
          there was any change to the remote database.
        </p></li><li class="listitem"><p>
          When using a <code class="literal">CONNECTION</code> string, you cannot
          use an '@' character in the password. You can get round this
          limitation by using the <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE
          SERVER</code></a> statement to create a server connection.
        </p></li><li class="listitem"><p>
          The <a class="link" href="server-administration.html#sysvar_insert_id"><code class="literal">insert_id</code></a> and
          <a class="link" href="server-administration.html#sysvar_timestamp"><code class="literal">timestamp</code></a> options are not
          propagated to the data provider.
        </p></li><li class="listitem"><p>
          Any <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> statement issued
          against a <code class="literal">FEDERATED</code> table drops only the
          local table, not the remote table.
        </p></li><li class="listitem"><p>
          <code class="literal">FEDERATED</code> tables do not work with the query
          cache.
        </p></li><li class="listitem"><p>
          User-defined partitioning is not supported for
          <code class="literal">FEDERATED</code> tables.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-storage-engine-resources"></a>14.9.4. <code class="literal">FEDERATED</code> Storage Engine Resources</h3>

</div>

</div>

</div>
<p>
      The following additional resources are available for the
      <code class="literal">FEDERATED</code> storage engine:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A forum dedicated to the <code class="literal">FEDERATED</code> storage
          engine is available at
          <a class="ulink" href="http://forums.mysql.com/list.php?105" target="_top">http://forums.mysql.com/list.php?105</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="example-storage-engine"></a>14.10. The <code class="literal">EXAMPLE</code> Storage Engine</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp94157168"></a><a class="indexterm" name="idp94158240"></a><p>
    The <code class="literal">EXAMPLE</code> storage engine is a stub engine that
    does nothing. Its purpose is to serve as an example in the MySQL
    source code that illustrates how to begin writing new storage
    engines. As such, it is primarily of interest to developers.
  </p><p>
    To enable the <code class="literal">EXAMPLE</code> storage engine if you build
    MySQL from source, invoke <span class="command"><strong>CMake</strong></span> with the
    <a class="link" href="installing.html#option_cmake_storage_engine_options" title="2.9.4.  Storage Engine Options"><code class="option">-DWITH_EXAMPLE_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    To examine the source for the <code class="literal">EXAMPLE</code> engine,
    look in the <code class="filename">storage/example</code> directory of a
    MySQL source distribution.
  </p><p>
    When you create an <code class="literal">EXAMPLE</code> table, the server
    creates a table format file in the database directory. The file
    begins with the table name and has an <code class="filename">.frm</code>
    extension. No other files are created. No data can be stored into
    the table. Retrievals return an empty result.
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test (i INT) ENGINE = EXAMPLE;</code></strong>
Query OK, 0 rows affected (0.78 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO test VALUES(1),(2),(3);</code></strong>
ERROR 1031 (HY000): Table storage engine for 'test' doesn't »
                    have this option

mysql&gt; <strong class="userinput"><code>SELECT * FROM test;</code></strong>
Empty set (0.31 sec)
</pre><p>
    The <code class="literal">EXAMPLE</code> storage engine does not support
    indexing.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="storage-engines-other"></a>14.11. Other Storage Engines</h2>

</div>

</div>

</div>
<p>
      Other storage engines may be available from third parties and
      community members that have used the Custom Storage Engine
      interface.
    </p><p>
      Third party engines are not supported by MySQL. For further
      information, documentation, installation guides, bug reporting or
      for any help or assistance with these engines, please contact the
      developer of the engine directly.
    </p><p>
      For more information on developing a customer storage engine that
      can be used with the Pluggable Storage Engine Architecture, see
      <a class="ulink" href="http://dev.mysql.com/doc/internals/en/custom-engine.html" target="_top">MySQL
      Internals: Writing a Custom Storage Engine</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="pluggable-storage-overview"></a>14.12. Overview of MySQL Storage Engine Architecture</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="storage-engines.html#pluggable-storage">14.12.1. Pluggable Storage Engine Architecture</a></span></dt><dt><span class="section"><a href="storage-engines.html#pluggable-storage-common-layer">14.12.2. The Common Database Server Layer</a></span></dt></dl>
</div>
<p>
      The MySQL pluggable storage engine architecture enables a database
      professional to select a specialized storage engine for a
      particular application need while being completely shielded from
      the need to manage any specific application coding requirements.
      The MySQL server architecture isolates the application programmer
      and DBA from all of the low-level implementation details at the
      storage level, providing a consistent and easy application model
      and API. Thus, although there are different capabilities across
      different storage engines, the application is shielded from these
      differences.
    </p><p>
      The pluggable storage engine architecture provides a standard set
      of management and support services that are common among all
      underlying storage engines. The storage engines themselves are the
      components of the database server that actually perform actions on
      the underlying data that is maintained at the physical server
      level.
    </p><p>
      This efficient and modular architecture provides huge benefits for
      those wishing to specifically target a particular application
      need—such as data warehousing, transaction processing, or
      high availability situations—while enjoying the advantage of
      utilizing a set of interfaces and services that are independent of
      any one storage engine.
    </p><p>
      The application programmer and DBA interact with the MySQL
      database through Connector APIs and service layers that are above
      the storage engines. If application changes bring about
      requirements that demand the underlying storage engine change, or
      that one or more storage engines be added to support new needs, no
      significant coding or process changes are required to make things
      work. The MySQL server architecture shields the application from
      the underlying complexity of the storage engine by presenting a
      consistent and easy-to-use API that applies across storage
      engines.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="pluggable-storage"></a>14.12.1. Pluggable Storage Engine Architecture</h3>
</div>
</div>
</div>
<p>
        MySQL Server uses a pluggable storage engine architecture that
        enables storage engines to be loaded into and unloaded from a
        running MySQL server.
      </p><p>
        <span class="bold"><strong>Plugging in a Storage Engine</strong></span>
      </p><p>
        Before a storage engine can be used, the storage engine plugin
        shared library must be loaded into MySQL using the
        <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3. INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement. For
        example, if the <code class="literal">EXAMPLE</code> engine plugin is
        named <code class="literal">example</code> and the shared library is named
        <code class="filename">ha_example.so</code>, you load it with the
        following statement:
      </p><pre class="programlisting">mysql&gt; INSTALL PLUGIN example SONAME 'ha_example.so';</pre><p>
        To install a pluggable storage engine, the plugin file must be
        located in the MySQL plugin directory, and the user issuing the
        <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3. INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement must
        have <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> privilege for the
        <code class="literal">mysql.plugin</code> table.
      </p><p>
        The shared library must be located in the MySQL server plugin
        directory, the location of which is given by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable.
      </p><p>
        <span class="bold"><strong>Unplugging a Storage Engine</strong></span>
      </p><p>
        To unplug a storage engine, use the
        <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.3.4. UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> statement:
      </p><pre class="programlisting">mysql&gt; UNINSTALL PLUGIN example;</pre><p>
        If you unplug a storage engine that is needed by existing
        tables, those tables become inaccessible, but will still be
        present on disk (where applicable). Ensure that there are no
        tables using a storage engine before you unplug the storage
        engine.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="pluggable-storage-common-layer"></a>14.12.2. The Common Database Server Layer</h3>

</div>

</div>

</div>
<p>
        A MySQL pluggable storage engine is the component in the MySQL
        database server that is responsible for performing the actual
        data I/O operations for a database as well as enabling and
        enforcing certain feature sets that target a specific
        application need. A major benefit of using specific storage
        engines is that you are only delivered the features needed for a
        particular application, and therefore you have less system
        overhead in the database, with the end result being more
        efficient and higher database performance. This is one of the
        reasons that MySQL has always been known to have such high
        performance, matching or beating proprietary monolithic
        databases in industry standard benchmarks.
      </p><p>
        From a technical perspective, what are some of the unique
        supporting infrastructure components that are in a storage
        engine? Some of the key feature differentiations include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="emphasis"><em>Concurrency</em></span>: Some applications have
            more granular lock requirements (such as row-level locks)
            than others. Choosing the right locking strategy can reduce
            overhead and therefore improve overall performance. This
            area also includes support for capabilities such as
            multi-version concurrency control or <span class="quote">“<span class="quote">snapshot</span>”</span>
            read.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Transaction Support</em></span>: Not every
            application needs transactions, but for those that do, there
            are very well defined requirements such as ACID compliance
            and more.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Referential Integrity</em></span>: The need to have
            the server enforce relational database referential integrity
            through DDL defined foreign keys.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Physical Storage</em></span>: This involves
            everything from the overall page size for tables and indexes
            as well as the format used for storing data to physical
            disk.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Index Support</em></span>: Different application
            scenarios tend to benefit from different index strategies.
            Each storage engine generally has its own indexing methods,
            although some (such as B-tree indexes) are common to nearly
            all engines.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Memory Caches</em></span>: Different applications
            respond better to some memory caching strategies than
            others, so although some memory caches are common to all
            storage engines (such as those used for user connections or
            MySQL's high-speed Query Cache), others are uniquely defined
            only when a particular storage engine is put in play.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Performance Aids</em></span>: This includes
            multiple I/O threads for parallel operations, thread
            concurrency, database checkpointing, bulk insert handling,
            and more.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Miscellaneous Target Features</em></span>: This may
            include support for geospatial operations, security
            restrictions for certain data manipulation operations, and
            other similar features.
</p></li></ul>
</div>
<p>
        Each set of the pluggable storage engine infrastructure
        components are designed to offer a selective set of benefits for
        a particular application. Conversely, avoiding a set of
        component features helps reduce unnecessary overhead. It stands
        to reason that understanding a particular application's set of
        requirements and selecting the proper MySQL storage engine can
        have a dramatic impact on overall system efficiency and
        performance.
</p>
</div>

</div>

</div>
<div class="copyright-footer">
    Copyright © 1997, 2013, Oracle and/or its affiliates. All
    rights reserved.
<a href="preface.html#legalnotice">Legal Notices</a>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="ha-overview.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 13. SQL Statement Syntax</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 15. High Availability and Scalability</td>
</tr>
</table>
</div>
</body>
</html>
