
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>14. SQLAzure Sharding Tutorial &mdash; Doctrine DBAL 2.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script src="../_static/bootstrap/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/doctrine.ico"/>
    <link rel="top" title="Doctrine DBAL 2.1.0 documentation" href="../index.html" />
    <link rel="next" title="15. Supporting Other Databases" href="supporting-other-databases.html" />
    <link rel="prev" title="13. Sharding" href="sharding.html" />
 
<!-- RTD Extra Head -->
<script type="text/javascript">
  // This is included here for Javascript that doesn't have access to the templates.
  var doc_version = "latest";
  var doc_slug = "doctrine-dbal";
  var page_name = "reference/sharding_azure_tutorial";
</script>

<script type="text/javascript" src="//media.readthedocs.org/javascript/rtd.js"></script>
<link rel="stylesheet" href="//media.readthedocs.org/css/rtd-shim.css" type="text/css" />
<!-- end RTD <extrahead> -->

  </head>
  <body>
    <div id="wrapper">
      <div id="header">
        <h1 id="h1title"></h1>
        <div id="logo">
          <a href="http://www.doctrine-project.org/">Doctrine - PHP Database Libraries</a>
        </div>
      </div>
      <div id="nav" class="cls">
        <div class="tl cls">
          <ul>
            <li><a target="_top" href="/">home</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/about">about</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects.html">projects</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/orm">orm</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/dbal">dbal</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/blog">blog</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/jira">development</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/contribute">contribute</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/community">community</a></li>
          </ul>
        </div>
      </div>
      <div id="content" class="cls">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="supporting-other-databases.html" title="15. Supporting Other Databases"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sharding.html" title="13. Sharding"
             accesskey="P">previous</a> |</li>
        <li><a href="/">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine DBAL 2.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

        <div class="document">
            <div class="documentwrapper">
                <div class="bodywrapper">

              <div class="body" >
                
  <div class="section" id="sqlazure-sharding-tutorial">
<h1>14. SQLAzure Sharding Tutorial<a class="headerlink" href="#sqlazure-sharding-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The sharding extension is currently in transition from a seperate Project
into DBAL. Class names may differ.</p>
</div>
<p>This tutorial builds upon the <a class="reference external" href="http://blogs.msdn.com/b/silverlining/archive/2012/01/18/using-sql-azure-federations-via-php.aspx">Brian Swans tutorial</a>
on SQLAzure Sharding and turns all the examples into examples using the Doctrine Sharding support.</p>
<p>It introduces SQL Azure Sharding, which is an abstraction layer in SQL Azure to
support sharding. Many features for sharding are implemented on the database
level, which makes it much easier to work with than generic sharding
implementations.</p>
<p>For this tutorial you need an Azure account. You don&#8217;t need to deploy the code
on Azure, you can run it from your own machine against the remote database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can look at the code from the &#8216;examples/sharding&#8217; directory.</p>
</div>
<div class="section" id="install-doctrine">
<h2>14.1. Install Doctrine<a class="headerlink" href="#install-doctrine" title="Permalink to this headline">¶</a></h2>
<p>For this tutorial we will install Doctrine and the Sharding Extension through
<a class="reference external" href="http://getcomposer.org">Composer</a> which is the easiest way to install
Doctrine. Composer is a new package manager for PHP. Download the
<tt class="docutils literal"><span class="pre">composer.phar</span></tt> from their website and put it into a newly created folder for
this tutorial. Now create a <tt class="docutils literal"><span class="pre">composer.json</span></tt> file in this project root with
the following content:</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><dl class="first docutils">
<dt>&#8220;require&#8221;: {</dt>
<dd>&#8220;doctrine/dbal&#8221;: &#8220;2.2.2&#8221;,
&#8220;doctrine/shards&#8221;: &#8220;0.2&#8221;</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>Open up the commandline and switch to your tutorial root directory, then call
<tt class="docutils literal"><span class="pre">php</span> <span class="pre">composer.phar</span> <span class="pre">install</span></tt>. It will grab the code and install it into the
<tt class="docutils literal"><span class="pre">vendor</span></tt> subdirectory of your project. It also creates an autoloader, so that
we don&#8217;t have to care about this.</p>
</div>
<div class="section" id="setup-connection">
<h2>14.2. Setup Connection<a class="headerlink" href="#setup-connection" title="Permalink to this headline">¶</a></h2>
<p>The first thing to start with is setting up Doctrine and the database connection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// bootstrap.php</span>
<span class="k">use</span> <span class="nx">Doctrine\DBAL\DriverManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Shards\DBAL\SQLAzure\SQLAzureShardManager</span><span class="p">;</span>

<span class="k">require_once</span> <span class="s2">&quot;vendor/autoload.php&quot;</span><span class="p">;</span>

<span class="nv">$conn</span> <span class="o">=</span> <span class="nx">DriverManager</span><span class="o">::</span><span class="na">getConnection</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;driver&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;pdo_sqlsrv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dbname&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;SalesDB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;host&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;tcp:dbname.windows.net&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;user@dbname&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;XXX&#39;</span><span class="p">,</span>
    <span class="s1">&#39;platform&#39;</span>       <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Doctrine\DBAL\Platforms\SQLAzurePlatform</span><span class="p">(),</span>
    <span class="s1">&#39;driverOptions&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;MultipleActiveResultSets&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">),</span>
    <span class="s1">&#39;sharding&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;federationName&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;Orders_Federation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;distributionKey&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;CustId&#39;</span><span class="p">,</span>
        <span class="s1">&#39;distributionType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">));</span>

<span class="nv">$shardManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQLAzureShardManager</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="create-database">
<h2>14.3. Create Database<a class="headerlink" href="#create-database" title="Permalink to this headline">¶</a></h2>
<p>Create a new database using the Azure/SQL Azure management console.</p>
</div>
<div class="section" id="create-schema">
<h2>14.4. Create Schema<a class="headerlink" href="#create-schema" title="Permalink to this headline">¶</a></h2>
<p>Doctrine has a powerful schema API. We don&#8217;t need to use low-level DDL
statements to generate the database schema. Instead you can use an Object-Oriented API
to create the database schema and then have Doctrine turn it into DDL
statements.</p>
<p>We will recreate Brians example schema with Doctrine DBAL. Instead of having to
create federations and schema seperately as in his example, Doctrine will do it
all in one step:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// create_schema.php</span>
<span class="k">use</span> <span class="nx">Doctrine\DBAL\Schema\Schema</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Shards\DBAL\SQLAzure\SQLAzureSchemaSynchronizer</span><span class="p">;</span>

<span class="k">require_once</span> <span class="s1">&#39;bootstrap.php&#39;</span><span class="p">;</span>

<span class="nv">$schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">();</span>

<span class="nv">$products</span> <span class="o">=</span> <span class="nv">$schema</span><span class="o">-&gt;</span><span class="na">createTable</span><span class="p">(</span><span class="s1">&#39;Products&#39;</span><span class="p">);</span>
<span class="nv">$products</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;ProductID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$products</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;SupplierID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$products</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;ProductName&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
<span class="nv">$products</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">));</span>
<span class="nv">$products</span><span class="o">-&gt;</span><span class="na">setPrimaryKey</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;ProductID&#39;</span><span class="p">));</span>
<span class="nv">$products</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;azure.federated&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="nv">$customers</span> <span class="o">=</span> <span class="nv">$schema</span><span class="o">-&gt;</span><span class="na">createTable</span><span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">);</span>
<span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;CompanyName&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
<span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;FirstName&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
<span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;LastName&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
<span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">setPrimaryKey</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">));</span>
<span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;azure.federated&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;azure.federatedOnColumnName&#39;</span><span class="p">,</span> <span class="s1">&#39;CustomerID&#39;</span><span class="p">);</span>

<span class="nv">$orders</span> <span class="o">=</span> <span class="nv">$schema</span><span class="o">-&gt;</span><span class="na">createTable</span><span class="p">(</span><span class="s1">&#39;Orders&#39;</span><span class="p">);</span>
<span class="nv">$orders</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$orders</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;OrderID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$orders</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;OrderDate&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">);</span>
<span class="nv">$orders</span><span class="o">-&gt;</span><span class="na">setPrimaryKey</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;OrderID&#39;</span><span class="p">));</span>
<span class="nv">$orders</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;azure.federated&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nv">$orders</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;azure.federatedOnColumnName&#39;</span><span class="p">,</span> <span class="s1">&#39;CustomerID&#39;</span><span class="p">);</span>

<span class="nv">$orderItems</span> <span class="o">=</span> <span class="nv">$schema</span><span class="o">-&gt;</span><span class="na">createTable</span><span class="p">(</span><span class="s1">&#39;OrderItems&#39;</span><span class="p">);</span>
<span class="nv">$orderItems</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$orderItems</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;OrderID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$orderItems</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;ProductID&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$orderItems</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span><span class="s1">&#39;Quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
<span class="nv">$orderItems</span><span class="o">-&gt;</span><span class="na">setPrimaryKey</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;OrderID&#39;</span><span class="p">,</span> <span class="s1">&#39;ProductID&#39;</span><span class="p">));</span>
<span class="nv">$orderItems</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;azure.federated&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nv">$orderItems</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;azure.federatedOnColumnName&#39;</span><span class="p">,</span> <span class="s1">&#39;CustomerID&#39;</span><span class="p">);</span>

<span class="c1">// Create the Schema + Federation:</span>
<span class="nv">$synchronizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQLAzureSchemaSynchronizer</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$shardManager</span><span class="p">);</span>
<span class="nv">$synchronizer</span><span class="o">-&gt;</span><span class="na">createSchema</span><span class="p">(</span><span class="nv">$schema</span><span class="p">);</span>

<span class="c1">// Or jut look at the SQL:</span>
<span class="k">echo</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$synchronizer</span><span class="o">-&gt;</span><span class="na">getCreateSchema</span><span class="p">(</span><span class="nv">$schema</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="view-federation-members">
<h2>14.5. View Federation Members<a class="headerlink" href="#view-federation-members" title="Permalink to this headline">¶</a></h2>
<p>To see how many shard instances (called Federation Members) your SQLAzure database currently has
you can ask the <tt class="docutils literal"><span class="pre">ShardManager</span></tt> to enumerate all shards:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// view_federation_members.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$shards</span> <span class="o">=</span> <span class="nv">$shardManager</span><span class="o">-&gt;</span><span class="na">getShards</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$shards</span> <span class="k">as</span> <span class="nv">$shard</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$shard</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="insert-data">
<h2>14.6. Insert Data<a class="headerlink" href="#insert-data" title="Permalink to this headline">¶</a></h2>
<p>Now we want to insert some test data into the database to see the behavior when
we split the shards. We use the same test data as Brian, but use the Doctrine
API to insert them. To insert data into federated tables we have to select the
shard we want to put the data into. We can use the ShardManager to execute this
operation for us:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// insert_data.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$shardManager</span><span class="o">-&gt;</span><span class="na">selectShard</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Products&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;ProductID&quot;</span> <span class="o">=&gt;</span> <span class="mi">386</span><span class="p">,</span>
    <span class="s2">&quot;SupplierID&quot;</span> <span class="o">=&gt;</span> <span class="mi">1001</span><span class="p">,</span>
    <span class="s2">&quot;ProductName&quot;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Titanium Extension Bracket Left Hand&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Price&quot;</span> <span class="o">=&gt;</span> <span class="mf">5.25</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Products&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;ProductID&quot;</span> <span class="o">=&gt;</span> <span class="mi">387</span><span class="p">,</span>
    <span class="s2">&quot;SupplierID&quot;</span> <span class="o">=&gt;</span> <span class="mi">1001</span><span class="p">,</span>
    <span class="s2">&quot;ProductName&quot;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Titanium Extension Bracket Right Hand&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Price&quot;</span> <span class="o">=&gt;</span> <span class="mf">5.25</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Products&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;ProductID&quot;</span> <span class="o">=&gt;</span> <span class="mi">388</span><span class="p">,</span>
    <span class="s2">&quot;SupplierID&quot;</span> <span class="o">=&gt;</span> <span class="mi">1001</span><span class="p">,</span>
    <span class="s2">&quot;ProductName&quot;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fusion Generator Module 5 kV&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Price&quot;</span> <span class="o">=&gt;</span> <span class="mf">10.50</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Products&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;ProductID&quot;</span> <span class="o">=&gt;</span> <span class="mi">388</span><span class="p">,</span>
    <span class="s2">&quot;SupplierID&quot;</span> <span class="o">=&gt;</span> <span class="mi">1001</span><span class="p">,</span>
    <span class="s2">&quot;ProductName&quot;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bypass Filter 400 MHz Low Pass&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Price&quot;</span> <span class="o">=&gt;</span> <span class="mf">10.50</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Van Nuys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Catherine&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Abel&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Abercrombie&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Kim&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Branch&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Contoso&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Frances&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Adams&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">40</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;A. Datum Corporation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Harrington&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Adventure Works&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Keith&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Harris&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Alpine Ski House&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Wilson&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Pais&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">70</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Baldwin Museum of Science&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Roger&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Harui&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Blue Yonder Airlines&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Pilar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Pinilla&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">90</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;City Power &amp; Light&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Kari&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hensien&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;CustomerID&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;CompanyName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Coho Winery&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FirstName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Peter&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LastName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Brehm&#39;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s2">&quot;DECLARE @orderId INT</span>

<span class="s2">    DECLARE @customerId INT</span>

<span class="s2">    SET @orderId = 10</span>
<span class="s2">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = &#39;Hensien&#39; and FirstName = &#39;Kari&#39;</span>

<span class="s2">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)</span>
<span class="s2">    VALUES (@customerId, @orderId, GetDate())</span>

<span class="s2">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)</span>
<span class="s2">    VALUES (@customerId, @orderId, 388, 4)</span>

<span class="s2">    SET @orderId = 20</span>
<span class="s2">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = &#39;Harui&#39; and FirstName = &#39;Roger&#39;</span>

<span class="s2">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)</span>
<span class="s2">    VALUES (@customerId, @orderId, GetDate())</span>

<span class="s2">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)</span>
<span class="s2">    VALUES (@customerId, @orderId, 389, 2)</span>

<span class="s2">    SET @orderId = 30</span>
<span class="s2">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = &#39;Brehm&#39; and FirstName = &#39;Peter&#39;</span>

<span class="s2">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)</span>
<span class="s2">    VALUES (@customerId, @orderId, GetDate())</span>

<span class="s2">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)</span>
<span class="s2">    VALUES (@customerId, @orderId, 387, 3)</span>

<span class="s2">    SET @orderId = 40</span>
<span class="s2">    SELECT @customerId = CustomerId FROM Customers WHERE LastName = &#39;Pais&#39; and FirstName = &#39;Wilson&#39;</span>

<span class="s2">    INSERT INTO Orders (CustomerId, OrderId, OrderDate)</span>
<span class="s2">    VALUES (@customerId, @orderId, GetDate())</span>

<span class="s2">    INSERT INTO OrderItems (CustomerID, OrderID, ProductID, Quantity)</span>
<span class="s2">    VALUES (@customerId, @orderId, 388, 1)&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>This puts the data into the currently only existing federation member. We
selected that federation member by picking 0 as distribution value, which is by
definition part of the only existing federation.</p>
</div>
<div class="section" id="split-federation">
<h2>14.7. Split Federation<a class="headerlink" href="#split-federation" title="Permalink to this headline">¶</a></h2>
<p>Now lets split the federation, creating a second federation member. SQL Azure
will automatically redistribute the data into the two federations after you
executed this command.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// split_federation.php</span>
<span class="k">require_once</span> <span class="s1">&#39;bootstrap.php&#39;</span><span class="p">;</span>

<span class="nv">$shardManager</span><span class="o">-&gt;</span><span class="na">splitFederation</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
</pre></div>
</div>
<p>This little script uses the shard manager with a special method only existing
on the SQL AZure implementation <tt class="docutils literal"><span class="pre">splitFederation</span></tt>. It accepts a value at
at which the split is executed.</p>
<p>If you reexecute the <tt class="docutils literal"><span class="pre">view_federation_members.php</span></tt> script you can now see
that there are two federation members instead of just one as before. You can
see with the <tt class="docutils literal"><span class="pre">rangeLow</span></tt> and <tt class="docutils literal"><span class="pre">rangeHigh</span></tt> parameters what customers and
related entries are now served by which federation.</p>
</div>
<div class="section" id="inserting-data-after-split">
<h2>14.8. Inserting Data after Split<a class="headerlink" href="#inserting-data-after-split" title="Permalink to this headline">¶</a></h2>
<p>Now after we splitted the data we now have to make sure to be connected to the
right federation before inserting data. Lets add a new customer with ID 55 and
have him create an order.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// insert_data_aftersplit.php</span>
<span class="k">require_once</span> <span class="s1">&#39;bootstrap.php&#39;</span><span class="p">;</span>

<span class="nv">$newCustomerId</span> <span class="o">=</span> <span class="mi">55</span><span class="p">;</span>

<span class="nv">$shardManager</span><span class="o">-&gt;</span><span class="na">selectShard</span><span class="p">(</span><span class="nv">$newCustomerId</span><span class="p">);</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;CustomerID&quot;</span> <span class="o">=&gt;</span> <span class="nv">$newCustomerId</span><span class="p">,</span>
    <span class="s2">&quot;CompanyName&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Microsoft&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FirstName&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Brian&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LastName&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Swan&quot;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;Orders&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;CustomerID&quot;</span> <span class="o">=&gt;</span> <span class="mi">55</span><span class="p">,</span>
    <span class="s2">&quot;OrderID&quot;</span> <span class="o">=&gt;</span> <span class="mi">37</span><span class="p">,</span>
    <span class="s2">&quot;OrderDate&quot;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">),</span>
<span class="p">));</span>

<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s2">&quot;OrderItems&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;CustomerID&quot;</span> <span class="o">=&gt;</span> <span class="mi">55</span><span class="p">,</span>
    <span class="s2">&quot;OrderID&quot;</span> <span class="o">=&gt;</span> <span class="mi">37</span><span class="p">,</span>
    <span class="s2">&quot;ProductID&quot;</span> <span class="o">=&gt;</span> <span class="mi">387</span><span class="p">,</span>
    <span class="s2">&quot;Quantity&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>As you can see its very important to pick the right distribution key in your
sharded application. Otherwise you have to switch the shards very often, which
is not really easy to work with. If you pick the sharding key right then it
should be possible to select the shard only once per request for the major
number of use-cases.</p>
<p>Fan-out the queries accross multiple shards should only be necessary for a
small number of queries, because these kind of queries are complex.</p>
</div>
<div class="section" id="querying-data-with-filtering-off">
<h2>14.9. Querying data with filtering off<a class="headerlink" href="#querying-data-with-filtering-off" title="Permalink to this headline">¶</a></h2>
<p>To access the data you have to pick a shard again and then start selecting data
from it.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// query_filtering_off.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$shardManager</span><span class="o">-&gt;</span><span class="na">selectShard</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM Customers&#39;</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
<p>This returns all customers from the shard with distribution value 0. This will
be all customers with id 10 to less than 60, since we split federations at 60.</p>
</div>
<div class="section" id="querying-data-with-filtering-on">
<h2>14.10. Querying data with filtering on<a class="headerlink" href="#querying-data-with-filtering-on" title="Permalink to this headline">¶</a></h2>
<p>One special feature of SQL Azure is the possibility to database level filtering
based on the sharding distribution values. This means that SQL Azure will add
WHERE clauses with distributionkey=current distribution value conditions to
each distribution key.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// query_filtering_on.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$shardManager</span><span class="o">-&gt;</span><span class="na">setFilteringEnabled</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nv">$shardManager</span><span class="o">-&gt;</span><span class="na">selectShard</span><span class="p">(</span><span class="mi">55</span><span class="p">);</span>

<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM Customers&#39;</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
<p>Now you only get the customer with id = 55. The same holds for queries on the
<tt class="docutils literal"><span class="pre">Orders</span></tt> and <tt class="docutils literal"><span class="pre">OrderItems</span></tt> table, which are restricted by customer id = 55.</p>
</div>
</div>


              </div>
                </div>

            </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">



            
                <h3>Project Versions</h3>

                <select name="versions" id="versions">
            
            <option value="http://readthedocs.org/en/latest/">latest</option>
            
                </select>
            
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:Doctrine DBAL">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">14. SQLAzure Sharding Tutorial</a><ul>
<li><a class="reference internal" href="#install-doctrine">14.1. Install Doctrine</a></li>
<li><a class="reference internal" href="#setup-connection">14.2. Setup Connection</a></li>
<li><a class="reference internal" href="#create-database">14.3. Create Database</a></li>
<li><a class="reference internal" href="#create-schema">14.4. Create Schema</a></li>
<li><a class="reference internal" href="#view-federation-members">14.5. View Federation Members</a></li>
<li><a class="reference internal" href="#insert-data">14.6. Insert Data</a></li>
<li><a class="reference internal" href="#split-federation">14.7. Split Federation</a></li>
<li><a class="reference internal" href="#inserting-data-after-split">14.8. Inserting Data after Split</a></li>
<li><a class="reference internal" href="#querying-data-with-filtering-off">14.9. Querying data with filtering off</a></li>
<li><a class="reference internal" href="#querying-data-with-filtering-on">14.10. Querying data with filtering on</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="sharding.html"
                                  title="previous chapter">13. Sharding</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="supporting-other-databases.html"
                                  title="next chapter">15. Supporting Other Databases</a></p>
  
    <h3>This Page</h3>
    <ul class="this-page-menu">
      
        <li><a href="../_sources/reference/sharding_azure_tutorial.txt"
               rel="nofollow">Show Source</a></li>
      
      
        <li><a href="https://github.com/doctrine/dbal/blob/master/docs/en/reference/sharding_azure_tutorial.rst">
          Show on GitHub</a></li>
        <li><a href="https://github.com/doctrine/dbal/edit/master/docs/en/reference/sharding_azure_tutorial.rst">
          Edit on GitHub</a></li>
      
    </ul>
  

        </div>
      </div>
          <div class="clearer"></div>
        </div>

          <div class="footer">
              &copy; Copyright 2010, Roman Borschel, Guilherme Blanco, Benjamin Eberlei, Jonathan Wage.
              Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
            <br/>
            <a target="_BLANK" href="http://www.servergrove.com"><img src="http://www.doctrine-project.org/images/servergrove.jpg" /></a>      <br/><br/>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
              <input type="hidden" name="cmd" value="_s-xclick" />
              <input type="hidden" name="hosted_button_id" value="BAE2E3XANQ77Y" />
              <input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" />
              <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
            </form>
          </div>
 <!-- End original user content -->


<br/>
<br/>
<br/>


<style type="text/css">
  #version_menu, .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0.75s;
    transition: all 0.25s 0.75s;
  }
  .footer_popout:hover #version_menu, .footer_popout:hover .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0s;
    transition: all 0.25s 0s;
  }
  .rtd-badge {
    position: fixed;
    display: block;
    bottom: 5px;
    height: 40px;
    text-indent: -9999em;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
  }
  #version_menu {
    position: fixed;
    visibility: hidden;
    opacity: 0;
    bottom: 11px;
    right: 47px;
    list-style-type: none;
    margin: 0;
  }
  .footer_popout:hover #version_menu {
    visibility: visible;
    opacity: 1;
    right: 166px;
  }
  #version_menu li {
    display: block;
    float: right;
  }
  #version_menu li a {
    display: block;
    padding: 6px 10px 4px 10px;
    margin: 7px 7px 0 0;
    font-weight: bold;
    font-size: 14px;
    height: 20px;
    line-height: 17px;
    text-decoration: none;
    color: #fff;
    background: #8ca1af url(//media.readthedocs.org//images/gradient-light.png) bottom left repeat-x;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 1px #465158;
    -moz-box-shadow: 0 1px 1px #465158;
    -webkit-box-shadow: 0 1px 1px #465158;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }
  #version_menu li a:hover {
    text-decoration: none;
    background-color: #697983;
    box-shadow: 0 1px 0px #465158;
    -moz-box-shadow: 0 1px 0px #465158;
    -webkit-box-shadow: 0 1px 0px #465158;
  }
  .rtd-badge.rtd {
    background: #3b4449 url(//media.readthedocs.org//images/badge-rtd.png) scroll top left no-repeat;
    border: 1px solid #282E32;
    width: 41px;
    right: 5px;
  }
  .footer_popout:hover .rtd-badge.rtd {
    width: 160px;
  }
  .rtd-badge.revsys { background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline-sponsored {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys-sm.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 205px;
    right: 173px;
  }

</style>
<div class="rtd_doc_footer">
  <div class="footer_popout">
    <a href="//readthedocs.org/projects/doctrine-dbal/?fromdocs=doctrine-dbal" class="rtd-badge rtd"> Brought to you by Read the Docs</a>
    <ul id="version_menu">
      
        <li><a href="/en/latest/">latest</a></li>
      
    </ul>
  </div>
</div>
<!-- RTD Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




      </div>

      <div id="bot-rcnr">
        <div class="tl"><!-- corner --></div>
      </div>
    </div>

  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
  </script>
  <script type="text/javascript">
  _uacct = "UA-288343-7";
  urchinTracker();
  </script>
  <a class="githublink" href="http://github.com/doctrine"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>