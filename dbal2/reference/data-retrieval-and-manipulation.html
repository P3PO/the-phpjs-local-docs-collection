
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. Data Retrieval And Manipulation &mdash; Doctrine DBAL 2.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script src="../_static/bootstrap/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/doctrine.ico"/>
    <link rel="top" title="Doctrine DBAL 2.1.0 documentation" href="../index.html" />
    <link rel="next" title="5. SQL Query Builder" href="query-builder.html" />
    <link rel="prev" title="3. Configuration" href="configuration.html" />
 
<!-- RTD Extra Head -->
<script type="text/javascript">
  // This is included here for Javascript that doesn't have access to the templates.
  var doc_version = "latest";
  var doc_slug = "doctrine-dbal";
  var page_name = "reference/data-retrieval-and-manipulation";
</script>

<script type="text/javascript" src="//media.readthedocs.org/javascript/rtd.js"></script>
<link rel="stylesheet" href="//media.readthedocs.org/css/rtd-shim.css" type="text/css" />
<!-- end RTD <extrahead> -->

  </head>
  <body>
    <div id="wrapper">
      <div id="header">
        <h1 id="h1title"></h1>
        <div id="logo">
          <a href="http://www.doctrine-project.org/">Doctrine - PHP Database Libraries</a>
        </div>
      </div>
      <div id="nav" class="cls">
        <div class="tl cls">
          <ul>
            <li><a target="_top" href="/">home</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/about">about</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects.html">projects</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/orm">orm</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/dbal">dbal</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/blog">blog</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/jira">development</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/contribute">contribute</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/community">community</a></li>
          </ul>
        </div>
      </div>
      <div id="content" class="cls">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="query-builder.html" title="5. SQL Query Builder"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="3. Configuration"
             accesskey="P">previous</a> |</li>
        <li><a href="/">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine DBAL 2.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

        <div class="document">
            <div class="documentwrapper">
                <div class="bodywrapper">

              <div class="body" >
                
  <div class="section" id="data-retrieval-and-manipulation">
<h1>4. Data Retrieval And Manipulation<a class="headerlink" href="#data-retrieval-and-manipulation" title="Permalink to this headline">¶</a></h1>
<p>Doctrine DBAL follows the PDO API very closely. If you have worked with PDO
before you will get to know Doctrine DBAL very quickly. On top of the API provided
by PDO there are tons of convenience functions in Doctrine DBAL.</p>
<div class="section" id="data-retrieval">
<h2>4.1. Data Retrieval<a class="headerlink" href="#data-retrieval" title="Permalink to this headline">¶</a></h2>
<p>Using a database implies retrieval of data. It is the primary use-case of a database.
For this purpose each database vendor exposes a Client API that can be integrated into
programming languages. PHP has a generic abstraction layer for this
kind of API called PDO (PHP Data Objects). However because of disagreements
between the PHP community there are often native extensions for each database
vendor that are much more maintained (OCI8 for example).</p>
<p>Doctrine DBAL API builds on top of PDO and integrates native extensions by
wrapping them into the PDO API as well. If you already have an open connection
through the <tt class="docutils literal"><span class="pre">Doctrine\DBAL\DriverManager::getConnection()</span></tt> method you
can start using this API for data retrieval easily.</p>
<p>Start writing an SQL query and pass it to the <tt class="docutils literal"><span class="pre">query()</span></tt> method of your
connection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Doctrine\DBAL\DriverManager</span><span class="p">;</span>

<span class="nv">$conn</span> <span class="o">=</span> <span class="nx">DriverManager</span><span class="o">::</span><span class="na">getConnection</span><span class="p">(</span><span class="nv">$params</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM articles&quot;</span><span class="p">;</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span> <span class="c1">// Simple, but has several drawbacks</span>
</pre></div>
</div>
<p>The query method executes the SQL and returns a database statement object.
A database statement object can be iterated to retrieve all the rows that matched
the query until there are no more rows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;headline&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The query method is the most simple one for fetching data, but it also has
several drawbacks:</p>
<ul class="simple">
<li>There is no way to add dynamic parameters to the SQL query without modifying
<tt class="docutils literal"><span class="pre">$sql</span></tt> itself. This can easily lead to a category of security
holes called <strong>SQL injection</strong>, where a third party can modify the SQL executed
and even execute their own queries through clever exploiting of the security hole.</li>
<li><strong>Quoting</strong> dynamic parameters for an SQL query is tedious work and requires lots
of use of the <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Connection#quote()</span></tt> method, which makes the
original SQL query hard to read/understand.</li>
<li>Databases optimize SQL queries before they are executed. Using the query method
you will trigger the optimization process over and over again, although
it could re-use this information easily using a technique called <strong>prepared statements</strong>.</li>
</ul>
<p>This three arguments and some more technical details hopefully convinced you to investigate
prepared statements for accessing your database.</p>
<div class="section" id="dynamic-parameters-and-prepared-statements">
<h3>4.1.1. Dynamic Parameters and Prepared Statements<a class="headerlink" href="#dynamic-parameters-and-prepared-statements" title="Permalink to this headline">¶</a></h3>
<p>Consider the previous query, now parameterized to fetch only a single article by id.
Using <strong>ext/mysql</strong> (still the primary choice of MySQL access for many developers) you had to escape
every value passed into the query using <tt class="docutils literal"><span class="pre">mysql_real_escape_string()</span></tt> to avoid SQL injection:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM articles WHERE id = &#39;&quot;</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$link</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
<span class="nv">$rs</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</pre></div>
</div>
<p>If you start adding more and more parameters to a query (for example in UPDATE or INSERT statements)
this approach might lead to complex to maintain SQL queries. The reason is simple, the actual
SQL query is not clearly separated from the input parameters. Prepared statements separate
these two concepts by requiring the developer to add <strong>placeholders</strong> to the SQL query (prepare) which
are then replaced by their actual values in a second step (execute).</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $conn instanceof Doctrine\DBAL\Connection</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM articles WHERE id = ?&quot;</span><span class="p">;</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Placeholders in prepared statements are either simple positional question marks (?) or named labels starting with
a double-colon (:name1). You cannot mix the positional and the named approach. The approach
using question marks is called positional, because the values are bound in order from left to right
to any question mark found in the previously prepared SQL query. That is why you specify the
position of the variable to bind into the <tt class="docutils literal"><span class="pre">bindValue()</span></tt> method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $conn instanceof Doctrine\DBAL\Connection</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM articles WHERE id = ? AND status = ?&quot;</span><span class="p">;</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Named parameters have the advantage that their labels can be re-used and only need to be bound once:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $conn instanceof Doctrine\DBAL\Connection</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE name = :name OR username = :name&quot;</span><span class="p">;</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>The following section describes the API of Doctrine DBAL with regard to prepared statements.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Support for positional and named prepared statements varies between the different
database extensions. PDO implements its own client side parser so that both approaches
are feasible for all PDO drivers. OCI8/Oracle only supports named parameters, but
Doctrine implements a client side parser to allow positional parameters also.</p>
</div>
</div>
<div class="section" id="using-prepared-statements">
<h3>4.1.2. Using Prepared Statements<a class="headerlink" href="#using-prepared-statements" title="Permalink to this headline">¶</a></h3>
<p>There are three low-level methods on <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Connection</span></tt> that allow you to
use prepared statements:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">prepare($sql)</span></tt> - Create a prepared statement of the type <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Statement</span></tt>.
Using this method is preferred if you want to re-use the statement to execute several
queries with the same SQL statement only with different parameters.</li>
<li><tt class="docutils literal"><span class="pre">executeQuery($sql,</span> <span class="pre">$params,</span> <span class="pre">$types)</span></tt> - Create a prepared statement for the passed
SQL query, bind the given params with their binding types and execute the query.
This method returns the executed prepared statement for iteration and is useful
for SELECT statements.</li>
<li><tt class="docutils literal"><span class="pre">executeUpdate($sql,</span> <span class="pre">$params,</span> <span class="pre">$types)</span></tt> - Create a prepared statement for the passed
SQL query, bind the given params with their binding types and execute the query.
This method returns the number of affected rows by the executed query and is useful
for UPDATE, DELETE and INSERT statements.</li>
</ul>
<p>A simple usage of prepare was shown in the previous section, however it is useful to
dig into the features of a <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Statement</span></tt> a little bit more. There are essentially
two different types of methods available on a statement. Methods for binding parameters and types
and methods to retrieve data from a statement.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bindValue($pos,</span> <span class="pre">$value,</span> <span class="pre">$type)</span></tt> - Bind a given value to the positional or named parameter
in the prepared statement.</li>
<li><tt class="docutils literal"><span class="pre">bindParam($pos,</span> <span class="pre">&amp;$param,</span> <span class="pre">$type)</span></tt> - Bind a given reference to the positional or
named parameter in the prepared statement.</li>
</ul>
<p>If you are finished with binding parameters you have to call <tt class="docutils literal"><span class="pre">execute()</span></tt> on the statement, which
will trigger a query to the database. After the query is finished you can access the results
of this query using the fetch API of a statement:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">fetch($fetchStyle)</span></tt> - Retrieves the next row from the statement or false if there are none.
Moves the pointer forward one row, so that consecutive calls will always return the next row.</li>
<li><tt class="docutils literal"><span class="pre">fetchColumn($column)</span></tt> - Retrieves only one column of the next row specified by column index.
Moves the pointer forward one row, so that consecutive calls will always return the next row.</li>
<li><tt class="docutils literal"><span class="pre">fetchAll($fetchStyle)</span></tt> - Retrieves all rows from the statement.</li>
</ul>
<p>The fetch API of a prepared statement obviously works only for <tt class="docutils literal"><span class="pre">SELECT</span></tt> queries.</p>
<p>If you find it tedious to write all the prepared statement code you can alternatively use
the <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Connection#executeQuery()</span></tt> and <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Connection#executeUpdate()</span></tt>
methods. See the API section below on details how to use them.</p>
<p>Additionally there are lots of convenience methods for data-retrieval and manipulation
on the Connection, which are all described in the API section below.</p>
</div>
</div>
<div class="section" id="binding-types">
<h2>4.2. Binding Types<a class="headerlink" href="#binding-types" title="Permalink to this headline">¶</a></h2>
<p>Doctrine DBAL extends PDOs handling of binding types in prepared statement
considerably. Besides the well known <tt class="docutils literal"><span class="pre">\PDO::PARAM_*</span></tt> constants you
can make use of two very powerful additional features.</p>
<div class="section" id="doctrinedbaltypes-conversion">
<h3>4.2.1. DoctrineDBALTypes Conversion<a class="headerlink" href="#doctrinedbaltypes-conversion" title="Permalink to this headline">¶</a></h3>
<p>If you don&#8217;t specify an integer (through a <tt class="docutils literal"><span class="pre">PDO::PARAM*</span></tt> constant) to
any of the parameter binding methods but a string, Doctrine DBAL will
ask the type abstraction layer to convert the passed value from
its PHP to a database representation. This way you can pass <tt class="docutils literal"><span class="pre">\DateTime</span></tt>
instances to a prepared statement and have Doctrine convert them
to the appropriate vendors database format:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="s2">&quot;2011-03-05 14:00:21&quot;</span><span class="p">);</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM articles WHERE publish_date &gt; ?&quot;</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$date</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>If you take a look at <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Types\DateTimeType</span></tt> you will see that
parts of the conversion is delegated to a method on the current database platform,
which means this code works independent of the database you are using.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be aware this type conversion only works with <tt class="docutils literal"><span class="pre">Statement#bindValue()</span></tt>,
<tt class="docutils literal"><span class="pre">Connection#executeQuery()</span></tt> and <tt class="docutils literal"><span class="pre">Connection#executeUpdate()</span></tt>. It
is not supported to pass a doctrine type name to <tt class="docutils literal"><span class="pre">Statement#bindParam()</span></tt>,
because this would not work with binding by reference.</p>
</div>
</div>
<div class="section" id="list-of-parameters-conversion">
<h3>4.2.2. List of Parameters Conversion<a class="headerlink" href="#list-of-parameters-conversion" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a Doctrine 2.1 feature.</p>
</div>
<p>One rather annoying bit of missing functionality in SQL is the support for lists of parameters.
You cannot bind an array of values into a single prepared statement parameter. Consider
the following very common SQL statement:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">articles</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span>
</pre></div>
</div>
<p>Since you are using an <tt class="docutils literal"><span class="pre">IN</span></tt> expression you would really like to use it in the following way
(and I guess everybody has tried to do this once in his life, before realizing it doesn&#8217;t work):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM articles WHERE id IN (?)&#39;</span><span class="p">);</span>
<span class="c1">// THIS WILL NOT WORK:</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Implementing a generic way to handle this kind of query is tedious work. This is why most
developers fallback to inserting the parameters directly into the query, which can open
SQL injection possibilities if not handled carefully.</p>
<p>Doctrine DBAL implements a very powerful parsing process that will make this kind of prepared
statement possible natively in the binding type system.
The parsing necessarily comes with a performance overhead, but only if you really use a list of parameters.
There are two special binding types that describe a list of integers or strings:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">\Doctrine\DBAL\Connection::PARAM_INT_ARRAY</span></tt></li>
<li><tt class="docutils literal"><span class="pre">\Doctrine\DBAL\Connection::PARAM_STR_ARRAY</span></tt></li>
</ul>
<p>Using one of this constants as a type you can activate the SQLParser inside Doctrine that rewrites
the SQL and flattens the specified values into the set of parameters. Consider our previous example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM articles WHERE id IN (?)&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
    <span class="k">array</span><span class="p">(</span><span class="nx">\Doctrine\DBAL\Connection</span><span class="o">::</span><span class="na">PARAM_INT_ARRAY</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The SQL statement passed to <tt class="docutils literal"><span class="pre">Connection#executeQuery</span></tt> is not the one actually passed to the
database. It is internally rewritten to look like the following explicit code that could
be specified as well:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Same SQL WITHOUT usage of Doctrine\DBAL\Connection::PARAM_INT_ARRAY</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM articles WHERE id IN (?, ?, ?, ?, ?, ?)&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">,</span> <span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">,</span> <span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">,</span> <span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">,</span> <span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">,</span> <span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>This is much more complicated and is ugly to write generically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The parameter list support only works with <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Connection::executeQuery()</span></tt>
and <tt class="docutils literal"><span class="pre">Doctrine\DBAL\Connection::executeUpdate()</span></tt>, NOT with the binding methods of
a prepared statement.</p>
</div>
</div>
</div>
<div class="section" id="api">
<h2>4.3. API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>The DBAL contains several methods for executing queries against
your configured database for data retrieval and manipulation. Below
we&#8217;ll introduce these methods and provide some examples for each of
them.</p>
<div class="section" id="prepare">
<h3>4.3.1. prepare()<a class="headerlink" href="#prepare" title="Permalink to this headline">¶</a></h3>
<p>Prepare a given SQL statement and return the
<tt class="docutils literal"><span class="pre">\Doctrine\DBAL\Driver\Statement</span></tt> instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM user&#39;</span><span class="p">);</span>
<span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">array(</span>
<span class="cm">  0 =&gt; array(</span>
<span class="cm">    &#39;username&#39; =&gt; &#39;jwage&#39;,</span>
<span class="cm">    &#39;password&#39; =&gt; &#39;changeme</span>
<span class="cm">  )</span>
<span class="cm">)</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="executeupdate">
<h3>4.3.2. executeUpdate()<a class="headerlink" href="#executeupdate" title="Permalink to this headline">¶</a></h3>
<p>Executes a prepared statement with the given SQL and parameters and
returns the affected rows count:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$count</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s1">&#39;UPDATE user SET username = ? WHERE id = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;jwage&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="k">echo</span> <span class="nv">$count</span><span class="p">;</span> <span class="c1">// 1</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">$types</span></tt> variable contains the PDO or Doctrine Type constants
to perform necessary type conversions between actual input
parameters and expected database values. See the
<a class="reference external" href="./types#type-conversion">Types</a> section for more information.</p>
</div>
<div class="section" id="executequery">
<h3>4.3.3. executeQuery()<a class="headerlink" href="#executequery" title="Permalink to this headline">¶</a></h3>
<p>Creates a prepared statement for the given SQL and passes the
parameters to the execute method, then returning the statement:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM user WHERE username = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;jwage&#39;</span><span class="p">));</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">array(</span>
<span class="cm">  0 =&gt; &#39;jwage&#39;,</span>
<span class="cm">  1 =&gt; &#39;changeme</span>
<span class="cm">)</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">$types</span></tt> variable contains the PDO or Doctrine Type constants
to perform necessary type conversions between actual input
parameters and expected database values. See the
<a class="reference external" href="./types#type-conversion">Types</a> section for more information.</p>
</div>
<div class="section" id="fetchall">
<h3>4.3.4. fetchAll()<a class="headerlink" href="#fetchall" title="Permalink to this headline">¶</a></h3>
<p>Execute the query and fetch all results into an array:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM user&#39;</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">array(</span>
<span class="cm">  0 =&gt; array(</span>
<span class="cm">    &#39;username&#39; =&gt; &#39;jwage&#39;,</span>
<span class="cm">    &#39;password&#39; =&gt; &#39;changeme</span>
<span class="cm">  )</span>
<span class="cm">)</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="fetcharray">
<h3>4.3.5. fetchArray()<a class="headerlink" href="#fetcharray" title="Permalink to this headline">¶</a></h3>
<p>Numeric index retrieval of first result row of the given query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM user WHERE username = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;jwage&#39;</span><span class="p">));</span>

<span class="cm">/*</span>
<span class="cm">array(</span>
<span class="cm">  0 =&gt; &#39;jwage&#39;,</span>
<span class="cm">  1 =&gt; &#39;changeme</span>
<span class="cm">)</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="fetchcolumn">
<h3>4.3.6. fetchColumn()<a class="headerlink" href="#fetchcolumn" title="Permalink to this headline">¶</a></h3>
<p>Retrieve only the given column of the first result row.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">fetchColumn</span><span class="p">(</span><span class="s1">&#39;SELECT username FROM user WHERE id = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$username</span><span class="p">;</span> <span class="c1">// jwage</span>
</pre></div>
</div>
</div>
<div class="section" id="fetchassoc">
<h3>4.3.7. fetchAssoc()<a class="headerlink" href="#fetchassoc" title="Permalink to this headline">¶</a></h3>
<p>Retrieve assoc row of the first result row.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">fetchAssoc</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM user WHERE username = ?&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;jwage&#39;</span><span class="p">));</span>
<span class="cm">/*</span>
<span class="cm">array(</span>
<span class="cm">  &#39;username&#39; =&gt; &#39;jwage&#39;,</span>
<span class="cm">  &#39;password&#39; =&gt; &#39;changeme</span>
<span class="cm">)</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>There are also convenience methods for data manipulation queries:</p>
</div>
<div class="section" id="delete">
<h3>4.3.8. delete()<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p>Delete all rows of a table matching the given identifier, where
keys are column names.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
<span class="c1">// DELETE FROM user WHERE id = ? (1)</span>
</pre></div>
</div>
</div>
<div class="section" id="insert">
<h3>4.3.9. insert()<a class="headerlink" href="#insert" title="Permalink to this headline">¶</a></h3>
<p>Insert a row into the given table name using the key value pairs of
data.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jwage&#39;</span><span class="p">));</span>
<span class="c1">// INSERT INTO user (username) VALUES (?) (jwage)</span>
</pre></div>
</div>
</div>
<div class="section" id="update">
<h3>4.3.10. update()<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h3>
<p>Update all rows for the matching key value identifiers with the
given data.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jwage&#39;</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
<span class="c1">// UPDATE user (username) VALUES (?) WHERE id = ? (jwage, 1)</span>
</pre></div>
</div>
<p>By default the Doctrine DBAL does no escaping. Escaping is a very
tricky business to do automatically, therefore there is none by
default. The ORM internally escapes all your values, because it has
lots of metadata available about the current context. When you use
the Doctrine DBAL as standalone, you have to take care of this
yourself. The following methods help you with it:</p>
</div>
<div class="section" id="quote">
<h3>4.3.11. quote()<a class="headerlink" href="#quote" title="Permalink to this headline">¶</a></h3>
<p>Quote a value:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$quoted</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">quote</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
<span class="nv">$quoted</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">quote</span><span class="p">(</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span> <span class="nx">\PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="quoteidentifier">
<h3>4.3.12. quoteIdentifier()<a class="headerlink" href="#quoteidentifier" title="Permalink to this headline">¶</a></h3>
<p>Quote an identifier according to the platform details.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$quoted</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">quoteIdentifier</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
                </div>

            </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">



            
                <h3>Project Versions</h3>

                <select name="versions" id="versions">
            
            <option value="http://readthedocs.org/en/latest/">latest</option>
            
                </select>
            
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:Doctrine DBAL">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">4. Data Retrieval And Manipulation</a><ul>
<li><a class="reference internal" href="#data-retrieval">4.1. Data Retrieval</a><ul>
<li><a class="reference internal" href="#dynamic-parameters-and-prepared-statements">4.1.1. Dynamic Parameters and Prepared Statements</a></li>
<li><a class="reference internal" href="#using-prepared-statements">4.1.2. Using Prepared Statements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#binding-types">4.2. Binding Types</a><ul>
<li><a class="reference internal" href="#doctrinedbaltypes-conversion">4.2.1. DoctrineDBALTypes Conversion</a></li>
<li><a class="reference internal" href="#list-of-parameters-conversion">4.2.2. List of Parameters Conversion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">4.3. API</a><ul>
<li><a class="reference internal" href="#prepare">4.3.1. prepare()</a></li>
<li><a class="reference internal" href="#executeupdate">4.3.2. executeUpdate()</a></li>
<li><a class="reference internal" href="#executequery">4.3.3. executeQuery()</a></li>
<li><a class="reference internal" href="#fetchall">4.3.4. fetchAll()</a></li>
<li><a class="reference internal" href="#fetcharray">4.3.5. fetchArray()</a></li>
<li><a class="reference internal" href="#fetchcolumn">4.3.6. fetchColumn()</a></li>
<li><a class="reference internal" href="#fetchassoc">4.3.7. fetchAssoc()</a></li>
<li><a class="reference internal" href="#delete">4.3.8. delete()</a></li>
<li><a class="reference internal" href="#insert">4.3.9. insert()</a></li>
<li><a class="reference internal" href="#update">4.3.10. update()</a></li>
<li><a class="reference internal" href="#quote">4.3.11. quote()</a></li>
<li><a class="reference internal" href="#quoteidentifier">4.3.12. quoteIdentifier()</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="configuration.html"
                                  title="previous chapter">3. Configuration</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="query-builder.html"
                                  title="next chapter">5. SQL Query Builder</a></p>
  
    <h3>This Page</h3>
    <ul class="this-page-menu">
      
        <li><a href="../_sources/reference/data-retrieval-and-manipulation.txt"
               rel="nofollow">Show Source</a></li>
      
      
        <li><a href="https://github.com/doctrine/dbal/blob/master/docs/en/reference/data-retrieval-and-manipulation.rst">
          Show on GitHub</a></li>
        <li><a href="https://github.com/doctrine/dbal/edit/master/docs/en/reference/data-retrieval-and-manipulation.rst">
          Edit on GitHub</a></li>
      
    </ul>
  

        </div>
      </div>
          <div class="clearer"></div>
        </div>

          <div class="footer">
              &copy; Copyright 2010, Roman Borschel, Guilherme Blanco, Benjamin Eberlei, Jonathan Wage.
              Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
            <br/>
            <a target="_BLANK" href="http://www.servergrove.com"><img src="http://www.doctrine-project.org/images/servergrove.jpg" /></a>      <br/><br/>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
              <input type="hidden" name="cmd" value="_s-xclick" />
              <input type="hidden" name="hosted_button_id" value="BAE2E3XANQ77Y" />
              <input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" />
              <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
            </form>
          </div>
 <!-- End original user content -->


<br/>
<br/>
<br/>


<style type="text/css">
  #version_menu, .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0.75s;
    transition: all 0.25s 0.75s;
  }
  .footer_popout:hover #version_menu, .footer_popout:hover .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0s;
    transition: all 0.25s 0s;
  }
  .rtd-badge {
    position: fixed;
    display: block;
    bottom: 5px;
    height: 40px;
    text-indent: -9999em;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
  }
  #version_menu {
    position: fixed;
    visibility: hidden;
    opacity: 0;
    bottom: 11px;
    right: 47px;
    list-style-type: none;
    margin: 0;
  }
  .footer_popout:hover #version_menu {
    visibility: visible;
    opacity: 1;
    right: 166px;
  }
  #version_menu li {
    display: block;
    float: right;
  }
  #version_menu li a {
    display: block;
    padding: 6px 10px 4px 10px;
    margin: 7px 7px 0 0;
    font-weight: bold;
    font-size: 14px;
    height: 20px;
    line-height: 17px;
    text-decoration: none;
    color: #fff;
    background: #8ca1af url(//media.readthedocs.org//images/gradient-light.png) bottom left repeat-x;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 1px #465158;
    -moz-box-shadow: 0 1px 1px #465158;
    -webkit-box-shadow: 0 1px 1px #465158;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }
  #version_menu li a:hover {
    text-decoration: none;
    background-color: #697983;
    box-shadow: 0 1px 0px #465158;
    -moz-box-shadow: 0 1px 0px #465158;
    -webkit-box-shadow: 0 1px 0px #465158;
  }
  .rtd-badge.rtd {
    background: #3b4449 url(//media.readthedocs.org//images/badge-rtd.png) scroll top left no-repeat;
    border: 1px solid #282E32;
    width: 41px;
    right: 5px;
  }
  .footer_popout:hover .rtd-badge.rtd {
    width: 160px;
  }
  .rtd-badge.revsys { background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline-sponsored {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys-sm.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 205px;
    right: 173px;
  }

</style>
<div class="rtd_doc_footer">
  <div class="footer_popout">
    <a href="//readthedocs.org/projects/doctrine-dbal/?fromdocs=doctrine-dbal" class="rtd-badge rtd"> Brought to you by Read the Docs</a>
    <ul id="version_menu">
      
        <li><a href="/en/latest/">latest</a></li>
      
    </ul>
  </div>
</div>
<!-- RTD Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




      </div>

      <div id="bot-rcnr">
        <div class="tl"><!-- corner --></div>
      </div>
    </div>

  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
  </script>
  <script type="text/javascript">
  _uacct = "UA-288343-7";
  urchinTracker();
  </script>
  <a class="githublink" href="http://github.com/doctrine"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>